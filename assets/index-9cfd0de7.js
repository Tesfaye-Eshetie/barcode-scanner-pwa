(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}})();function ff(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lo={exports:{}},ko={},_e={exports:{}},Te={};var pr=Symbol.for("react.element"),gf=Symbol.for("react.portal"),pf=Symbol.for("react.fragment"),mf=Symbol.for("react.strict_mode"),_f=Symbol.for("react.profiler"),vf=Symbol.for("react.provider"),yf=Symbol.for("react.context"),Sf=Symbol.for("react.forward_ref"),wf=Symbol.for("react.suspense"),Cf=Symbol.for("react.memo"),xf=Symbol.for("react.lazy"),Bl=Symbol.iterator;function Tf(t){return t===null||typeof t!="object"?null:(t=Bl&&t[Bl]||t["@@iterator"],typeof t=="function"?t:null)}var Ou={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ru=Object.assign,Du={};function wn(t,e,i){this.props=t,this.context=e,this.refs=Du,this.updater=i||Ou}wn.prototype.isReactComponent={};wn.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};wn.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Mu(){}Mu.prototype=wn.prototype;function Da(t,e,i){this.props=t,this.context=e,this.refs=Du,this.updater=i||Ou}var Ma=Da.prototype=new Mu;Ma.constructor=Da;Ru(Ma,wn.prototype);Ma.isPureReactComponent=!0;var Nl=Array.isArray,Lu=Object.prototype.hasOwnProperty,La={current:null},ku={key:!0,ref:!0,__self:!0,__source:!0};function Fu(t,e,i){var n,s={},l=null,d=null;if(e!=null)for(n in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(l=""+e.key),e)Lu.call(e,n)&&!ku.hasOwnProperty(n)&&(s[n]=e[n]);var _=arguments.length-2;if(_===1)s.children=i;else if(1<_){for(var S=Array(_),w=0;w<_;w++)S[w]=arguments[w+2];s.children=S}if(t&&t.defaultProps)for(n in _=t.defaultProps,_)s[n]===void 0&&(s[n]=_[n]);return{$$typeof:pr,type:t,key:l,ref:d,props:s,_owner:La.current}}function bf(t,e){return{$$typeof:pr,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function ka(t){return typeof t=="object"&&t!==null&&t.$$typeof===pr}function Ef(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var jl=/\/+/g;function qo(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ef(""+t.key):e.toString(36)}function Ur(t,e,i,n,s){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(l){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case pr:case gf:d=!0}}if(d)return d=t,s=s(d),t=n===""?"."+qo(d,0):n,Nl(s)?(i="",t!=null&&(i=t.replace(jl,"$&/")+"/"),Ur(s,e,i,"",function(w){return w})):s!=null&&(ka(s)&&(s=bf(s,i+(!s.key||d&&d.key===s.key?"":(""+s.key).replace(jl,"$&/")+"/")+t)),e.push(s)),1;if(d=0,n=n===""?".":n+":",Nl(t))for(var _=0;_<t.length;_++){l=t[_];var S=n+qo(l,_);d+=Ur(l,e,i,S,s)}else if(S=Tf(t),typeof S=="function")for(t=S.call(t),_=0;!(l=t.next()).done;)l=l.value,S=n+qo(l,_++),d+=Ur(l,e,i,S,s);else if(l==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function wr(t,e,i){if(t==null)return t;var n=[],s=0;return Ur(t,n,"","",function(l){return e.call(i,l,s++)}),n}function If(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var rt={current:null},Wr={transition:null},Af={ReactCurrentDispatcher:rt,ReactCurrentBatchConfig:Wr,ReactCurrentOwner:La};Te.Children={map:wr,forEach:function(t,e,i){wr(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return wr(t,function(){e++}),e},toArray:function(t){return wr(t,function(e){return e})||[]},only:function(t){if(!ka(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Te.Component=wn;Te.Fragment=pf;Te.Profiler=_f;Te.PureComponent=Da;Te.StrictMode=mf;Te.Suspense=wf;Te.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Af;Te.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=Ru({},t.props),s=t.key,l=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,d=La.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var _=t.type.defaultProps;for(S in e)Lu.call(e,S)&&!ku.hasOwnProperty(S)&&(n[S]=e[S]===void 0&&_!==void 0?_[S]:e[S])}var S=arguments.length-2;if(S===1)n.children=i;else if(1<S){_=Array(S);for(var w=0;w<S;w++)_[w]=arguments[w+2];n.children=_}return{$$typeof:pr,type:t.type,key:s,ref:l,props:n,_owner:d}};Te.createContext=function(t){return t={$$typeof:yf,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:vf,_context:t},t.Consumer=t};Te.createElement=Fu;Te.createFactory=function(t){var e=Fu.bind(null,t);return e.type=t,e};Te.createRef=function(){return{current:null}};Te.forwardRef=function(t){return{$$typeof:Sf,render:t}};Te.isValidElement=ka;Te.lazy=function(t){return{$$typeof:xf,_payload:{_status:-1,_result:t},_init:If}};Te.memo=function(t,e){return{$$typeof:Cf,type:t,compare:e===void 0?null:e}};Te.startTransition=function(t){var e=Wr.transition;Wr.transition={};try{t()}finally{Wr.transition=e}};Te.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Te.useCallback=function(t,e){return rt.current.useCallback(t,e)};Te.useContext=function(t){return rt.current.useContext(t)};Te.useDebugValue=function(){};Te.useDeferredValue=function(t){return rt.current.useDeferredValue(t)};Te.useEffect=function(t,e){return rt.current.useEffect(t,e)};Te.useId=function(){return rt.current.useId()};Te.useImperativeHandle=function(t,e,i){return rt.current.useImperativeHandle(t,e,i)};Te.useInsertionEffect=function(t,e){return rt.current.useInsertionEffect(t,e)};Te.useLayoutEffect=function(t,e){return rt.current.useLayoutEffect(t,e)};Te.useMemo=function(t,e){return rt.current.useMemo(t,e)};Te.useReducer=function(t,e,i){return rt.current.useReducer(t,e,i)};Te.useRef=function(t){return rt.current.useRef(t)};Te.useState=function(t){return rt.current.useState(t)};Te.useSyncExternalStore=function(t,e,i){return rt.current.useSyncExternalStore(t,e,i)};Te.useTransition=function(){return rt.current.useTransition()};Te.version="18.2.0";(function(t){t.exports=Te})(_e);const Of=ff(_e.exports);var Rf=_e.exports,Df=Symbol.for("react.element"),Mf=Symbol.for("react.fragment"),Lf=Object.prototype.hasOwnProperty,kf=Rf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ff={key:!0,ref:!0,__self:!0,__source:!0};function Pu(t,e,i){var n,s={},l=null,d=null;i!==void 0&&(l=""+i),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(d=e.ref);for(n in e)Lf.call(e,n)&&!Ff.hasOwnProperty(n)&&(s[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Df,type:t,key:l,ref:d,props:s,_owner:kf.current}}ko.Fragment=Mf;ko.jsx=Pu;ko.jsxs=Pu;(function(t){t.exports=ko})(Lo);const Pf=Lo.exports.Fragment,ye=Lo.exports.jsx,ci=Lo.exports.jsxs;var Ms={},Bu={exports:{}},yt={},Nu={exports:{}},ju={};(function(t){function e(h,m){var g=h.length;h.push(m);e:for(;0<g;){var p=g-1>>>1,v=h[p];if(0<s(v,m))h[p]=m,h[g]=v,g=p;else break e}}function i(h){return h.length===0?null:h[0]}function n(h){if(h.length===0)return null;var m=h[0],g=h.pop();if(g!==m){h[0]=g;e:for(var p=0,v=h.length,C=v>>>1;p<C;){var x=2*(p+1)-1,b=h[x],E=x+1,O=h[E];if(0>s(b,g))E<v&&0>s(O,b)?(h[p]=O,h[E]=g,p=E):(h[p]=b,h[x]=g,p=x);else if(E<v&&0>s(O,g))h[p]=O,h[E]=g,p=E;else break e}}return m}function s(h,m){var g=h.sortIndex-m.sortIndex;return g!==0?g:h.id-m.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var d=Date,_=d.now();t.unstable_now=function(){return d.now()-_}}var S=[],w=[],T=1,A=null,I=3,k=!1,B=!1,F=!1,z=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(h){for(var m=i(w);m!==null;){if(m.callback===null)n(w);else if(m.startTime<=h)n(w),m.sortIndex=m.expirationTime,e(S,m);else break;m=i(w)}}function $(h){if(F=!1,L(h),!B)if(i(S)!==null)B=!0,r(ie);else{var m=i(w);m!==null&&o($,m.startTime-h)}}function ie(h,m){B=!1,F&&(F=!1,D(y),y=-1),k=!0;var g=I;try{for(L(m),A=i(S);A!==null&&(!(A.expirationTime>m)||h&&!be());){var p=A.callback;if(typeof p=="function"){A.callback=null,I=A.priorityLevel;var v=p(A.expirationTime<=m);m=t.unstable_now(),typeof v=="function"?A.callback=v:A===i(S)&&n(S),L(m)}else n(S);A=i(S)}if(A!==null)var C=!0;else{var x=i(w);x!==null&&o($,x.startTime-m),C=!1}return C}finally{A=null,I=g,k=!1}}var ne=!1,J=null,y=-1,de=5,ge=-1;function be(){return!(t.unstable_now()-ge<de)}function u(){if(J!==null){var h=t.unstable_now();ge=h;var m=!0;try{m=J(!0,h)}finally{m?a():(ne=!1,J=null)}}else ne=!1}var a;if(typeof R=="function")a=function(){R(u)};else if(typeof MessageChannel<"u"){var c=new MessageChannel,f=c.port2;c.port1.onmessage=u,a=function(){f.postMessage(null)}}else a=function(){z(u,0)};function r(h){J=h,ne||(ne=!0,a())}function o(h,m){y=z(function(){h(t.unstable_now())},m)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(h){h.callback=null},t.unstable_continueExecution=function(){B||k||(B=!0,r(ie))},t.unstable_forceFrameRate=function(h){0>h||125<h?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<h?Math.floor(1e3/h):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return i(S)},t.unstable_next=function(h){switch(I){case 1:case 2:case 3:var m=3;break;default:m=I}var g=I;I=m;try{return h()}finally{I=g}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(h,m){switch(h){case 1:case 2:case 3:case 4:case 5:break;default:h=3}var g=I;I=h;try{return m()}finally{I=g}},t.unstable_scheduleCallback=function(h,m,g){var p=t.unstable_now();switch(typeof g=="object"&&g!==null?(g=g.delay,g=typeof g=="number"&&0<g?p+g:p):g=p,h){case 1:var v=-1;break;case 2:v=250;break;case 5:v=1073741823;break;case 4:v=1e4;break;default:v=5e3}return v=g+v,h={id:T++,callback:m,priorityLevel:h,startTime:g,expirationTime:v,sortIndex:-1},g>p?(h.sortIndex=g,e(w,h),i(S)===null&&h===i(w)&&(F?(D(y),y=-1):F=!0,o($,g-p))):(h.sortIndex=v,e(S,h),B||k||(B=!0,r(ie))),h},t.unstable_shouldYield=be,t.unstable_wrapCallback=function(h){var m=I;return function(){var g=I;I=m;try{return h.apply(this,arguments)}finally{I=g}}}})(ju);(function(t){t.exports=ju})(Nu);var Vu=_e.exports,vt=Nu.exports;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Uu=new Set,Jn={};function Ui(t,e){fn(t,e),fn(t+"Capture",e)}function fn(t,e){for(Jn[t]=e,t=0;t<e.length;t++)Uu.add(e[t])}var Zt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ls=Object.prototype.hasOwnProperty,Bf=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vl={},Ul={};function Nf(t){return Ls.call(Ul,t)?!0:Ls.call(Vl,t)?!1:Bf.test(t)?Ul[t]=!0:(Vl[t]=!0,!1)}function jf(t,e,i,n){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Vf(t,e,i,n){if(e===null||typeof e>"u"||jf(t,e,i,n))return!0;if(n)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ot(t,e,i,n,s,l,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=l,this.removeEmptyString=d}var Ke={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ke[t]=new ot(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ke[e]=new ot(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ke[t]=new ot(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ke[t]=new ot(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ke[t]=new ot(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ke[t]=new ot(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ke[t]=new ot(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ke[t]=new ot(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ke[t]=new ot(t,5,!1,t.toLowerCase(),null,!1,!1)});var Fa=/[\-:]([a-z])/g;function Pa(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Fa,Pa);Ke[e]=new ot(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Fa,Pa);Ke[e]=new ot(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Fa,Pa);Ke[e]=new ot(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ke[t]=new ot(t,1,!1,t.toLowerCase(),null,!1,!1)});Ke.xlinkHref=new ot("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ke[t]=new ot(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ba(t,e,i,n){var s=Ke.hasOwnProperty(e)?Ke[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Vf(e,i,s,n)&&(i=null),n||s===null?Nf(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):s.mustUseProperty?t[s.propertyName]=i===null?s.type===3?!1:"":i:(e=s.attributeName,n=s.attributeNamespace,i===null?t.removeAttribute(e):(s=s.type,i=s===3||s===4&&i===!0?"":""+i,n?t.setAttributeNS(n,e,i):t.setAttribute(e,i))))}var ti=Vu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Cr=Symbol.for("react.element"),$i=Symbol.for("react.portal"),Ki=Symbol.for("react.fragment"),Na=Symbol.for("react.strict_mode"),ks=Symbol.for("react.profiler"),Wu=Symbol.for("react.provider"),Gu=Symbol.for("react.context"),ja=Symbol.for("react.forward_ref"),Fs=Symbol.for("react.suspense"),Ps=Symbol.for("react.suspense_list"),Va=Symbol.for("react.memo"),ni=Symbol.for("react.lazy"),zu=Symbol.for("react.offscreen"),Wl=Symbol.iterator;function In(t){return t===null||typeof t!="object"?null:(t=Wl&&t[Wl]||t["@@iterator"],typeof t=="function"?t:null)}var Be=Object.assign,es;function Nn(t){if(es===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);es=e&&e[1]||""}return`
`+es+t}var ts=!1;function is(t,e){if(!t||ts)return"";ts=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var n=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){n=w}t.call(e.prototype)}else{try{throw Error()}catch(w){n=w}t()}}catch(w){if(w&&n&&typeof w.stack=="string"){for(var s=w.stack.split(`
`),l=n.stack.split(`
`),d=s.length-1,_=l.length-1;1<=d&&0<=_&&s[d]!==l[_];)_--;for(;1<=d&&0<=_;d--,_--)if(s[d]!==l[_]){if(d!==1||_!==1)do if(d--,_--,0>_||s[d]!==l[_]){var S=`
`+s[d].replace(" at new "," at ");return t.displayName&&S.includes("<anonymous>")&&(S=S.replace("<anonymous>",t.displayName)),S}while(1<=d&&0<=_);break}}}finally{ts=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?Nn(t):""}function Uf(t){switch(t.tag){case 5:return Nn(t.type);case 16:return Nn("Lazy");case 13:return Nn("Suspense");case 19:return Nn("SuspenseList");case 0:case 2:case 15:return t=is(t.type,!1),t;case 11:return t=is(t.type.render,!1),t;case 1:return t=is(t.type,!0),t;default:return""}}function Bs(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ki:return"Fragment";case $i:return"Portal";case ks:return"Profiler";case Na:return"StrictMode";case Fs:return"Suspense";case Ps:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Gu:return(t.displayName||"Context")+".Consumer";case Wu:return(t._context.displayName||"Context")+".Provider";case ja:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Va:return e=t.displayName||null,e!==null?e:Bs(t.type)||"Memo";case ni:e=t._payload,t=t._init;try{return Bs(t(e))}catch{}}return null}function Wf(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bs(e);case 8:return e===Na?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function yi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Hu(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Gf(t){var e=Hu(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var s=i.get,l=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(d){n=""+d,l.call(this,d)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(d){n=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function xr(t){t._valueTracker||(t._valueTracker=Gf(t))}function Yu(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),n="";return t&&(n=Hu(t)?t.checked?"true":"false":t.value),t=n,t!==i?(e.setValue(t),!0):!1}function to(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ns(t,e){var i=e.checked;return Be({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function Gl(t,e){var i=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;i=yi(e.value!=null?e.value:i),t._wrapperState={initialChecked:n,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Xu(t,e){e=e.checked,e!=null&&Ba(t,"checked",e,!1)}function js(t,e){Xu(t,e);var i=yi(e.value),n=e.type;if(i!=null)n==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Vs(t,e.type,i):e.hasOwnProperty("defaultValue")&&Vs(t,e.type,yi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function zl(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function Vs(t,e,i){(e!=="number"||to(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var jn=Array.isArray;function an(t,e,i,n){if(t=t.options,e){e={};for(var s=0;s<i.length;s++)e["$"+i[s]]=!0;for(i=0;i<t.length;i++)s=e.hasOwnProperty("$"+t[i].value),t[i].selected!==s&&(t[i].selected=s),s&&n&&(t[i].defaultSelected=!0)}else{for(i=""+yi(i),e=null,s=0;s<t.length;s++){if(t[s].value===i){t[s].selected=!0,n&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Us(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return Be({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Hl(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(ae(92));if(jn(i)){if(1<i.length)throw Error(ae(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:yi(i)}}function $u(t,e){var i=yi(e.value),n=yi(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),n!=null&&(t.defaultValue=""+n)}function Yl(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Ku(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ws(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Ku(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Tr,Zu=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,n,s){MSApp.execUnsafeLocalFunction(function(){return t(e,i,n,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Tr=Tr||document.createElement("div"),Tr.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Tr.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qn(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var Wn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zf=["Webkit","ms","Moz","O"];Object.keys(Wn).forEach(function(t){zf.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Wn[e]=Wn[t]})});function Ju(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||Wn.hasOwnProperty(t)&&Wn[t]?(""+e).trim():e+"px"}function Qu(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var n=i.indexOf("--")===0,s=Ju(i,e[i],n);i==="float"&&(i="cssFloat"),n?t.setProperty(i,s):t[i]=s}}var Hf=Be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gs(t,e){if(e){if(Hf[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function zs(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hs=null;function Ua(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ys=null,ln=null,cn=null;function Xl(t){if(t=vr(t)){if(typeof Ys!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=jo(e),Ys(t.stateNode,t.type,e))}}function qu(t){ln?cn?cn.push(t):cn=[t]:ln=t}function eh(){if(ln){var t=ln,e=cn;if(cn=ln=null,Xl(t),e)for(t=0;t<e.length;t++)Xl(e[t])}}function th(t,e){return t(e)}function ih(){}var ns=!1;function nh(t,e,i){if(ns)return t(e,i);ns=!0;try{return th(t,e,i)}finally{ns=!1,(ln!==null||cn!==null)&&(ih(),eh())}}function qn(t,e){var i=t.stateNode;if(i===null)return null;var n=jo(i);if(n===null)return null;i=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(ae(231,e,typeof i));return i}var Xs=!1;if(Zt)try{var An={};Object.defineProperty(An,"passive",{get:function(){Xs=!0}}),window.addEventListener("test",An,An),window.removeEventListener("test",An,An)}catch{Xs=!1}function Yf(t,e,i,n,s,l,d,_,S){var w=Array.prototype.slice.call(arguments,3);try{e.apply(i,w)}catch(T){this.onError(T)}}var Gn=!1,io=null,no=!1,$s=null,Xf={onError:function(t){Gn=!0,io=t}};function $f(t,e,i,n,s,l,d,_,S){Gn=!1,io=null,Yf.apply(Xf,arguments)}function Kf(t,e,i,n,s,l,d,_,S){if($f.apply(this,arguments),Gn){if(Gn){var w=io;Gn=!1,io=null}else throw Error(ae(198));no||(no=!0,$s=w)}}function Wi(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function rh(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function $l(t){if(Wi(t)!==t)throw Error(ae(188))}function Zf(t){var e=t.alternate;if(!e){if(e=Wi(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var i=t,n=e;;){var s=i.return;if(s===null)break;var l=s.alternate;if(l===null){if(n=s.return,n!==null){i=n;continue}break}if(s.child===l.child){for(l=s.child;l;){if(l===i)return $l(s),t;if(l===n)return $l(s),e;l=l.sibling}throw Error(ae(188))}if(i.return!==n.return)i=s,n=l;else{for(var d=!1,_=s.child;_;){if(_===i){d=!0,i=s,n=l;break}if(_===n){d=!0,n=s,i=l;break}_=_.sibling}if(!d){for(_=l.child;_;){if(_===i){d=!0,i=l,n=s;break}if(_===n){d=!0,n=l,i=s;break}_=_.sibling}if(!d)throw Error(ae(189))}}if(i.alternate!==n)throw Error(ae(190))}if(i.tag!==3)throw Error(ae(188));return i.stateNode.current===i?t:e}function oh(t){return t=Zf(t),t!==null?sh(t):null}function sh(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=sh(t);if(e!==null)return e;t=t.sibling}return null}var ah=vt.unstable_scheduleCallback,Kl=vt.unstable_cancelCallback,Jf=vt.unstable_shouldYield,Qf=vt.unstable_requestPaint,je=vt.unstable_now,qf=vt.unstable_getCurrentPriorityLevel,Wa=vt.unstable_ImmediatePriority,lh=vt.unstable_UserBlockingPriority,ro=vt.unstable_NormalPriority,eg=vt.unstable_LowPriority,ch=vt.unstable_IdlePriority,Fo=null,Vt=null;function tg(t){if(Vt&&typeof Vt.onCommitFiberRoot=="function")try{Vt.onCommitFiberRoot(Fo,t,void 0,(t.current.flags&128)===128)}catch{}}var Lt=Math.clz32?Math.clz32:rg,ig=Math.log,ng=Math.LN2;function rg(t){return t>>>=0,t===0?32:31-(ig(t)/ng|0)|0}var br=64,Er=4194304;function Vn(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function oo(t,e){var i=t.pendingLanes;if(i===0)return 0;var n=0,s=t.suspendedLanes,l=t.pingedLanes,d=i&268435455;if(d!==0){var _=d&~s;_!==0?n=Vn(_):(l&=d,l!==0&&(n=Vn(l)))}else d=i&~s,d!==0?n=Vn(d):l!==0&&(n=Vn(l));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,l=e&-e,s>=l||s===16&&(l&4194240)!==0))return e;if(n&4&&(n|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)i=31-Lt(e),s=1<<i,n|=t[i],e&=~s;return n}function og(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sg(t,e){for(var i=t.suspendedLanes,n=t.pingedLanes,s=t.expirationTimes,l=t.pendingLanes;0<l;){var d=31-Lt(l),_=1<<d,S=s[d];S===-1?(!(_&i)||_&n)&&(s[d]=og(_,e)):S<=e&&(t.expiredLanes|=_),l&=~_}}function Ks(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function uh(){var t=br;return br<<=1,!(br&4194240)&&(br=64),t}function rs(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function mr(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lt(e),t[e]=i}function ag(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<i;){var s=31-Lt(i),l=1<<s;e[s]=0,n[s]=-1,t[s]=-1,i&=~l}}function Ga(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var n=31-Lt(i),s=1<<n;s&e|t[n]&e&&(t[n]|=e),i&=~s}}var Ae=0;function hh(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var dh,za,fh,gh,ph,Zs=!1,Ir=[],ui=null,hi=null,di=null,er=new Map,tr=new Map,oi=[],lg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zl(t,e){switch(t){case"focusin":case"focusout":ui=null;break;case"dragenter":case"dragleave":hi=null;break;case"mouseover":case"mouseout":di=null;break;case"pointerover":case"pointerout":er.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":tr.delete(e.pointerId)}}function On(t,e,i,n,s,l){return t===null||t.nativeEvent!==l?(t={blockedOn:e,domEventName:i,eventSystemFlags:n,nativeEvent:l,targetContainers:[s]},e!==null&&(e=vr(e),e!==null&&za(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function cg(t,e,i,n,s){switch(e){case"focusin":return ui=On(ui,t,e,i,n,s),!0;case"dragenter":return hi=On(hi,t,e,i,n,s),!0;case"mouseover":return di=On(di,t,e,i,n,s),!0;case"pointerover":var l=s.pointerId;return er.set(l,On(er.get(l)||null,t,e,i,n,s)),!0;case"gotpointercapture":return l=s.pointerId,tr.set(l,On(tr.get(l)||null,t,e,i,n,s)),!0}return!1}function mh(t){var e=Ai(t.target);if(e!==null){var i=Wi(e);if(i!==null){if(e=i.tag,e===13){if(e=rh(i),e!==null){t.blockedOn=e,ph(t.priority,function(){fh(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Gr(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=Js(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var n=new i.constructor(i.type,i);Hs=n,i.target.dispatchEvent(n),Hs=null}else return e=vr(i),e!==null&&za(e),t.blockedOn=i,!1;e.shift()}return!0}function Jl(t,e,i){Gr(t)&&i.delete(e)}function ug(){Zs=!1,ui!==null&&Gr(ui)&&(ui=null),hi!==null&&Gr(hi)&&(hi=null),di!==null&&Gr(di)&&(di=null),er.forEach(Jl),tr.forEach(Jl)}function Rn(t,e){t.blockedOn===e&&(t.blockedOn=null,Zs||(Zs=!0,vt.unstable_scheduleCallback(vt.unstable_NormalPriority,ug)))}function ir(t){function e(s){return Rn(s,t)}if(0<Ir.length){Rn(Ir[0],t);for(var i=1;i<Ir.length;i++){var n=Ir[i];n.blockedOn===t&&(n.blockedOn=null)}}for(ui!==null&&Rn(ui,t),hi!==null&&Rn(hi,t),di!==null&&Rn(di,t),er.forEach(e),tr.forEach(e),i=0;i<oi.length;i++)n=oi[i],n.blockedOn===t&&(n.blockedOn=null);for(;0<oi.length&&(i=oi[0],i.blockedOn===null);)mh(i),i.blockedOn===null&&oi.shift()}var un=ti.ReactCurrentBatchConfig,so=!0;function hg(t,e,i,n){var s=Ae,l=un.transition;un.transition=null;try{Ae=1,Ha(t,e,i,n)}finally{Ae=s,un.transition=l}}function dg(t,e,i,n){var s=Ae,l=un.transition;un.transition=null;try{Ae=4,Ha(t,e,i,n)}finally{Ae=s,un.transition=l}}function Ha(t,e,i,n){if(so){var s=Js(t,e,i,n);if(s===null)gs(t,e,n,ao,i),Zl(t,n);else if(cg(s,t,e,i,n))n.stopPropagation();else if(Zl(t,n),e&4&&-1<lg.indexOf(t)){for(;s!==null;){var l=vr(s);if(l!==null&&dh(l),l=Js(t,e,i,n),l===null&&gs(t,e,n,ao,i),l===s)break;s=l}s!==null&&n.stopPropagation()}else gs(t,e,n,null,i)}}var ao=null;function Js(t,e,i,n){if(ao=null,t=Ua(n),t=Ai(t),t!==null)if(e=Wi(t),e===null)t=null;else if(i=e.tag,i===13){if(t=rh(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ao=t,null}function _h(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qf()){case Wa:return 1;case lh:return 4;case ro:case eg:return 16;case ch:return 536870912;default:return 16}default:return 16}}var ai=null,Ya=null,zr=null;function vh(){if(zr)return zr;var t,e=Ya,i=e.length,n,s="value"in ai?ai.value:ai.textContent,l=s.length;for(t=0;t<i&&e[t]===s[t];t++);var d=i-t;for(n=1;n<=d&&e[i-n]===s[l-n];n++);return zr=s.slice(t,1<n?1-n:void 0)}function Hr(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ar(){return!0}function Ql(){return!1}function St(t){function e(i,n,s,l,d){this._reactName=i,this._targetInst=s,this.type=n,this.nativeEvent=l,this.target=d,this.currentTarget=null;for(var _ in t)t.hasOwnProperty(_)&&(i=t[_],this[_]=i?i(l):l[_]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Ar:Ql,this.isPropagationStopped=Ql,this}return Be(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Ar)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Ar)},persist:function(){},isPersistent:Ar}),e}var Cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xa=St(Cn),_r=Be({},Cn,{view:0,detail:0}),fg=St(_r),os,ss,Dn,Po=Be({},_r,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$a,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Dn&&(Dn&&t.type==="mousemove"?(os=t.screenX-Dn.screenX,ss=t.screenY-Dn.screenY):ss=os=0,Dn=t),os)},movementY:function(t){return"movementY"in t?t.movementY:ss}}),ql=St(Po),gg=Be({},Po,{dataTransfer:0}),pg=St(gg),mg=Be({},_r,{relatedTarget:0}),as=St(mg),_g=Be({},Cn,{animationName:0,elapsedTime:0,pseudoElement:0}),vg=St(_g),yg=Be({},Cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Sg=St(yg),wg=Be({},Cn,{data:0}),ec=St(wg),Cg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bg(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Tg[t])?!!e[t]:!1}function $a(){return bg}var Eg=Be({},_r,{key:function(t){if(t.key){var e=Cg[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Hr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?xg[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$a,charCode:function(t){return t.type==="keypress"?Hr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Hr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ig=St(Eg),Ag=Be({},Po,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tc=St(Ag),Og=Be({},_r,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$a}),Rg=St(Og),Dg=Be({},Cn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mg=St(Dg),Lg=Be({},Po,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kg=St(Lg),Fg=[9,13,27,32],Ka=Zt&&"CompositionEvent"in window,zn=null;Zt&&"documentMode"in document&&(zn=document.documentMode);var Pg=Zt&&"TextEvent"in window&&!zn,yh=Zt&&(!Ka||zn&&8<zn&&11>=zn),ic=String.fromCharCode(32),nc=!1;function Sh(t,e){switch(t){case"keyup":return Fg.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wh(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zi=!1;function Bg(t,e){switch(t){case"compositionend":return wh(e);case"keypress":return e.which!==32?null:(nc=!0,ic);case"textInput":return t=e.data,t===ic&&nc?null:t;default:return null}}function Ng(t,e){if(Zi)return t==="compositionend"||!Ka&&Sh(t,e)?(t=vh(),zr=Ya=ai=null,Zi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yh&&e.locale!=="ko"?null:e.data;default:return null}}var jg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!jg[t.type]:e==="textarea"}function Ch(t,e,i,n){qu(n),e=lo(e,"onChange"),0<e.length&&(i=new Xa("onChange","change",null,i,n),t.push({event:i,listeners:e}))}var Hn=null,nr=null;function Vg(t){Lh(t,0)}function Bo(t){var e=qi(t);if(Yu(e))return t}function Ug(t,e){if(t==="change")return e}var xh=!1;if(Zt){var ls;if(Zt){var cs="oninput"in document;if(!cs){var oc=document.createElement("div");oc.setAttribute("oninput","return;"),cs=typeof oc.oninput=="function"}ls=cs}else ls=!1;xh=ls&&(!document.documentMode||9<document.documentMode)}function sc(){Hn&&(Hn.detachEvent("onpropertychange",Th),nr=Hn=null)}function Th(t){if(t.propertyName==="value"&&Bo(nr)){var e=[];Ch(e,nr,t,Ua(t)),nh(Vg,e)}}function Wg(t,e,i){t==="focusin"?(sc(),Hn=e,nr=i,Hn.attachEvent("onpropertychange",Th)):t==="focusout"&&sc()}function Gg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bo(nr)}function zg(t,e){if(t==="click")return Bo(e)}function Hg(t,e){if(t==="input"||t==="change")return Bo(e)}function Yg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ft=typeof Object.is=="function"?Object.is:Yg;function rr(t,e){if(Ft(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var s=i[n];if(!Ls.call(e,s)||!Ft(t[s],e[s]))return!1}return!0}function ac(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function lc(t,e){var i=ac(t);t=0;for(var n;i;){if(i.nodeType===3){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ac(i)}}function bh(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?bh(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Eh(){for(var t=window,e=to();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=to(t.document)}return e}function Za(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Xg(t){var e=Eh(),i=t.focusedElem,n=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&bh(i.ownerDocument.documentElement,i)){if(n!==null&&Za(i)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=i.textContent.length,l=Math.min(n.start,s);n=n.end===void 0?l:Math.min(n.end,s),!t.extend&&l>n&&(s=n,n=l,l=s),s=lc(i,l);var d=lc(i,n);s&&d&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),l>n?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var $g=Zt&&"documentMode"in document&&11>=document.documentMode,Ji=null,Qs=null,Yn=null,qs=!1;function cc(t,e,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;qs||Ji==null||Ji!==to(n)||(n=Ji,"selectionStart"in n&&Za(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Yn&&rr(Yn,n)||(Yn=n,n=lo(Qs,"onSelect"),0<n.length&&(e=new Xa("onSelect","select",null,e,i),t.push({event:e,listeners:n}),e.target=Ji)))}function Or(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var Qi={animationend:Or("Animation","AnimationEnd"),animationiteration:Or("Animation","AnimationIteration"),animationstart:Or("Animation","AnimationStart"),transitionend:Or("Transition","TransitionEnd")},us={},Ih={};Zt&&(Ih=document.createElement("div").style,"AnimationEvent"in window||(delete Qi.animationend.animation,delete Qi.animationiteration.animation,delete Qi.animationstart.animation),"TransitionEvent"in window||delete Qi.transitionend.transition);function No(t){if(us[t])return us[t];if(!Qi[t])return t;var e=Qi[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in Ih)return us[t]=e[i];return t}var Ah=No("animationend"),Oh=No("animationiteration"),Rh=No("animationstart"),Dh=No("transitionend"),Mh=new Map,uc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(t,e){Mh.set(t,e),Ui(e,[t])}for(var hs=0;hs<uc.length;hs++){var ds=uc[hs],Kg=ds.toLowerCase(),Zg=ds[0].toUpperCase()+ds.slice(1);wi(Kg,"on"+Zg)}wi(Ah,"onAnimationEnd");wi(Oh,"onAnimationIteration");wi(Rh,"onAnimationStart");wi("dblclick","onDoubleClick");wi("focusin","onFocus");wi("focusout","onBlur");wi(Dh,"onTransitionEnd");fn("onMouseEnter",["mouseout","mouseover"]);fn("onMouseLeave",["mouseout","mouseover"]);fn("onPointerEnter",["pointerout","pointerover"]);fn("onPointerLeave",["pointerout","pointerover"]);Ui("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ui("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ui("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ui("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ui("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ui("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Un="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jg=new Set("cancel close invalid load scroll toggle".split(" ").concat(Un));function hc(t,e,i){var n=t.type||"unknown-event";t.currentTarget=i,Kf(n,e,void 0,t),t.currentTarget=null}function Lh(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var n=t[i],s=n.event;n=n.listeners;e:{var l=void 0;if(e)for(var d=n.length-1;0<=d;d--){var _=n[d],S=_.instance,w=_.currentTarget;if(_=_.listener,S!==l&&s.isPropagationStopped())break e;hc(s,_,w),l=S}else for(d=0;d<n.length;d++){if(_=n[d],S=_.instance,w=_.currentTarget,_=_.listener,S!==l&&s.isPropagationStopped())break e;hc(s,_,w),l=S}}}if(no)throw t=$s,no=!1,$s=null,t}function Re(t,e){var i=e[ra];i===void 0&&(i=e[ra]=new Set);var n=t+"__bubble";i.has(n)||(kh(e,t,2,!1),i.add(n))}function fs(t,e,i){var n=0;e&&(n|=4),kh(i,t,n,e)}var Rr="_reactListening"+Math.random().toString(36).slice(2);function or(t){if(!t[Rr]){t[Rr]=!0,Uu.forEach(function(i){i!=="selectionchange"&&(Jg.has(i)||fs(i,!1,t),fs(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Rr]||(e[Rr]=!0,fs("selectionchange",!1,e))}}function kh(t,e,i,n){switch(_h(e)){case 1:var s=hg;break;case 4:s=dg;break;default:s=Ha}i=s.bind(null,e,i,t),s=void 0,!Xs||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?t.addEventListener(e,i,{capture:!0,passive:s}):t.addEventListener(e,i,!0):s!==void 0?t.addEventListener(e,i,{passive:s}):t.addEventListener(e,i,!1)}function gs(t,e,i,n,s){var l=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var _=n.stateNode.containerInfo;if(_===s||_.nodeType===8&&_.parentNode===s)break;if(d===4)for(d=n.return;d!==null;){var S=d.tag;if((S===3||S===4)&&(S=d.stateNode.containerInfo,S===s||S.nodeType===8&&S.parentNode===s))return;d=d.return}for(;_!==null;){if(d=Ai(_),d===null)return;if(S=d.tag,S===5||S===6){n=l=d;continue e}_=_.parentNode}}n=n.return}nh(function(){var w=l,T=Ua(i),A=[];e:{var I=Mh.get(t);if(I!==void 0){var k=Xa,B=t;switch(t){case"keypress":if(Hr(i)===0)break e;case"keydown":case"keyup":k=Ig;break;case"focusin":B="focus",k=as;break;case"focusout":B="blur",k=as;break;case"beforeblur":case"afterblur":k=as;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=ql;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=pg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=Rg;break;case Ah:case Oh:case Rh:k=vg;break;case Dh:k=Mg;break;case"scroll":k=fg;break;case"wheel":k=kg;break;case"copy":case"cut":case"paste":k=Sg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=tc}var F=(e&4)!==0,z=!F&&t==="scroll",D=F?I!==null?I+"Capture":null:I;F=[];for(var R=w,L;R!==null;){L=R;var $=L.stateNode;if(L.tag===5&&$!==null&&(L=$,D!==null&&($=qn(R,D),$!=null&&F.push(sr(R,$,L)))),z)break;R=R.return}0<F.length&&(I=new k(I,B,null,i,T),A.push({event:I,listeners:F}))}}if(!(e&7)){e:{if(I=t==="mouseover"||t==="pointerover",k=t==="mouseout"||t==="pointerout",I&&i!==Hs&&(B=i.relatedTarget||i.fromElement)&&(Ai(B)||B[Jt]))break e;if((k||I)&&(I=T.window===T?T:(I=T.ownerDocument)?I.defaultView||I.parentWindow:window,k?(B=i.relatedTarget||i.toElement,k=w,B=B?Ai(B):null,B!==null&&(z=Wi(B),B!==z||B.tag!==5&&B.tag!==6)&&(B=null)):(k=null,B=w),k!==B)){if(F=ql,$="onMouseLeave",D="onMouseEnter",R="mouse",(t==="pointerout"||t==="pointerover")&&(F=tc,$="onPointerLeave",D="onPointerEnter",R="pointer"),z=k==null?I:qi(k),L=B==null?I:qi(B),I=new F($,R+"leave",k,i,T),I.target=z,I.relatedTarget=L,$=null,Ai(T)===w&&(F=new F(D,R+"enter",B,i,T),F.target=L,F.relatedTarget=z,$=F),z=$,k&&B)t:{for(F=k,D=B,R=0,L=F;L;L=Xi(L))R++;for(L=0,$=D;$;$=Xi($))L++;for(;0<R-L;)F=Xi(F),R--;for(;0<L-R;)D=Xi(D),L--;for(;R--;){if(F===D||D!==null&&F===D.alternate)break t;F=Xi(F),D=Xi(D)}F=null}else F=null;k!==null&&dc(A,I,k,F,!1),B!==null&&z!==null&&dc(A,z,B,F,!0)}}e:{if(I=w?qi(w):window,k=I.nodeName&&I.nodeName.toLowerCase(),k==="select"||k==="input"&&I.type==="file")var ie=Ug;else if(rc(I))if(xh)ie=Hg;else{ie=Gg;var ne=Wg}else(k=I.nodeName)&&k.toLowerCase()==="input"&&(I.type==="checkbox"||I.type==="radio")&&(ie=zg);if(ie&&(ie=ie(t,w))){Ch(A,ie,i,T);break e}ne&&ne(t,I,w),t==="focusout"&&(ne=I._wrapperState)&&ne.controlled&&I.type==="number"&&Vs(I,"number",I.value)}switch(ne=w?qi(w):window,t){case"focusin":(rc(ne)||ne.contentEditable==="true")&&(Ji=ne,Qs=w,Yn=null);break;case"focusout":Yn=Qs=Ji=null;break;case"mousedown":qs=!0;break;case"contextmenu":case"mouseup":case"dragend":qs=!1,cc(A,i,T);break;case"selectionchange":if($g)break;case"keydown":case"keyup":cc(A,i,T)}var J;if(Ka)e:{switch(t){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Zi?Sh(t,i)&&(y="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(y="onCompositionStart");y&&(yh&&i.locale!=="ko"&&(Zi||y!=="onCompositionStart"?y==="onCompositionEnd"&&Zi&&(J=vh()):(ai=T,Ya="value"in ai?ai.value:ai.textContent,Zi=!0)),ne=lo(w,y),0<ne.length&&(y=new ec(y,t,null,i,T),A.push({event:y,listeners:ne}),J?y.data=J:(J=wh(i),J!==null&&(y.data=J)))),(J=Pg?Bg(t,i):Ng(t,i))&&(w=lo(w,"onBeforeInput"),0<w.length&&(T=new ec("onBeforeInput","beforeinput",null,i,T),A.push({event:T,listeners:w}),T.data=J))}Lh(A,e)})}function sr(t,e,i){return{instance:t,listener:e,currentTarget:i}}function lo(t,e){for(var i=e+"Capture",n=[];t!==null;){var s=t,l=s.stateNode;s.tag===5&&l!==null&&(s=l,l=qn(t,i),l!=null&&n.unshift(sr(t,l,s)),l=qn(t,e),l!=null&&n.push(sr(t,l,s))),t=t.return}return n}function Xi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function dc(t,e,i,n,s){for(var l=e._reactName,d=[];i!==null&&i!==n;){var _=i,S=_.alternate,w=_.stateNode;if(S!==null&&S===n)break;_.tag===5&&w!==null&&(_=w,s?(S=qn(i,l),S!=null&&d.unshift(sr(i,S,_))):s||(S=qn(i,l),S!=null&&d.push(sr(i,S,_)))),i=i.return}d.length!==0&&t.push({event:e,listeners:d})}var Qg=/\r\n?/g,qg=/\u0000|\uFFFD/g;function fc(t){return(typeof t=="string"?t:""+t).replace(Qg,`
`).replace(qg,"")}function Dr(t,e,i){if(e=fc(e),fc(t)!==e&&i)throw Error(ae(425))}function co(){}var ea=null,ta=null;function ia(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var na=typeof setTimeout=="function"?setTimeout:void 0,ep=typeof clearTimeout=="function"?clearTimeout:void 0,gc=typeof Promise=="function"?Promise:void 0,tp=typeof queueMicrotask=="function"?queueMicrotask:typeof gc<"u"?function(t){return gc.resolve(null).then(t).catch(ip)}:na;function ip(t){setTimeout(function(){throw t})}function ps(t,e){var i=e,n=0;do{var s=i.nextSibling;if(t.removeChild(i),s&&s.nodeType===8)if(i=s.data,i==="/$"){if(n===0){t.removeChild(s),ir(e);return}n--}else i!=="$"&&i!=="$?"&&i!=="$!"||n++;i=s}while(i);ir(e)}function fi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function pc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var xn=Math.random().toString(36).slice(2),jt="__reactFiber$"+xn,ar="__reactProps$"+xn,Jt="__reactContainer$"+xn,ra="__reactEvents$"+xn,np="__reactListeners$"+xn,rp="__reactHandles$"+xn;function Ai(t){var e=t[jt];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Jt]||i[jt]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=pc(t);t!==null;){if(i=t[jt])return i;t=pc(t)}return e}t=i,i=t.parentNode}return null}function vr(t){return t=t[jt]||t[Jt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function qi(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function jo(t){return t[ar]||null}var oa=[],en=-1;function Ci(t){return{current:t}}function Me(t){0>en||(t.current=oa[en],oa[en]=null,en--)}function Oe(t,e){en++,oa[en]=t.current,t.current=e}var Si={},tt=Ci(Si),lt=Ci(!1),Pi=Si;function gn(t,e){var i=t.type.contextTypes;if(!i)return Si;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},l;for(l in i)s[l]=e[l];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function ct(t){return t=t.childContextTypes,t!=null}function uo(){Me(lt),Me(tt)}function mc(t,e,i){if(tt.current!==Si)throw Error(ae(168));Oe(tt,e),Oe(lt,i)}function Fh(t,e,i){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return i;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(ae(108,Wf(t)||"Unknown",s));return Be({},i,n)}function ho(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Si,Pi=tt.current,Oe(tt,t),Oe(lt,lt.current),!0}function _c(t,e,i){var n=t.stateNode;if(!n)throw Error(ae(169));i?(t=Fh(t,e,Pi),n.__reactInternalMemoizedMergedChildContext=t,Me(lt),Me(tt),Oe(tt,t)):Me(lt),Oe(lt,i)}var zt=null,Vo=!1,ms=!1;function Ph(t){zt===null?zt=[t]:zt.push(t)}function op(t){Vo=!0,Ph(t)}function xi(){if(!ms&&zt!==null){ms=!0;var t=0,e=Ae;try{var i=zt;for(Ae=1;t<i.length;t++){var n=i[t];do n=n(!0);while(n!==null)}zt=null,Vo=!1}catch(s){throw zt!==null&&(zt=zt.slice(t+1)),ah(Wa,xi),s}finally{Ae=e,ms=!1}}return null}var tn=[],nn=0,fo=null,go=0,xt=[],Tt=0,Bi=null,Xt=1,$t="";function Ei(t,e){tn[nn++]=go,tn[nn++]=fo,fo=t,go=e}function Bh(t,e,i){xt[Tt++]=Xt,xt[Tt++]=$t,xt[Tt++]=Bi,Bi=t;var n=Xt;t=$t;var s=32-Lt(n)-1;n&=~(1<<s),i+=1;var l=32-Lt(e)+s;if(30<l){var d=s-s%5;l=(n&(1<<d)-1).toString(32),n>>=d,s-=d,Xt=1<<32-Lt(e)+s|i<<s|n,$t=l+t}else Xt=1<<l|i<<s|n,$t=t}function Ja(t){t.return!==null&&(Ei(t,1),Bh(t,1,0))}function Qa(t){for(;t===fo;)fo=tn[--nn],tn[nn]=null,go=tn[--nn],tn[nn]=null;for(;t===Bi;)Bi=xt[--Tt],xt[Tt]=null,$t=xt[--Tt],xt[Tt]=null,Xt=xt[--Tt],xt[Tt]=null}var _t=null,mt=null,ke=!1,Mt=null;function Nh(t,e){var i=bt(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function vc(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,_t=t,mt=fi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,_t=t,mt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=Bi!==null?{id:Xt,overflow:$t}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=bt(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,_t=t,mt=null,!0):!1;default:return!1}}function sa(t){return(t.mode&1)!==0&&(t.flags&128)===0}function aa(t){if(ke){var e=mt;if(e){var i=e;if(!vc(t,e)){if(sa(t))throw Error(ae(418));e=fi(i.nextSibling);var n=_t;e&&vc(t,e)?Nh(n,i):(t.flags=t.flags&-4097|2,ke=!1,_t=t)}}else{if(sa(t))throw Error(ae(418));t.flags=t.flags&-4097|2,ke=!1,_t=t}}}function yc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;_t=t}function Mr(t){if(t!==_t)return!1;if(!ke)return yc(t),ke=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ia(t.type,t.memoizedProps)),e&&(e=mt)){if(sa(t))throw jh(),Error(ae(418));for(;e;)Nh(t,e),e=fi(e.nextSibling)}if(yc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){mt=fi(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}mt=null}}else mt=_t?fi(t.stateNode.nextSibling):null;return!0}function jh(){for(var t=mt;t;)t=fi(t.nextSibling)}function pn(){mt=_t=null,ke=!1}function qa(t){Mt===null?Mt=[t]:Mt.push(t)}var sp=ti.ReactCurrentBatchConfig;function Rt(t,e){if(t&&t.defaultProps){e=Be({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}var po=Ci(null),mo=null,rn=null,el=null;function tl(){el=rn=mo=null}function il(t){var e=po.current;Me(po),t._currentValue=e}function la(t,e,i){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===i)break;t=t.return}}function hn(t,e){mo=t,el=rn=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(at=!0),t.firstContext=null)}function It(t){var e=t._currentValue;if(el!==t)if(t={context:t,memoizedValue:e,next:null},rn===null){if(mo===null)throw Error(ae(308));rn=t,mo.dependencies={lanes:0,firstContext:t}}else rn=rn.next=t;return e}var Oi=null;function nl(t){Oi===null?Oi=[t]:Oi.push(t)}function Vh(t,e,i,n){var s=e.interleaved;return s===null?(i.next=i,nl(e)):(i.next=s.next,s.next=i),e.interleaved=i,Qt(t,n)}function Qt(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var ri=!1;function rl(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uh(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Kt(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function gi(t,e,i){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Ee&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,Qt(t,i)}return s=n.interleaved,s===null?(e.next=e,nl(n)):(e.next=s.next,s.next=e),n.interleaved=e,Qt(t,i)}function Yr(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,Ga(t,i)}}function Sc(t,e){var i=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var s=null,l=null;if(i=i.firstBaseUpdate,i!==null){do{var d={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};l===null?s=l=d:l=l.next=d,i=i.next}while(i!==null);l===null?s=l=e:l=l.next=e}else s=l=e;i={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:l,shared:n.shared,effects:n.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function _o(t,e,i,n){var s=t.updateQueue;ri=!1;var l=s.firstBaseUpdate,d=s.lastBaseUpdate,_=s.shared.pending;if(_!==null){s.shared.pending=null;var S=_,w=S.next;S.next=null,d===null?l=w:d.next=w,d=S;var T=t.alternate;T!==null&&(T=T.updateQueue,_=T.lastBaseUpdate,_!==d&&(_===null?T.firstBaseUpdate=w:_.next=w,T.lastBaseUpdate=S))}if(l!==null){var A=s.baseState;d=0,T=w=S=null,_=l;do{var I=_.lane,k=_.eventTime;if((n&I)===I){T!==null&&(T=T.next={eventTime:k,lane:0,tag:_.tag,payload:_.payload,callback:_.callback,next:null});e:{var B=t,F=_;switch(I=e,k=i,F.tag){case 1:if(B=F.payload,typeof B=="function"){A=B.call(k,A,I);break e}A=B;break e;case 3:B.flags=B.flags&-65537|128;case 0:if(B=F.payload,I=typeof B=="function"?B.call(k,A,I):B,I==null)break e;A=Be({},A,I);break e;case 2:ri=!0}}_.callback!==null&&_.lane!==0&&(t.flags|=64,I=s.effects,I===null?s.effects=[_]:I.push(_))}else k={eventTime:k,lane:I,tag:_.tag,payload:_.payload,callback:_.callback,next:null},T===null?(w=T=k,S=A):T=T.next=k,d|=I;if(_=_.next,_===null){if(_=s.shared.pending,_===null)break;I=_,_=I.next,I.next=null,s.lastBaseUpdate=I,s.shared.pending=null}}while(1);if(T===null&&(S=A),s.baseState=S,s.firstBaseUpdate=w,s.lastBaseUpdate=T,e=s.shared.interleaved,e!==null){s=e;do d|=s.lane,s=s.next;while(s!==e)}else l===null&&(s.shared.lanes=0);ji|=d,t.lanes=d,t.memoizedState=A}}function wc(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],s=n.callback;if(s!==null){if(n.callback=null,n=i,typeof s!="function")throw Error(ae(191,s));s.call(n)}}}var Wh=new Vu.Component().refs;function ca(t,e,i,n){e=t.memoizedState,i=i(n,e),i=i==null?e:Be({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var Uo={isMounted:function(t){return(t=t._reactInternals)?Wi(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var n=nt(),s=mi(t),l=Kt(n,s);l.payload=e,i!=null&&(l.callback=i),e=gi(t,l,s),e!==null&&(kt(e,t,s,n),Yr(e,t,s))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var n=nt(),s=mi(t),l=Kt(n,s);l.tag=1,l.payload=e,i!=null&&(l.callback=i),e=gi(t,l,s),e!==null&&(kt(e,t,s,n),Yr(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=nt(),n=mi(t),s=Kt(i,n);s.tag=2,e!=null&&(s.callback=e),e=gi(t,s,n),e!==null&&(kt(e,t,n,i),Yr(e,t,n))}};function Cc(t,e,i,n,s,l,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,l,d):e.prototype&&e.prototype.isPureReactComponent?!rr(i,n)||!rr(s,l):!0}function Gh(t,e,i){var n=!1,s=Si,l=e.contextType;return typeof l=="object"&&l!==null?l=It(l):(s=ct(e)?Pi:tt.current,n=e.contextTypes,l=(n=n!=null)?gn(t,s):Si),e=new e(i,l),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Uo,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=l),e}function xc(t,e,i,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,n),e.state!==t&&Uo.enqueueReplaceState(e,e.state,null)}function ua(t,e,i,n){var s=t.stateNode;s.props=i,s.state=t.memoizedState,s.refs=Wh,rl(t);var l=e.contextType;typeof l=="object"&&l!==null?s.context=It(l):(l=ct(e)?Pi:tt.current,s.context=gn(t,l)),s.state=t.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(ca(t,e,l,i),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Uo.enqueueReplaceState(s,s.state,null),_o(t,i,s,n),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Mn(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ae(309));var n=i.stateNode}if(!n)throw Error(ae(147,t));var s=n,l=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===l?e.ref:(e=function(d){var _=s.refs;_===Wh&&(_=s.refs={}),d===null?delete _[l]:_[l]=d},e._stringRef=l,e)}if(typeof t!="string")throw Error(ae(284));if(!i._owner)throw Error(ae(290,t))}return t}function Lr(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Tc(t){var e=t._init;return e(t._payload)}function zh(t){function e(D,R){if(t){var L=D.deletions;L===null?(D.deletions=[R],D.flags|=16):L.push(R)}}function i(D,R){if(!t)return null;for(;R!==null;)e(D,R),R=R.sibling;return null}function n(D,R){for(D=new Map;R!==null;)R.key!==null?D.set(R.key,R):D.set(R.index,R),R=R.sibling;return D}function s(D,R){return D=_i(D,R),D.index=0,D.sibling=null,D}function l(D,R,L){return D.index=L,t?(L=D.alternate,L!==null?(L=L.index,L<R?(D.flags|=2,R):L):(D.flags|=2,R)):(D.flags|=1048576,R)}function d(D){return t&&D.alternate===null&&(D.flags|=2),D}function _(D,R,L,$){return R===null||R.tag!==6?(R=xs(L,D.mode,$),R.return=D,R):(R=s(R,L),R.return=D,R)}function S(D,R,L,$){var ie=L.type;return ie===Ki?T(D,R,L.props.children,$,L.key):R!==null&&(R.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===ni&&Tc(ie)===R.type)?($=s(R,L.props),$.ref=Mn(D,R,L),$.return=D,$):($=Qr(L.type,L.key,L.props,null,D.mode,$),$.ref=Mn(D,R,L),$.return=D,$)}function w(D,R,L,$){return R===null||R.tag!==4||R.stateNode.containerInfo!==L.containerInfo||R.stateNode.implementation!==L.implementation?(R=Ts(L,D.mode,$),R.return=D,R):(R=s(R,L.children||[]),R.return=D,R)}function T(D,R,L,$,ie){return R===null||R.tag!==7?(R=Li(L,D.mode,$,ie),R.return=D,R):(R=s(R,L),R.return=D,R)}function A(D,R,L){if(typeof R=="string"&&R!==""||typeof R=="number")return R=xs(""+R,D.mode,L),R.return=D,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Cr:return L=Qr(R.type,R.key,R.props,null,D.mode,L),L.ref=Mn(D,null,R),L.return=D,L;case $i:return R=Ts(R,D.mode,L),R.return=D,R;case ni:var $=R._init;return A(D,$(R._payload),L)}if(jn(R)||In(R))return R=Li(R,D.mode,L,null),R.return=D,R;Lr(D,R)}return null}function I(D,R,L,$){var ie=R!==null?R.key:null;if(typeof L=="string"&&L!==""||typeof L=="number")return ie!==null?null:_(D,R,""+L,$);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case Cr:return L.key===ie?S(D,R,L,$):null;case $i:return L.key===ie?w(D,R,L,$):null;case ni:return ie=L._init,I(D,R,ie(L._payload),$)}if(jn(L)||In(L))return ie!==null?null:T(D,R,L,$,null);Lr(D,L)}return null}function k(D,R,L,$,ie){if(typeof $=="string"&&$!==""||typeof $=="number")return D=D.get(L)||null,_(R,D,""+$,ie);if(typeof $=="object"&&$!==null){switch($.$$typeof){case Cr:return D=D.get($.key===null?L:$.key)||null,S(R,D,$,ie);case $i:return D=D.get($.key===null?L:$.key)||null,w(R,D,$,ie);case ni:var ne=$._init;return k(D,R,L,ne($._payload),ie)}if(jn($)||In($))return D=D.get(L)||null,T(R,D,$,ie,null);Lr(R,$)}return null}function B(D,R,L,$){for(var ie=null,ne=null,J=R,y=R=0,de=null;J!==null&&y<L.length;y++){J.index>y?(de=J,J=null):de=J.sibling;var ge=I(D,J,L[y],$);if(ge===null){J===null&&(J=de);break}t&&J&&ge.alternate===null&&e(D,J),R=l(ge,R,y),ne===null?ie=ge:ne.sibling=ge,ne=ge,J=de}if(y===L.length)return i(D,J),ke&&Ei(D,y),ie;if(J===null){for(;y<L.length;y++)J=A(D,L[y],$),J!==null&&(R=l(J,R,y),ne===null?ie=J:ne.sibling=J,ne=J);return ke&&Ei(D,y),ie}for(J=n(D,J);y<L.length;y++)de=k(J,D,y,L[y],$),de!==null&&(t&&de.alternate!==null&&J.delete(de.key===null?y:de.key),R=l(de,R,y),ne===null?ie=de:ne.sibling=de,ne=de);return t&&J.forEach(function(be){return e(D,be)}),ke&&Ei(D,y),ie}function F(D,R,L,$){var ie=In(L);if(typeof ie!="function")throw Error(ae(150));if(L=ie.call(L),L==null)throw Error(ae(151));for(var ne=ie=null,J=R,y=R=0,de=null,ge=L.next();J!==null&&!ge.done;y++,ge=L.next()){J.index>y?(de=J,J=null):de=J.sibling;var be=I(D,J,ge.value,$);if(be===null){J===null&&(J=de);break}t&&J&&be.alternate===null&&e(D,J),R=l(be,R,y),ne===null?ie=be:ne.sibling=be,ne=be,J=de}if(ge.done)return i(D,J),ke&&Ei(D,y),ie;if(J===null){for(;!ge.done;y++,ge=L.next())ge=A(D,ge.value,$),ge!==null&&(R=l(ge,R,y),ne===null?ie=ge:ne.sibling=ge,ne=ge);return ke&&Ei(D,y),ie}for(J=n(D,J);!ge.done;y++,ge=L.next())ge=k(J,D,y,ge.value,$),ge!==null&&(t&&ge.alternate!==null&&J.delete(ge.key===null?y:ge.key),R=l(ge,R,y),ne===null?ie=ge:ne.sibling=ge,ne=ge);return t&&J.forEach(function(u){return e(D,u)}),ke&&Ei(D,y),ie}function z(D,R,L,$){if(typeof L=="object"&&L!==null&&L.type===Ki&&L.key===null&&(L=L.props.children),typeof L=="object"&&L!==null){switch(L.$$typeof){case Cr:e:{for(var ie=L.key,ne=R;ne!==null;){if(ne.key===ie){if(ie=L.type,ie===Ki){if(ne.tag===7){i(D,ne.sibling),R=s(ne,L.props.children),R.return=D,D=R;break e}}else if(ne.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===ni&&Tc(ie)===ne.type){i(D,ne.sibling),R=s(ne,L.props),R.ref=Mn(D,ne,L),R.return=D,D=R;break e}i(D,ne);break}else e(D,ne);ne=ne.sibling}L.type===Ki?(R=Li(L.props.children,D.mode,$,L.key),R.return=D,D=R):($=Qr(L.type,L.key,L.props,null,D.mode,$),$.ref=Mn(D,R,L),$.return=D,D=$)}return d(D);case $i:e:{for(ne=L.key;R!==null;){if(R.key===ne)if(R.tag===4&&R.stateNode.containerInfo===L.containerInfo&&R.stateNode.implementation===L.implementation){i(D,R.sibling),R=s(R,L.children||[]),R.return=D,D=R;break e}else{i(D,R);break}else e(D,R);R=R.sibling}R=Ts(L,D.mode,$),R.return=D,D=R}return d(D);case ni:return ne=L._init,z(D,R,ne(L._payload),$)}if(jn(L))return B(D,R,L,$);if(In(L))return F(D,R,L,$);Lr(D,L)}return typeof L=="string"&&L!==""||typeof L=="number"?(L=""+L,R!==null&&R.tag===6?(i(D,R.sibling),R=s(R,L),R.return=D,D=R):(i(D,R),R=xs(L,D.mode,$),R.return=D,D=R),d(D)):i(D,R)}return z}var mn=zh(!0),Hh=zh(!1),yr={},Ut=Ci(yr),lr=Ci(yr),cr=Ci(yr);function Ri(t){if(t===yr)throw Error(ae(174));return t}function ol(t,e){switch(Oe(cr,e),Oe(lr,t),Oe(Ut,yr),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ws(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ws(e,t)}Me(Ut),Oe(Ut,e)}function _n(){Me(Ut),Me(lr),Me(cr)}function Yh(t){Ri(cr.current);var e=Ri(Ut.current),i=Ws(e,t.type);e!==i&&(Oe(lr,t),Oe(Ut,i))}function sl(t){lr.current===t&&(Me(Ut),Me(lr))}var Fe=Ci(0);function vo(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _s=[];function al(){for(var t=0;t<_s.length;t++)_s[t]._workInProgressVersionPrimary=null;_s.length=0}var Xr=ti.ReactCurrentDispatcher,vs=ti.ReactCurrentBatchConfig,Ni=0,Pe=null,We=null,ze=null,yo=!1,Xn=!1,ur=0,ap=0;function Je(){throw Error(ae(321))}function ll(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!Ft(t[i],e[i]))return!1;return!0}function cl(t,e,i,n,s,l){if(Ni=l,Pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Xr.current=t===null||t.memoizedState===null?hp:dp,t=i(n,s),Xn){l=0;do{if(Xn=!1,ur=0,25<=l)throw Error(ae(301));l+=1,ze=We=null,e.updateQueue=null,Xr.current=fp,t=i(n,s)}while(Xn)}if(Xr.current=So,e=We!==null&&We.next!==null,Ni=0,ze=We=Pe=null,yo=!1,e)throw Error(ae(300));return t}function ul(){var t=ur!==0;return ur=0,t}function Bt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ze===null?Pe.memoizedState=ze=t:ze=ze.next=t,ze}function At(){if(We===null){var t=Pe.alternate;t=t!==null?t.memoizedState:null}else t=We.next;var e=ze===null?Pe.memoizedState:ze.next;if(e!==null)ze=e,We=t;else{if(t===null)throw Error(ae(310));We=t,t={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},ze===null?Pe.memoizedState=ze=t:ze=ze.next=t}return ze}function hr(t,e){return typeof e=="function"?e(t):e}function ys(t){var e=At(),i=e.queue;if(i===null)throw Error(ae(311));i.lastRenderedReducer=t;var n=We,s=n.baseQueue,l=i.pending;if(l!==null){if(s!==null){var d=s.next;s.next=l.next,l.next=d}n.baseQueue=s=l,i.pending=null}if(s!==null){l=s.next,n=n.baseState;var _=d=null,S=null,w=l;do{var T=w.lane;if((Ni&T)===T)S!==null&&(S=S.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),n=w.hasEagerState?w.eagerState:t(n,w.action);else{var A={lane:T,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};S===null?(_=S=A,d=n):S=S.next=A,Pe.lanes|=T,ji|=T}w=w.next}while(w!==null&&w!==l);S===null?d=n:S.next=_,Ft(n,e.memoizedState)||(at=!0),e.memoizedState=n,e.baseState=d,e.baseQueue=S,i.lastRenderedState=n}if(t=i.interleaved,t!==null){s=t;do l=s.lane,Pe.lanes|=l,ji|=l,s=s.next;while(s!==t)}else s===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function Ss(t){var e=At(),i=e.queue;if(i===null)throw Error(ae(311));i.lastRenderedReducer=t;var n=i.dispatch,s=i.pending,l=e.memoizedState;if(s!==null){i.pending=null;var d=s=s.next;do l=t(l,d.action),d=d.next;while(d!==s);Ft(l,e.memoizedState)||(at=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),i.lastRenderedState=l}return[l,n]}function Xh(){}function $h(t,e){var i=Pe,n=At(),s=e(),l=!Ft(n.memoizedState,s);if(l&&(n.memoizedState=s,at=!0),n=n.queue,hl(Jh.bind(null,i,n,t),[t]),n.getSnapshot!==e||l||ze!==null&&ze.memoizedState.tag&1){if(i.flags|=2048,dr(9,Zh.bind(null,i,n,s,e),void 0,null),Ye===null)throw Error(ae(349));Ni&30||Kh(i,e,s)}return s}function Kh(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=Pe.updateQueue,e===null?(e={lastEffect:null,stores:null},Pe.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function Zh(t,e,i,n){e.value=i,e.getSnapshot=n,Qh(e)&&qh(t)}function Jh(t,e,i){return i(function(){Qh(e)&&qh(t)})}function Qh(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!Ft(t,i)}catch{return!0}}function qh(t){var e=Qt(t,1);e!==null&&kt(e,t,1,-1)}function bc(t){var e=Bt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hr,lastRenderedState:t},e.queue=t,t=t.dispatch=up.bind(null,Pe,t),[e.memoizedState,t]}function dr(t,e,i,n){return t={tag:t,create:e,destroy:i,deps:n,next:null},e=Pe.updateQueue,e===null?(e={lastEffect:null,stores:null},Pe.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(n=i.next,i.next=t,t.next=n,e.lastEffect=t)),t}function ed(){return At().memoizedState}function $r(t,e,i,n){var s=Bt();Pe.flags|=t,s.memoizedState=dr(1|e,i,void 0,n===void 0?null:n)}function Wo(t,e,i,n){var s=At();n=n===void 0?null:n;var l=void 0;if(We!==null){var d=We.memoizedState;if(l=d.destroy,n!==null&&ll(n,d.deps)){s.memoizedState=dr(e,i,l,n);return}}Pe.flags|=t,s.memoizedState=dr(1|e,i,l,n)}function Ec(t,e){return $r(8390656,8,t,e)}function hl(t,e){return Wo(2048,8,t,e)}function td(t,e){return Wo(4,2,t,e)}function id(t,e){return Wo(4,4,t,e)}function nd(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function rd(t,e,i){return i=i!=null?i.concat([t]):null,Wo(4,4,nd.bind(null,e,t),i)}function dl(){}function od(t,e){var i=At();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&ll(e,n[1])?n[0]:(i.memoizedState=[t,e],t)}function sd(t,e){var i=At();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&ll(e,n[1])?n[0]:(t=t(),i.memoizedState=[t,e],t)}function ad(t,e,i){return Ni&21?(Ft(i,e)||(i=uh(),Pe.lanes|=i,ji|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,at=!0),t.memoizedState=i)}function lp(t,e){var i=Ae;Ae=i!==0&&4>i?i:4,t(!0);var n=vs.transition;vs.transition={};try{t(!1),e()}finally{Ae=i,vs.transition=n}}function ld(){return At().memoizedState}function cp(t,e,i){var n=mi(t);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},cd(t))ud(e,i);else if(i=Vh(t,e,i,n),i!==null){var s=nt();kt(i,t,n,s),hd(i,e,n)}}function up(t,e,i){var n=mi(t),s={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(cd(t))ud(e,s);else{var l=t.alternate;if(t.lanes===0&&(l===null||l.lanes===0)&&(l=e.lastRenderedReducer,l!==null))try{var d=e.lastRenderedState,_=l(d,i);if(s.hasEagerState=!0,s.eagerState=_,Ft(_,d)){var S=e.interleaved;S===null?(s.next=s,nl(e)):(s.next=S.next,S.next=s),e.interleaved=s;return}}catch{}finally{}i=Vh(t,e,s,n),i!==null&&(s=nt(),kt(i,t,n,s),hd(i,e,n))}}function cd(t){var e=t.alternate;return t===Pe||e!==null&&e===Pe}function ud(t,e){Xn=yo=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function hd(t,e,i){if(i&4194240){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,Ga(t,i)}}var So={readContext:It,useCallback:Je,useContext:Je,useEffect:Je,useImperativeHandle:Je,useInsertionEffect:Je,useLayoutEffect:Je,useMemo:Je,useReducer:Je,useRef:Je,useState:Je,useDebugValue:Je,useDeferredValue:Je,useTransition:Je,useMutableSource:Je,useSyncExternalStore:Je,useId:Je,unstable_isNewReconciler:!1},hp={readContext:It,useCallback:function(t,e){return Bt().memoizedState=[t,e===void 0?null:e],t},useContext:It,useEffect:Ec,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,$r(4194308,4,nd.bind(null,e,t),i)},useLayoutEffect:function(t,e){return $r(4194308,4,t,e)},useInsertionEffect:function(t,e){return $r(4,2,t,e)},useMemo:function(t,e){var i=Bt();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var n=Bt();return e=i!==void 0?i(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=cp.bind(null,Pe,t),[n.memoizedState,t]},useRef:function(t){var e=Bt();return t={current:t},e.memoizedState=t},useState:bc,useDebugValue:dl,useDeferredValue:function(t){return Bt().memoizedState=t},useTransition:function(){var t=bc(!1),e=t[0];return t=lp.bind(null,t[1]),Bt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var n=Pe,s=Bt();if(ke){if(i===void 0)throw Error(ae(407));i=i()}else{if(i=e(),Ye===null)throw Error(ae(349));Ni&30||Kh(n,e,i)}s.memoizedState=i;var l={value:i,getSnapshot:e};return s.queue=l,Ec(Jh.bind(null,n,l,t),[t]),n.flags|=2048,dr(9,Zh.bind(null,n,l,i,e),void 0,null),i},useId:function(){var t=Bt(),e=Ye.identifierPrefix;if(ke){var i=$t,n=Xt;i=(n&~(1<<32-Lt(n)-1)).toString(32)+i,e=":"+e+"R"+i,i=ur++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=ap++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},dp={readContext:It,useCallback:od,useContext:It,useEffect:hl,useImperativeHandle:rd,useInsertionEffect:td,useLayoutEffect:id,useMemo:sd,useReducer:ys,useRef:ed,useState:function(){return ys(hr)},useDebugValue:dl,useDeferredValue:function(t){var e=At();return ad(e,We.memoizedState,t)},useTransition:function(){var t=ys(hr)[0],e=At().memoizedState;return[t,e]},useMutableSource:Xh,useSyncExternalStore:$h,useId:ld,unstable_isNewReconciler:!1},fp={readContext:It,useCallback:od,useContext:It,useEffect:hl,useImperativeHandle:rd,useInsertionEffect:td,useLayoutEffect:id,useMemo:sd,useReducer:Ss,useRef:ed,useState:function(){return Ss(hr)},useDebugValue:dl,useDeferredValue:function(t){var e=At();return We===null?e.memoizedState=t:ad(e,We.memoizedState,t)},useTransition:function(){var t=Ss(hr)[0],e=At().memoizedState;return[t,e]},useMutableSource:Xh,useSyncExternalStore:$h,useId:ld,unstable_isNewReconciler:!1};function vn(t,e){try{var i="",n=e;do i+=Uf(n),n=n.return;while(n);var s=i}catch(l){s=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:e,stack:s,digest:null}}function ws(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function ha(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var gp=typeof WeakMap=="function"?WeakMap:Map;function dd(t,e,i){i=Kt(-1,i),i.tag=3,i.payload={element:null};var n=e.value;return i.callback=function(){Co||(Co=!0,wa=n),ha(t,e)},i}function fd(t,e,i){i=Kt(-1,i),i.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;i.payload=function(){return n(s)},i.callback=function(){ha(t,e)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(i.callback=function(){ha(t,e),typeof n!="function"&&(pi===null?pi=new Set([this]):pi.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),i}function Ic(t,e,i){var n=t.pingCache;if(n===null){n=t.pingCache=new gp;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(i)||(s.add(i),t=Ap.bind(null,t,e,i),e.then(t,t))}function Ac(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Oc(t,e,i,n,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=Kt(-1,1),e.tag=2,gi(i,e,1))),i.lanes|=1),t)}var pp=ti.ReactCurrentOwner,at=!1;function it(t,e,i,n){e.child=t===null?Hh(e,null,i,n):mn(e,t.child,i,n)}function Rc(t,e,i,n,s){i=i.render;var l=e.ref;return hn(e,s),n=cl(t,e,i,n,l,s),i=ul(),t!==null&&!at?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,qt(t,e,s)):(ke&&i&&Ja(e),e.flags|=1,it(t,e,n,s),e.child)}function Dc(t,e,i,n,s){if(t===null){var l=i.type;return typeof l=="function"&&!Sl(l)&&l.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=l,gd(t,e,l,n,s)):(t=Qr(i.type,null,n,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(l=t.child,!(t.lanes&s)){var d=l.memoizedProps;if(i=i.compare,i=i!==null?i:rr,i(d,n)&&t.ref===e.ref)return qt(t,e,s)}return e.flags|=1,t=_i(l,n),t.ref=e.ref,t.return=e,e.child=t}function gd(t,e,i,n,s){if(t!==null){var l=t.memoizedProps;if(rr(l,n)&&t.ref===e.ref)if(at=!1,e.pendingProps=n=l,(t.lanes&s)!==0)t.flags&131072&&(at=!0);else return e.lanes=t.lanes,qt(t,e,s)}return da(t,e,i,n,s)}function pd(t,e,i){var n=e.pendingProps,s=n.children,l=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Oe(sn,ft),ft|=i;else{if(!(i&1073741824))return t=l!==null?l.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Oe(sn,ft),ft|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=l!==null?l.baseLanes:i,Oe(sn,ft),ft|=n}else l!==null?(n=l.baseLanes|i,e.memoizedState=null):n=i,Oe(sn,ft),ft|=n;return it(t,e,s,i),e.child}function md(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function da(t,e,i,n,s){var l=ct(i)?Pi:tt.current;return l=gn(e,l),hn(e,s),i=cl(t,e,i,n,l,s),n=ul(),t!==null&&!at?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,qt(t,e,s)):(ke&&n&&Ja(e),e.flags|=1,it(t,e,i,s),e.child)}function Mc(t,e,i,n,s){if(ct(i)){var l=!0;ho(e)}else l=!1;if(hn(e,s),e.stateNode===null)Kr(t,e),Gh(e,i,n),ua(e,i,n,s),n=!0;else if(t===null){var d=e.stateNode,_=e.memoizedProps;d.props=_;var S=d.context,w=i.contextType;typeof w=="object"&&w!==null?w=It(w):(w=ct(i)?Pi:tt.current,w=gn(e,w));var T=i.getDerivedStateFromProps,A=typeof T=="function"||typeof d.getSnapshotBeforeUpdate=="function";A||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(_!==n||S!==w)&&xc(e,d,n,w),ri=!1;var I=e.memoizedState;d.state=I,_o(e,n,d,s),S=e.memoizedState,_!==n||I!==S||lt.current||ri?(typeof T=="function"&&(ca(e,i,T,n),S=e.memoizedState),(_=ri||Cc(e,i,_,n,I,S,w))?(A||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=S),d.props=n,d.state=S,d.context=w,n=_):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{d=e.stateNode,Uh(t,e),_=e.memoizedProps,w=e.type===e.elementType?_:Rt(e.type,_),d.props=w,A=e.pendingProps,I=d.context,S=i.contextType,typeof S=="object"&&S!==null?S=It(S):(S=ct(i)?Pi:tt.current,S=gn(e,S));var k=i.getDerivedStateFromProps;(T=typeof k=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(_!==A||I!==S)&&xc(e,d,n,S),ri=!1,I=e.memoizedState,d.state=I,_o(e,n,d,s);var B=e.memoizedState;_!==A||I!==B||lt.current||ri?(typeof k=="function"&&(ca(e,i,k,n),B=e.memoizedState),(w=ri||Cc(e,i,w,n,I,B,S)||!1)?(T||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,B,S),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,B,S)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=B),d.props=n,d.state=B,d.context=S,n=w):(typeof d.componentDidUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=1024),n=!1)}return fa(t,e,i,n,l,s)}function fa(t,e,i,n,s,l){md(t,e);var d=(e.flags&128)!==0;if(!n&&!d)return s&&_c(e,i,!1),qt(t,e,l);n=e.stateNode,pp.current=e;var _=d&&typeof i.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&d?(e.child=mn(e,t.child,null,l),e.child=mn(e,null,_,l)):it(t,e,_,l),e.memoizedState=n.state,s&&_c(e,i,!0),e.child}function _d(t){var e=t.stateNode;e.pendingContext?mc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&mc(t,e.context,!1),ol(t,e.containerInfo)}function Lc(t,e,i,n,s){return pn(),qa(s),e.flags|=256,it(t,e,i,n),e.child}var ga={dehydrated:null,treeContext:null,retryLane:0};function pa(t){return{baseLanes:t,cachePool:null,transitions:null}}function vd(t,e,i){var n=e.pendingProps,s=Fe.current,l=!1,d=(e.flags&128)!==0,_;if((_=d)||(_=t!==null&&t.memoizedState===null?!1:(s&2)!==0),_?(l=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Oe(Fe,s&1),t===null)return aa(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=n.children,t=n.fallback,l?(n=e.mode,l=e.child,d={mode:"hidden",children:d},!(n&1)&&l!==null?(l.childLanes=0,l.pendingProps=d):l=Ho(d,n,0,null),t=Li(t,n,i,null),l.return=e,t.return=e,l.sibling=t,e.child=l,e.child.memoizedState=pa(i),e.memoizedState=ga,t):fl(e,d));if(s=t.memoizedState,s!==null&&(_=s.dehydrated,_!==null))return mp(t,e,d,n,_,s,i);if(l){l=n.fallback,d=e.mode,s=t.child,_=s.sibling;var S={mode:"hidden",children:n.children};return!(d&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=S,e.deletions=null):(n=_i(s,S),n.subtreeFlags=s.subtreeFlags&14680064),_!==null?l=_i(_,l):(l=Li(l,d,i,null),l.flags|=2),l.return=e,n.return=e,n.sibling=l,e.child=n,n=l,l=e.child,d=t.child.memoizedState,d=d===null?pa(i):{baseLanes:d.baseLanes|i,cachePool:null,transitions:d.transitions},l.memoizedState=d,l.childLanes=t.childLanes&~i,e.memoizedState=ga,n}return l=t.child,t=l.sibling,n=_i(l,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=i),n.return=e,n.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n,e.memoizedState=null,n}function fl(t,e){return e=Ho({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function kr(t,e,i,n){return n!==null&&qa(n),mn(e,t.child,null,i),t=fl(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function mp(t,e,i,n,s,l,d){if(i)return e.flags&256?(e.flags&=-257,n=ws(Error(ae(422))),kr(t,e,d,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(l=n.fallback,s=e.mode,n=Ho({mode:"visible",children:n.children},s,0,null),l=Li(l,s,d,null),l.flags|=2,n.return=e,l.return=e,n.sibling=l,e.child=n,e.mode&1&&mn(e,t.child,null,d),e.child.memoizedState=pa(d),e.memoizedState=ga,l);if(!(e.mode&1))return kr(t,e,d,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var _=n.dgst;return n=_,l=Error(ae(419)),n=ws(l,n,void 0),kr(t,e,d,n)}if(_=(d&t.childLanes)!==0,at||_){if(n=Ye,n!==null){switch(d&-d){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|d)?0:s,s!==0&&s!==l.retryLane&&(l.retryLane=s,Qt(t,s),kt(n,t,s,-1))}return yl(),n=ws(Error(ae(421))),kr(t,e,d,n)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Op.bind(null,t),s._reactRetry=e,null):(t=l.treeContext,mt=fi(s.nextSibling),_t=e,ke=!0,Mt=null,t!==null&&(xt[Tt++]=Xt,xt[Tt++]=$t,xt[Tt++]=Bi,Xt=t.id,$t=t.overflow,Bi=e),e=fl(e,n.children),e.flags|=4096,e)}function kc(t,e,i){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),la(t.return,e,i)}function Cs(t,e,i,n,s){var l=t.memoizedState;l===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:s}:(l.isBackwards=e,l.rendering=null,l.renderingStartTime=0,l.last=n,l.tail=i,l.tailMode=s)}function yd(t,e,i){var n=e.pendingProps,s=n.revealOrder,l=n.tail;if(it(t,e,n.children,i),n=Fe.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&kc(t,i,e);else if(t.tag===19)kc(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Oe(Fe,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(i=e.child,s=null;i!==null;)t=i.alternate,t!==null&&vo(t)===null&&(s=i),i=i.sibling;i=s,i===null?(s=e.child,e.child=null):(s=i.sibling,i.sibling=null),Cs(e,!1,s,i,l);break;case"backwards":for(i=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&vo(t)===null){e.child=s;break}t=s.sibling,s.sibling=i,i=s,s=t}Cs(e,!0,i,null,l);break;case"together":Cs(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Kr(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function qt(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),ji|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,i=_i(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=_i(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function _p(t,e,i){switch(e.tag){case 3:_d(e),pn();break;case 5:Yh(e);break;case 1:ct(e.type)&&ho(e);break;case 4:ol(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;Oe(po,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Oe(Fe,Fe.current&1),e.flags|=128,null):i&e.child.childLanes?vd(t,e,i):(Oe(Fe,Fe.current&1),t=qt(t,e,i),t!==null?t.sibling:null);Oe(Fe,Fe.current&1);break;case 19:if(n=(i&e.childLanes)!==0,t.flags&128){if(n)return yd(t,e,i);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Oe(Fe,Fe.current),n)break;return null;case 22:case 23:return e.lanes=0,pd(t,e,i)}return qt(t,e,i)}var Sd,ma,wd,Cd;Sd=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};ma=function(){};wd=function(t,e,i,n){var s=t.memoizedProps;if(s!==n){t=e.stateNode,Ri(Ut.current);var l=null;switch(i){case"input":s=Ns(t,s),n=Ns(t,n),l=[];break;case"select":s=Be({},s,{value:void 0}),n=Be({},n,{value:void 0}),l=[];break;case"textarea":s=Us(t,s),n=Us(t,n),l=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=co)}Gs(i,n);var d;i=null;for(w in s)if(!n.hasOwnProperty(w)&&s.hasOwnProperty(w)&&s[w]!=null)if(w==="style"){var _=s[w];for(d in _)_.hasOwnProperty(d)&&(i||(i={}),i[d]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Jn.hasOwnProperty(w)?l||(l=[]):(l=l||[]).push(w,null));for(w in n){var S=n[w];if(_=s!=null?s[w]:void 0,n.hasOwnProperty(w)&&S!==_&&(S!=null||_!=null))if(w==="style")if(_){for(d in _)!_.hasOwnProperty(d)||S&&S.hasOwnProperty(d)||(i||(i={}),i[d]="");for(d in S)S.hasOwnProperty(d)&&_[d]!==S[d]&&(i||(i={}),i[d]=S[d])}else i||(l||(l=[]),l.push(w,i)),i=S;else w==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,_=_?_.__html:void 0,S!=null&&_!==S&&(l=l||[]).push(w,S)):w==="children"?typeof S!="string"&&typeof S!="number"||(l=l||[]).push(w,""+S):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Jn.hasOwnProperty(w)?(S!=null&&w==="onScroll"&&Re("scroll",t),l||_===S||(l=[])):(l=l||[]).push(w,S))}i&&(l=l||[]).push("style",i);var w=l;(e.updateQueue=w)&&(e.flags|=4)}};Cd=function(t,e,i,n){i!==n&&(e.flags|=4)};function Ln(t,e){if(!ke)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,n=0;if(e)for(var s=t.child;s!==null;)i|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)i|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=n,t.childLanes=i,e}function vp(t,e,i){var n=e.pendingProps;switch(Qa(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qe(e),null;case 1:return ct(e.type)&&uo(),Qe(e),null;case 3:return n=e.stateNode,_n(),Me(lt),Me(tt),al(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Mr(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mt!==null&&(Ta(Mt),Mt=null))),ma(t,e),Qe(e),null;case 5:sl(e);var s=Ri(cr.current);if(i=e.type,t!==null&&e.stateNode!=null)wd(t,e,i,n,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ae(166));return Qe(e),null}if(t=Ri(Ut.current),Mr(e)){n=e.stateNode,i=e.type;var l=e.memoizedProps;switch(n[jt]=e,n[ar]=l,t=(e.mode&1)!==0,i){case"dialog":Re("cancel",n),Re("close",n);break;case"iframe":case"object":case"embed":Re("load",n);break;case"video":case"audio":for(s=0;s<Un.length;s++)Re(Un[s],n);break;case"source":Re("error",n);break;case"img":case"image":case"link":Re("error",n),Re("load",n);break;case"details":Re("toggle",n);break;case"input":Gl(n,l),Re("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!l.multiple},Re("invalid",n);break;case"textarea":Hl(n,l),Re("invalid",n)}Gs(i,l),s=null;for(var d in l)if(l.hasOwnProperty(d)){var _=l[d];d==="children"?typeof _=="string"?n.textContent!==_&&(l.suppressHydrationWarning!==!0&&Dr(n.textContent,_,t),s=["children",_]):typeof _=="number"&&n.textContent!==""+_&&(l.suppressHydrationWarning!==!0&&Dr(n.textContent,_,t),s=["children",""+_]):Jn.hasOwnProperty(d)&&_!=null&&d==="onScroll"&&Re("scroll",n)}switch(i){case"input":xr(n),zl(n,l,!0);break;case"textarea":xr(n),Yl(n);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(n.onclick=co)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{d=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ku(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=d.createElement("div"),t.innerHTML="<script></script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=d.createElement(i,{is:n.is}):(t=d.createElement(i),i==="select"&&(d=t,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):t=d.createElementNS(t,i),t[jt]=e,t[ar]=n,Sd(t,e,!1,!1),e.stateNode=t;e:{switch(d=zs(i,n),i){case"dialog":Re("cancel",t),Re("close",t),s=n;break;case"iframe":case"object":case"embed":Re("load",t),s=n;break;case"video":case"audio":for(s=0;s<Un.length;s++)Re(Un[s],t);s=n;break;case"source":Re("error",t),s=n;break;case"img":case"image":case"link":Re("error",t),Re("load",t),s=n;break;case"details":Re("toggle",t),s=n;break;case"input":Gl(t,n),s=Ns(t,n),Re("invalid",t);break;case"option":s=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},s=Be({},n,{value:void 0}),Re("invalid",t);break;case"textarea":Hl(t,n),s=Us(t,n),Re("invalid",t);break;default:s=n}Gs(i,s),_=s;for(l in _)if(_.hasOwnProperty(l)){var S=_[l];l==="style"?Qu(t,S):l==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,S!=null&&Zu(t,S)):l==="children"?typeof S=="string"?(i!=="textarea"||S!=="")&&Qn(t,S):typeof S=="number"&&Qn(t,""+S):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Jn.hasOwnProperty(l)?S!=null&&l==="onScroll"&&Re("scroll",t):S!=null&&Ba(t,l,S,d))}switch(i){case"input":xr(t),zl(t,n,!1);break;case"textarea":xr(t),Yl(t);break;case"option":n.value!=null&&t.setAttribute("value",""+yi(n.value));break;case"select":t.multiple=!!n.multiple,l=n.value,l!=null?an(t,!!n.multiple,l,!1):n.defaultValue!=null&&an(t,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=co)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qe(e),null;case 6:if(t&&e.stateNode!=null)Cd(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ae(166));if(i=Ri(cr.current),Ri(Ut.current),Mr(e)){if(n=e.stateNode,i=e.memoizedProps,n[jt]=e,(l=n.nodeValue!==i)&&(t=_t,t!==null))switch(t.tag){case 3:Dr(n.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Dr(n.nodeValue,i,(t.mode&1)!==0)}l&&(e.flags|=4)}else n=(i.nodeType===9?i:i.ownerDocument).createTextNode(n),n[jt]=e,e.stateNode=n}return Qe(e),null;case 13:if(Me(Fe),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ke&&mt!==null&&e.mode&1&&!(e.flags&128))jh(),pn(),e.flags|=98560,l=!1;else if(l=Mr(e),n!==null&&n.dehydrated!==null){if(t===null){if(!l)throw Error(ae(318));if(l=e.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(ae(317));l[jt]=e}else pn(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qe(e),l=!1}else Mt!==null&&(Ta(Mt),Mt=null),l=!0;if(!l)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Fe.current&1?Ge===0&&(Ge=3):yl())),e.updateQueue!==null&&(e.flags|=4),Qe(e),null);case 4:return _n(),ma(t,e),t===null&&or(e.stateNode.containerInfo),Qe(e),null;case 10:return il(e.type._context),Qe(e),null;case 17:return ct(e.type)&&uo(),Qe(e),null;case 19:if(Me(Fe),l=e.memoizedState,l===null)return Qe(e),null;if(n=(e.flags&128)!==0,d=l.rendering,d===null)if(n)Ln(l,!1);else{if(Ge!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=vo(t),d!==null){for(e.flags|=128,Ln(l,!1),n=d.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=i,i=e.child;i!==null;)l=i,t=n,l.flags&=14680066,d=l.alternate,d===null?(l.childLanes=0,l.lanes=t,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=d.childLanes,l.lanes=d.lanes,l.child=d.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=d.memoizedProps,l.memoizedState=d.memoizedState,l.updateQueue=d.updateQueue,l.type=d.type,t=d.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return Oe(Fe,Fe.current&1|2),e.child}t=t.sibling}l.tail!==null&&je()>yn&&(e.flags|=128,n=!0,Ln(l,!1),e.lanes=4194304)}else{if(!n)if(t=vo(d),t!==null){if(e.flags|=128,n=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),Ln(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!ke)return Qe(e),null}else 2*je()-l.renderingStartTime>yn&&i!==1073741824&&(e.flags|=128,n=!0,Ln(l,!1),e.lanes=4194304);l.isBackwards?(d.sibling=e.child,e.child=d):(i=l.last,i!==null?i.sibling=d:e.child=d,l.last=d)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=je(),e.sibling=null,i=Fe.current,Oe(Fe,n?i&1|2:i&1),e):(Qe(e),null);case 22:case 23:return vl(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?ft&1073741824&&(Qe(e),e.subtreeFlags&6&&(e.flags|=8192)):Qe(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function yp(t,e){switch(Qa(e),e.tag){case 1:return ct(e.type)&&uo(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return _n(),Me(lt),Me(tt),al(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return sl(e),null;case 13:if(Me(Fe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));pn()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Me(Fe),null;case 4:return _n(),null;case 10:return il(e.type._context),null;case 22:case 23:return vl(),null;case 24:return null;default:return null}}var Fr=!1,et=!1,Sp=typeof WeakSet=="function"?WeakSet:Set,me=null;function on(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(n){Ne(t,e,n)}else i.current=null}function _a(t,e,i){try{i()}catch(n){Ne(t,e,n)}}var Fc=!1;function wp(t,e){if(ea=so,t=Eh(),Za(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var s=n.anchorOffset,l=n.focusNode;n=n.focusOffset;try{i.nodeType,l.nodeType}catch{i=null;break e}var d=0,_=-1,S=-1,w=0,T=0,A=t,I=null;t:for(;;){for(var k;A!==i||s!==0&&A.nodeType!==3||(_=d+s),A!==l||n!==0&&A.nodeType!==3||(S=d+n),A.nodeType===3&&(d+=A.nodeValue.length),(k=A.firstChild)!==null;)I=A,A=k;for(;;){if(A===t)break t;if(I===i&&++w===s&&(_=d),I===l&&++T===n&&(S=d),(k=A.nextSibling)!==null)break;A=I,I=A.parentNode}A=k}i=_===-1||S===-1?null:{start:_,end:S}}else i=null}i=i||{start:0,end:0}}else i=null;for(ta={focusedElem:t,selectionRange:i},so=!1,me=e;me!==null;)if(e=me,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,me=t;else for(;me!==null;){e=me;try{var B=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var F=B.memoizedProps,z=B.memoizedState,D=e.stateNode,R=D.getSnapshotBeforeUpdate(e.elementType===e.type?F:Rt(e.type,F),z);D.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var L=e.stateNode.containerInfo;L.nodeType===1?L.textContent="":L.nodeType===9&&L.documentElement&&L.removeChild(L.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch($){Ne(e,e.return,$)}if(t=e.sibling,t!==null){t.return=e.return,me=t;break}me=e.return}return B=Fc,Fc=!1,B}function $n(t,e,i){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&t)===t){var l=s.destroy;s.destroy=void 0,l!==void 0&&_a(e,i,l)}s=s.next}while(s!==n)}}function Go(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var n=i.create;i.destroy=n()}i=i.next}while(i!==e)}}function va(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function xd(t){var e=t.alternate;e!==null&&(t.alternate=null,xd(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[jt],delete e[ar],delete e[ra],delete e[np],delete e[rp])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Td(t){return t.tag===5||t.tag===3||t.tag===4}function Pc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Td(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ya(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=co));else if(n!==4&&(t=t.child,t!==null))for(ya(t,e,i),t=t.sibling;t!==null;)ya(t,e,i),t=t.sibling}function Sa(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Sa(t,e,i),t=t.sibling;t!==null;)Sa(t,e,i),t=t.sibling}var Xe=null,Dt=!1;function ii(t,e,i){for(i=i.child;i!==null;)bd(t,e,i),i=i.sibling}function bd(t,e,i){if(Vt&&typeof Vt.onCommitFiberUnmount=="function")try{Vt.onCommitFiberUnmount(Fo,i)}catch{}switch(i.tag){case 5:et||on(i,e);case 6:var n=Xe,s=Dt;Xe=null,ii(t,e,i),Xe=n,Dt=s,Xe!==null&&(Dt?(t=Xe,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):Xe.removeChild(i.stateNode));break;case 18:Xe!==null&&(Dt?(t=Xe,i=i.stateNode,t.nodeType===8?ps(t.parentNode,i):t.nodeType===1&&ps(t,i),ir(t)):ps(Xe,i.stateNode));break;case 4:n=Xe,s=Dt,Xe=i.stateNode.containerInfo,Dt=!0,ii(t,e,i),Xe=n,Dt=s;break;case 0:case 11:case 14:case 15:if(!et&&(n=i.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var l=s,d=l.destroy;l=l.tag,d!==void 0&&(l&2||l&4)&&_a(i,e,d),s=s.next}while(s!==n)}ii(t,e,i);break;case 1:if(!et&&(on(i,e),n=i.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(_){Ne(i,e,_)}ii(t,e,i);break;case 21:ii(t,e,i);break;case 22:i.mode&1?(et=(n=et)||i.memoizedState!==null,ii(t,e,i),et=n):ii(t,e,i);break;default:ii(t,e,i)}}function Bc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new Sp),e.forEach(function(n){var s=Rp.bind(null,t,n);i.has(n)||(i.add(n),n.then(s,s))})}}function Ot(t,e){var i=e.deletions;if(i!==null)for(var n=0;n<i.length;n++){var s=i[n];try{var l=t,d=e,_=d;e:for(;_!==null;){switch(_.tag){case 5:Xe=_.stateNode,Dt=!1;break e;case 3:Xe=_.stateNode.containerInfo,Dt=!0;break e;case 4:Xe=_.stateNode.containerInfo,Dt=!0;break e}_=_.return}if(Xe===null)throw Error(ae(160));bd(l,d,s),Xe=null,Dt=!1;var S=s.alternate;S!==null&&(S.return=null),s.return=null}catch(w){Ne(s,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ed(e,t),e=e.sibling}function Ed(t,e){var i=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ot(e,t),Pt(t),n&4){try{$n(3,t,t.return),Go(3,t)}catch(F){Ne(t,t.return,F)}try{$n(5,t,t.return)}catch(F){Ne(t,t.return,F)}}break;case 1:Ot(e,t),Pt(t),n&512&&i!==null&&on(i,i.return);break;case 5:if(Ot(e,t),Pt(t),n&512&&i!==null&&on(i,i.return),t.flags&32){var s=t.stateNode;try{Qn(s,"")}catch(F){Ne(t,t.return,F)}}if(n&4&&(s=t.stateNode,s!=null)){var l=t.memoizedProps,d=i!==null?i.memoizedProps:l,_=t.type,S=t.updateQueue;if(t.updateQueue=null,S!==null)try{_==="input"&&l.type==="radio"&&l.name!=null&&Xu(s,l),zs(_,d);var w=zs(_,l);for(d=0;d<S.length;d+=2){var T=S[d],A=S[d+1];T==="style"?Qu(s,A):T==="dangerouslySetInnerHTML"?Zu(s,A):T==="children"?Qn(s,A):Ba(s,T,A,w)}switch(_){case"input":js(s,l);break;case"textarea":$u(s,l);break;case"select":var I=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!l.multiple;var k=l.value;k!=null?an(s,!!l.multiple,k,!1):I!==!!l.multiple&&(l.defaultValue!=null?an(s,!!l.multiple,l.defaultValue,!0):an(s,!!l.multiple,l.multiple?[]:"",!1))}s[ar]=l}catch(F){Ne(t,t.return,F)}}break;case 6:if(Ot(e,t),Pt(t),n&4){if(t.stateNode===null)throw Error(ae(162));s=t.stateNode,l=t.memoizedProps;try{s.nodeValue=l}catch(F){Ne(t,t.return,F)}}break;case 3:if(Ot(e,t),Pt(t),n&4&&i!==null&&i.memoizedState.isDehydrated)try{ir(e.containerInfo)}catch(F){Ne(t,t.return,F)}break;case 4:Ot(e,t),Pt(t);break;case 13:Ot(e,t),Pt(t),s=t.child,s.flags&8192&&(l=s.memoizedState!==null,s.stateNode.isHidden=l,!l||s.alternate!==null&&s.alternate.memoizedState!==null||(ml=je())),n&4&&Bc(t);break;case 22:if(T=i!==null&&i.memoizedState!==null,t.mode&1?(et=(w=et)||T,Ot(e,t),et=w):Ot(e,t),Pt(t),n&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!T&&t.mode&1)for(me=t,T=t.child;T!==null;){for(A=me=T;me!==null;){switch(I=me,k=I.child,I.tag){case 0:case 11:case 14:case 15:$n(4,I,I.return);break;case 1:on(I,I.return);var B=I.stateNode;if(typeof B.componentWillUnmount=="function"){n=I,i=I.return;try{e=n,B.props=e.memoizedProps,B.state=e.memoizedState,B.componentWillUnmount()}catch(F){Ne(n,i,F)}}break;case 5:on(I,I.return);break;case 22:if(I.memoizedState!==null){jc(A);continue}}k!==null?(k.return=I,me=k):jc(A)}T=T.sibling}e:for(T=null,A=t;;){if(A.tag===5){if(T===null){T=A;try{s=A.stateNode,w?(l=s.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(_=A.stateNode,S=A.memoizedProps.style,d=S!=null&&S.hasOwnProperty("display")?S.display:null,_.style.display=Ju("display",d))}catch(F){Ne(t,t.return,F)}}}else if(A.tag===6){if(T===null)try{A.stateNode.nodeValue=w?"":A.memoizedProps}catch(F){Ne(t,t.return,F)}}else if((A.tag!==22&&A.tag!==23||A.memoizedState===null||A===t)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===t)break e;for(;A.sibling===null;){if(A.return===null||A.return===t)break e;T===A&&(T=null),A=A.return}T===A&&(T=null),A.sibling.return=A.return,A=A.sibling}}break;case 19:Ot(e,t),Pt(t),n&4&&Bc(t);break;case 21:break;default:Ot(e,t),Pt(t)}}function Pt(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(Td(i)){var n=i;break e}i=i.return}throw Error(ae(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(Qn(s,""),n.flags&=-33);var l=Pc(t);Sa(t,l,s);break;case 3:case 4:var d=n.stateNode.containerInfo,_=Pc(t);ya(t,_,d);break;default:throw Error(ae(161))}}catch(S){Ne(t,t.return,S)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Cp(t,e,i){me=t,Id(t)}function Id(t,e,i){for(var n=(t.mode&1)!==0;me!==null;){var s=me,l=s.child;if(s.tag===22&&n){var d=s.memoizedState!==null||Fr;if(!d){var _=s.alternate,S=_!==null&&_.memoizedState!==null||et;_=Fr;var w=et;if(Fr=d,(et=S)&&!w)for(me=s;me!==null;)d=me,S=d.child,d.tag===22&&d.memoizedState!==null?Vc(s):S!==null?(S.return=d,me=S):Vc(s);for(;l!==null;)me=l,Id(l),l=l.sibling;me=s,Fr=_,et=w}Nc(t)}else s.subtreeFlags&8772&&l!==null?(l.return=s,me=l):Nc(t)}}function Nc(t){for(;me!==null;){var e=me;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:et||Go(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!et)if(i===null)n.componentDidMount();else{var s=e.elementType===e.type?i.memoizedProps:Rt(e.type,i.memoizedProps);n.componentDidUpdate(s,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var l=e.updateQueue;l!==null&&wc(e,l,n);break;case 3:var d=e.updateQueue;if(d!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}wc(e,d,i)}break;case 5:var _=e.stateNode;if(i===null&&e.flags&4){i=_;var S=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":S.autoFocus&&i.focus();break;case"img":S.src&&(i.src=S.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var T=w.memoizedState;if(T!==null){var A=T.dehydrated;A!==null&&ir(A)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}et||e.flags&512&&va(e)}catch(I){Ne(e,e.return,I)}}if(e===t){me=null;break}if(i=e.sibling,i!==null){i.return=e.return,me=i;break}me=e.return}}function jc(t){for(;me!==null;){var e=me;if(e===t){me=null;break}var i=e.sibling;if(i!==null){i.return=e.return,me=i;break}me=e.return}}function Vc(t){for(;me!==null;){var e=me;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{Go(4,e)}catch(S){Ne(e,i,S)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(S){Ne(e,s,S)}}var l=e.return;try{va(e)}catch(S){Ne(e,l,S)}break;case 5:var d=e.return;try{va(e)}catch(S){Ne(e,d,S)}}}catch(S){Ne(e,e.return,S)}if(e===t){me=null;break}var _=e.sibling;if(_!==null){_.return=e.return,me=_;break}me=e.return}}var xp=Math.ceil,wo=ti.ReactCurrentDispatcher,gl=ti.ReactCurrentOwner,Et=ti.ReactCurrentBatchConfig,Ee=0,Ye=null,Ve=null,$e=0,ft=0,sn=Ci(0),Ge=0,fr=null,ji=0,zo=0,pl=0,Kn=null,st=null,ml=0,yn=1/0,Gt=null,Co=!1,wa=null,pi=null,Pr=!1,li=null,xo=0,Zn=0,Ca=null,Zr=-1,Jr=0;function nt(){return Ee&6?je():Zr!==-1?Zr:Zr=je()}function mi(t){return t.mode&1?Ee&2&&$e!==0?$e&-$e:sp.transition!==null?(Jr===0&&(Jr=uh()),Jr):(t=Ae,t!==0||(t=window.event,t=t===void 0?16:_h(t.type)),t):1}function kt(t,e,i,n){if(50<Zn)throw Zn=0,Ca=null,Error(ae(185));mr(t,i,n),(!(Ee&2)||t!==Ye)&&(t===Ye&&(!(Ee&2)&&(zo|=i),Ge===4&&si(t,$e)),ut(t,n),i===1&&Ee===0&&!(e.mode&1)&&(yn=je()+500,Vo&&xi()))}function ut(t,e){var i=t.callbackNode;sg(t,e);var n=oo(t,t===Ye?$e:0);if(n===0)i!==null&&Kl(i),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(i!=null&&Kl(i),e===1)t.tag===0?op(Uc.bind(null,t)):Ph(Uc.bind(null,t)),tp(function(){!(Ee&6)&&xi()}),i=null;else{switch(hh(n)){case 1:i=Wa;break;case 4:i=lh;break;case 16:i=ro;break;case 536870912:i=ch;break;default:i=ro}i=Fd(i,Ad.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function Ad(t,e){if(Zr=-1,Jr=0,Ee&6)throw Error(ae(327));var i=t.callbackNode;if(dn()&&t.callbackNode!==i)return null;var n=oo(t,t===Ye?$e:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=To(t,n);else{e=n;var s=Ee;Ee|=2;var l=Rd();(Ye!==t||$e!==e)&&(Gt=null,yn=je()+500,Mi(t,e));do try{Ep();break}catch(_){Od(t,_)}while(1);tl(),wo.current=l,Ee=s,Ve!==null?e=0:(Ye=null,$e=0,e=Ge)}if(e!==0){if(e===2&&(s=Ks(t),s!==0&&(n=s,e=xa(t,s))),e===1)throw i=fr,Mi(t,0),si(t,n),ut(t,je()),i;if(e===6)si(t,n);else{if(s=t.current.alternate,!(n&30)&&!Tp(s)&&(e=To(t,n),e===2&&(l=Ks(t),l!==0&&(n=l,e=xa(t,l))),e===1))throw i=fr,Mi(t,0),si(t,n),ut(t,je()),i;switch(t.finishedWork=s,t.finishedLanes=n,e){case 0:case 1:throw Error(ae(345));case 2:Ii(t,st,Gt);break;case 3:if(si(t,n),(n&130023424)===n&&(e=ml+500-je(),10<e)){if(oo(t,0)!==0)break;if(s=t.suspendedLanes,(s&n)!==n){nt(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=na(Ii.bind(null,t,st,Gt),e);break}Ii(t,st,Gt);break;case 4:if(si(t,n),(n&4194240)===n)break;for(e=t.eventTimes,s=-1;0<n;){var d=31-Lt(n);l=1<<d,d=e[d],d>s&&(s=d),n&=~l}if(n=s,n=je()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*xp(n/1960))-n,10<n){t.timeoutHandle=na(Ii.bind(null,t,st,Gt),n);break}Ii(t,st,Gt);break;case 5:Ii(t,st,Gt);break;default:throw Error(ae(329))}}}return ut(t,je()),t.callbackNode===i?Ad.bind(null,t):null}function xa(t,e){var i=Kn;return t.current.memoizedState.isDehydrated&&(Mi(t,e).flags|=256),t=To(t,e),t!==2&&(e=st,st=i,e!==null&&Ta(e)),t}function Ta(t){st===null?st=t:st.push.apply(st,t)}function Tp(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var n=0;n<i.length;n++){var s=i[n],l=s.getSnapshot;s=s.value;try{if(!Ft(l(),s))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function si(t,e){for(e&=~pl,e&=~zo,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-Lt(e),n=1<<i;t[i]=-1,e&=~n}}function Uc(t){if(Ee&6)throw Error(ae(327));dn();var e=oo(t,0);if(!(e&1))return ut(t,je()),null;var i=To(t,e);if(t.tag!==0&&i===2){var n=Ks(t);n!==0&&(e=n,i=xa(t,n))}if(i===1)throw i=fr,Mi(t,0),si(t,e),ut(t,je()),i;if(i===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ii(t,st,Gt),ut(t,je()),null}function _l(t,e){var i=Ee;Ee|=1;try{return t(e)}finally{Ee=i,Ee===0&&(yn=je()+500,Vo&&xi())}}function Vi(t){li!==null&&li.tag===0&&!(Ee&6)&&dn();var e=Ee;Ee|=1;var i=Et.transition,n=Ae;try{if(Et.transition=null,Ae=1,t)return t()}finally{Ae=n,Et.transition=i,Ee=e,!(Ee&6)&&xi()}}function vl(){ft=sn.current,Me(sn)}function Mi(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,ep(i)),Ve!==null)for(i=Ve.return;i!==null;){var n=i;switch(Qa(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&uo();break;case 3:_n(),Me(lt),Me(tt),al();break;case 5:sl(n);break;case 4:_n();break;case 13:Me(Fe);break;case 19:Me(Fe);break;case 10:il(n.type._context);break;case 22:case 23:vl()}i=i.return}if(Ye=t,Ve=t=_i(t.current,null),$e=ft=e,Ge=0,fr=null,pl=zo=ji=0,st=Kn=null,Oi!==null){for(e=0;e<Oi.length;e++)if(i=Oi[e],n=i.interleaved,n!==null){i.interleaved=null;var s=n.next,l=i.pending;if(l!==null){var d=l.next;l.next=s,n.next=d}i.pending=n}Oi=null}return t}function Od(t,e){do{var i=Ve;try{if(tl(),Xr.current=So,yo){for(var n=Pe.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}yo=!1}if(Ni=0,ze=We=Pe=null,Xn=!1,ur=0,gl.current=null,i===null||i.return===null){Ge=1,fr=e,Ve=null;break}e:{var l=t,d=i.return,_=i,S=e;if(e=$e,_.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){var w=S,T=_,A=T.tag;if(!(T.mode&1)&&(A===0||A===11||A===15)){var I=T.alternate;I?(T.updateQueue=I.updateQueue,T.memoizedState=I.memoizedState,T.lanes=I.lanes):(T.updateQueue=null,T.memoizedState=null)}var k=Ac(d);if(k!==null){k.flags&=-257,Oc(k,d,_,l,e),k.mode&1&&Ic(l,w,e),e=k,S=w;var B=e.updateQueue;if(B===null){var F=new Set;F.add(S),e.updateQueue=F}else B.add(S);break e}else{if(!(e&1)){Ic(l,w,e),yl();break e}S=Error(ae(426))}}else if(ke&&_.mode&1){var z=Ac(d);if(z!==null){!(z.flags&65536)&&(z.flags|=256),Oc(z,d,_,l,e),qa(vn(S,_));break e}}l=S=vn(S,_),Ge!==4&&(Ge=2),Kn===null?Kn=[l]:Kn.push(l),l=d;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e;var D=dd(l,S,e);Sc(l,D);break e;case 1:_=S;var R=l.type,L=l.stateNode;if(!(l.flags&128)&&(typeof R.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(pi===null||!pi.has(L)))){l.flags|=65536,e&=-e,l.lanes|=e;var $=fd(l,_,e);Sc(l,$);break e}}l=l.return}while(l!==null)}Md(i)}catch(ie){e=ie,Ve===i&&i!==null&&(Ve=i=i.return);continue}break}while(1)}function Rd(){var t=wo.current;return wo.current=So,t===null?So:t}function yl(){(Ge===0||Ge===3||Ge===2)&&(Ge=4),Ye===null||!(ji&268435455)&&!(zo&268435455)||si(Ye,$e)}function To(t,e){var i=Ee;Ee|=2;var n=Rd();(Ye!==t||$e!==e)&&(Gt=null,Mi(t,e));do try{bp();break}catch(s){Od(t,s)}while(1);if(tl(),Ee=i,wo.current=n,Ve!==null)throw Error(ae(261));return Ye=null,$e=0,Ge}function bp(){for(;Ve!==null;)Dd(Ve)}function Ep(){for(;Ve!==null&&!Jf();)Dd(Ve)}function Dd(t){var e=kd(t.alternate,t,ft);t.memoizedProps=t.pendingProps,e===null?Md(t):Ve=e,gl.current=null}function Md(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=yp(i,e),i!==null){i.flags&=32767,Ve=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ge=6,Ve=null;return}}else if(i=vp(i,e,ft),i!==null){Ve=i;return}if(e=e.sibling,e!==null){Ve=e;return}Ve=e=t}while(e!==null);Ge===0&&(Ge=5)}function Ii(t,e,i){var n=Ae,s=Et.transition;try{Et.transition=null,Ae=1,Ip(t,e,i,n)}finally{Et.transition=s,Ae=n}return null}function Ip(t,e,i,n){do dn();while(li!==null);if(Ee&6)throw Error(ae(327));i=t.finishedWork;var s=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var l=i.lanes|i.childLanes;if(ag(t,l),t===Ye&&(Ve=Ye=null,$e=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||Pr||(Pr=!0,Fd(ro,function(){return dn(),null})),l=(i.flags&15990)!==0,i.subtreeFlags&15990||l){l=Et.transition,Et.transition=null;var d=Ae;Ae=1;var _=Ee;Ee|=4,gl.current=null,wp(t,i),Ed(i,t),Xg(ta),so=!!ea,ta=ea=null,t.current=i,Cp(i),Qf(),Ee=_,Ae=d,Et.transition=l}else t.current=i;if(Pr&&(Pr=!1,li=t,xo=s),l=t.pendingLanes,l===0&&(pi=null),tg(i.stateNode),ut(t,je()),e!==null)for(n=t.onRecoverableError,i=0;i<e.length;i++)s=e[i],n(s.value,{componentStack:s.stack,digest:s.digest});if(Co)throw Co=!1,t=wa,wa=null,t;return xo&1&&t.tag!==0&&dn(),l=t.pendingLanes,l&1?t===Ca?Zn++:(Zn=0,Ca=t):Zn=0,xi(),null}function dn(){if(li!==null){var t=hh(xo),e=Et.transition,i=Ae;try{if(Et.transition=null,Ae=16>t?16:t,li===null)var n=!1;else{if(t=li,li=null,xo=0,Ee&6)throw Error(ae(331));var s=Ee;for(Ee|=4,me=t.current;me!==null;){var l=me,d=l.child;if(me.flags&16){var _=l.deletions;if(_!==null){for(var S=0;S<_.length;S++){var w=_[S];for(me=w;me!==null;){var T=me;switch(T.tag){case 0:case 11:case 15:$n(8,T,l)}var A=T.child;if(A!==null)A.return=T,me=A;else for(;me!==null;){T=me;var I=T.sibling,k=T.return;if(xd(T),T===w){me=null;break}if(I!==null){I.return=k,me=I;break}me=k}}}var B=l.alternate;if(B!==null){var F=B.child;if(F!==null){B.child=null;do{var z=F.sibling;F.sibling=null,F=z}while(F!==null)}}me=l}}if(l.subtreeFlags&2064&&d!==null)d.return=l,me=d;else e:for(;me!==null;){if(l=me,l.flags&2048)switch(l.tag){case 0:case 11:case 15:$n(9,l,l.return)}var D=l.sibling;if(D!==null){D.return=l.return,me=D;break e}me=l.return}}var R=t.current;for(me=R;me!==null;){d=me;var L=d.child;if(d.subtreeFlags&2064&&L!==null)L.return=d,me=L;else e:for(d=R;me!==null;){if(_=me,_.flags&2048)try{switch(_.tag){case 0:case 11:case 15:Go(9,_)}}catch(ie){Ne(_,_.return,ie)}if(_===d){me=null;break e}var $=_.sibling;if($!==null){$.return=_.return,me=$;break e}me=_.return}}if(Ee=s,xi(),Vt&&typeof Vt.onPostCommitFiberRoot=="function")try{Vt.onPostCommitFiberRoot(Fo,t)}catch{}n=!0}return n}finally{Ae=i,Et.transition=e}}return!1}function Wc(t,e,i){e=vn(i,e),e=dd(t,e,1),t=gi(t,e,1),e=nt(),t!==null&&(mr(t,1,e),ut(t,e))}function Ne(t,e,i){if(t.tag===3)Wc(t,t,i);else for(;e!==null;){if(e.tag===3){Wc(e,t,i);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(pi===null||!pi.has(n))){t=vn(i,t),t=fd(e,t,1),e=gi(e,t,1),t=nt(),e!==null&&(mr(e,1,t),ut(e,t));break}}e=e.return}}function Ap(t,e,i){var n=t.pingCache;n!==null&&n.delete(e),e=nt(),t.pingedLanes|=t.suspendedLanes&i,Ye===t&&($e&i)===i&&(Ge===4||Ge===3&&($e&130023424)===$e&&500>je()-ml?Mi(t,0):pl|=i),ut(t,e)}function Ld(t,e){e===0&&(t.mode&1?(e=Er,Er<<=1,!(Er&130023424)&&(Er=4194304)):e=1);var i=nt();t=Qt(t,e),t!==null&&(mr(t,e,i),ut(t,i))}function Op(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),Ld(t,i)}function Rp(t,e){var i=0;switch(t.tag){case 13:var n=t.stateNode,s=t.memoizedState;s!==null&&(i=s.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(ae(314))}n!==null&&n.delete(e),Ld(t,i)}var kd;kd=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||lt.current)at=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return at=!1,_p(t,e,i);at=!!(t.flags&131072)}else at=!1,ke&&e.flags&1048576&&Bh(e,go,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Kr(t,e),t=e.pendingProps;var s=gn(e,tt.current);hn(e,i),s=cl(null,e,n,t,s,i);var l=ul();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ct(n)?(l=!0,ho(e)):l=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,rl(e),s.updater=Uo,e.stateNode=s,s._reactInternals=e,ua(e,n,t,i),e=fa(null,e,n,!0,l,i)):(e.tag=0,ke&&l&&Ja(e),it(null,e,s,i),e=e.child),e;case 16:n=e.elementType;e:{switch(Kr(t,e),t=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=Mp(n),t=Rt(n,t),s){case 0:e=da(null,e,n,t,i);break e;case 1:e=Mc(null,e,n,t,i);break e;case 11:e=Rc(null,e,n,t,i);break e;case 14:e=Dc(null,e,n,Rt(n.type,t),i);break e}throw Error(ae(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Rt(n,s),da(t,e,n,s,i);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Rt(n,s),Mc(t,e,n,s,i);case 3:e:{if(_d(e),t===null)throw Error(ae(387));n=e.pendingProps,l=e.memoizedState,s=l.element,Uh(t,e),_o(e,n,null,i);var d=e.memoizedState;if(n=d.element,l.isDehydrated)if(l={element:n,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=l,e.memoizedState=l,e.flags&256){s=vn(Error(ae(423)),e),e=Lc(t,e,n,i,s);break e}else if(n!==s){s=vn(Error(ae(424)),e),e=Lc(t,e,n,i,s);break e}else for(mt=fi(e.stateNode.containerInfo.firstChild),_t=e,ke=!0,Mt=null,i=Hh(e,null,n,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(pn(),n===s){e=qt(t,e,i);break e}it(t,e,n,i)}e=e.child}return e;case 5:return Yh(e),t===null&&aa(e),n=e.type,s=e.pendingProps,l=t!==null?t.memoizedProps:null,d=s.children,ia(n,s)?d=null:l!==null&&ia(n,l)&&(e.flags|=32),md(t,e),it(t,e,d,i),e.child;case 6:return t===null&&aa(e),null;case 13:return vd(t,e,i);case 4:return ol(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=mn(e,null,n,i):it(t,e,n,i),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Rt(n,s),Rc(t,e,n,s,i);case 7:return it(t,e,e.pendingProps,i),e.child;case 8:return it(t,e,e.pendingProps.children,i),e.child;case 12:return it(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,l=e.memoizedProps,d=s.value,Oe(po,n._currentValue),n._currentValue=d,l!==null)if(Ft(l.value,d)){if(l.children===s.children&&!lt.current){e=qt(t,e,i);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var _=l.dependencies;if(_!==null){d=l.child;for(var S=_.firstContext;S!==null;){if(S.context===n){if(l.tag===1){S=Kt(-1,i&-i),S.tag=2;var w=l.updateQueue;if(w!==null){w=w.shared;var T=w.pending;T===null?S.next=S:(S.next=T.next,T.next=S),w.pending=S}}l.lanes|=i,S=l.alternate,S!==null&&(S.lanes|=i),la(l.return,i,e),_.lanes|=i;break}S=S.next}}else if(l.tag===10)d=l.type===e.type?null:l.child;else if(l.tag===18){if(d=l.return,d===null)throw Error(ae(341));d.lanes|=i,_=d.alternate,_!==null&&(_.lanes|=i),la(d,i,e),d=l.sibling}else d=l.child;if(d!==null)d.return=l;else for(d=l;d!==null;){if(d===e){d=null;break}if(l=d.sibling,l!==null){l.return=d.return,d=l;break}d=d.return}l=d}it(t,e,s.children,i),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,hn(e,i),s=It(s),n=n(s),e.flags|=1,it(t,e,n,i),e.child;case 14:return n=e.type,s=Rt(n,e.pendingProps),s=Rt(n.type,s),Dc(t,e,n,s,i);case 15:return gd(t,e,e.type,e.pendingProps,i);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Rt(n,s),Kr(t,e),e.tag=1,ct(n)?(t=!0,ho(e)):t=!1,hn(e,i),Gh(e,n,s),ua(e,n,s,i),fa(null,e,n,!0,t,i);case 19:return yd(t,e,i);case 22:return pd(t,e,i)}throw Error(ae(156,e.tag))};function Fd(t,e){return ah(t,e)}function Dp(t,e,i,n){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function bt(t,e,i,n){return new Dp(t,e,i,n)}function Sl(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Mp(t){if(typeof t=="function")return Sl(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ja)return 11;if(t===Va)return 14}return 2}function _i(t,e){var i=t.alternate;return i===null?(i=bt(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Qr(t,e,i,n,s,l){var d=2;if(n=t,typeof t=="function")Sl(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case Ki:return Li(i.children,s,l,e);case Na:d=8,s|=8;break;case ks:return t=bt(12,i,e,s|2),t.elementType=ks,t.lanes=l,t;case Fs:return t=bt(13,i,e,s),t.elementType=Fs,t.lanes=l,t;case Ps:return t=bt(19,i,e,s),t.elementType=Ps,t.lanes=l,t;case zu:return Ho(i,s,l,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Wu:d=10;break e;case Gu:d=9;break e;case ja:d=11;break e;case Va:d=14;break e;case ni:d=16,n=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=bt(d,i,e,s),e.elementType=t,e.type=n,e.lanes=l,e}function Li(t,e,i,n){return t=bt(7,t,n,e),t.lanes=i,t}function Ho(t,e,i,n){return t=bt(22,t,n,e),t.elementType=zu,t.lanes=i,t.stateNode={isHidden:!1},t}function xs(t,e,i){return t=bt(6,t,null,e),t.lanes=i,t}function Ts(t,e,i){return e=bt(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Lp(t,e,i,n,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rs(0),this.expirationTimes=rs(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rs(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function wl(t,e,i,n,s,l,d,_,S){return t=new Lp(t,e,i,_,S),e===1?(e=1,l===!0&&(e|=8)):e=0,l=bt(3,null,null,e),t.current=l,l.stateNode=t,l.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},rl(l),t}function kp(t,e,i){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$i,key:n==null?null:""+n,children:t,containerInfo:e,implementation:i}}function Pd(t){if(!t)return Si;t=t._reactInternals;e:{if(Wi(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ct(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var i=t.type;if(ct(i))return Fh(t,i,e)}return e}function Bd(t,e,i,n,s,l,d,_,S){return t=wl(i,n,!0,t,s,l,d,_,S),t.context=Pd(null),i=t.current,n=nt(),s=mi(i),l=Kt(n,s),l.callback=e??null,gi(i,l,s),t.current.lanes=s,mr(t,s,n),ut(t,n),t}function Yo(t,e,i,n){var s=e.current,l=nt(),d=mi(s);return i=Pd(i),e.context===null?e.context=i:e.pendingContext=i,e=Kt(l,d),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=gi(s,e,d),t!==null&&(kt(t,s,d,l),Yr(t,s,d)),d}function bo(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Gc(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function Cl(t,e){Gc(t,e),(t=t.alternate)&&Gc(t,e)}function Fp(){return null}var Nd=typeof reportError=="function"?reportError:function(t){console.error(t)};function xl(t){this._internalRoot=t}Xo.prototype.render=xl.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));Yo(t,e,null,null)};Xo.prototype.unmount=xl.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Vi(function(){Yo(null,t,null,null)}),e[Jt]=null}};function Xo(t){this._internalRoot=t}Xo.prototype.unstable_scheduleHydration=function(t){if(t){var e=gh();t={blockedOn:null,target:t,priority:e};for(var i=0;i<oi.length&&e!==0&&e<oi[i].priority;i++);oi.splice(i,0,t),i===0&&mh(t)}};function Tl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function $o(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function zc(){}function Pp(t,e,i,n,s){if(s){if(typeof n=="function"){var l=n;n=function(){var w=bo(d);l.call(w)}}var d=Bd(e,n,t,0,null,!1,!1,"",zc);return t._reactRootContainer=d,t[Jt]=d.current,or(t.nodeType===8?t.parentNode:t),Vi(),d}for(;s=t.lastChild;)t.removeChild(s);if(typeof n=="function"){var _=n;n=function(){var w=bo(S);_.call(w)}}var S=wl(t,0,!1,null,null,!1,!1,"",zc);return t._reactRootContainer=S,t[Jt]=S.current,or(t.nodeType===8?t.parentNode:t),Vi(function(){Yo(e,S,i,n)}),S}function Ko(t,e,i,n,s){var l=i._reactRootContainer;if(l){var d=l;if(typeof s=="function"){var _=s;s=function(){var S=bo(d);_.call(S)}}Yo(e,d,t,s)}else d=Pp(i,e,t,s,n);return bo(d)}dh=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=Vn(e.pendingLanes);i!==0&&(Ga(e,i|1),ut(e,je()),!(Ee&6)&&(yn=je()+500,xi()))}break;case 13:Vi(function(){var n=Qt(t,1);if(n!==null){var s=nt();kt(n,t,1,s)}}),Cl(t,1)}};za=function(t){if(t.tag===13){var e=Qt(t,134217728);if(e!==null){var i=nt();kt(e,t,134217728,i)}Cl(t,134217728)}};fh=function(t){if(t.tag===13){var e=mi(t),i=Qt(t,e);if(i!==null){var n=nt();kt(i,t,e,n)}Cl(t,e)}};gh=function(){return Ae};ph=function(t,e){var i=Ae;try{return Ae=t,e()}finally{Ae=i}};Ys=function(t,e,i){switch(e){case"input":if(js(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var n=i[e];if(n!==t&&n.form===t.form){var s=jo(n);if(!s)throw Error(ae(90));Yu(n),js(n,s)}}}break;case"textarea":$u(t,i);break;case"select":e=i.value,e!=null&&an(t,!!i.multiple,e,!1)}};th=_l;ih=Vi;var Bp={usingClientEntryPoint:!1,Events:[vr,qi,jo,qu,eh,_l]},kn={findFiberByHostInstance:Ai,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Np={bundleType:kn.bundleType,version:kn.version,rendererPackageName:kn.rendererPackageName,rendererConfig:kn.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ti.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=oh(t),t===null?null:t.stateNode},findFiberByHostInstance:kn.findFiberByHostInstance||Fp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Br=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Br.isDisabled&&Br.supportsFiber)try{Fo=Br.inject(Np),Vt=Br}catch{}}yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bp;yt.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tl(e))throw Error(ae(200));return kp(t,e,null,i)};yt.createRoot=function(t,e){if(!Tl(t))throw Error(ae(299));var i=!1,n="",s=Nd;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=wl(t,1,!1,null,null,i,!1,n,s),t[Jt]=e.current,or(t.nodeType===8?t.parentNode:t),new xl(e)};yt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=oh(e),t=t===null?null:t.stateNode,t};yt.flushSync=function(t){return Vi(t)};yt.hydrate=function(t,e,i){if(!$o(e))throw Error(ae(200));return Ko(null,t,e,!0,i)};yt.hydrateRoot=function(t,e,i){if(!Tl(t))throw Error(ae(405));var n=i!=null&&i.hydratedSources||null,s=!1,l="",d=Nd;if(i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onRecoverableError!==void 0&&(d=i.onRecoverableError)),e=Bd(e,null,t,1,i??null,s,!1,l,d),t[Jt]=e.current,or(t),n)for(t=0;t<n.length;t++)i=n[t],s=i._getVersion,s=s(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,s]:e.mutableSourceEagerHydrationData.push(i,s);return new Xo(e)};yt.render=function(t,e,i){if(!$o(e))throw Error(ae(200));return Ko(null,t,e,!1,i)};yt.unmountComponentAtNode=function(t){if(!$o(t))throw Error(ae(40));return t._reactRootContainer?(Vi(function(){Ko(null,null,t,!1,function(){t._reactRootContainer=null,t[Jt]=null})}),!0):!1};yt.unstable_batchedUpdates=_l;yt.unstable_renderSubtreeIntoContainer=function(t,e,i,n){if(!$o(i))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return Ko(t,e,i,!1,n)};yt.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}e(),t.exports=yt})(Bu);var Hc=Bu.exports;Ms.createRoot=Hc.createRoot,Ms.hydrateRoot=Hc.hydrateRoot;function jp(t,e,i,n){t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(l){var d=this;if(!d.ctx||!d.ctx.listener)return d;for(var _=d._howls.length-1;_>=0;_--)d._howls[_].stereo(l);return d},t.prototype.pos=function(l,d,_){var S=this;if(!S.ctx||!S.ctx.listener)return S;if(d=typeof d!="number"?S._pos[1]:d,_=typeof _!="number"?S._pos[2]:_,typeof l=="number")S._pos=[l,d,_],typeof S.ctx.listener.positionX<"u"?(S.ctx.listener.positionX.setTargetAtTime(S._pos[0],e.ctx.currentTime,.1),S.ctx.listener.positionY.setTargetAtTime(S._pos[1],e.ctx.currentTime,.1),S.ctx.listener.positionZ.setTargetAtTime(S._pos[2],e.ctx.currentTime,.1)):S.ctx.listener.setPosition(S._pos[0],S._pos[1],S._pos[2]);else return S._pos;return S},t.prototype.orientation=function(l,d,_,S,w,T){var A=this;if(!A.ctx||!A.ctx.listener)return A;var I=A._orientation;if(d=typeof d!="number"?I[1]:d,_=typeof _!="number"?I[2]:_,S=typeof S!="number"?I[3]:S,w=typeof w!="number"?I[4]:w,T=typeof T!="number"?I[5]:T,typeof l=="number")A._orientation=[l,d,_,S,w,T],typeof A.ctx.listener.forwardX<"u"?(A.ctx.listener.forwardX.setTargetAtTime(l,e.ctx.currentTime,.1),A.ctx.listener.forwardY.setTargetAtTime(d,e.ctx.currentTime,.1),A.ctx.listener.forwardZ.setTargetAtTime(_,e.ctx.currentTime,.1),A.ctx.listener.upX.setTargetAtTime(S,e.ctx.currentTime,.1),A.ctx.listener.upY.setTargetAtTime(w,e.ctx.currentTime,.1),A.ctx.listener.upZ.setTargetAtTime(T,e.ctx.currentTime,.1)):A.ctx.listener.setOrientation(l,d,_,S,w,T);else return I;return A},i.prototype.init=function(l){return function(d){var _=this;return _._orientation=d.orientation||[1,0,0],_._stereo=d.stereo||null,_._pos=d.pos||null,_._pannerAttr={coneInnerAngle:typeof d.coneInnerAngle<"u"?d.coneInnerAngle:360,coneOuterAngle:typeof d.coneOuterAngle<"u"?d.coneOuterAngle:360,coneOuterGain:typeof d.coneOuterGain<"u"?d.coneOuterGain:0,distanceModel:typeof d.distanceModel<"u"?d.distanceModel:"inverse",maxDistance:typeof d.maxDistance<"u"?d.maxDistance:1e4,panningModel:typeof d.panningModel<"u"?d.panningModel:"HRTF",refDistance:typeof d.refDistance<"u"?d.refDistance:1,rolloffFactor:typeof d.rolloffFactor<"u"?d.rolloffFactor:1},_._onstereo=d.onstereo?[{fn:d.onstereo}]:[],_._onpos=d.onpos?[{fn:d.onpos}]:[],_._onorientation=d.onorientation?[{fn:d.onorientation}]:[],l.call(this,d)}}(i.prototype.init),i.prototype.stereo=function(l,d){var _=this;if(!_._webAudio)return _;if(_._state!=="loaded")return _._queue.push({event:"stereo",action:function(){_.stereo(l,d)}}),_;var S=typeof e.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof d>"u")if(typeof l=="number")_._stereo=l,_._pos=[l,0,0];else return _._stereo;for(var w=_._getSoundIds(d),T=0;T<w.length;T++){var A=_._soundById(w[T]);if(A)if(typeof l=="number")A._stereo=l,A._pos=[l,0,0],A._node&&(A._pannerAttr.panningModel="equalpower",(!A._panner||!A._panner.pan)&&s(A,S),S==="spatial"?typeof A._panner.positionX<"u"?(A._panner.positionX.setValueAtTime(l,e.ctx.currentTime),A._panner.positionY.setValueAtTime(0,e.ctx.currentTime),A._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):A._panner.setPosition(l,0,0):A._panner.pan.setValueAtTime(l,e.ctx.currentTime)),_._emit("stereo",A._id);else return A._stereo}return _},i.prototype.pos=function(l,d,_,S){var w=this;if(!w._webAudio)return w;if(w._state!=="loaded")return w._queue.push({event:"pos",action:function(){w.pos(l,d,_,S)}}),w;if(d=typeof d!="number"?0:d,_=typeof _!="number"?-.5:_,typeof S>"u")if(typeof l=="number")w._pos=[l,d,_];else return w._pos;for(var T=w._getSoundIds(S),A=0;A<T.length;A++){var I=w._soundById(T[A]);if(I)if(typeof l=="number")I._pos=[l,d,_],I._node&&((!I._panner||I._panner.pan)&&s(I,"spatial"),typeof I._panner.positionX<"u"?(I._panner.positionX.setValueAtTime(l,e.ctx.currentTime),I._panner.positionY.setValueAtTime(d,e.ctx.currentTime),I._panner.positionZ.setValueAtTime(_,e.ctx.currentTime)):I._panner.setPosition(l,d,_)),w._emit("pos",I._id);else return I._pos}return w},i.prototype.orientation=function(l,d,_,S){var w=this;if(!w._webAudio)return w;if(w._state!=="loaded")return w._queue.push({event:"orientation",action:function(){w.orientation(l,d,_,S)}}),w;if(d=typeof d!="number"?w._orientation[1]:d,_=typeof _!="number"?w._orientation[2]:_,typeof S>"u")if(typeof l=="number")w._orientation=[l,d,_];else return w._orientation;for(var T=w._getSoundIds(S),A=0;A<T.length;A++){var I=w._soundById(T[A]);if(I)if(typeof l=="number")I._orientation=[l,d,_],I._node&&(I._panner||(I._pos||(I._pos=w._pos||[0,0,-.5]),s(I,"spatial")),typeof I._panner.orientationX<"u"?(I._panner.orientationX.setValueAtTime(l,e.ctx.currentTime),I._panner.orientationY.setValueAtTime(d,e.ctx.currentTime),I._panner.orientationZ.setValueAtTime(_,e.ctx.currentTime)):I._panner.setOrientation(l,d,_)),w._emit("orientation",I._id);else return I._orientation}return w},i.prototype.pannerAttr=function(){var l=this,d=arguments,_,S,w;if(!l._webAudio)return l;if(d.length===0)return l._pannerAttr;if(d.length===1)if(typeof d[0]=="object")_=d[0],typeof S>"u"&&(_.pannerAttr||(_.pannerAttr={coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor,panningModel:_.panningModel}),l._pannerAttr={coneInnerAngle:typeof _.pannerAttr.coneInnerAngle<"u"?_.pannerAttr.coneInnerAngle:l._coneInnerAngle,coneOuterAngle:typeof _.pannerAttr.coneOuterAngle<"u"?_.pannerAttr.coneOuterAngle:l._coneOuterAngle,coneOuterGain:typeof _.pannerAttr.coneOuterGain<"u"?_.pannerAttr.coneOuterGain:l._coneOuterGain,distanceModel:typeof _.pannerAttr.distanceModel<"u"?_.pannerAttr.distanceModel:l._distanceModel,maxDistance:typeof _.pannerAttr.maxDistance<"u"?_.pannerAttr.maxDistance:l._maxDistance,refDistance:typeof _.pannerAttr.refDistance<"u"?_.pannerAttr.refDistance:l._refDistance,rolloffFactor:typeof _.pannerAttr.rolloffFactor<"u"?_.pannerAttr.rolloffFactor:l._rolloffFactor,panningModel:typeof _.pannerAttr.panningModel<"u"?_.pannerAttr.panningModel:l._panningModel});else return w=l._soundById(parseInt(d[0],10)),w?w._pannerAttr:l._pannerAttr;else d.length===2&&(_=d[0],S=parseInt(d[1],10));for(var T=l._getSoundIds(S),A=0;A<T.length;A++)if(w=l._soundById(T[A]),w){var I=w._pannerAttr;I={coneInnerAngle:typeof _.coneInnerAngle<"u"?_.coneInnerAngle:I.coneInnerAngle,coneOuterAngle:typeof _.coneOuterAngle<"u"?_.coneOuterAngle:I.coneOuterAngle,coneOuterGain:typeof _.coneOuterGain<"u"?_.coneOuterGain:I.coneOuterGain,distanceModel:typeof _.distanceModel<"u"?_.distanceModel:I.distanceModel,maxDistance:typeof _.maxDistance<"u"?_.maxDistance:I.maxDistance,refDistance:typeof _.refDistance<"u"?_.refDistance:I.refDistance,rolloffFactor:typeof _.rolloffFactor<"u"?_.rolloffFactor:I.rolloffFactor,panningModel:typeof _.panningModel<"u"?_.panningModel:I.panningModel};var k=w._panner;k||(w._pos||(w._pos=l._pos||[0,0,-.5]),s(w,"spatial"),k=w._panner),k.coneInnerAngle=I.coneInnerAngle,k.coneOuterAngle=I.coneOuterAngle,k.coneOuterGain=I.coneOuterGain,k.distanceModel=I.distanceModel,k.maxDistance=I.maxDistance,k.refDistance=I.refDistance,k.rolloffFactor=I.rolloffFactor,k.panningModel=I.panningModel}return l},n.prototype.init=function(l){return function(){var d=this,_=d._parent;d._orientation=_._orientation,d._stereo=_._stereo,d._pos=_._pos,d._pannerAttr=_._pannerAttr,l.call(this),d._stereo?_.stereo(d._stereo):d._pos&&_.pos(d._pos[0],d._pos[1],d._pos[2],d._id)}}(n.prototype.init),n.prototype.reset=function(l){return function(){var d=this,_=d._parent;return d._orientation=_._orientation,d._stereo=_._stereo,d._pos=_._pos,d._pannerAttr=_._pannerAttr,d._stereo?_.stereo(d._stereo):d._pos?_.pos(d._pos[0],d._pos[1],d._pos[2],d._id):d._panner&&(d._panner.disconnect(0),d._panner=void 0,_._refreshBuffer(d)),l.call(this)}}(n.prototype.reset);var s=function(l,d){d=d||"spatial",d==="spatial"?(l._panner=e.ctx.createPanner(),l._panner.coneInnerAngle=l._pannerAttr.coneInnerAngle,l._panner.coneOuterAngle=l._pannerAttr.coneOuterAngle,l._panner.coneOuterGain=l._pannerAttr.coneOuterGain,l._panner.distanceModel=l._pannerAttr.distanceModel,l._panner.maxDistance=l._pannerAttr.maxDistance,l._panner.refDistance=l._pannerAttr.refDistance,l._panner.rolloffFactor=l._pannerAttr.rolloffFactor,l._panner.panningModel=l._pannerAttr.panningModel,typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(l._pos[0],e.ctx.currentTime),l._panner.positionY.setValueAtTime(l._pos[1],e.ctx.currentTime),l._panner.positionZ.setValueAtTime(l._pos[2],e.ctx.currentTime)):l._panner.setPosition(l._pos[0],l._pos[1],l._pos[2]),typeof l._panner.orientationX<"u"?(l._panner.orientationX.setValueAtTime(l._orientation[0],e.ctx.currentTime),l._panner.orientationY.setValueAtTime(l._orientation[1],e.ctx.currentTime),l._panner.orientationZ.setValueAtTime(l._orientation[2],e.ctx.currentTime)):l._panner.setOrientation(l._orientation[0],l._orientation[1],l._orientation[2])):(l._panner=e.ctx.createStereoPanner(),l._panner.pan.setValueAtTime(l._stereo,e.ctx.currentTime)),l._panner.connect(l._node),l._paused||l._parent.pause(l._id,!0).play(l._id,!0)}}var bl=function(){this.init()};bl.prototype={init:function(){var t=this||oe;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||oe;if(t=parseFloat(t),e.ctx||qr(),typeof t<"u"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,oe.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),s=0;s<n.length;s++){var l=e._howls[i]._soundById(n[s]);l&&l._node&&(l._node.volume=l._volume*t)}return e}return e._volume},mute:function(t){var e=this||oe;e.ctx||qr(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,oe.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),s=0;s<n.length;s++){var l=e._howls[i]._soundById(n[s]);l&&l._node&&(l._node.muted=t?!0:l._muted)}return e},stop:function(){for(var t=this||oe,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||oe,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,qr()),t},codecs:function(t){return(this||oe)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||oe;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{var e=new Audio;typeof e.oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||oe,e=null;try{e=typeof Audio<"u"?new Audio:null}catch{return t}if(!e||typeof e.canPlayType!="function")return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",s=n.match(/OPR\/([0-6].)/g),l=s&&parseInt(s[0].split("/")[1],10)<33,d=n.indexOf("Safari")!==-1&&n.indexOf("Chrome")===-1,_=n.match(/Version\/(.*?) /),S=d&&_&&parseInt(_[1],10)<15;return t._codecs={mp3:!!(!l&&(i||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!S&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!S&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||oe;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch{t.noAudio=!0;break}for(var s=0;s<t._howls.length;s++)if(!t._howls[s]._webAudio)for(var l=t._howls[s]._getSoundIds(),d=0;d<l.length;d++){var _=t._howls[s]._soundById(l[d]);_&&_._node&&!_._node._unlocked&&(_._node._unlocked=!0,_._node.load())}t._autoResume();var S=t.ctx.createBufferSource();S.buffer=t._scratchBuffer,S.connect(t.ctx.destination),typeof S.start>"u"?S.noteOn(0):S.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),S.onended=function(){S.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var w=0;w<t._howls.length;w++)t._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||oe;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=new Audio().play();return e&&typeof Promise<"u"&&(e instanceof Promise||typeof e.then=="function")&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||oe;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend>"u"||!oe.usingWebAudio)){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio){for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var n=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(n,n)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume>"u"||!oe.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var oe=new bl,Eo=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};Eo.prototype={init:function(t){var e=this;return oe.ctx||qr(),e._autoplay=t.autoplay||!1,e._format=typeof t.format!="string"?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src=typeof t.src!="string"?t.src:[t.src],e._volume=t.volume!==void 0?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=oe.usingWebAudio&&!e._html5,typeof oe.ctx<"u"&&oe.ctx&&oe.autoUnlock&&oe._unlockAudio(),oe._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e._preload!=="none"&&e.load(),e},load:function(){var t=this,e=null;if(oe.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var n,s;if(t._format&&t._format[i])n=t._format[i];else{if(s=t._src[i],typeof s!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}n=/^data:audio\/([^;,]+);/i.exec(s),n||(n=/\.([^.]+)$/.exec(s.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&oe.codecs(n)){e=t._src[i];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=e,t._state="loading",window.location.protocol==="https:"&&e.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new Io(t),t._webAudio&&Vp(t),t},play:function(t,e){var i=this,n=null;if(typeof t=="number")n=t,t=null;else{if(typeof t=="string"&&i._state==="loaded"&&!i._sprite[t])return null;if(typeof t>"u"&&(t="__default",!i._playLock)){for(var s=0,l=0;l<i._sounds.length;l++)i._sounds[l]._paused&&!i._sounds[l]._ended&&(s++,n=i._sounds[l]._id);s===1?t=null:n=null}}var d=n?i._soundById(n):i._inactiveSound();if(!d)return null;if(n&&!t&&(t=d._sprite||"__default"),i._state!=="loaded"){d._sprite=t,d._ended=!1;var _=d._id;return i._queue.push({event:"play",action:function(){i.play(_)}}),_}if(n&&!d._paused)return e||i._loadQueue("play"),d._id;i._webAudio&&oe._autoResume();var S=Math.max(0,d._seek>0?d._seek:i._sprite[t][0]/1e3),w=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-S),T=w*1e3/Math.abs(d._rate),A=i._sprite[t][0]/1e3,I=(i._sprite[t][0]+i._sprite[t][1])/1e3;d._sprite=t,d._ended=!1;var k=function(){d._paused=!1,d._seek=S,d._start=A,d._stop=I,d._loop=!!(d._loop||i._sprite[t][2])};if(S>=I){i._ended(d);return}var B=d._node;if(i._webAudio){var F=function(){i._playLock=!1,k(),i._refreshBuffer(d);var L=d._muted||i._muted?0:d._volume;B.gain.setValueAtTime(L,oe.ctx.currentTime),d._playStart=oe.ctx.currentTime,typeof B.bufferSource.start>"u"?d._loop?B.bufferSource.noteGrainOn(0,S,86400):B.bufferSource.noteGrainOn(0,S,w):d._loop?B.bufferSource.start(0,S,86400):B.bufferSource.start(0,S,w),T!==1/0&&(i._endTimers[d._id]=setTimeout(i._ended.bind(i,d),T)),e||setTimeout(function(){i._emit("play",d._id),i._loadQueue()},0)};oe.state==="running"&&oe.ctx.state!=="interrupted"?F():(i._playLock=!0,i.once("resume",F),i._clearTimer(d._id))}else{var z=function(){B.currentTime=S,B.muted=d._muted||i._muted||oe._muted||B.muted,B.volume=d._volume*oe.volume(),B.playbackRate=d._rate;try{var L=B.play();if(L&&typeof Promise<"u"&&(L instanceof Promise||typeof L.then=="function")?(i._playLock=!0,k(),L.then(function(){i._playLock=!1,B._unlocked=!0,e?i._loadQueue():i._emit("play",d._id)}).catch(function(){i._playLock=!1,i._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),d._ended=!0,d._paused=!0})):e||(i._playLock=!1,k(),i._emit("play",d._id)),B.playbackRate=d._rate,B.paused){i._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||d._loop?i._endTimers[d._id]=setTimeout(i._ended.bind(i,d),T):(i._endTimers[d._id]=function(){i._ended(d),B.removeEventListener("ended",i._endTimers[d._id],!1)},B.addEventListener("ended",i._endTimers[d._id],!1))}catch($){i._emit("playerror",d._id,$)}};B.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(B.src=i._src,B.load());var D=window&&window.ejecta||!B.readyState&&oe._navigator.isCocoonJS;if(B.readyState>=3||D)z();else{i._playLock=!0,i._state="loading";var R=function(){i._state="loaded",z(),B.removeEventListener(oe._canPlayEvent,R,!1)};B.addEventListener(oe._canPlayEvent,R,!1),i._clearTimer(d._id)}}return d._id},pause:function(t){var e=this;if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),n=0;n<i.length;n++){e._clearTimer(i[n]);var s=e._soundById(i[n]);if(s&&!s._paused&&(s._seek=e.seek(i[n]),s._rateSeek=0,s._paused=!0,e._stopFade(i[n]),s._node))if(e._webAudio){if(!s._node.bufferSource)continue;typeof s._node.bufferSource.stop>"u"?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),e._cleanBuffer(s._node)}else(!isNaN(s._node.duration)||s._node.duration===1/0)&&s._node.pause();arguments[1]||e._emit("pause",s?s._id:null)}return e},stop:function(t,e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var n=i._getSoundIds(t),s=0;s<n.length;s++){i._clearTimer(n[s]);var l=i._soundById(n[s]);l&&(l._seek=l._start||0,l._rateSeek=0,l._paused=!0,l._ended=!0,i._stopFade(n[s]),l._node&&(i._webAudio?l._node.bufferSource&&(typeof l._node.bufferSource.stop>"u"?l._node.bufferSource.noteOff(0):l._node.bufferSource.stop(0),i._cleanBuffer(l._node)):(!isNaN(l._node.duration)||l._node.duration===1/0)&&(l._node.currentTime=l._start||0,l._node.pause(),l._node.duration===1/0&&i._clearSound(l._node))),e||i._emit("stop",l._id))}return i},mute:function(t,e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(typeof e>"u")if(typeof t=="boolean")i._muted=t;else return i._muted;for(var n=i._getSoundIds(e),s=0;s<n.length;s++){var l=i._soundById(n[s]);l&&(l._muted=t,l._interval&&i._stopFade(l._id),i._webAudio&&l._node?l._node.gain.setValueAtTime(t?0:l._volume,oe.ctx.currentTime):l._node&&(l._node.muted=oe._muted?!0:t),i._emit("mute",l._id))}return i},volume:function(){var t=this,e=arguments,i,n;if(e.length===0)return t._volume;if(e.length===1||e.length===2&&typeof e[1]>"u"){var s=t._getSoundIds(),l=s.indexOf(e[0]);l>=0?n=parseInt(e[0],10):i=parseFloat(e[0])}else e.length>=2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));var d;if(typeof i<"u"&&i>=0&&i<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof n>"u"&&(t._volume=i),n=t._getSoundIds(n);for(var _=0;_<n.length;_++)d=t._soundById(n[_]),d&&(d._volume=i,e[2]||t._stopFade(n[_]),t._webAudio&&d._node&&!d._muted?d._node.gain.setValueAtTime(i,oe.ctx.currentTime):d._node&&!d._muted&&(d._node.volume=i*oe.volume()),t._emit("volume",d._id))}else return d=n?t._soundById(n):t._sounds[0],d?d._volume:0;return t},fade:function(t,e,i,n){var s=this;if(s._state!=="loaded"||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(t,e,i,n)}}),s;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),s.volume(t,n);for(var l=s._getSoundIds(n),d=0;d<l.length;d++){var _=s._soundById(l[d]);if(_){if(n||s._stopFade(l[d]),s._webAudio&&!_._muted){var S=oe.ctx.currentTime,w=S+i/1e3;_._volume=t,_._node.gain.setValueAtTime(t,S),_._node.gain.linearRampToValueAtTime(e,w)}s._startFadeInterval(_,t,e,i,l[d],typeof n>"u")}}return s},_startFadeInterval:function(t,e,i,n,s,l){var d=this,_=e,S=i-e,w=Math.abs(S/.01),T=Math.max(4,w>0?n/w:n),A=Date.now();t._fadeTo=i,t._interval=setInterval(function(){var I=(Date.now()-A)/n;A=Date.now(),_+=S*I,_=Math.round(_*100)/100,S<0?_=Math.max(i,_):_=Math.min(i,_),d._webAudio?t._volume=_:d.volume(_,t._id,!0),l&&(d._volume=_),(i<e&&_<=i||i>e&&_>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,d.volume(i,t._id),d._emit("fade",t._id))},T)},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(oe.ctx.currentTime),clearInterval(i._interval),i._interval=null,e.volume(i._fadeTo,t),i._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t=this,e=arguments,i,n,s;if(e.length===0)return t._loop;if(e.length===1)if(typeof e[0]=="boolean")i=e[0],t._loop=i;else return s=t._soundById(parseInt(e[0],10)),s?s._loop:!1;else e.length===2&&(i=e[0],n=parseInt(e[1],10));for(var l=t._getSoundIds(n),d=0;d<l.length;d++)s=t._soundById(l[d]),s&&(s._loop=i,t._webAudio&&s._node&&s._node.bufferSource&&(s._node.bufferSource.loop=i,i&&(s._node.bufferSource.loopStart=s._start||0,s._node.bufferSource.loopEnd=s._stop,t.playing(l[d])&&(t.pause(l[d],!0),t.play(l[d],!0)))));return t},rate:function(){var t=this,e=arguments,i,n;if(e.length===0)n=t._sounds[0]._id;else if(e.length===1){var s=t._getSoundIds(),l=s.indexOf(e[0]);l>=0?n=parseInt(e[0],10):i=parseFloat(e[0])}else e.length===2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));var d;if(typeof i=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof n>"u"&&(t._rate=i),n=t._getSoundIds(n);for(var _=0;_<n.length;_++)if(d=t._soundById(n[_]),d){t.playing(n[_])&&(d._rateSeek=t.seek(n[_]),d._playStart=t._webAudio?oe.ctx.currentTime:d._playStart),d._rate=i,t._webAudio&&d._node&&d._node.bufferSource?d._node.bufferSource.playbackRate.setValueAtTime(i,oe.ctx.currentTime):d._node&&(d._node.playbackRate=i);var S=t.seek(n[_]),w=(t._sprite[d._sprite][0]+t._sprite[d._sprite][1])/1e3-S,T=w*1e3/Math.abs(d._rate);(t._endTimers[n[_]]||!d._paused)&&(t._clearTimer(n[_]),t._endTimers[n[_]]=setTimeout(t._ended.bind(t,d),T)),t._emit("rate",d._id)}}else return d=t._soundById(n),d?d._rate:t._rate;return t},seek:function(){var t=this,e=arguments,i,n;if(e.length===0)t._sounds.length&&(n=t._sounds[0]._id);else if(e.length===1){var s=t._getSoundIds(),l=s.indexOf(e[0]);l>=0?n=parseInt(e[0],10):t._sounds.length&&(n=t._sounds[0]._id,i=parseFloat(e[0]))}else e.length===2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));if(typeof n>"u")return 0;if(typeof i=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var d=t._soundById(n);if(d)if(typeof i=="number"&&i>=0){var _=t.playing(n);_&&t.pause(n,!0),d._seek=i,d._ended=!1,t._clearTimer(n),!t._webAudio&&d._node&&!isNaN(d._node.duration)&&(d._node.currentTime=i);var S=function(){_&&t.play(n,!0),t._emit("seek",n)};if(_&&!t._webAudio){var w=function(){t._playLock?setTimeout(w,0):S()};setTimeout(w,0)}else S()}else if(t._webAudio){var T=t.playing(n)?oe.ctx.currentTime-d._playStart:0,A=d._rateSeek?d._rateSeek-d._seek:0;return d._seek+(A+T*Math.abs(d._rate))}else return d._node.currentTime;return t},playing:function(t){var e=this;if(typeof t=="number"){var i=e._soundById(t);return i?!i._paused:!1}for(var n=0;n<e._sounds.length;n++)if(!e._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,n=e._soundById(t);return n&&(i=e._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(oe._canPlayEvent,e[i]._loadFn,!1),e[i]._node.removeEventListener("ended",e[i]._endFn,!1),oe._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var n=oe._howls.indexOf(t);n>=0&&oe._howls.splice(n,1);var s=!0;for(i=0;i<oe._howls.length;i++)if(oe._howls[i]._src===t._src||t._src.indexOf(oe._howls[i]._src)>=0){s=!1;break}return ki&&s&&delete ki[t._src],oe.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,n){var s=this,l=s["_on"+t];return typeof e=="function"&&l.push(n?{id:i,fn:e,once:n}:{id:i,fn:e}),s},off:function(t,e,i){var n=this,s=n["_on"+t],l=0;if(typeof e=="number"&&(i=e,e=null),e||i)for(l=0;l<s.length;l++){var d=i===s[l].id;if(e===s[l].fn&&d||!e&&d){s.splice(l,1);break}}else if(t)n["_on"+t]=[];else{var _=Object.keys(n);for(l=0;l<_.length;l++)_[l].indexOf("_on")===0&&Array.isArray(n[_[l]])&&(n[_[l]]=[])}return n},once:function(t,e,i){var n=this;return n.on(t,e,i,1),n},_emit:function(t,e,i){for(var n=this,s=n["_on"+t],l=s.length-1;l>=0;l--)(!s[l].id||s[l].id===e||t==="load")&&(setTimeout(function(d){d.call(this,e,i)}.bind(n,s[l].fn),0),s[l].once&&n.off(t,s[l].fn,s[l].id));return n._loadQueue(t),n},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,i=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!!(t._loop||e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=oe.ctx.currentTime;var s=(t._stop-t._start)*1e3/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),s)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),oe._autoSuspend()),!e._webAudio&&!n&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if(typeof e._endTimers[t]!="function")clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new Io(t)},_drain:function(){var t=this,e=t._pool,i=0,n=0;if(!(t._sounds.length<e)){for(n=0;n<t._sounds.length;n++)t._sounds[n]._ended&&i++;for(n=t._sounds.length-1;n>=0;n--){if(i<=e)return;t._sounds[n]._ended&&(t._webAudio&&t._sounds[n]._node&&t._sounds[n]._node.disconnect(0),t._sounds.splice(n,1),i--)}}},_getSoundIds:function(t){var e=this;if(typeof t>"u"){for(var i=[],n=0;n<e._sounds.length;n++)i.push(e._sounds[n]._id);return i}else return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=oe.ctx.createBufferSource(),t._node.bufferSource.buffer=ki[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,oe.ctx.currentTime),e},_cleanBuffer:function(t){var e=this,i=oe._navigator&&oe._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return e;if(oe._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),i))try{t.bufferSource.buffer=oe._scratchBuffer}catch{}return t.bufferSource=null,e},_clearSound:function(t){var e=/MSIE |Trident\//.test(oe._navigator&&oe._navigator.userAgent);e||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Io=function(t){this._parent=t,this.init()};Io.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++oe._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=oe._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof oe.ctx.createGain>"u"?oe.ctx.createGainNode():oe.ctx.createGain(),t._node.gain.setValueAtTime(i,oe.ctx.currentTime),t._node.paused=!0,t._node.connect(oe.masterGain)):oe.noAudio||(t._node=oe._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(oe._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=e._preload===!0?"auto":e._preload,t._node.volume=i*oe.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++oe._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10,Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(oe._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(t._node.duration*10)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=e._duration*1e3),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var ki={},Vp=function(t){var e=t._src;if(ki[e]){t._duration=ki[e].duration,jd(t);return}if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),n=new Uint8Array(i.length),s=0;s<i.length;++s)n[s]=i.charCodeAt(s);Yc(n.buffer,t)}else{var l=new XMLHttpRequest;l.open(t._xhr.method,e,!0),l.withCredentials=t._xhr.withCredentials,l.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(d){l.setRequestHeader(d,t._xhr.headers[d])}),l.onload=function(){var d=(l.status+"")[0];if(d!=="0"&&d!=="2"&&d!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+l.status+".");return}Yc(l.response,t)},l.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete ki[e],t.load())},Up(l)}},Up=function(t){try{t.send()}catch{t.onerror()}},Yc=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(s){s&&e._sounds.length>0?(ki[e._src]=s,jd(e,s)):i()};typeof Promise<"u"&&oe.ctx.decodeAudioData.length===1?oe.ctx.decodeAudioData(t).then(n).catch(i):oe.ctx.decodeAudioData(t,n,i)},jd=function(t,e){e&&!t._duration&&(t._duration=e.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},qr=function(){if(oe.usingWebAudio){try{typeof AudioContext<"u"?oe.ctx=new AudioContext:typeof webkitAudioContext<"u"?oe.ctx=new webkitAudioContext:oe.usingWebAudio=!1}catch{oe.usingWebAudio=!1}oe.ctx||(oe.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(oe._navigator&&oe._navigator.platform),e=oe._navigator&&oe._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var n=/safari/.test(oe._navigator&&oe._navigator.userAgent.toLowerCase());oe._navigator&&!n&&(oe.usingWebAudio=!1)}oe.usingWebAudio&&(oe.masterGain=typeof oe.ctx.createGain>"u"?oe.ctx.createGainNode():oe.ctx.createGain(),oe.masterGain.gain.setValueAtTime(oe._muted?0:oe._volume,oe.ctx.currentTime),oe.masterGain.connect(oe.ctx.destination)),oe._setup()}};jp(bl,oe,Eo,Io);const Gi=typeof self>"u";let Fn,Ht,Nr,Ao,qe;if(typeof navigator<"u"&&(Fn=navigator,Ht=Fn.userAgent,Nr=Fn.platform,Ao=Fn.mediaDevices),!Gi){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Fn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Nr,search:"Win"},Mac:{str:Nr},Linux:{str:Nr}};let i="unknownBrowser",n=0,s="unknownOS";for(let l in t){const d=t[l]||{};let _=d.str||Ht,S=d.search||l,w=d.verStr||Ht,T=d.verSearch||l;if(T instanceof Array||(T=[T]),_.indexOf(S)!=-1){i=l;for(let A of T){let I=w.indexOf(A);if(I!=-1){n=parseFloat(w.substring(I+A.length+1));break}}break}}for(let l in e){const d=e[l]||{};let _=d.str||Ht,S=d.search||l;if(_.indexOf(S)!=-1){s=l;break}}s=="Linux"&&Ht.indexOf("Windows NT")!=-1&&(s="HarmonyOS"),qe={browser:i,version:n,OS:s}}Gi&&(qe={browser:"ssr",version:0,OS:"ssr"});const Wp=typeof WebAssembly<"u"&&Ht&&!(/Safari/.test(Ht)&&!/Chrome/.test(Ht)&&/\(.+\s11_2_([2-6]).*\)/.test(Ht)),Gp=!(typeof Worker>"u"),Vd=!(!Ao||!Ao.getUserMedia),zp=async()=>{let t=!1;if(Vd)try{(await Ao.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};qe.browser==="Chrome"&&qe.version>66||qe.browser==="Safari"&&qe.version>13||qe.browser==="OPR"&&qe.version>43||qe.browser==="Edge"&&qe.version;const Hp=(()=>{if(!Gi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let i=t.indexOf("#");i!=-1&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Pn=" is not allowed to change after `createInstance` or `loadWasm` is called.",Yp=!Gi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Xp=!Gi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",Xc=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!Gi){let i=document.createElement("a");i.href=t[e],t[e]=i.href}t[e].endsWith("/")||(t[e]+="/")}}return t};var De,Oo,ba,gt,Sn;(function(t){t[t.IPF_Binary=0]="IPF_Binary",t[t.IPF_BinaryInverted=1]="IPF_BinaryInverted",t[t.IPF_GrayScaled=2]="IPF_GrayScaled",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888"})(De||(De={})),function(t){t[t.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",t[t.DBR_SUCCESS=0]="DBR_SUCCESS",t[t.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",t[t.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",t[t.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",t[t.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",t[t.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",t[t.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",t[t.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",t[t.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",t[t.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",t[t.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",t[t.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",t[t.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",t[t.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",t[t.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",t[t.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",t[t.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",t[t.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",t[t.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",t[t.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",t[t.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",t[t.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",t[t.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",t[t.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",t[t.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",t[t.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",t[t.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",t[t.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",t[t.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",t[t.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",t[t.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",t[t.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",t[t.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",t[t.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",t[t.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",t[t.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",t[t.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",t[t.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",t[t.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",t[t.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",t[t.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",t[t.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",t[t.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",t[t.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",t[t.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",t[t.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",t[t.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",t[t.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",t[t.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",t[t.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",t[t.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",t[t.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",t[t.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",t[t.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",t[t.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",t[t.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",t[t.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",t[t.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",t[t.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",t[t.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",t[t.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(Oo||(Oo={})),function(t){t[t.IMRDT_IMAGE=1]="IMRDT_IMAGE",t[t.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",t[t.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",t[t.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",t[t.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",t[t.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(ba||(ba={})),function(t){t[t.BF_ALL=4265607167]="BF_ALL",t[t.BF_ONED=3147775]="BF_ONED",t[t.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",t[t.BF_CODE_39=1]="BF_CODE_39",t[t.BF_CODE_128=2]="BF_CODE_128",t[t.BF_CODE_93=4]="BF_CODE_93",t[t.BF_CODABAR=8]="BF_CODABAR",t[t.BF_ITF=16]="BF_ITF",t[t.BF_EAN_13=32]="BF_EAN_13",t[t.BF_EAN_8=64]="BF_EAN_8",t[t.BF_UPC_A=128]="BF_UPC_A",t[t.BF_UPC_E=256]="BF_UPC_E",t[t.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",t[t.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",t[t.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",t[t.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",t[t.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",t[t.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",t[t.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",t[t.BF_PATCHCODE=262144]="BF_PATCHCODE",t[t.BF_PDF417=33554432]="BF_PDF417",t[t.BF_QR_CODE=67108864]="BF_QR_CODE",t[t.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",t[t.BF_AZTEC=268435456]="BF_AZTEC",t[t.BF_MAXICODE=536870912]="BF_MAXICODE",t[t.BF_MICRO_QR=1073741824]="BF_MICRO_QR",t[t.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",t[t.BF_GS1_COMPOSITE=2147483648]="BF_GS1_COMPOSITE",t[t.BF_MSI_CODE=1048576]="BF_MSI_CODE",t[t.BF_CODE_11=2097152]="BF_CODE_11",t[t.BF_NULL=0]="BF_NULL"}(gt||(gt={})),function(t){t[t.IRT_NO_RESULT=0]="IRT_NO_RESULT",t[t.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",t[t.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",t[t.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",t[t.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",t[t.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",t[t.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",t[t.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",t[t.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",t[t.IRT_CONTOUR=256]="IRT_CONTOUR",t[t.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",t[t.IRT_FORM=1024]="IRT_FORM",t[t.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",t[t.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",t[t.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(Sn||(Sn={}));const $c=t=>t&&typeof t=="object"&&typeof t.then=="function";class Ud extends Promise{constructor(e){let i,n;super((s,l)=>{i=s,n=l}),this._s="pending",this.resolve=s=>{this.isPending&&($c(s)?this.task=s:(this._s="fulfilled",i(s)))},this.reject=s=>{this.isPending&&(this._s="rejected",n(s))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let i;this._task=e,$c(e)?i=e:typeof e=="function"&&(i=new Promise(e)),i&&(async()=>{try{const n=await i;e===this._task&&this.resolve(n)}catch(n){e===this._task&&this.reject(n)}})()}get isEmpty(){return this._task==null}}const Kc=["iPhone","iPad","Android","HarmonyOS"].includes(qe.OS)?2048:4096;class j{constructor(){this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.beepSound=new Eo({src:["data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"],onplayerror:(e,i)=>{console.warn(`Sound '${e}' playback failure: ${i}`)}}),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.captureAndDecodeInParallel=!0,this.autoSuggestTip=!1,this.suggestTipFrameArray=[],this.suggestTipFrameLimit=[5,3],this.noIntermediateResultsCount=0,this.noIntermediateResultsTipLimit=100,this.tinyBarcodeTipModuleSizeLimit=3,this.hugeBarcodeTipLimit=.9,this.autoZoomInFrameArray=[],this.autoZoomInFrameLimit=[5,3],this.autoZoomInStepRate=1/3,this.autoZoomInMaxStep=1.5,this.autoZoomInMaxTimes=5,this.autoZoomInMinStep=Math.pow(10,1/this.autoZoomInMaxTimes),this.autoZoomInIdealModuleSize=6,this.autoZoomOutFrameCount=0,this.autoZoomOutFrameLimit=3,this.autoZoomOutStepRate=1/3,this.autoZoomOutMinValue=1,this.autoZoomOutMinStep=2,this.autoZoomOutStepRate_2=.05,this.autoZoomOutMinValue_2=2,this.frameArrayInIdealZoom=[],this.frameLimitInIdealZoom=[5,3],this.enableZoomOutInIdealZoom=!1,this.nextActionInIdealZoom="focus",this.autoFocusFrameArray=[],this.autoFocusFrameLimit=[5,3],this.autoZoomIdealArea=[0,.05],this.autoZoomTargetBorder=.9,this.autoZoomDetectionArea=.5,this.autoZoom=!1,this.autoFocus=!1,this._dce=null,this._imgSource=null,this._maxCvsSideLength=Kc,this._promiseStartScan=null}static get version(){return this._version}static get license(){return this._license}static set license(e){((i,n)=>{const s=i;if(!s._pLoad.isEmpty)throw new Error("`license`"+Pn);s._license=n})(j,e)}static get productKeys(){return this._license}static set productKeys(e){j.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){j.license=e}static get organizationID(){return this._license}static set organizationID(e){j.license=e}static set sessionPassword(e){((i,n)=>{const s=i;if(!s._pLoad.isEmpty)throw new Error("`sessionPassword`"+Pn);s._sessionPassword=n})(j,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:Wp,worker:Gp,getUserMedia:Vd,camera:await zp(),browser:qe.browser,version:qe.version,OS:qe.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");j._engineResourcePath=(i=>{if(i==null&&(i="./"),!Gi){let n=document.createElement("a");n.href=i,i=n.href}return i.endsWith("/")||(i+="/"),i})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((i,n)=>{const s=i;if(!s._pLoad.isEmpty)throw new Error("`licenseServer`"+Pn);s._licenseServer=Xc(n)})(j,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((i,n)=>{const s=i;if(!s._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Pn);s._deviceFriendlyName=n||""})(j,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");j.__bUseFullFeature=e}static isImageSource(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"width"in e&&"height"in e&&"pixelFormat"in e}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return(e=j._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",j.engineResourcePath)}static set defaultUIElementURL(e){j._defaultUIElementURL=e}static _fireHTTPSWarnning(){j.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{j.onWarning&&j.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new Eo({src:[this._soundSource],onplayerror:(i,n)=>{console.warn(`Sound '${i}' playback failure: ${n}`)}})}get whenToPlaySoundforSuccessfulRead(){return this.bPlaySoundOnSuccessfulRead===!0?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead=e!=="never"&&e}get whenToVibrateforSuccessfulRead(){return this.bVibrateOnSuccessfulRead===!0?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead=e!=="never"&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed||this._dce.disposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;j._onLog&&j._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const i=this._dceControler;i.register(this),i.setDisiredValue(this,"refreshInterval",200),i.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"});try{}catch(l){l.name==="ReferenceError"&&window&&(window.ResizeObserver=void 0)}const n=e.getUIElement(),s=this.dce.constructor;if(s._defaultUIElementURL==="@engineResourcePath/dce.ui.html")try{n?n===i._innerSetUI&&(await e.setUIElement(`${s.engineResourcePath}dce.ui.html`),i._innerSetUI=e.getUIElement()):(await e.setUIElement(`${s.engineResourcePath}dbr.ui.html`),i._innerSetUI=e.getUIElement())}catch{await e.setUIElement(s.defaultUIElementURL)}else n||await e.setUIElement(s.defaultUIElementURL);this.callbackCameraChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async l=>{this._drawResults(null);let d=await this._decode_DCEFrame(l,{bCopyData:!1}),_=null;if(d&&d.length){const{sx:S,sy:w,width:T,height:A,_sWidth:I,_sHeight:k}=l;_=d.map(B=>({localizationResult:JSON.parse(JSON.stringify(B.localizationResult))})),j.recalculateResultLocation(_,S,w,I,k,T,A)}if(this._drawResults(_,d),await this.clearMapDecodeRecord(),this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let S=this._cloneDecodeResults(d);this.onImageRead(S)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let S of d)this.onUniqueRead(S.barcodeText,this._cloneDecodeResults(S))},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(j._onLog&&j._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}async setImageSource(e,i){if(e==null)return this._imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this._imgSource=null;else{if(!j.isImageSource(e))throw new Error("Invalid value.");this._logoutDCEControler(),this._imgSource=e}i&&i.resultsHighlightBaseShapes&&(this._drawingItemNamespace=i.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:i,ls:n,sp:s,rmk:l}=(d=>{const _=d;if(_._pLoad.isEmpty){let S,w,T=_._license||"",A=JSON.parse(JSON.stringify(_._licenseServer)),I=_._sessionPassword,k=0;if(T.startsWith("t")||T.startsWith("f"))k=0;else if(T.length===0||T.startsWith("P")||T.startsWith("L")||T.startsWith("Y")||T.startsWith("A"))k=1;else{k=2;const B=T.indexOf(":");if(B!=-1&&(T=T.substring(B+1)),T.startsWith("DLS2")){let F;try{let z=T.substring(4);z=atob(z),F=JSON.parse(z)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(T=F.handshakeCode?F.handshakeCode:F.organizationID?F.organizationID:"",typeof T=="number"&&(T=JSON.stringify(T)),A.length===0){let z=[];F.mainServerURL&&(z[0]=F.mainServerURL),F.standbyServerURL&&(z[1]=F.standbyServerURL),A=Xc(z)}!I&&F.sessionPassword&&(I=F.sessionPassword),S=F.remark}(T==="200001"||T.startsWith("200001-"))&&(A&&A.length||(T="")),T||(k=1)}if(k&&(globalThis.crypto||(w="Please upgrade your browser to support online key."),globalThis.crypto.subtle||(w="Require https to use online key in this browser.")),w){if(k!==1)throw new Error(w);k=0,console.warn(w),_._lastErrorCode=-1,_._lastErrorString=w}return k===1&&(T="",console.warn("Applying for a public trial license ...")),{lt:k,l:T,ls:A,sp:I,rmk:S}}throw new Error("Can't preprocess license again"+Pn)})(j);this._pLoad.task=async(d,_)=>{let S=j.engineResourcePath+j._workerName;j.engineResourcePath.startsWith(location.origin)||(S=await fetch(S).then(w=>w.blob()).then(w=>URL.createObjectURL(w))),j._dbrWorker=new Worker(S),j._dbrWorker.onerror=w=>{let T=new Error(w.message);_(T)},j._dbrWorker.onmessage=async w=>{let T=w.data?w.data:w;switch(T.type){case"log":j._onLog&&j._onLog(T.message);break;case"load":{T.message&&(T.message=T.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let A,I=!1;e===1&&(I=!0),T.success?(j._dbrWorker.onerror=null,j._version=T.version+"(JS "+j._jsVersion+"."+j._jsEditVersion+")",j._bIntermediateResultsSupported=T.bIntermediateResultsSupported,j._onLog&&j._onLog("load dbr worker success"),T.message&&console.warn(T.message)):(A=new Error(T.message),A.stack=T.stack+`
`+A.stack,A.ltsErrorCode=T.ltsErrorCode,I||T.ltsErrorCode==111&&T.message.toLowerCase().indexOf("trial license")!=-1&&(I=!0)),I&&j.showDialog(T.success?"warn":"error",T.message),T.success?d():_(A);break}case"task":{let A=T.id,I=T.body;try{j._taskCallbackMap.get(A)(I),j._taskCallbackMap.delete(A)}catch(k){throw j._taskCallbackMap.delete(A),k}break}default:j._onLog&&j._onLog(w)}},j._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:j.engineResourcePath,bUseFullFeature:j._bUseFullFeature,bd:j._bWasmDebug,v:j._jsVersion,brtk:!!e,bptk:e===1,l:i,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:qe,fn:j.deviceFriendlyName,ls:n,sp:s,rmk:l})}}await this._pLoad}static async showDialog(e,i){await(async(n,s,l)=>{if(!n._bNeverShowDialog)try{let d=await fetch(n.engineResourcePath+"dls.license.dialog.html");if(!d.ok)throw Error("Get license dialog fail. Network Error: "+d.statusText);let _=await d.text();if(!_.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let S=document.createElement("div");S.innerHTML=_;let w=[];for(let R=0;R<S.childElementCount;++R){let L=S.children[R];L instanceof HTMLStyleElement&&(w.push(L),document.head.append(L))}let T=S.childElementCount==1?S.children[0]:S;T.remove();let A,I,k,B,F,z=[T],D=T.children;for(let R of D)z.push(R);for(let R=0;R<z.length;++R)for(let L of z[R].children)z.push(L);for(let R of z)if(!A&&R.classList.contains("dls-license-mask"))A=R,R.addEventListener("click",L=>{if(R==L.target){T.remove();for(let $ of w)$.remove()}});else if(!I&&R.classList.contains("dls-license-icon-close"))I=R,R.addEventListener("click",()=>{T.remove();for(let L of w)L.remove()});else if(!k&&R.classList.contains("dls-license-icon-error"))k=R,s!="error"&&R.remove();else if(!B&&R.classList.contains("dls-license-icon-warn"))B=R,s!="warn"&&R.remove();else if(!F&&R.classList.contains("dls-license-msg-content")){F=R;let L=l;for(;L;){let $=L.indexOf("["),ie=L.indexOf("]",$),ne=L.indexOf("(",ie),J=L.indexOf(")",ne);if($==-1||ie==-1||ne==-1||J==-1){R.appendChild(new Text(L));break}$>0&&R.appendChild(new Text(L.substring(0,$)));let y=document.createElement("a"),de=L.substring($+1,ie);y.innerText=de;let ge=L.substring(ne+1,J);y.setAttribute("href",ge),y.setAttribute("target","_blank"),R.appendChild(y),L=L.substring(J+1)}}document.body.appendChild(T)}catch(d){n._onLog&&n._onLog(d.message||d)}})(this,e,i)}static async createInstanceInWorker(e=!1){return await j.loadWasm(),await new Promise((i,n)=>{let s=j._nextTaskID++;j._taskCallbackMap.set(s,l=>{if(l.success)return i(l.instanceID);{let d=new Error(l.message);return d.stack=l.stack+`
`+d.stack,n(d)}}),j._dbrWorker.postMessage({type:"createInstance",id:s,bScanner:e})})}static async createInstance(){let e=new j;return e._instanceID=await j.createInstanceInWorker(),j._fireHTTPSWarnning(),e}async clearMapDecodeRecord(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,s=>{if(s.success)return e();{let l=new Error(s.message);return l.stack=s.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:n,instanceID:this._instanceID})})}async decode(e){j._onLog&&j._onLog("decode(source: any)"),j._onLog&&(this._timeStartDecode=Date.now());{let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?await this._decode_Blob(e,i):e instanceof ArrayBuffer?await this._decode_ArrayBuffer(e,i):e instanceof Uint8Array||e instanceof Uint8ClampedArray?await this._decode_Uint8Array(e,i):e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?await this._decode_Image(e,i):e instanceof HTMLCanvasElement?await this._decode_Canvas(e,i):e instanceof HTMLVideoElement?await this._decode_Video(e,i):typeof e=="string"?e.substring(0,11)=="data:image/"?await this._decode_Base64(e,i):await this._decode_Url(e,i):j.isDCEFrame(e)?(i.bCopyData=!0,await this._decode_DCEFrame(e,i)):j.isDSImage(e)?(i.bCopyData=!0,await this._decode_DSImage(e,i)):await Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}async decodeBase64String(e){let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,i)}async decodeUrl(e){let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,i)}async _decodeBuffer_Uint8Array(e,i,n,s,l,d){return await new Promise((_,S)=>{let w=j._nextTaskID++;j._taskCallbackMap.set(w,T=>{if(T.success){let A,I=j._onLog?Date.now():0;j._onLog&&j._onLog("worker return result: "+I),this._lastInnerDecodeDuration=T.duration;try{A=this._handleRetJsonString(T.decodeReturn)}catch(k){return S(k)}if(j._onLog){let k=Date.now();j._onLog("DBR getting message from worker timestamp: "+I),j._onLog("From DBR staring decoding to entering worker costs: "+(this._timeEnterInnerDBR-this._timeStartDecode)),j._onLog("From DBR entering worker to returning message from worker costs: "+(I-this._timeEnterInnerDBR)),j._onLog("Handling results from DBR worker costs: "+(k-I)),j._onLog("Total decoding image costs: "+(k-this._timeStartDecode))}return _(A)}{let A=new Error(T.message);return A.stack=T.stack+`
`+A.stack,S(A)}}),this._timeEnterInnerDBR=Date.now(),j._onLog&&j._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDBR),j._dbrWorker.postMessage({type:"decodeBuffer",id:w,instanceID:this._instanceID,body:{buffer:e,width:i,height:n,stride:s,format:l,config:d}},[e.buffer]),j._onLog&&d&&d.timeStamp&&j._onLog("Delay of decoding image: "+(this._timeEnterInnerDBR-d.timeStamp))})}async _decodeBuffer_Blob(e,i,n,s,l,d){j._onLog&&j._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const _=e.arrayBuffer?await e.arrayBuffer():await new Promise((S,w)=>{let T=new FileReader;T.readAsArrayBuffer(e),T.onload=()=>{S(T.result)},T.onerror=()=>{w(T.error)}});return await this._decodeBuffer_Uint8Array(new Uint8Array(_),i,n,s,l,d)}async decodeBuffer(e,i,n,s,l,d){let _;return j._onLog&&j._onLog("decodeBuffer(buffer,width,height,stride,format)"),j._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?_=await this._decodeBuffer_Uint8Array(e,i,n,s,l,d):e instanceof ArrayBuffer?_=await this._decodeBuffer_Uint8Array(new Uint8Array(e),i,n,s,l,d):e instanceof Blob&&(_=await this._decodeBuffer_Blob(e,i,n,s,l,d)),_}async _decodeFileInMemory_Uint8Array(e){return await new Promise((i,n)=>{let s=j._nextTaskID++;j._taskCallbackMap.set(s,l=>{if(l.success){let d;this._lastInnerDecodeDuration=l.duration;try{d=this._handleRetJsonString(l.decodeReturn)}catch(_){return n(_)}return i(d)}{let d=new Error(l.message);return d.stack=l.stack+`
`+d.stack,n(d)}}),j._dbrWorker.postMessage({type:"decodeFileInMemory",id:s,instanceID:this._instanceID,body:{bytes:e}})})}async getRuntimeSettings(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,s=>{if(s.success){let l=JSON.parse(s.results);return this.userDefinedRegion!=null&&(l.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(l)}{let l=new Error(s.message);return l.stack=s.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"getRuntimeSettings",id:n,instanceID:this._instanceID})})}async updateRuntimeSettings(e){let i;if(typeof e=="string")if(e=="speed"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0]}else if(e=="balance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0]}else if(e=="coverage"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region}else if(e=="dense"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=9,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else if(e=="distance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else i=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let n=i.region;[n.regionLeft,n.regionTop,n.regionLeft,n.regionBottom,n.regionMeasuredByPercentage].some(s=>s!==void 0)&&(i.region={regionLeft:n.regionLeft||0,regionTop:n.regionTop||0,regionRight:n.regionRight||0,regionBottom:n.regionBottom||0,regionMeasuredByPercentage:n.regionMeasuredByPercentage||0})}}if(!j._bUseFullFeature){if(i.barcodeFormatIds&~(gt.BF_ONED|gt.BF_QR_CODE|gt.BF_PDF417|gt.BF_DATAMATRIX)||i.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(i.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let n=i.region;if(n instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(n)),(n.regionLeft||n.regionTop||n.regionRight||n.regionBottom||n.regionMeasuredByPercentage)&&(n.regionLeft||n.regionTop||n.regionRight!=100||n.regionBottom!=100||!n.regionMeasuredByPercentage)?this.region=n:this.region=null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return(this.autoZoom||this.autoFocus)&&(i.intermediateResultTypes|=Sn.IRT_TYPED_BARCODE_ZONE),await new Promise((n,s)=>{let l=j._nextTaskID++;j._taskCallbackMap.set(l,d=>{if(d.success){try{this._handleRetJsonString(d.updateReturn)}catch(_){s(_)}return n()}{let _=new Error(d.message);return _.stack=d.stack+`
`+_.stack,s(_)}}),j._dbrWorker.postMessage({type:"updateRuntimeSettings",id:l,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})})}async resetRuntimeSettings(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=Kc,await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,s=>{if(s.success)return e();{let l=new Error(s.message);return l.stack=s.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"resetRuntimeSettings",id:n,instanceID:this._instanceID})})}async outputRuntimeSettingsToString(){if(!j._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,s=>{if(s.success)return e(s.results);{let l=new Error(s.message);return l.stack=s.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:n,instanceID:this._instanceID})})}async initRuntimeSettingsWithString(e){if(!j._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if(typeof e=="string")e=e;else{if(typeof e!="object")throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise((i,n)=>{let s=j._nextTaskID++;j._taskCallbackMap.set(s,l=>{if(l.success){try{this._handleRetJsonString(l.initReturn)}catch(d){n(d)}return i()}{let d=new Error(l.message);return d.stack=l.stack+`
`+d.stack,n(d)}}),j._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:s,instanceID:this._instanceID,body:{settings:e}})})}async _decode_Blob(e,i){j._onLog&&j._onLog("_decode_Blob(blob: Blob)");let n=null,s=null;if(typeof createImageBitmap<"u")try{n=await createImageBitmap(e)}catch{}n||(s=await function(d){return new Promise((_,S)=>{let w=URL.createObjectURL(d),T=new Image;T.dbrObjUrl=w,T.src=w,T.onload=()=>{_(T)},T.onerror=A=>{S(new Error("Can't convert blob to image : "+(A instanceof Event?A.type:A)))}})}(e));let l=await this._decode_Image(n||s,i);return n&&n.close(),l}async _decode_ArrayBuffer(e,i){return await this._decode_Blob(new Blob([e]),i)}async _decode_Uint8Array(e,i){return await this._decode_Blob(new Blob([e]),i)}async _decode_Image(e,i){j._onLog&&j._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),i=i||{};let n,s,l=e instanceof HTMLImageElement?e.naturalWidth:e.width,d=e instanceof HTMLImageElement?e.naturalHeight:e.height,_=Math.max(l,d);if(_>this._maxCvsSideLength){let w=this._maxCvsSideLength/_;n=Math.round(l*w),s=Math.round(d*w)}else n=l,s=d;this.canvas||(this.canvas=document.createElement("canvas"));const S=this.canvas;return S.width===n&&S.height===s||(S.width=n,S.height=s),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(e,0,0,l,d,0,0,n,s),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._decode_Canvas(S,i)}async _decode_Canvas(e,i){if(j._onLog&&j._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if(e.width===0||e.height===0)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let n=(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data;return await this._decodeBuffer_Uint8Array(n,e.width,e.height,4*e.width,De.IPF_ABGR_8888,i)}async _decode_Video(e,i){if(j._onLog&&j._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";i=i||{};let n,s,l=e.videoWidth,d=e.videoHeight,_=Math.max(l,d);if(_>this._maxCvsSideLength){let w=this._maxCvsSideLength/_;n=Math.round(l*w),s=Math.round(d*w)}else n=l,s=d;this.canvas||(this.canvas=document.createElement("canvas"));const S=this.canvas;return S.width===n&&S.height===s||(S.width=n,S.height=s),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(e,0,0,l,d,0,0,n,s),await this._decode_Canvas(S,i)}async _decode_DCEFrame(e,i){if(j._onLog&&j._onLog("_decode_DCEFrame(dceFrame)"),!j.isDCEFrame(e))return[];let n=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:s,height:l,colorMode:d,pixelFormat:_,stride:S,timeStamp:w}=e;let T;T=i&&i.bCopyData?new Uint8Array(e.data):e.data;let A=null;if(i?(A=JSON.parse(JSON.stringify(i)),A.timeStamp=w):A={timeStamp:w},_&&S)if(_==="grey")n=await this._decodeBuffer_Uint8Array(T,s,l,S,De.IPF_GrayScaled,A);else if(_==="rgba")n=await this._decodeBuffer_Uint8Array(T,s,l,S,De.IPF_ABGR_8888,A);else{if(_!=="bgra")throw new Error(`Pixel format '${_}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(T,s,l,S,De.IPF_ARGB_8888,A)}else if(d==="grey")n=await this._decodeBuffer_Uint8Array(T,s,l,s,De.IPF_GrayScaled,A);else if(d==="rgba")n=await this._decodeBuffer_Uint8Array(T,s,l,4*s,De.IPF_ABGR_8888,A);else{if(d!=="bgra")throw new Error(`Color mode '${d}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(T,s,l,4*s,De.IPF_ARGB_8888,A)}return n}async _decode_DSImage(e,i){if(j._onLog&&j._onLog("_decode_DSImage(dsImage)"),!j.isDSImage(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const w=document.createElement("canvas");let T;switch(w.width=this.width,w.height=this.height,this.pixelFormat){case"grey":T=new Uint8ClampedArray(this.width*this.height*4);for(let I=0;I<T.length;I+=4)T[I]=this.data[I/4],T[I+1]=this.data[I/4],T[I+2]=this.data[I/4],T[I+3]=255;break;case"rgb":T=new Uint8ClampedArray(this.width*this.height*4);for(let I=0;I<T.length;I+=4)T[I]=this.data[I],T[I+1]=this.data[I+1],T[I+2]=this.data[I+2],T[I+3]=255;break;case"bgr":T=new Uint8ClampedArray(this.width*this.height*4);for(let I=0;I<T.length;I+=4)T[I]=this.data[I],T[I+1]=this.data[I+1],T[I+2]=this.data[I+2],T[I+3]=255;break;case"rgba":case"bgra":T=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const A=new ImageData(T,this.width,this.height);return w.getContext("2d").putImageData(A,0,0),w}});const{width:n,height:s}=e;let l,d,_,S=e.pixelFormat.toLowerCase();switch(l=i&&i.bCopyData?new Uint8Array(e.data):e.data,S){case"grey":_=De.IPF_GrayScaled,d=n;break;case"rgb":_=De.IPF_BGR_888,d=3*n;break;case"bgr":_=De.IPF_RGB_888,d=3*n;break;case"rgba":_=De.IPF_ABGR_8888,d=4*n;break;case"bgra":_=De.IPF_ARGB_8888,d=4*n;break;default:throw new Error("The pixel format is not supported to decode.")}return await this._decodeBuffer_Uint8Array(l,n,s,d,_,i)}async _decode_Base64(e,i){if(j._onLog&&j._onLog("_decode_Base64(base64Str)"),typeof e!="string")return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");e.substring(0,11)=="data:image/"&&(e=e.substring(e.indexOf(",")+1));{let n=atob(e),s=n.length,l=new Uint8Array(s);for(;s--;)l[s]=n.charCodeAt(s);return await this._decode_Blob(new Blob([l]),i)}}async _decode_Url(e,i){if(j._onLog&&j._onLog("_decode_Url(url)"),typeof e!="string")throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");e=e;{let n=await new Promise((s,l)=>{let d=new XMLHttpRequest;d.open("GET",e,!0),d.responseType="blob",d.send(),d.onloadend=async()=>{s(d.response)},d.onerror=()=>{l(new Error("Network Error: "+d.statusText))}});return await this._decode_Blob(n,i)}}async _decode_FilePath(e,i){throw j._onLog&&j._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")}static recalculateResultLocation(e,i,n,s,l,d,_){if(e.length>0)for(let S of e){let w=S.localizationResult;w.resultCoordinateType==2&&(w.x1*=.01*d,w.x2*=.01*d,w.x3*=.01*d,w.x4*=.01*d,w.y1*=.01*_,w.y2*=.01*_,w.y3*=.01*_,w.y4*=.01*_);let T=d/s,A=_/l;w.x1=w.x1/T+i,w.x2=w.x2/T+i,w.x3=w.x3/T+i,w.x4=w.x4/T+i,w.y1=w.y1/A+n,w.y2=w.y2/A+n,w.y3=w.y3/A+n,w.y4=w.y4/A+n,w.resultCoordinateType==2&&(w.x1*=100/s,w.x2*=100/s,w.x3*=100/s,w.x4*=100/s,w.y1*=100/l,w.y2*=100/l,w.y3*=100/l,w.y4*=100/l)}}static BarcodeReaderException(e,i){let n,s=Oo.DBR_UNKNOWN;return typeof e=="number"?(s=e,n=new Error(i)):n=new Error(e),n.code=s,n}_handleRetJsonString(e){let i=Oo;if(e.textResults){for(let n=0;n<e.textResults.length;n++){let s=e.textResults[n];try{let l=s.barcodeText,d="";for(let _=0;_<l.length;_++)d+=String.fromCharCode(l[_]);try{s.barcodeText=decodeURIComponent(escape(d))}catch{s.barcodeText=d}}catch{s.barcodeText=""}if(s.exception!=null){j._setWarnnedEx.has(s.exception)||(j._setWarnnedEx.add(s.exception),console.warn(s.exception));let l={};s.exception.split(";").forEach(d=>{let _=d.indexOf(":");l[d.substring(0,_)]=d.substring(_+1)}),s.exception=l}}return e.decodeRecords?this.decodeRecords=e.decodeRecords:this.decodeRecords={},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!j._setWarnnedEx.has(e.description)&&(j._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==i.DBR_SUCCESS)return e.data;throw j.BarcodeReaderException(e.exception,e.description)}async setModeArgument(e,i,n,s){return await new Promise((l,d)=>{let _=j._nextTaskID++;j._taskCallbackMap.set(_,S=>{if(S.success){try{this._handleRetJsonString(S.setReturn)}catch(w){return d(w)}return l()}{let w=new Error(S.message);return w.stack=S.stack+`
`+w.stack,d(w)}}),j._dbrWorker.postMessage({type:"setModeArgument",id:_,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:n,argumentValue:s}})})}async getModeArgument(e,i,n){return await new Promise((s,l)=>{let d=j._nextTaskID++;j._taskCallbackMap.set(d,_=>{if(_.success){let S;try{S=this._handleRetJsonString(_.getReturn)}catch(w){return l(w)}return s(S)}{let S=new Error(_.message);return S.stack=_.stack+`
`+S.stack,l(S)}}),j._dbrWorker.postMessage({type:"getModeArgument",id:d,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:n}})})}async getIntermediateResults(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,s=>{if(s.success)return e(s.results);{let l=new Error(s.message);return l.stack=s.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"getIntermediateResults",id:n,instanceID:this._instanceID})})}async getIntermediateCanvas(){let e=await this.getIntermediateResults(),i=[];for(let n of e)if(n.dataType==ba.IMRDT_IMAGE)for(let s of n.results){const l=s.bytes;let d;switch(j._onLog&&j._onLog(" "+l.length+" "+l.byteLength+" "+s.width+" "+s.height+" "+s.stride+" "+s.format),s.format){case De.IPF_ABGR_8888:d=new Uint8ClampedArray(l);break;case De.IPF_RGB_888:{const w=l.length/3;d=new Uint8ClampedArray(4*w);for(let T=0;T<w;++T)d[4*T]=l[3*T+2],d[4*T+1]=l[3*T+1],d[4*T+2]=l[3*T],d[4*T+3]=255;break}case De.IPF_GrayScaled:{const w=l.length;d=new Uint8ClampedArray(4*w);for(let T=0;T<w;T++)d[4*T]=d[4*T+1]=d[4*T+2]=l[T],d[4*T+3]=255;break}case De.IPF_Binary:case De.IPF_BinaryInverted:{const w=l.length,T=s.width,A=s.height,I=s.stride;d=new Uint8ClampedArray(T*A*4);for(let k=0;k<w;k++){let B=l[k],F=k%I*8,z=Math.floor(k/I);for(let D=0;D<8;D++){let R=F+D,L=4*(z*T+R);if(R>=T)break;d[L]=d[L+1]=d[L+2]=(128&B)/128*255,d[L+3]=255,B<<=1}}break}default:console.warn("unknow intermediate image",s)}if(!d)continue;let _=new ImageData(d,s.width,s.height),S=document.createElement("canvas");S.width=s.width,S.height=s.height,S.getContext("2d").putImageData(_,0,0),i.push(S)}return i}async getScanSettings(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,s=>{if(s.success){let l=s.results;return l.intervalTime=this.intervalTime,l.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,l.soundOnSuccessfullRead=this.soundSource,l.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,l.vibrateDuration=this.vibrateDuration,l.captureAndDecodeInParallel=this.captureAndDecodeInParallel,l.autoZoom=this.autoZoom,l.autoFocus=this.autoFocus,l.autoSuggestTip=this.autoSuggestTip,e(l)}{let l=new Error(s.message);return l.stack+=`
`+s.stack,i(l)}}),j._dbrWorker.postMessage({type:"getScanSettings",id:n,instanceID:this._instanceID})})}async updateScanSettings(e){if(!e)return;const i=JSON.parse(JSON.stringify(e));if(i.autoZoom||i.autoFocus||i.autoSuggestTip){if(!j._bUseFullFeature)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported in the compact version. Please try the full-featured version.");if(!j._bIntermediateResultsSupported)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported because the license does not contain the intermediate_results module.");const n=await this.getRuntimeSettings();n.intermediateResultTypes|=Sn.IRT_TYPED_BARCODE_ZONE,await this.updateRuntimeSettings(n)}return i.hasOwnProperty("intervalTime")&&(this.intervalTime=Math.max(i.intervalTime,0),delete i.intervalTime),i.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=i.whenToPlaySoundforSuccessfulRead,delete i.whenToPlaySoundforSuccessfulRead),i.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=i.soundOnSuccessfullRead,delete i.soundOnSuccessfullRead),i.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=i.whenToVibrateforSuccessfulRead,delete i.whenToVibrateforSuccessfulRead),i.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=i.vibrateDuration,delete i.vibrateDuration),i.hasOwnProperty("captureAndDecodeInParallel")&&(this.captureAndDecodeInParallel=i.captureAndDecodeInParallel,delete i.captureAndDecodeInParallel),i.hasOwnProperty("autoZoom")&&(this.autoZoom&&this.autoZoom!=i.autoZoom&&this.dce&&this.dce.setZoom({factor:1}).catch(()=>{}),this.autoZoom=i.autoZoom,delete i.autoZoom),i.hasOwnProperty("autoFocus")&&(this.autoFocus=i.autoFocus,this.dce&&this.dce.setFocus({mode:"continuous"}).catch(()=>{}),delete i.autoFocus),i.hasOwnProperty("autoSuggestTip")&&(this.autoSuggestTip=i.autoSuggestTip,delete i.autoFocus),await new Promise((n,s)=>{let l=j._nextTaskID++;j._taskCallbackMap.set(l,d=>{if(d.success)return n();{let _=new Error(d.message);return _.stack+=`
`+d.stack,s(_)}}),j._dbrWorker.postMessage({type:"updateScanSettings",id:l,instanceID:this._instanceID,body:{settings:i}})})}_cloneDecodeResults(e){if(e instanceof Array){let i=[];for(let n of e)i.push(this._cloneDecodeResults(n));return i}{let i=e;return JSON.parse(JSON.stringify(i,(s,l)=>s=="oriVideoCanvas"||s=="searchRegionCanvas"?void 0:l))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this._imgSource||this._bPauseScan)return j._onLog&&j._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));j._onLog&&j._onLog("======= once read ======="),j._onLog&&(this._timeStartDecode=Date.now());let e=null,i=null;if(this.dce)e=this._getVideoFrame();else if(this._imgSource&&(i=await this._imgSource.getImage(),!j.isDSImage(i)))throw new Error("Invalid DSImage.");if(!e&&!i)return j._onLog&&j._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{let n=[];if(e){n=await this._decode_DCEFrame(e,{bScanner:!0,bCopyData:!1});let s=null;if(n&&n.length){const{sx:l,sy:d,width:_,height:S,_sWidth:w,_sHeight:T}=e;s=n.map(A=>({resultState:A.resultState,localizationResult:JSON.parse(JSON.stringify(A.localizationResult))})),j.recalculateResultLocation(s,l,d,w,T,_,S)}this._drawResults(s,n)}else i&&(n=await this._decode_DSImage(i,{bScanner:!0,bCopyData:!1}));return n})().then(n=>{if(j._onLog&&j._onLog(n),this.dce&&this.captureAndDecodeInParallel){let s=this.array_decodeFrameTimeCost,l=this.array_getFrameTimeCost;const d=()=>{let _=0;if(l&&l.length){let S=Math.min(...s),w=Math.max(...l);S&&w&&(_=S-w)}else _=0;return _>0?_:0};(()=>{for(;s.length>=5;)s.shift();s.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=d()+this.intervalTime}if((this.dce&&this.dce.isOpen()||this._imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&n.length){let s=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?s=n.some(l=>l.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(s=n.some(l=>l.resultState==0)),s&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&n.length){let s=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?s=n.some(l=>l.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(s=n.some(l=>l.resultState==0)),s)try{navigator.vibrate(this.vibrateDuration)}catch(l){console.warn("Vibration not allowed. User interaction required: "+(l.message||l))}}if(this.onImageRead){n=n.filter(l=>l.resultState>=0);const s=this._cloneDecodeResults(n);this.onImageRead(s)}if(this.onUniqueRead){n=n.filter(l=>l.resultState==0);const s=this._cloneDecodeResults(n);for(let l of s)this.onUniqueRead(l.barcodeText,l)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()}).catch(n=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),j._onLog&&j._onLog(n.message||n),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},Math.max(this.intervalTime,1e3)),n.message=="platform error"||console.warn(n.message)})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){if(j._onLog&&j._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer(),(n=>{if(!n)return;let s=n.timeSpent,l=this.array_getFrameTimeCost;for(;l.length>=5;)l.shift();l.push(s)})(e)}else j._onLog&&j._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e,i){if(!this.dce||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dbrDrawingLayer){if(!this.dce.isOpen()||!(this.dce.singleFrameMode||this.dce.video&&this.dce._videoTrack))return;this._dbrDrawingLayer=this.dce.getDrawingLayer(3)}const n=this._dbrDrawingLayer;e||(e=[]);let s=this._arrPolygons;for(let l=0;l<e.length;l++){let d,_=e[l].localizationResult;s[l]?(d=s[l],n.hasDrawingItem(d)||n.addDrawingItem(d),d.set("vertices",[{x:_.x1,y:_.y1},{x:_.x2,y:_.y2},{x:_.x3,y:_.y3},{x:_.x4,y:_.y4}]),(d.set||d.setAttribute).call(d,"vertices",[{x:_.x1,y:_.y1},{x:_.x2,y:_.y2},{x:_.x3,y:_.y3},{x:_.x4,y:_.y4}])):(d=new this._drawingItemNamespace.DT_Polygon([{x:_.x1,y:_.y1},{x:_.x2,y:_.y2},{x:_.x3,y:_.y3},{x:_.x4,y:_.y4}]),n.addDrawingItem(d),s[l]=d),e[l].resultState===-1?(d.styleId=this._styleIdBeforeVerification,d._mapStyle.set("default",this.dce.getDrawingStyle(this._styleIdBeforeVerification)),d._mapStyle.set("selected",this.dce.getDrawingStyle(this._styleIdBeforeVerification))):(d.styleId=null,d._mapStyle.set("default",this.dce.getDrawingStyle(3)),d._mapStyle.set("selected",this.dce.getDrawingStyle(7))),i&&i[l]?d.addNote({name:"Barcode_Result",content:i[l]},!0):d.addNote({name:"Barcode_Result",content:e[l]},!0)}for(let l=e.length;l<s.length;l++)s[l].deleteNote("Barcode_Result"),n.removeDrawingItem(s[l]);n.renderAll()}async startScanning(e){if(!this.dce&&!this._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new Ud;let i=null;if(this.dce){if(this.dce.isOpen())if(e&&this.dce.appendAndShowUI(),this.dce.playCallbackInfo)i=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else{const n=this.dce.getSelectedCamera();i={width:this.dce.video.videoWidth,height:this.dce.video.videoHeight,deviceId:n&&n.deviceId}}else if(i=await this.dce.open(e),!this._promiseStartScan)return null;this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},0)),this._promiseStartScan.resolve(i),i}stopScanning(e){this.dce&&(this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(j._onLog&&j._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,!this.dce&&this._promiseStartScan||this.stopScanning(),this.setImageSource(null);let e=j._nextTaskID++;j._taskCallbackMap.set(e,i=>{if(!i.success){let n=new Error(i.message);throw n.stack=i.stack+`
`+n.stack,n}}),j._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}j._jsVersion="9.6.0",j._jsEditVersion="20221213",j._version=`loading...(JS ${j._jsVersion}.${j._jsEditVersion})`,j._license=Yp,j._sessionPassword=Xp,j.browserInfo=qe,j._workerName=`dbr-${j._jsVersion}.browser.worker.js`,j._engineResourcePath=Hp,j._licenseServer=[],j._deviceFriendlyName="",j._bIntermediateResultsSupported=!0,j._isShowRelDecodeTimeInResults=!1,j._bWasmDebug=!1,j._bNeverShowDialog=!1,j.__bUseFullFeature=!0,j._nextTaskID=0,j._taskCallbackMap=new Map,j._pLoad=new Ud,j._lastErrorCode=0,j._lastErrorString="",j._setWarnnedEx=new Set,j._defaultUIElementURL="@engineResourcePath/dbr.ui.html";var $p={653:(t,e,i)=>{var n,s,l,d,_,S,w,T,A,I,k,B,F,z,D,R,L,$,ie,ne,J,y=y||{version:"5.2.1"};if(e.fabric=y,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?y.document=document:y.document=document.implementation.createHTMLDocument(""),y.window=window;else{var de=new(i(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;y.document=de.document,y.jsdomImplForWrapper=i(898).implForWrapper,y.nodeCanvas=i(245).Canvas,y.window=de,DOMParser=y.window.DOMParser}function ge(u,a){var c=u.canvas,f=a.targetCanvas,r=f.getContext("2d");r.translate(0,f.height),r.scale(1,-1);var o=c.height-f.height;r.drawImage(c,0,o,f.width,f.height,0,0,f.width,f.height)}function be(u,a){var c=a.targetCanvas.getContext("2d"),f=a.destinationWidth,r=a.destinationHeight,o=f*r*4,h=new Uint8Array(this.imageBuffer,0,o),m=new Uint8ClampedArray(this.imageBuffer,0,o);u.readPixels(0,0,f,r,u.RGBA,u.UNSIGNED_BYTE,h);var g=new ImageData(m,f,r);c.putImageData(g,0,0)}y.isTouchSupported="ontouchstart"in y.window||"ontouchstart"in y.document||y.window&&y.window.navigator&&y.window.navigator.maxTouchPoints>0,y.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",y.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],y.DPI=96,y.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",y.commaWsp="(?:\\s+,?\\s*|,\\s*)",y.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,y.reNonWord=/[ \n\.,;!\?\-]/,y.fontPaths={},y.iMatrix=[1,0,0,1,0,0],y.svgNS="http://www.w3.org/2000/svg",y.perfLimitSizeTotal=2097152,y.maxCacheSideLimit=4096,y.minCacheSideLimit=256,y.charWidthsCache={},y.textureSize=2048,y.disableStyleCopyPaste=!1,y.enableGLFiltering=!0,y.devicePixelRatio=y.window.devicePixelRatio||y.window.webkitDevicePixelRatio||y.window.mozDevicePixelRatio||1,y.browserShadowBlurConstant=1,y.arcToSegmentsCache={},y.boundsOfCurveCache={},y.cachesBoundsOfCurve=!0,y.forceGLPutImageData=!1,y.initFilterBackend=function(){return y.enableGLFiltering&&y.isWebglSupported&&y.isWebglSupported(y.textureSize)?(console.log("max texture size: "+y.maxTextureSize),new y.WebglFilterBackend({tileSize:y.textureSize})):y.Canvas2dFilterBackend?new y.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=y),function(){function u(c,f){if(this.__eventListeners[c]){var r=this.__eventListeners[c];f?r[r.indexOf(f)]=!1:y.util.array.fill(r,!1)}}function a(c,f){var r=function(){f.apply(this,arguments),this.off(c,r)}.bind(this);this.on(c,r)}y.Observable={fire:function(c,f){if(!this.__eventListeners)return this;var r=this.__eventListeners[c];if(!r)return this;for(var o=0,h=r.length;o<h;o++)r[o]&&r[o].call(this,f||{});return this.__eventListeners[c]=r.filter(function(m){return m!==!1}),this},on:function(c,f){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var r in c)this.on(r,c[r]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(f);return this},once:function(c,f){if(arguments.length===1)for(var r in c)a.call(this,r,c[r]);else a.call(this,c,f);return this},off:function(c,f){if(!this.__eventListeners)return this;if(arguments.length===0)for(c in this.__eventListeners)u.call(this,c);else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in c)u.call(this,r,c[r]);else u.call(this,c,f);return this}}}(),y.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var u=0,a=arguments.length;u<a;u++)this._onObjectAdded(arguments[u]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(u,a,c){var f=this._objects;return c?f[a]=u:f.splice(a,0,u),this._onObjectAdded&&this._onObjectAdded(u),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var u,a=this._objects,c=!1,f=0,r=arguments.length;f<r;f++)(u=a.indexOf(arguments[f]))!==-1&&(c=!0,a.splice(u,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[f]));return this.renderOnAddRemove&&c&&this.requestRenderAll(),this},forEachObject:function(u,a){for(var c=this.getObjects(),f=0,r=c.length;f<r;f++)u.call(a,c[f],f,c);return this},getObjects:function(u){return u===void 0?this._objects.concat():this._objects.filter(function(a){return a.type===u})},item:function(u){return this._objects[u]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(u,a){return this._objects.indexOf(u)>-1||!!a&&this._objects.some(function(c){return typeof c.contains=="function"&&c.contains(u,!0)})},complexity:function(){return this._objects.reduce(function(u,a){return u+(a.complexity?a.complexity():0)},0)}},y.CommonMethods={_setOptions:function(u){for(var a in u)this.set(a,u[a])},_initGradient:function(u,a){!u||!u.colorStops||u instanceof y.Gradient||this.set(a,new y.Gradient(u))},_initPattern:function(u,a,c){!u||!u.source||u instanceof y.Pattern?c&&c():this.set(a,new y.Pattern(u,c))},_setObject:function(u){for(var a in u)this._set(a,u[a])},set:function(u,a){return typeof u=="object"?this._setObject(u):this._set(u,a),this},_set:function(u,a){this[u]=a},toggle:function(u){var a=this.get(u);return typeof a=="boolean"&&this.set(u,!a),this},get:function(u){return this[u]}},n=e,s=Math.sqrt,l=Math.atan2,d=Math.pow,_=Math.PI/180,S=Math.PI/2,y.util={cos:function(u){if(u===0)return 1;switch(u<0&&(u=-u),u/S){case 1:case 3:return 0;case 2:return-1}return Math.cos(u)},sin:function(u){if(u===0)return 0;var a=1;switch(u<0&&(a=-1),u/S){case 1:return a;case 2:return 0;case 3:return-a}return Math.sin(u)},removeFromArray:function(u,a){var c=u.indexOf(a);return c!==-1&&u.splice(c,1),u},getRandomInt:function(u,a){return Math.floor(Math.random()*(a-u+1))+u},degreesToRadians:function(u){return u*_},radiansToDegrees:function(u){return u/_},rotatePoint:function(u,a,c){var f=new y.Point(u.x-a.x,u.y-a.y),r=y.util.rotateVector(f,c);return new y.Point(r.x,r.y).addEquals(a)},rotateVector:function(u,a){var c=y.util.sin(a),f=y.util.cos(a);return{x:u.x*f-u.y*c,y:u.x*c+u.y*f}},createVector:function(u,a){return new y.Point(a.x-u.x,a.y-u.y)},calcAngleBetweenVectors:function(u,a){return Math.acos((u.x*a.x+u.y*a.y)/(Math.hypot(u.x,u.y)*Math.hypot(a.x,a.y)))},getHatVector:function(u){return new y.Point(u.x,u.y).multiply(1/Math.hypot(u.x,u.y))},getBisector:function(u,a,c){var f=y.util.createVector(u,a),r=y.util.createVector(u,c),o=y.util.calcAngleBetweenVectors(f,r),h=o*(y.util.calcAngleBetweenVectors(y.util.rotateVector(f,o),r)===0?1:-1)/2;return{vector:y.util.getHatVector(y.util.rotateVector(f,h)),angle:o}},projectStrokeOnPoints:function(u,a,c){var f=[],r=a.strokeWidth/2,o=a.strokeUniform?new y.Point(1/a.scaleX,1/a.scaleY):new y.Point(1,1),h=function(m){var g=r/Math.hypot(m.x,m.y);return new y.Point(m.x*g*o.x,m.y*g*o.y)};return u.length<=1||u.forEach(function(m,g){var p,v,C=new y.Point(m.x,m.y);g===0?(v=u[g+1],p=c?h(y.util.createVector(v,C)).addEquals(C):u[u.length-1]):g===u.length-1?(p=u[g-1],v=c?h(y.util.createVector(p,C)).addEquals(C):u[0]):(p=u[g-1],v=u[g+1]);var x,b,E=y.util.getBisector(C,p,v),O=E.vector,M=E.angle;if(a.strokeLineJoin==="miter"&&(x=-r/Math.sin(M/2),b=new y.Point(O.x*x*o.x,O.y*x*o.y),Math.hypot(b.x,b.y)/r<=a.strokeMiterLimit))return f.push(C.add(b)),void f.push(C.subtract(b));x=-r*Math.SQRT2,b=new y.Point(O.x*x*o.x,O.y*x*o.y),f.push(C.add(b)),f.push(C.subtract(b))}),f},transformPoint:function(u,a,c){return c?new y.Point(a[0]*u.x+a[2]*u.y,a[1]*u.x+a[3]*u.y):new y.Point(a[0]*u.x+a[2]*u.y+a[4],a[1]*u.x+a[3]*u.y+a[5])},makeBoundingBoxFromPoints:function(u,a){if(a)for(var c=0;c<u.length;c++)u[c]=y.util.transformPoint(u[c],a);var f=[u[0].x,u[1].x,u[2].x,u[3].x],r=y.util.array.min(f),o=y.util.array.max(f)-r,h=[u[0].y,u[1].y,u[2].y,u[3].y],m=y.util.array.min(h);return{left:r,top:m,width:o,height:y.util.array.max(h)-m}},invertTransform:function(u){var a=1/(u[0]*u[3]-u[1]*u[2]),c=[a*u[3],-a*u[1],-a*u[2],a*u[0]],f=y.util.transformPoint({x:u[4],y:u[5]},c,!0);return c[4]=-f.x,c[5]=-f.y,c},toFixed:function(u,a){return parseFloat(Number(u).toFixed(a))},parseUnit:function(u,a){var c=/\D{0,2}$/.exec(u),f=parseFloat(u);switch(a||(a=y.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return f*y.DPI/25.4;case"cm":return f*y.DPI/2.54;case"in":return f*y.DPI;case"pt":return f*y.DPI/72;case"pc":return f*y.DPI/72*12;case"em":return f*a;default:return f}},falseFunction:function(){return!1},getKlass:function(u,a){return u=y.util.string.camelize(u.charAt(0).toUpperCase()+u.slice(1)),y.util.resolveNamespace(a)[u]},getSvgAttributes:function(u){var a=["instantiated_by_use","style","id","class"];switch(u){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"])}return a},resolveNamespace:function(u){if(!u)return y;var a,c=u.split("."),f=c.length,r=n||y.window;for(a=0;a<f;++a)r=r[c[a]];return r},loadImage:function(u,a,c,f){if(u){var r=y.util.createImage(),o=function(){a&&a.call(c,r,!1),r=r.onload=r.onerror=null};r.onload=o,r.onerror=function(){y.log("Error loading "+r.src),a&&a.call(c,null,!0),r=r.onload=r.onerror=null},u.indexOf("data")!==0&&f!=null&&(r.crossOrigin=f),u.substring(0,14)==="data:image/svg"&&(r.onload=null,y.util.loadImageInDom(r,o)),r.src=u}else a&&a.call(c,u)},loadImageInDom:function(u,a){var c=y.document.createElement("div");c.style.width=c.style.height="1px",c.style.left=c.style.top="-100%",c.style.position="absolute",c.appendChild(u),y.document.querySelector("body").appendChild(c),u.onload=function(){a(),c.parentNode.removeChild(c),c=null}},enlivenObjects:function(u,a,c,f){var r=[],o=0,h=(u=u||[]).length;function m(){++o===h&&a&&a(r.filter(function(g){return g}))}h?u.forEach(function(g,p){g&&g.type?y.util.getKlass(g.type,c).fromObject(g,function(v,C){C||(r[p]=v),f&&f(g,v,C),m()}):m()}):a&&a(r)},enlivenObjectEnlivables:function(u,a,c){var f=y.Object.ENLIVEN_PROPS.filter(function(r){return!!u[r]});y.util.enlivenObjects(f.map(function(r){return u[r]}),function(r){var o={};f.forEach(function(h,m){o[h]=r[m],a&&(a[h]=r[m])}),c&&c(o)})},enlivenPatterns:function(u,a){function c(){++r===o&&a&&a(f)}var f=[],r=0,o=(u=u||[]).length;o?u.forEach(function(h,m){h&&h.source?new y.Pattern(h,function(g){f[m]=g,c()}):(f[m]=h,c())}):a&&a(f)},groupSVGElements:function(u,a,c){var f;return u&&u.length===1?u[0]:(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),f=new y.Group(u,a),c!==void 0&&(f.sourcePath=c),f)},populateWithProperties:function(u,a,c){if(c&&Array.isArray(c))for(var f=0,r=c.length;f<r;f++)c[f]in u&&(a[c[f]]=u[c[f]])},createCanvasElement:function(){return y.document.createElement("canvas")},copyCanvasElement:function(u){var a=y.util.createCanvasElement();return a.width=u.width,a.height=u.height,a.getContext("2d").drawImage(u,0,0),a},toDataURL:function(u,a,c){return u.toDataURL("image/"+a,c)},createImage:function(){return y.document.createElement("img")},multiplyTransformMatrices:function(u,a,c){return[u[0]*a[0]+u[2]*a[1],u[1]*a[0]+u[3]*a[1],u[0]*a[2]+u[2]*a[3],u[1]*a[2]+u[3]*a[3],c?0:u[0]*a[4]+u[2]*a[5]+u[4],c?0:u[1]*a[4]+u[3]*a[5]+u[5]]},qrDecompose:function(u){var a=l(u[1],u[0]),c=d(u[0],2)+d(u[1],2),f=s(c),r=(u[0]*u[3]-u[2]*u[1])/f,o=l(u[0]*u[2]+u[1]*u[3],c);return{angle:a/_,scaleX:f,scaleY:r,skewX:o/_,skewY:0,translateX:u[4],translateY:u[5]}},calcRotateMatrix:function(u){if(!u.angle)return y.iMatrix.concat();var a=y.util.degreesToRadians(u.angle),c=y.util.cos(a),f=y.util.sin(a);return[c,f,-f,c,0,0]},calcDimensionsMatrix:function(u){var a=u.scaleX===void 0?1:u.scaleX,c=u.scaleY===void 0?1:u.scaleY,f=[u.flipX?-a:a,0,0,u.flipY?-c:c,0,0],r=y.util.multiplyTransformMatrices,o=y.util.degreesToRadians;return u.skewX&&(f=r(f,[1,0,Math.tan(o(u.skewX)),1],!0)),u.skewY&&(f=r(f,[1,Math.tan(o(u.skewY)),0,1],!0)),f},composeMatrix:function(u){var a=[1,0,0,1,u.translateX||0,u.translateY||0],c=y.util.multiplyTransformMatrices;return u.angle&&(a=c(a,y.util.calcRotateMatrix(u))),(u.scaleX!==1||u.scaleY!==1||u.skewX||u.skewY||u.flipX||u.flipY)&&(a=c(a,y.util.calcDimensionsMatrix(u))),a},resetObjectTransform:function(u){u.scaleX=1,u.scaleY=1,u.skewX=0,u.skewY=0,u.flipX=!1,u.flipY=!1,u.rotate(0)},saveObjectTransform:function(u){return{scaleX:u.scaleX,scaleY:u.scaleY,skewX:u.skewX,skewY:u.skewY,angle:u.angle,left:u.left,flipX:u.flipX,flipY:u.flipY,top:u.top}},isTransparent:function(u,a,c,f){f>0&&(a>f?a-=f:a=0,c>f?c-=f:c=0);var r,o=!0,h=u.getImageData(a,c,2*f||1,2*f||1),m=h.data.length;for(r=3;r<m&&(o=h.data[r]<=0)!=0;r+=4);return h=null,o},parsePreserveAspectRatioAttribute:function(u){var a,c="meet",f=u.split(" ");return f&&f.length&&((c=f.pop())!=="meet"&&c!=="slice"?(a=c,c="meet"):f.length&&(a=f.pop())),{meetOrSlice:c,alignX:a!=="none"?a.slice(1,4):"none",alignY:a!=="none"?a.slice(5,8):"none"}},clearFabricFontCache:function(u){(u=(u||"").toLowerCase())?y.charWidthsCache[u]&&delete y.charWidthsCache[u]:y.charWidthsCache={}},limitDimsByArea:function(u,a){var c=Math.sqrt(a*u),f=Math.floor(a/c);return{x:Math.floor(c),y:f}},capValue:function(u,a,c){return Math.max(u,Math.min(a,c))},findScaleToFit:function(u,a){return Math.min(a.width/u.width,a.height/u.height)},findScaleToCover:function(u,a){return Math.max(a.width/u.width,a.height/u.height)},matrixToSVG:function(u){return"matrix("+u.map(function(a){return y.util.toFixed(a,y.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(u,a){var c=y.util.invertTransform(a),f=y.util.multiplyTransformMatrices(c,u.calcOwnMatrix());y.util.applyTransformToObject(u,f)},addTransformToObject:function(u,a){y.util.applyTransformToObject(u,y.util.multiplyTransformMatrices(a,u.calcOwnMatrix()))},applyTransformToObject:function(u,a){var c=y.util.qrDecompose(a),f=new y.Point(c.translateX,c.translateY);u.flipX=!1,u.flipY=!1,u.set("scaleX",c.scaleX),u.set("scaleY",c.scaleY),u.skewX=c.skewX,u.skewY=c.skewY,u.angle=c.angle,u.setPositionByOrigin(f,"center","center")},sizeAfterTransform:function(u,a,c){var f=u/2,r=a/2,o=[{x:-f,y:-r},{x:f,y:-r},{x:-f,y:r},{x:f,y:r}],h=y.util.calcDimensionsMatrix(c),m=y.util.makeBoundingBoxFromPoints(o,h);return{x:m.width,y:m.height}},mergeClipPaths:function(u,a){var c=u,f=a;c.inverted&&!f.inverted&&(c=a,f=u),y.util.applyTransformToObject(f,y.util.multiplyTransformMatrices(y.util.invertTransform(c.calcTransformMatrix()),f.calcTransformMatrix()));var r=c.inverted&&f.inverted;return r&&(c.inverted=f.inverted=!1),new y.Group([c],{clipPath:f,inverted:r})}},function(){var u=Array.prototype.join,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};function f(b,E,O,M,W,G,Q,K,Y,N,P){var H=y.util.cos(b),q=y.util.sin(b),ee=y.util.cos(E),U=y.util.sin(E),V=O*W*ee-M*G*U+Q,X=M*W*ee+O*G*U+K;return["C",N+Y*(-O*W*q-M*G*H),P+Y*(-M*W*q+O*G*H),V+Y*(O*W*U+M*G*ee),X+Y*(M*W*U-O*G*ee),V,X]}function r(b,E,O,M){var W=Math.atan2(E,b),G=Math.atan2(M,O);return G>=W?G-W:2*Math.PI-(W-G)}function o(b,E,O){for(var M=O[1],W=O[2],G=O[3],Q=O[4],K=O[5],Y=function(H,q,ee,U,V,X,te){var Z=Math.PI,re=te*Z/180,he=y.util.sin(re),le=y.util.cos(re),se=0,ue=0,ce=-le*H*.5-he*q*.5,fe=-le*q*.5+he*H*.5,ve=(ee=Math.abs(ee))*ee,pe=(U=Math.abs(U))*U,we=fe*fe,Ie=ce*ce,wt=ve*pe-ve*we-pe*Ie,Wt=0;if(wt<0){var zi=Math.sqrt(1-wt/(ve*pe));ee*=zi,U*=zi}else Wt=(V===X?-1:1)*Math.sqrt(wt/(ve*we+pe*Ie));var Le=Wt*ee*fe/U,Ct=-Wt*U*ce/ee,Tn=le*Le-he*Ct+.5*H,Hi=he*Le+le*Ct+.5*q,bi=r(1,0,(ce-Le)/ee,(fe-Ct)/U),Yi=r((ce-Le)/ee,(fe-Ct)/U,(-ce-Le)/ee,(-fe-Ct)/U);X===0&&Yi>0?Yi-=2*Z:X===1&&Yi<0&&(Yi+=2*Z);for(var Pl=Math.ceil(Math.abs(Yi/Z*2)),Sr=[],bn=Yi/Pl,df=8/3*Math.sin(bn/4)*Math.sin(bn/4)/Math.sin(bn/2),Qo=bi+bn,En=0;En<Pl;En++)Sr[En]=f(bi,Qo,le,he,ee,U,Tn,Hi,df,se,ue),se=Sr[En][5],ue=Sr[En][6],bi=Qo,Qo+=bn;return Sr}(O[6]-b,O[7]-E,M,W,Q,K,G),N=0,P=Y.length;N<P;N++)Y[N][1]+=b,Y[N][2]+=E,Y[N][3]+=b,Y[N][4]+=E,Y[N][5]+=b,Y[N][6]+=E;return Y}function h(b,E,O,M){return Math.sqrt((O-b)*(O-b)+(M-E)*(M-E))}function m(b,E,O,M,W,G,Q,K){return function(Y){var N,P=(N=Y)*N*N,H=function(U){return 3*U*U*(1-U)}(Y),q=function(U){return 3*U*(1-U)*(1-U)}(Y),ee=function(U){return(1-U)*(1-U)*(1-U)}(Y);return{x:Q*P+W*H+O*q+b*ee,y:K*P+G*H+M*q+E*ee}}}function g(b,E,O,M,W,G,Q,K){return function(Y){var N=1-Y,P=3*N*N*(O-b)+6*N*Y*(W-O)+3*Y*Y*(Q-W),H=3*N*N*(M-E)+6*N*Y*(G-M)+3*Y*Y*(K-G);return Math.atan2(H,P)}}function p(b,E,O,M,W,G){return function(Q){var K,Y=(K=Q)*K,N=function(H){return 2*H*(1-H)}(Q),P=function(H){return(1-H)*(1-H)}(Q);return{x:W*Y+O*N+b*P,y:G*Y+M*N+E*P}}}function v(b,E,O,M,W,G){return function(Q){var K=1-Q,Y=2*K*(O-b)+2*Q*(W-O),N=2*K*(M-E)+2*Q*(G-M);return Math.atan2(N,Y)}}function C(b,E,O){var M,W,G={x:E,y:O},Q=0;for(W=1;W<=100;W+=1)M=b(W/100),Q+=h(G.x,G.y,M.x,M.y),G=M;return Q}function x(b){for(var E,O,M,W,G=0,Q=b.length,K=0,Y=0,N=0,P=0,H=[],q=0;q<Q;q++){switch(M={x:K,y:Y,command:(E=b[q])[0]},E[0]){case"M":M.length=0,N=K=E[1],P=Y=E[2];break;case"L":M.length=h(K,Y,E[1],E[2]),K=E[1],Y=E[2];break;case"C":O=m(K,Y,E[1],E[2],E[3],E[4],E[5],E[6]),W=g(K,Y,E[1],E[2],E[3],E[4],E[5],E[6]),M.iterator=O,M.angleFinder=W,M.length=C(O,K,Y),K=E[5],Y=E[6];break;case"Q":O=p(K,Y,E[1],E[2],E[3],E[4]),W=v(K,Y,E[1],E[2],E[3],E[4]),M.iterator=O,M.angleFinder=W,M.length=C(O,K,Y),K=E[3],Y=E[4];break;case"Z":case"z":M.destX=N,M.destY=P,M.length=h(K,Y,N,P),K=N,Y=P}G+=M.length,H.push(M)}return H.push({length:G,x:K,y:Y}),H}y.util.joinPath=function(b){return b.map(function(E){return E.join(" ")}).join(" ")},y.util.parsePath=function(b){var E,O,M,W,G,Q=[],K=[],Y=y.rePathCommand,N="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",P="("+N+")"+y.commaWsp,H="([01])"+y.commaWsp+"?",q=new RegExp(P+"?"+P+"?"+P+H+H+P+"?("+N+")","g");if(!b||!b.match)return Q;for(var ee,U=0,V=(G=b.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;U<V;U++){W=(E=G[U]).slice(1).trim(),K.length=0;var X=E.charAt(0);if(ee=[X],X.toLowerCase()==="a")for(var te;te=q.exec(W);)for(var Z=1;Z<te.length;Z++)K.push(te[Z]);else for(;M=Y.exec(W);)K.push(M[0]);Z=0;for(var re=K.length;Z<re;Z++)O=parseFloat(K[Z]),isNaN(O)||ee.push(O);var he=a[X.toLowerCase()],le=c[X]||X;if(ee.length-1>he)for(var se=1,ue=ee.length;se<ue;se+=he)Q.push([X].concat(ee.slice(se,se+he))),X=le;else Q.push(ee)}return Q},y.util.makePathSimpler=function(b){var E,O,M,W,G,Q,K=0,Y=0,N=b.length,P=0,H=0,q=[];for(O=0;O<N;++O){switch(M=!1,(E=b[O].slice(0))[0]){case"l":E[0]="L",E[1]+=K,E[2]+=Y;case"L":K=E[1],Y=E[2];break;case"h":E[1]+=K;case"H":E[0]="L",E[2]=Y,K=E[1];break;case"v":E[1]+=Y;case"V":E[0]="L",Y=E[1],E[1]=K,E[2]=Y;break;case"m":E[0]="M",E[1]+=K,E[2]+=Y;case"M":K=E[1],Y=E[2],P=E[1],H=E[2];break;case"c":E[0]="C",E[1]+=K,E[2]+=Y,E[3]+=K,E[4]+=Y,E[5]+=K,E[6]+=Y;case"C":G=E[3],Q=E[4],K=E[5],Y=E[6];break;case"s":E[0]="S",E[1]+=K,E[2]+=Y,E[3]+=K,E[4]+=Y;case"S":W==="C"?(G=2*K-G,Q=2*Y-Q):(G=K,Q=Y),K=E[3],Y=E[4],E[0]="C",E[5]=E[3],E[6]=E[4],E[3]=E[1],E[4]=E[2],E[1]=G,E[2]=Q,G=E[3],Q=E[4];break;case"q":E[0]="Q",E[1]+=K,E[2]+=Y,E[3]+=K,E[4]+=Y;case"Q":G=E[1],Q=E[2],K=E[3],Y=E[4];break;case"t":E[0]="T",E[1]+=K,E[2]+=Y;case"T":W==="Q"?(G=2*K-G,Q=2*Y-Q):(G=K,Q=Y),E[0]="Q",K=E[1],Y=E[2],E[1]=G,E[2]=Q,E[3]=K,E[4]=Y;break;case"a":E[0]="A",E[6]+=K,E[7]+=Y;case"A":M=!0,q=q.concat(o(K,Y,E)),K=E[6],Y=E[7];break;case"z":case"Z":K=P,Y=H}M||q.push(E),W=E[0]}return q},y.util.getSmoothPathFromPoints=function(b,E){var O,M=[],W=new y.Point(b[0].x,b[0].y),G=new y.Point(b[1].x,b[1].y),Q=b.length,K=1,Y=0,N=Q>2;for(E=E||0,N&&(K=b[2].x<G.x?-1:b[2].x===G.x?0:1,Y=b[2].y<G.y?-1:b[2].y===G.y?0:1),M.push(["M",W.x-K*E,W.y-Y*E]),O=1;O<Q;O++){if(!W.eq(G)){var P=W.midPointFrom(G);M.push(["Q",W.x,W.y,P.x,P.y])}W=b[O],O+1<b.length&&(G=b[O+1])}return N&&(K=W.x>b[O-2].x?1:W.x===b[O-2].x?0:-1,Y=W.y>b[O-2].y?1:W.y===b[O-2].y?0:-1),M.push(["L",W.x+K*E,W.y+Y*E]),M},y.util.getPathSegmentsInfo=x,y.util.getBoundsOfCurve=function(b,E,O,M,W,G,Q,K){var Y;if(y.cachesBoundsOfCurve&&(Y=u.call(arguments),y.boundsOfCurveCache[Y]))return y.boundsOfCurveCache[Y];var N,P,H,q,ee,U,V,X,te=Math.sqrt,Z=Math.min,re=Math.max,he=Math.abs,le=[],se=[[],[]];P=6*b-12*O+6*W,N=-3*b+9*O-9*W+3*Q,H=3*O-3*b;for(var ue=0;ue<2;++ue)if(ue>0&&(P=6*E-12*M+6*G,N=-3*E+9*M-9*G+3*K,H=3*M-3*E),he(N)<1e-12){if(he(P)<1e-12)continue;0<(q=-H/P)&&q<1&&le.push(q)}else(V=P*P-4*H*N)<0||(0<(ee=(-P+(X=te(V)))/(2*N))&&ee<1&&le.push(ee),0<(U=(-P-X)/(2*N))&&U<1&&le.push(U));for(var ce,fe,ve,pe=le.length,we=pe;pe--;)ce=(ve=1-(q=le[pe]))*ve*ve*b+3*ve*ve*q*O+3*ve*q*q*W+q*q*q*Q,se[0][pe]=ce,fe=ve*ve*ve*E+3*ve*ve*q*M+3*ve*q*q*G+q*q*q*K,se[1][pe]=fe;se[0][we]=b,se[1][we]=E,se[0][we+1]=Q,se[1][we+1]=K;var Ie=[{x:Z.apply(null,se[0]),y:Z.apply(null,se[1])},{x:re.apply(null,se[0]),y:re.apply(null,se[1])}];return y.cachesBoundsOfCurve&&(y.boundsOfCurveCache[Y]=Ie),Ie},y.util.getPointOnPath=function(b,E,O){O||(O=x(b));for(var M=0;E-O[M].length>0&&M<O.length-2;)E-=O[M].length,M++;var W,G=O[M],Q=E/G.length,K=G.command,Y=b[M];switch(K){case"M":return{x:G.x,y:G.y,angle:0};case"Z":case"z":return(W=new y.Point(G.x,G.y).lerp(new y.Point(G.destX,G.destY),Q)).angle=Math.atan2(G.destY-G.y,G.destX-G.x),W;case"L":return(W=new y.Point(G.x,G.y).lerp(new y.Point(Y[1],Y[2]),Q)).angle=Math.atan2(Y[2]-G.y,Y[1]-G.x),W;case"C":case"Q":return function(N,P){for(var H,q,ee,U=0,V=0,X=N.iterator,te={x:N.x,y:N.y},Z=.01,re=N.angleFinder;V<P&&Z>1e-4;)H=X(U),ee=U,(q=h(te.x,te.y,H.x,H.y))+V>P?(U-=Z,Z/=2):(te=H,U+=Z,V+=q);return H.angle=re(ee),H}(G,E)}},y.util.transformPath=function(b,E,O){return O&&(E=y.util.multiplyTransformMatrices(E,[1,0,0,1,-O.x,-O.y])),b.map(function(M){for(var W=M.slice(0),G={},Q=1;Q<M.length-1;Q+=2)G.x=M[Q],G.y=M[Q+1],G=y.util.transformPoint(G,E),W[Q]=G.x,W[Q+1]=G.y;return W})}}(),function(){var u=Array.prototype.slice;function a(c,f,r){if(c&&c.length!==0){var o=c.length-1,h=f?c[o][f]:c[o];if(f)for(;o--;)r(c[o][f],h)&&(h=c[o][f]);else for(;o--;)r(c[o],h)&&(h=c[o]);return h}}y.util.array={fill:function(c,f){for(var r=c.length;r--;)c[r]=f;return c},invoke:function(c,f){for(var r=u.call(arguments,2),o=[],h=0,m=c.length;h<m;h++)o[h]=r.length?c[h][f].apply(c[h],r):c[h][f].call(c[h]);return o},min:function(c,f){return a(c,f,function(r,o){return r<o})},max:function(c,f){return a(c,f,function(r,o){return r>=o})}}}(),function(){function u(a,c,f){if(f)if(!y.isLikelyNode&&c instanceof Element)a=c;else if(c instanceof Array){a=[];for(var r=0,o=c.length;r<o;r++)a[r]=u({},c[r],f)}else if(c&&typeof c=="object")for(var h in c)h==="canvas"||h==="group"?a[h]=null:c.hasOwnProperty(h)&&(a[h]=u({},c[h],f));else a=c;else for(var h in c)a[h]=c[h];return a}y.util.object={extend:u,clone:function(a,c){return u({},a,c)}},y.util.object.extend(y.util,y.Observable)}(),function(){function u(a,c){var f=a.charCodeAt(c);if(isNaN(f))return"";if(f<55296||f>57343)return a.charAt(c);if(55296<=f&&f<=56319){if(a.length<=c+1)throw"High surrogate without following low surrogate";var r=a.charCodeAt(c+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return a.charAt(c)+a.charAt(c+1)}if(c===0)throw"Low surrogate without preceding high surrogate";var o=a.charCodeAt(c-1);if(55296>o||o>56319)throw"Low surrogate without preceding high surrogate";return!1}y.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(c,f){return f?f.toUpperCase():""})},capitalize:function(a,c){return a.charAt(0).toUpperCase()+(c?a.slice(1):a.slice(1).toLowerCase())},escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(a){var c,f=0,r=[];for(f=0;f<a.length;f++)(c=u(a,f))!==!1&&r.push(c);return r}}}(),function(){var u=Array.prototype.slice,a=function(){},c=function(){for(var h in{toString:1})if(h==="toString")return!1;return!0}(),f=function(h,m,g){for(var p in m)p in h.prototype&&typeof h.prototype[p]=="function"&&(m[p]+"").indexOf("callSuper")>-1?h.prototype[p]=function(v){return function(){var C=this.constructor.superclass;this.constructor.superclass=g;var x=m[v].apply(this,arguments);if(this.constructor.superclass=C,v!=="initialize")return x}}(p):h.prototype[p]=m[p],c&&(m.toString!==Object.prototype.toString&&(h.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(h.prototype.valueOf=m.valueOf))};function r(){}function o(h){for(var m=null,g=this;g.constructor.superclass;){var p=g.constructor.superclass.prototype[h];if(g[h]!==p){m=p;break}g=g.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,u.call(arguments,1)):m.call(this):console.log("tried to callSuper "+h+", method not found in prototype chain",this)}y.util.createClass=function(){var h=null,m=u.call(arguments,0);function g(){this.initialize.apply(this,arguments)}typeof m[0]=="function"&&(h=m.shift()),g.superclass=h,g.subclasses=[],h&&(r.prototype=h.prototype,g.prototype=new r,h.subclasses.push(g));for(var p=0,v=m.length;p<v;p++)f(g,m[p],h);return g.prototype.initialize||(g.prototype.initialize=a),g.prototype.constructor=g,g.prototype.callSuper=o,g}}(),w=!!y.document.createElement("div").attachEvent,T=["touchstart","touchmove","touchend"],y.util.addListener=function(u,a,c,f){u&&u.addEventListener(a,c,!w&&f)},y.util.removeListener=function(u,a,c,f){u&&u.removeEventListener(a,c,!w&&f)},y.util.getPointer=function(u){var a=u.target,c=y.util.getScrollLeftTop(a),f=function(r){var o=r.changedTouches;return o&&o[0]?o[0]:r}(u);return{x:f.clientX+c.left,y:f.clientY+c.top}},y.util.isTouchEvent=function(u){return T.indexOf(u.type)>-1||u.pointerType==="touch"},I=typeof(A=y.document.createElement("div")).style.opacity=="string",k=typeof A.style.filter=="string",B=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,F=function(u){return u},I?F=function(u,a){return u.style.opacity=a,u}:k&&(F=function(u,a){var c=u.style;return u.currentStyle&&!u.currentStyle.hasLayout&&(c.zoom=1),B.test(c.filter)?(a=a>=.9999?"":"alpha(opacity="+100*a+")",c.filter=c.filter.replace(B,a)):c.filter+=" alpha(opacity="+100*a+")",u}),y.util.setStyle=function(u,a){var c=u.style;if(!c)return u;if(typeof a=="string")return u.style.cssText+=";"+a,a.indexOf("opacity")>-1?F(u,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):u;for(var f in a)f==="opacity"?F(u,a[f]):c[f==="float"||f==="cssFloat"?c.styleFloat===void 0?"cssFloat":"styleFloat":f]=a[f];return u},function(){var u,a,c,f,r=Array.prototype.slice,o=function(g){return r.call(g,0)};try{u=o(y.document.childNodes)instanceof Array}catch{}function h(g,p){var v=y.document.createElement(g);for(var C in p)C==="class"?v.className=p[C]:C==="for"?v.htmlFor=p[C]:v.setAttribute(C,p[C]);return v}function m(g){for(var p=0,v=0,C=y.document.documentElement,x=y.document.body||{scrollLeft:0,scrollTop:0};g&&(g.parentNode||g.host)&&((g=g.parentNode||g.host)===y.document?(p=x.scrollLeft||C.scrollLeft||0,v=x.scrollTop||C.scrollTop||0):(p+=g.scrollLeft||0,v+=g.scrollTop||0),g.nodeType!==1||g.style.position!=="fixed"););return{left:p,top:v}}u||(o=function(g){for(var p=new Array(g.length),v=g.length;v--;)p[v]=g[v];return p}),a=y.document.defaultView&&y.document.defaultView.getComputedStyle?function(g,p){var v=y.document.defaultView.getComputedStyle(g,null);return v?v[p]:void 0}:function(g,p){var v=g.style[p];return!v&&g.currentStyle&&(v=g.currentStyle[p]),v},c=y.document.documentElement.style,f="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"",y.util.makeElementUnselectable=function(g){return g.onselectstart!==void 0&&(g.onselectstart=y.util.falseFunction),f?g.style[f]="none":typeof g.unselectable=="string"&&(g.unselectable="on"),g},y.util.makeElementSelectable=function(g){return g.onselectstart!==void 0&&(g.onselectstart=null),f?g.style[f]="":typeof g.unselectable=="string"&&(g.unselectable=""),g},y.util.setImageSmoothing=function(g,p){g.imageSmoothingEnabled=g.imageSmoothingEnabled||g.webkitImageSmoothingEnabled||g.mozImageSmoothingEnabled||g.msImageSmoothingEnabled||g.oImageSmoothingEnabled,g.imageSmoothingEnabled=p},y.util.getById=function(g){return typeof g=="string"?y.document.getElementById(g):g},y.util.toArray=o,y.util.addClass=function(g,p){g&&(" "+g.className+" ").indexOf(" "+p+" ")===-1&&(g.className+=(g.className?" ":"")+p)},y.util.makeElement=h,y.util.wrapElement=function(g,p,v){return typeof p=="string"&&(p=h(p,v)),g.parentNode&&g.parentNode.replaceChild(p,g),p.appendChild(g),p},y.util.getScrollLeftTop=m,y.util.getElementOffset=function(g){var p,v,C=g&&g.ownerDocument,x={left:0,top:0},b={left:0,top:0},E={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return b;for(var O in E)b[E[O]]+=parseInt(a(g,O),10)||0;return p=C.documentElement,g.getBoundingClientRect!==void 0&&(x=g.getBoundingClientRect()),v=m(g),{left:x.left+v.left-(p.clientLeft||0)+b.left,top:x.top+v.top-(p.clientTop||0)+b.top}},y.util.getNodeCanvas=function(g){var p=y.jsdomImplForWrapper(g);return p._canvas||p._image},y.util.cleanUpJsdomNode=function(g){if(y.isLikelyNode){var p=y.jsdomImplForWrapper(g);p&&(p._image=null,p._canvas=null,p._currentSrc=null,p._attributes=null,p._classList=null)}}}(),function(){function u(){}y.util.request=function(a,c){c||(c={});var f=c.method?c.method.toUpperCase():"GET",r=c.onComplete||function(){},o=new y.window.XMLHttpRequest,h=c.body||c.parameters;return o.onreadystatechange=function(){o.readyState===4&&(r(o),o.onreadystatechange=u)},f==="GET"&&(h=null,typeof c.parameters=="string"&&(a=function(m,g){return m+(/\?/.test(m)?"&":"?")+g}(a,c.parameters))),o.open(f,a,!0),f!=="POST"&&f!=="PUT"||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(h),o}}(),y.log=console.log,y.warn=console.warn,function(){var u=y.util.object.extend,a=y.util.object.clone,c=[];function f(){return!1}function r(g,p,v,C){return-v*Math.cos(g/C*(Math.PI/2))+v+p}y.util.object.extend(c,{cancelAll:function(){var g=this.splice(0);return g.forEach(function(p){p.cancel()}),g},cancelByCanvas:function(g){if(!g)return[];var p=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===g});return p.forEach(function(v){v.cancel()}),p},cancelByTarget:function(g){var p=this.findAnimationsByTarget(g);return p.forEach(function(v){v.cancel()}),p},findAnimationIndex:function(g){return this.indexOf(this.findAnimation(g))},findAnimation:function(g){return this.find(function(p){return p.cancel===g})},findAnimationsByTarget:function(g){return g?this.filter(function(p){return p.target===g}):[]}});var o=y.window.requestAnimationFrame||y.window.webkitRequestAnimationFrame||y.window.mozRequestAnimationFrame||y.window.oRequestAnimationFrame||y.window.msRequestAnimationFrame||function(g){return y.window.setTimeout(g,1e3/60)},h=y.window.cancelAnimationFrame||y.window.clearTimeout;function m(){return o.apply(y.window,arguments)}y.util.animate=function(g){g||(g={});var p,v=!1,C=function(){var x=y.runningAnimations.indexOf(p);return x>-1&&y.runningAnimations.splice(x,1)[0]};return p=u(a(g),{cancel:function(){return v=!0,C()},currentValue:"startValue"in g?g.startValue:0,completionRate:0,durationRate:0}),y.runningAnimations.push(p),m(function(x){var b,E=x||+new Date,O=g.duration||500,M=E+O,W=g.onChange||f,G=g.abort||f,Q=g.onComplete||f,K=g.easing||r,Y="startValue"in g&&g.startValue.length>0,N="startValue"in g?g.startValue:0,P="endValue"in g?g.endValue:100,H=g.byValue||(Y?N.map(function(q,ee){return P[ee]-N[ee]}):P-N);g.onStart&&g.onStart(),function q(ee){var U=(b=ee||+new Date)>M?O:b-E,V=U/O,X=Y?N.map(function(Z,re){return K(U,N[re],H[re],O)}):K(U,N,H,O),te=Math.abs(Y?(X[0]-N[0])/H[0]:(X-N)/H);if(p.currentValue=Y?X.slice():X,p.completionRate=te,p.durationRate=V,!v){if(!G(X,te,V))return b>M?(p.currentValue=Y?P.slice():P,p.completionRate=1,p.durationRate=1,W(Y?P.slice():P,1,1),Q(P,1,1),void C()):(W(X,te,V),void m(q));C()}}(E)}),p.cancel},y.util.requestAnimFrame=m,y.util.cancelAnimFrame=function(){return h.apply(y.window,arguments)},y.runningAnimations=c}(),function(){function u(a,c,f){var r="rgba("+parseInt(a[0]+f*(c[0]-a[0]),10)+","+parseInt(a[1]+f*(c[1]-a[1]),10)+","+parseInt(a[2]+f*(c[2]-a[2]),10);return(r+=","+(a&&c?parseFloat(a[3]+f*(c[3]-a[3])):1))+")"}y.util.animateColor=function(a,c,f,r){var o=new y.Color(a).getSource(),h=new y.Color(c).getSource(),m=r.onComplete,g=r.onChange;return r=r||{},y.util.animate(y.util.object.extend(r,{duration:f||500,startValue:o,endValue:h,byValue:h,easing:function(p,v,C,x){return u(v,C,r.colorEasing?r.colorEasing(p,x):1-Math.cos(p/x*(Math.PI/2)))},onComplete:function(p,v,C){if(m)return m(u(h,h,0),v,C)},onChange:function(p,v,C){if(g){if(Array.isArray(p))return g(u(p,p,0),v,C);g(p,v,C)}}}))}}(),function(){function u(r,o,h,m){return r<Math.abs(o)?(r=o,m=h/4):m=o===0&&r===0?h/(2*Math.PI)*Math.asin(1):h/(2*Math.PI)*Math.asin(o/r),{a:r,c:o,p:h,s:m}}function a(r,o,h){return r.a*Math.pow(2,10*(o-=1))*Math.sin((o*h-r.s)*(2*Math.PI)/r.p)}function c(r,o,h,m){return h-f(m-r,0,h,m)+o}function f(r,o,h,m){return(r/=m)<1/2.75?h*(7.5625*r*r)+o:r<2/2.75?h*(7.5625*(r-=1.5/2.75)*r+.75)+o:r<2.5/2.75?h*(7.5625*(r-=2.25/2.75)*r+.9375)+o:h*(7.5625*(r-=2.625/2.75)*r+.984375)+o}y.util.ease={easeInQuad:function(r,o,h,m){return h*(r/=m)*r+o},easeOutQuad:function(r,o,h,m){return-h*(r/=m)*(r-2)+o},easeInOutQuad:function(r,o,h,m){return(r/=m/2)<1?h/2*r*r+o:-h/2*(--r*(r-2)-1)+o},easeInCubic:function(r,o,h,m){return h*(r/=m)*r*r+o},easeOutCubic:function(r,o,h,m){return h*((r=r/m-1)*r*r+1)+o},easeInOutCubic:function(r,o,h,m){return(r/=m/2)<1?h/2*r*r*r+o:h/2*((r-=2)*r*r+2)+o},easeInQuart:function(r,o,h,m){return h*(r/=m)*r*r*r+o},easeOutQuart:function(r,o,h,m){return-h*((r=r/m-1)*r*r*r-1)+o},easeInOutQuart:function(r,o,h,m){return(r/=m/2)<1?h/2*r*r*r*r+o:-h/2*((r-=2)*r*r*r-2)+o},easeInQuint:function(r,o,h,m){return h*(r/=m)*r*r*r*r+o},easeOutQuint:function(r,o,h,m){return h*((r=r/m-1)*r*r*r*r+1)+o},easeInOutQuint:function(r,o,h,m){return(r/=m/2)<1?h/2*r*r*r*r*r+o:h/2*((r-=2)*r*r*r*r+2)+o},easeInSine:function(r,o,h,m){return-h*Math.cos(r/m*(Math.PI/2))+h+o},easeOutSine:function(r,o,h,m){return h*Math.sin(r/m*(Math.PI/2))+o},easeInOutSine:function(r,o,h,m){return-h/2*(Math.cos(Math.PI*r/m)-1)+o},easeInExpo:function(r,o,h,m){return r===0?o:h*Math.pow(2,10*(r/m-1))+o},easeOutExpo:function(r,o,h,m){return r===m?o+h:h*(1-Math.pow(2,-10*r/m))+o},easeInOutExpo:function(r,o,h,m){return r===0?o:r===m?o+h:(r/=m/2)<1?h/2*Math.pow(2,10*(r-1))+o:h/2*(2-Math.pow(2,-10*--r))+o},easeInCirc:function(r,o,h,m){return-h*(Math.sqrt(1-(r/=m)*r)-1)+o},easeOutCirc:function(r,o,h,m){return h*Math.sqrt(1-(r=r/m-1)*r)+o},easeInOutCirc:function(r,o,h,m){return(r/=m/2)<1?-h/2*(Math.sqrt(1-r*r)-1)+o:h/2*(Math.sqrt(1-(r-=2)*r)+1)+o},easeInElastic:function(r,o,h,m){var g=0;return r===0?o:(r/=m)==1?o+h:(g||(g=.3*m),-a(u(h,h,g,1.70158),r,m)+o)},easeOutElastic:function(r,o,h,m){var g=0;if(r===0)return o;if((r/=m)==1)return o+h;g||(g=.3*m);var p=u(h,h,g,1.70158);return p.a*Math.pow(2,-10*r)*Math.sin((r*m-p.s)*(2*Math.PI)/p.p)+p.c+o},easeInOutElastic:function(r,o,h,m){var g=0;if(r===0)return o;if((r/=m/2)==2)return o+h;g||(g=m*(.3*1.5));var p=u(h,h,g,1.70158);return r<1?-.5*a(p,r,m)+o:p.a*Math.pow(2,-10*(r-=1))*Math.sin((r*m-p.s)*(2*Math.PI)/p.p)*.5+p.c+o},easeInBack:function(r,o,h,m,g){return g===void 0&&(g=1.70158),h*(r/=m)*r*((g+1)*r-g)+o},easeOutBack:function(r,o,h,m,g){return g===void 0&&(g=1.70158),h*((r=r/m-1)*r*((g+1)*r+g)+1)+o},easeInOutBack:function(r,o,h,m,g){return g===void 0&&(g=1.70158),(r/=m/2)<1?h/2*(r*r*((1+(g*=1.525))*r-g))+o:h/2*((r-=2)*r*((1+(g*=1.525))*r+g)+2)+o},easeInBounce:c,easeOutBounce:f,easeInOutBounce:function(r,o,h,m){return r<m/2?.5*c(2*r,0,h,m)+o:.5*f(2*r-m,0,h,m)+.5*h+o}}}(),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.object.clone,r=a.util.toFixed,o=a.util.parseUnit,h=a.util.multiplyTransformMatrices,m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},g={stroke:"strokeOpacity",fill:"fillOpacity"},p="font-size",v="clip-path";function C(N){return N in m?m[N]:N}function x(N,P,H,q){var ee,U=Array.isArray(P);if(N!=="fill"&&N!=="stroke"||P!=="none"){if(N==="strokeUniform")return P==="non-scaling-stroke";if(N==="strokeDashArray")P=P==="none"?null:P.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(N==="transformMatrix")P=H&&H.transformMatrix?h(H.transformMatrix,a.parseTransformAttribute(P)):a.parseTransformAttribute(P);else if(N==="visible")P=P!=="none"&&P!=="hidden",H&&H.visible===!1&&(P=!1);else if(N==="opacity")P=parseFloat(P),H&&H.opacity!==void 0&&(P*=H.opacity);else if(N==="textAnchor")P=P==="start"?"left":P==="end"?"right":"center";else if(N==="charSpacing")ee=o(P,q)/q*1e3;else if(N==="paintFirst"){var V=P.indexOf("fill"),X=P.indexOf("stroke");P="fill",(V>-1&&X>-1&&X<V||V===-1&&X>-1)&&(P="stroke")}else{if(N==="href"||N==="xlink:href"||N==="font")return P;if(N==="imageSmoothing")return P==="optimizeQuality";ee=U?P.map(o):o(P,q)}}else P="";return!U&&isNaN(ee)?P:ee}function b(N){return new RegExp("^("+N.join("|")+")\\b","i")}function E(N,P){var H,q,ee,U,V=[];for(ee=0,U=P.length;ee<U;ee++)H=P[ee],q=N.getElementsByTagName(H),V=V.concat(Array.prototype.slice.call(q));return V}function O(N,P){var H,q=!0;return(H=M(N,P.pop()))&&P.length&&(q=function(ee,U){for(var V,X=!0;ee.parentNode&&ee.parentNode.nodeType===1&&U.length;)X&&(V=U.pop()),X=M(ee=ee.parentNode,V);return U.length===0}(N,P)),H&&q&&P.length===0}function M(N,P){var H,q,ee=N.nodeName,U=N.getAttribute("class"),V=N.getAttribute("id");if(H=new RegExp("^"+ee,"i"),P=P.replace(H,""),V&&P.length&&(H=new RegExp("#"+V+"(?![a-zA-Z\\-]+)","i"),P=P.replace(H,"")),U&&P.length)for(q=(U=U.split(" ")).length;q--;)H=new RegExp("\\."+U[q]+"(?![a-zA-Z\\-]+)","i"),P=P.replace(H,"");return P.length===0}function W(N,P){var H;if(N.getElementById&&(H=N.getElementById(P)),H)return H;var q,ee,U,V=N.getElementsByTagName("*");for(ee=0,U=V.length;ee<U;ee++)if(P===(q=V[ee]).getAttribute("id"))return q}a.svgValidTagNamesRegEx=b(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),a.svgViewBoxElementsRegEx=b(["symbol","image","marker","pattern","view","svg"]),a.svgInvalidAncestorsRegEx=b(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),a.svgValidParentsRegEx=b(["symbol","g","a","svg","clipPath","defs"]),a.cssRules={},a.gradientDefs={},a.clipPaths={},a.parseTransformAttribute=function(){function N(X,te,Z){X[Z]=Math.tan(a.util.degreesToRadians(te[0]))}var P=a.iMatrix,H=a.reNum,q=a.commaWsp,ee="(?:(?:(matrix)\\s*\\(\\s*("+H+")"+q+"("+H+")"+q+"("+H+")"+q+"("+H+")"+q+"("+H+")"+q+"("+H+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+H+")(?:"+q+"("+H+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+H+")(?:"+q+"("+H+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+H+")(?:"+q+"("+H+")"+q+"("+H+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+H+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+H+")\\s*\\)))",U=new RegExp("^\\s*(?:(?:"+ee+"(?:"+q+"*"+ee+")*)?)\\s*$"),V=new RegExp(ee,"g");return function(X){var te=P.concat(),Z=[];if(!X||X&&!U.test(X))return te;X.replace(V,function(he){var le=new RegExp(ee).exec(he).filter(function(ce){return!!ce}),se=le[1],ue=le.slice(2).map(parseFloat);switch(se){case"translate":(function(ce,fe){ce[4]=fe[0],fe.length===2&&(ce[5]=fe[1])})(te,ue);break;case"rotate":ue[0]=a.util.degreesToRadians(ue[0]),function(ce,fe){var ve=a.util.cos(fe[0]),pe=a.util.sin(fe[0]),we=0,Ie=0;fe.length===3&&(we=fe[1],Ie=fe[2]),ce[0]=ve,ce[1]=pe,ce[2]=-pe,ce[3]=ve,ce[4]=we-(ve*we-pe*Ie),ce[5]=Ie-(pe*we+ve*Ie)}(te,ue);break;case"scale":(function(ce,fe){var ve=fe[0],pe=fe.length===2?fe[1]:fe[0];ce[0]=ve,ce[3]=pe})(te,ue);break;case"skewX":N(te,ue,2);break;case"skewY":N(te,ue,1);break;case"matrix":te=ue}Z.push(te.concat()),te=P.concat()});for(var re=Z[0];Z.length>1;)Z.shift(),re=a.util.multiplyTransformMatrices(re,Z[0]);return re}}();var G=new RegExp("^\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*$");function Q(N){if(!a.svgViewBoxElementsRegEx.test(N.nodeName))return{};var P,H,q,ee,U,V,X=N.getAttribute("viewBox"),te=1,Z=1,re=N.getAttribute("width"),he=N.getAttribute("height"),le=N.getAttribute("x")||0,se=N.getAttribute("y")||0,ue=N.getAttribute("preserveAspectRatio")||"",ce=!X||!(X=X.match(G)),fe=!re||!he||re==="100%"||he==="100%",ve=ce&&fe,pe={},we="",Ie=0,wt=0;if(pe.width=0,pe.height=0,pe.toBeParsed=ve,ce&&(le||se)&&N.parentNode&&N.parentNode.nodeName!=="#document"&&(we=" translate("+o(le)+" "+o(se)+") ",U=(N.getAttribute("transform")||"")+we,N.setAttribute("transform",U),N.removeAttribute("x"),N.removeAttribute("y")),ve)return pe;if(ce)return pe.width=o(re),pe.height=o(he),pe;if(P=-parseFloat(X[1]),H=-parseFloat(X[2]),q=parseFloat(X[3]),ee=parseFloat(X[4]),pe.minX=P,pe.minY=H,pe.viewBoxWidth=q,pe.viewBoxHeight=ee,fe?(pe.width=q,pe.height=ee):(pe.width=o(re),pe.height=o(he),te=pe.width/q,Z=pe.height/ee),(ue=a.util.parsePreserveAspectRatioAttribute(ue)).alignX!=="none"&&(ue.meetOrSlice==="meet"&&(Z=te=te>Z?Z:te),ue.meetOrSlice==="slice"&&(Z=te=te>Z?te:Z),Ie=pe.width-q*te,wt=pe.height-ee*te,ue.alignX==="Mid"&&(Ie/=2),ue.alignY==="Mid"&&(wt/=2),ue.alignX==="Min"&&(Ie=0),ue.alignY==="Min"&&(wt=0)),te===1&&Z===1&&P===0&&H===0&&le===0&&se===0)return pe;if((le||se)&&N.parentNode.nodeName!=="#document"&&(we=" translate("+o(le)+" "+o(se)+") "),U=we+" matrix("+te+" 0 0 "+Z+" "+(P*te+Ie)+" "+(H*Z+wt)+") ",N.nodeName==="svg"){for(V=N.ownerDocument.createElementNS(a.svgNS,"g");N.firstChild;)V.appendChild(N.firstChild);N.appendChild(V)}else(V=N).removeAttribute("x"),V.removeAttribute("y"),U=V.getAttribute("transform")+U;return V.setAttribute("transform",U),pe}function K(N,P){var H="xlink:href",q=W(N,P.getAttribute(H).slice(1));if(q&&q.getAttribute(H)&&K(N,q),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(U){q&&!P.hasAttribute(U)&&q.hasAttribute(U)&&P.setAttribute(U,q.getAttribute(U))}),!P.children.length)for(var ee=q.cloneNode(!0);ee.firstChild;)P.appendChild(ee.firstChild);P.removeAttribute(H)}a.parseSVGDocument=function(N,P,H,q){if(N){(function(le){for(var se=E(le,["use","svg:use"]),ue=0;se.length&&ue<se.length;){var ce=se[ue],fe=ce.getAttribute("xlink:href")||ce.getAttribute("href");if(fe===null)return;var ve,pe,we,Ie,wt=fe.slice(1),Wt=ce.getAttribute("x")||0,zi=ce.getAttribute("y")||0,Le=W(le,wt).cloneNode(!0),Ct=(Le.getAttribute("transform")||"")+" translate("+Wt+", "+zi+")",Tn=se.length,Hi=a.svgNS;if(Q(Le),/^svg$/i.test(Le.nodeName)){var bi=Le.ownerDocument.createElementNS(Hi,"g");for(pe=0,Ie=(we=Le.attributes).length;pe<Ie;pe++)ve=we.item(pe),bi.setAttributeNS(Hi,ve.nodeName,ve.nodeValue);for(;Le.firstChild;)bi.appendChild(Le.firstChild);Le=bi}for(pe=0,Ie=(we=ce.attributes).length;pe<Ie;pe++)(ve=we.item(pe)).nodeName!=="x"&&ve.nodeName!=="y"&&ve.nodeName!=="xlink:href"&&ve.nodeName!=="href"&&(ve.nodeName==="transform"?Ct=ve.nodeValue+" "+Ct:Le.setAttribute(ve.nodeName,ve.nodeValue));Le.setAttribute("transform",Ct),Le.setAttribute("instantiated_by_use","1"),Le.removeAttribute("id"),ce.parentNode.replaceChild(Le,ce),se.length===Tn&&ue++}})(N);var ee,U,V=a.Object.__uid++,X=Q(N),te=a.util.toArray(N.getElementsByTagName("*"));if(X.crossOrigin=q&&q.crossOrigin,X.svgUid=V,te.length===0&&a.isLikelyNode){var Z=[];for(ee=0,U=(te=N.selectNodes('//*[name(.)!="svg"]')).length;ee<U;ee++)Z[ee]=te[ee];te=Z}var re=te.filter(function(le){return Q(le),a.svgValidTagNamesRegEx.test(le.nodeName.replace("svg:",""))&&!function(se,ue){for(;se&&(se=se.parentNode);)if(se.nodeName&&ue.test(se.nodeName.replace("svg:",""))&&!se.getAttribute("instantiated_by_use"))return!0;return!1}(le,a.svgInvalidAncestorsRegEx)});if(!re||re&&!re.length)P&&P([],{});else{var he={};te.filter(function(le){return le.nodeName.replace("svg:","")==="clipPath"}).forEach(function(le){var se=le.getAttribute("id");he[se]=a.util.toArray(le.getElementsByTagName("*")).filter(function(ue){return a.svgValidTagNamesRegEx.test(ue.nodeName.replace("svg:",""))})}),a.gradientDefs[V]=a.getGradientDefs(N),a.cssRules[V]=a.getCSSRules(N),a.clipPaths[V]=he,a.parseElements(re,function(le,se){P&&(P(le,X,se,te),delete a.gradientDefs[V],delete a.cssRules[V],delete a.clipPaths[V])},f(X),H,q)}}};var Y=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+a.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+a.reNum+"))?\\s+(.*)");c(a,{parseFontDeclaration:function(N,P){var H=N.match(Y);if(H){var q=H[1],ee=H[3],U=H[4],V=H[5],X=H[6];q&&(P.fontStyle=q),ee&&(P.fontWeight=isNaN(parseFloat(ee))?ee:parseFloat(ee)),U&&(P.fontSize=o(U)),X&&(P.fontFamily=X),V&&(P.lineHeight=V==="normal"?1:V)}},getGradientDefs:function(N){var P,H=E(N,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),q=0,ee={};for(q=H.length;q--;)(P=H[q]).getAttribute("xlink:href")&&K(N,P),ee[P.getAttribute("id")]=P;return ee},parseAttributes:function(N,P,H){if(N){var q,ee,U,V={};H===void 0&&(H=N.getAttribute("svgUid")),N.parentNode&&a.svgValidParentsRegEx.test(N.parentNode.nodeName)&&(V=a.parseAttributes(N.parentNode,P,H));var X=P.reduce(function(ue,ce){return(q=N.getAttribute(ce))&&(ue[ce]=q),ue},{}),te=c(function(ue,ce){var fe={};for(var ve in a.cssRules[ce])if(O(ue,ve.split(" ")))for(var pe in a.cssRules[ce][ve])fe[pe]=a.cssRules[ce][ve][pe];return fe}(N,H),a.parseStyleAttribute(N));X=c(X,te),te[v]&&N.setAttribute(v,te[v]),ee=U=V.fontSize||a.Text.DEFAULT_SVG_FONT_SIZE,X[p]&&(X[p]=ee=o(X[p],U));var Z,re,he={};for(var le in X)re=x(Z=C(le),X[le],V,ee),he[Z]=re;he&&he.font&&a.parseFontDeclaration(he.font,he);var se=c(V,he);return a.svgValidParentsRegEx.test(N.nodeName)?se:function(ue){for(var ce in g)if(ue[g[ce]]!==void 0&&ue[ce]!==""){if(ue[ce]===void 0){if(!a.Object.prototype[ce])continue;ue[ce]=a.Object.prototype[ce]}if(ue[ce].indexOf("url(")!==0){var fe=new a.Color(ue[ce]);ue[ce]=fe.setAlpha(r(fe.getAlpha()*ue[g[ce]],2)).toRgba()}}return ue}(se)}},parseElements:function(N,P,H,q,ee){new a.ElementsParser(N,P,H,q,ee).parse()},parseStyleAttribute:function(N){var P={},H=N.getAttribute("style");return H&&(typeof H=="string"?function(q,ee){var U,V;q.replace(/;\s*$/,"").split(";").forEach(function(X){var te=X.split(":");U=te[0].trim().toLowerCase(),V=te[1].trim(),ee[U]=V})}(H,P):function(q,ee){var U,V;for(var X in q)q[X]!==void 0&&(U=X.toLowerCase(),V=q[X],ee[U]=V)}(H,P)),P},parsePointsAttribute:function(N){if(!N)return null;var P,H,q=[];for(P=0,H=(N=(N=N.replace(/,/g," ").trim()).split(/\s+/)).length;P<H;P+=2)q.push({x:parseFloat(N[P]),y:parseFloat(N[P+1])});return q},getCSSRules:function(N){var P,H,q=N.getElementsByTagName("style"),ee={};for(P=0,H=q.length;P<H;P++){var U=q[P].textContent;(U=U.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&U.split("}").filter(function(V){return V.trim()}).forEach(function(V){var X=V.split("{"),te={},Z=X[1].trim().split(";").filter(function(se){return se.trim()});for(P=0,H=Z.length;P<H;P++){var re=Z[P].split(":"),he=re[0].trim(),le=re[1].trim();te[he]=le}(V=X[0].trim()).split(",").forEach(function(se){(se=se.replace(/^svg/i,"").trim())!==""&&(ee[se]?a.util.object.extend(ee[se],te):ee[se]=a.util.object.clone(te))})})}return ee},loadSVGFromURL:function(N,P,H,q){N=N.replace(/^\n\s*/,"").trim(),new a.util.request(N,{method:"get",onComplete:function(ee){var U=ee.responseXML;if(!U||!U.documentElement)return P&&P(null),!1;a.parseSVGDocument(U.documentElement,function(V,X,te,Z){P&&P(V,X,te,Z)},H,q)}})},loadSVGFromString:function(N,P,H,q){var ee=new a.window.DOMParser().parseFromString(N.trim(),"text/xml");a.parseSVGDocument(ee.documentElement,function(U,V,X,te){P(U,V,X,te)},H,q)}})}(e),y.ElementsParser=function(u,a,c,f,r,o){this.elements=u,this.callback=a,this.options=c,this.reviver=f,this.svgUid=c&&c.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o},(z=y.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},z.createObjects=function(){var u=this;this.elements.forEach(function(a,c){a.setAttribute("svgUid",u.svgUid),u.createObject(a,c)})},z.findTag=function(u){return y[y.util.string.capitalize(u.tagName.replace("svg:",""))]},z.createObject=function(u,a){var c=this.findTag(u);if(c&&c.fromElement)try{c.fromElement(u,this.createCallback(a,u),this.options)}catch(f){y.log(f)}else this.checkIfDone()},z.createCallback=function(u,a){var c=this;return function(f){var r;c.resolveGradient(f,a,"fill"),c.resolveGradient(f,a,"stroke"),f instanceof y.Image&&f._originalElement&&(r=f.parsePreserveAspectRatioAttribute(a)),f._removeTransformMatrix(r),c.resolveClipPath(f,a),c.reviver&&c.reviver(a,f),c.instances[u]=f,c.checkIfDone()}},z.extractPropertyDefinition=function(u,a,c){var f=u[a],r=this.regexUrl;if(r.test(f)){r.lastIndex=0;var o=r.exec(f)[1];return r.lastIndex=0,y[c][this.svgUid][o]}},z.resolveGradient=function(u,a,c){var f=this.extractPropertyDefinition(u,c,"gradientDefs");if(f){var r=a.getAttribute(c+"-opacity"),o=y.Gradient.fromElement(f,u,r,this.options);u.set(c,o)}},z.createClipPathCallback=function(u,a){return function(c){c._removeTransformMatrix(),c.fillRule=c.clipRule,a.push(c)}},z.resolveClipPath=function(u,a){var c,f,r,o,h=this.extractPropertyDefinition(u,"clipPath","clipPaths");if(h){r=[],f=y.util.invertTransform(u.calcTransformMatrix());for(var m=h[0].parentNode,g=a;g.parentNode&&g.getAttribute("clip-path")!==u.clipPath;)g=g.parentNode;g.parentNode.appendChild(m);for(var p=0;p<h.length;p++)c=h[p],this.findTag(c).fromElement(c,this.createClipPathCallback(u,r),this.options);h=r.length===1?r[0]:new y.Group(r),o=y.util.multiplyTransformMatrices(f,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,g);var v=y.util.qrDecompose(o);h.flipX=!1,h.flipY=!1,h.set("scaleX",v.scaleX),h.set("scaleY",v.scaleY),h.angle=v.angle,h.skewX=v.skewX,h.skewY=0,h.setPositionByOrigin({x:v.translateX,y:v.translateY},"center","center"),u.clipPath=h}else delete u.clipPath},z.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(u){return u!=null}),this.callback(this.instances,this.elements))},function(u){var a=u.fabric||(u.fabric={});function c(f,r){this.x=f,this.y=r}a.Point?a.warn("fabric.Point is already defined"):(a.Point=c,c.prototype={type:"point",constructor:c,add:function(f){return new c(this.x+f.x,this.y+f.y)},addEquals:function(f){return this.x+=f.x,this.y+=f.y,this},scalarAdd:function(f){return new c(this.x+f,this.y+f)},scalarAddEquals:function(f){return this.x+=f,this.y+=f,this},subtract:function(f){return new c(this.x-f.x,this.y-f.y)},subtractEquals:function(f){return this.x-=f.x,this.y-=f.y,this},scalarSubtract:function(f){return new c(this.x-f,this.y-f)},scalarSubtractEquals:function(f){return this.x-=f,this.y-=f,this},multiply:function(f){return new c(this.x*f,this.y*f)},multiplyEquals:function(f){return this.x*=f,this.y*=f,this},divide:function(f){return new c(this.x/f,this.y/f)},divideEquals:function(f){return this.x/=f,this.y/=f,this},eq:function(f){return this.x===f.x&&this.y===f.y},lt:function(f){return this.x<f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,r){return r===void 0&&(r=.5),r=Math.max(Math.min(1,r),0),new c(this.x+(f.x-this.x)*r,this.y+(f.y-this.y)*r)},distanceFrom:function(f){var r=this.x-f.x,o=this.y-f.y;return Math.sqrt(r*r+o*o)},midPointFrom:function(f){return this.lerp(f)},min:function(f){return new c(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new c(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},setXY:function(f,r){return this.x=f,this.y=r,this},setX:function(f){return this.x=f,this},setY:function(f){return this.y=f,this},setFromPoint:function(f){return this.x=f.x,this.y=f.y,this},swap:function(f){var r=this.x,o=this.y;this.x=f.x,this.y=f.y,f.x=r,f.y=o},clone:function(){return new c(this.x,this.y)}})}(e),function(u){var a=u.fabric||(u.fabric={});function c(f){this.status=f,this.points=[]}a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=c,a.Intersection.prototype={constructor:c,appendPoint:function(f){return this.points.push(f),this},appendPoints:function(f){return this.points=this.points.concat(f),this}},a.Intersection.intersectLineLine=function(f,r,o,h){var m,g=(h.x-o.x)*(f.y-o.y)-(h.y-o.y)*(f.x-o.x),p=(r.x-f.x)*(f.y-o.y)-(r.y-f.y)*(f.x-o.x),v=(h.y-o.y)*(r.x-f.x)-(h.x-o.x)*(r.y-f.y);if(v!==0){var C=g/v,x=p/v;0<=C&&C<=1&&0<=x&&x<=1?(m=new c("Intersection")).appendPoint(new a.Point(f.x+C*(r.x-f.x),f.y+C*(r.y-f.y))):m=new c}else m=new c(g===0||p===0?"Coincident":"Parallel");return m},a.Intersection.intersectLinePolygon=function(f,r,o){var h,m,g,p,v=new c,C=o.length;for(p=0;p<C;p++)h=o[p],m=o[(p+1)%C],g=c.intersectLineLine(f,r,h,m),v.appendPoints(g.points);return v.points.length>0&&(v.status="Intersection"),v},a.Intersection.intersectPolygonPolygon=function(f,r){var o,h=new c,m=f.length;for(o=0;o<m;o++){var g=f[o],p=f[(o+1)%m],v=c.intersectLinePolygon(g,p,r);h.appendPoints(v.points)}return h.points.length>0&&(h.status="Intersection"),h},a.Intersection.intersectPolygonRectangle=function(f,r,o){var h=r.min(o),m=r.max(o),g=new a.Point(m.x,h.y),p=new a.Point(h.x,m.y),v=c.intersectLinePolygon(h,g,f),C=c.intersectLinePolygon(g,m,f),x=c.intersectLinePolygon(m,p,f),b=c.intersectLinePolygon(p,h,f),E=new c;return E.appendPoints(v.points),E.appendPoints(C.points),E.appendPoints(x.points),E.appendPoints(b.points),E.points.length>0&&(E.status="Intersection"),E})}(e),function(u){var a=u.fabric||(u.fabric={});function c(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}function f(r,o,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?r+6*(o-r)*h:h<.5?o:h<2/3?r+(o-r)*(2/3-h)*6:r}a.Color?a.warn("fabric.Color is already defined."):(a.Color=c,a.Color.prototype={_tryParsingColor:function(r){var o;r in c.colorNameMap&&(r=c.colorNameMap[r]),r==="transparent"&&(o=[255,255,255,0]),o||(o=c.sourceFromHex(r)),o||(o=c.sourceFromRgb(r)),o||(o=c.sourceFromHsl(r)),o||(o=[0,0,0,1]),o&&this.setSource(o)},_rgbToHsl:function(r,o,h){r/=255,o/=255,h/=255;var m,g,p,v=a.util.array.max([r,o,h]),C=a.util.array.min([r,o,h]);if(p=(v+C)/2,v===C)m=g=0;else{var x=v-C;switch(g=p>.5?x/(2-v-C):x/(v+C),v){case r:m=(o-h)/x+(o<h?6:0);break;case o:m=(h-r)/x+2;break;case h:m=(r-o)/x+4}m/=6}return[Math.round(360*m),Math.round(100*g),Math.round(100*p)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),o=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+o[0]+","+o[1]+"%,"+o[2]+"%)"},toHsla:function(){var r=this.getSource(),o=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+o[0]+","+o[1]+"%,"+o[2]+"%,"+r[3]+")"},toHex:function(){var r,o,h,m=this.getSource();return r=(r=m[0].toString(16)).length===1?"0"+r:r,o=(o=m[1].toString(16)).length===1?"0"+o:o,h=(h=m[2].toString(16)).length===1?"0"+h:h,r.toUpperCase()+o.toUpperCase()+h.toUpperCase()},toHexa:function(){var r,o=this.getSource();return r=(r=(r=Math.round(255*o[3])).toString(16)).length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var o=this.getSource();return o[3]=r,this.setSource(o),this},toGrayscale:function(){var r=this.getSource(),o=parseInt((.3*r[0]+.59*r[1]+.11*r[2]).toFixed(0),10),h=r[3];return this.setSource([o,o,o,h]),this},toBlackWhite:function(r){var o=this.getSource(),h=(.3*o[0]+.59*o[1]+.11*o[2]).toFixed(0),m=o[3];return r=r||127,h=Number(h)<Number(r)?0:255,this.setSource([h,h,h,m]),this},overlayWith:function(r){r instanceof c||(r=new c(r));var o,h=[],m=this.getAlpha(),g=this.getSource(),p=r.getSource();for(o=0;o<3;o++)h.push(Math.round(.5*g[o]+.5*p[o]));return h[3]=m,this.setSource(h),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,a.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a.Color.fromRgb=function(r){return c.fromSource(c.sourceFromRgb(r))},a.Color.sourceFromRgb=function(r){var o=r.match(c.reRGBa);if(o){var h=parseInt(o[1],10)/(/%$/.test(o[1])?100:1)*(/%$/.test(o[1])?255:1),m=parseInt(o[2],10)/(/%$/.test(o[2])?100:1)*(/%$/.test(o[2])?255:1),g=parseInt(o[3],10)/(/%$/.test(o[3])?100:1)*(/%$/.test(o[3])?255:1);return[parseInt(h,10),parseInt(m,10),parseInt(g,10),o[4]?parseFloat(o[4]):1]}},a.Color.fromRgba=c.fromRgb,a.Color.fromHsl=function(r){return c.fromSource(c.sourceFromHsl(r))},a.Color.sourceFromHsl=function(r){var o=r.match(c.reHSLa);if(o){var h,m,g,p=(parseFloat(o[1])%360+360)%360/360,v=parseFloat(o[2])/(/%$/.test(o[2])?100:1),C=parseFloat(o[3])/(/%$/.test(o[3])?100:1);if(v===0)h=m=g=C;else{var x=C<=.5?C*(v+1):C+v-C*v,b=2*C-x;h=f(b,x,p+1/3),m=f(b,x,p),g=f(b,x,p-1/3)}return[Math.round(255*h),Math.round(255*m),Math.round(255*g),o[4]?parseFloat(o[4]):1]}},a.Color.fromHsla=c.fromHsl,a.Color.fromHex=function(r){return c.fromSource(c.sourceFromHex(r))},a.Color.sourceFromHex=function(r){if(r.match(c.reHex)){var o=r.slice(r.indexOf("#")+1),h=o.length===3||o.length===4,m=o.length===8||o.length===4,g=h?o.charAt(0)+o.charAt(0):o.substring(0,2),p=h?o.charAt(1)+o.charAt(1):o.substring(2,4),v=h?o.charAt(2)+o.charAt(2):o.substring(4,6),C=m?h?o.charAt(3)+o.charAt(3):o.substring(6,8):"FF";return[parseInt(g,16),parseInt(p,16),parseInt(v,16),parseFloat((parseInt(C,16)/255).toFixed(2))]}},a.Color.fromSource=function(r){var o=new c;return o.setSource(r),o})}(e),function(u){var a=u.fabric||(u.fabric={}),c=["e","se","s","sw","w","nw","n","ne","e"],f=["ns","nesw","ew","nwse"],r={},o="left",h="top",m="right",g="bottom",p="center",v={top:g,bottom:h,left:m,right:o,center:p},C=a.util.radiansToDegrees,x=Math.sign||function(U){return(U>0)-(U<0)||+U};function b(U,V){var X=U.angle+C(Math.atan2(V.y,V.x))+360;return Math.round(X%360/45)}function E(U,V){var X=V.transform.target,te=X.canvas,Z=a.util.object.clone(V);Z.target=X,te&&te.fire("object:"+U,Z),X.fire(U,V)}function O(U,V){var X=V.canvas,te=U[X.uniScaleKey];return X.uniformScaling&&!te||!X.uniformScaling&&te}function M(U){return U.originX===p&&U.originY===p}function W(U,V,X){var te=U.lockScalingX,Z=U.lockScalingY;return!((!te||!Z)&&(V||!te&&!Z||!X)&&(!te||V!=="x")&&(!Z||V!=="y"))}function G(U,V,X,te){return{e:U,transform:V,pointer:{x:X,y:te}}}function Q(U){return function(V,X,te,Z){var re=X.target,he=re.getCenterPoint(),le=re.translateToOriginPoint(he,X.originX,X.originY),se=U(V,X,te,Z);return re.setPositionByOrigin(le,X.originX,X.originY),se}}function K(U,V){return function(X,te,Z,re){var he=V(X,te,Z,re);return he&&E(U,G(X,te,Z,re)),he}}function Y(U,V,X,te,Z){var re=U.target,he=re.controls[U.corner],le=re.canvas.getZoom(),se=re.padding/le,ue=re.toLocalPoint(new a.Point(te,Z),V,X);return ue.x>=se&&(ue.x-=se),ue.x<=-se&&(ue.x+=se),ue.y>=se&&(ue.y-=se),ue.y<=se&&(ue.y+=se),ue.x-=he.offsetX,ue.y-=he.offsetY,ue}function N(U){return U.flipX!==U.flipY}function P(U,V,X,te,Z){if(U[V]!==0){var re=Z/U._getTransformedDimensions()[te]*U[X];U.set(X,re)}}function H(U,V,X,te){var Z,re=V.target,he=re._getTransformedDimensions(0,re.skewY),le=Y(V,V.originX,V.originY,X,te),se=Math.abs(2*le.x)-he.x,ue=re.skewX;se<2?Z=0:(Z=C(Math.atan2(se/re.scaleX,he.y/re.scaleY)),V.originX===o&&V.originY===g&&(Z=-Z),V.originX===m&&V.originY===h&&(Z=-Z),N(re)&&(Z=-Z));var ce=ue!==Z;if(ce){var fe=re._getTransformedDimensions().y;re.set("skewX",Z),P(re,"skewY","scaleY","y",fe)}return ce}function q(U,V,X,te){var Z,re=V.target,he=re._getTransformedDimensions(re.skewX,0),le=Y(V,V.originX,V.originY,X,te),se=Math.abs(2*le.y)-he.y,ue=re.skewY;se<2?Z=0:(Z=C(Math.atan2(se/re.scaleY,he.x/re.scaleX)),V.originX===o&&V.originY===g&&(Z=-Z),V.originX===m&&V.originY===h&&(Z=-Z),N(re)&&(Z=-Z));var ce=ue!==Z;if(ce){var fe=re._getTransformedDimensions().x;re.set("skewY",Z),P(re,"skewX","scaleX","x",fe)}return ce}function ee(U,V,X,te,Z){Z=Z||{};var re,he,le,se,ue,ce,fe=V.target,ve=fe.lockScalingX,pe=fe.lockScalingY,we=Z.by,Ie=O(U,fe),wt=W(fe,we,Ie),Wt=V.gestureScale;if(wt)return!1;if(Wt)he=V.scaleX*Wt,le=V.scaleY*Wt;else{if(re=Y(V,V.originX,V.originY,X,te),ue=we!=="y"?x(re.x):1,ce=we!=="x"?x(re.y):1,V.signX||(V.signX=ue),V.signY||(V.signY=ce),fe.lockScalingFlip&&(V.signX!==ue||V.signY!==ce))return!1;if(se=fe._getTransformedDimensions(),Ie&&!we){var zi=Math.abs(re.x)+Math.abs(re.y),Le=V.original,Ct=zi/(Math.abs(se.x*Le.scaleX/fe.scaleX)+Math.abs(se.y*Le.scaleY/fe.scaleY));he=Le.scaleX*Ct,le=Le.scaleY*Ct}else he=Math.abs(re.x*fe.scaleX/se.x),le=Math.abs(re.y*fe.scaleY/se.y);M(V)&&(he*=2,le*=2),V.signX!==ue&&we!=="y"&&(V.originX=v[V.originX],he*=-1,V.signX=ue),V.signY!==ce&&we!=="x"&&(V.originY=v[V.originY],le*=-1,V.signY=ce)}var Tn=fe.scaleX,Hi=fe.scaleY;return we?(we==="x"&&fe.set("scaleX",he),we==="y"&&fe.set("scaleY",le)):(!ve&&fe.set("scaleX",he),!pe&&fe.set("scaleY",le)),Tn!==fe.scaleX||Hi!==fe.scaleY}r.scaleCursorStyleHandler=function(U,V,X){var te=O(U,X),Z="";if(V.x!==0&&V.y===0?Z="x":V.x===0&&V.y!==0&&(Z="y"),W(X,Z,te))return"not-allowed";var re=b(X,V);return c[re]+"-resize"},r.skewCursorStyleHandler=function(U,V,X){var te="not-allowed";if(V.x!==0&&X.lockSkewingY||V.y!==0&&X.lockSkewingX)return te;var Z=b(X,V)%4;return f[Z]+"-resize"},r.scaleSkewCursorStyleHandler=function(U,V,X){return U[X.canvas.altActionKey]?r.skewCursorStyleHandler(U,V,X):r.scaleCursorStyleHandler(U,V,X)},r.rotationWithSnapping=K("rotating",Q(function(U,V,X,te){var Z=V,re=Z.target,he=re.translateToOriginPoint(re.getCenterPoint(),Z.originX,Z.originY);if(re.lockRotation)return!1;var le,se=Math.atan2(Z.ey-he.y,Z.ex-he.x),ue=Math.atan2(te-he.y,X-he.x),ce=C(ue-se+Z.theta);if(re.snapAngle>0){var fe=re.snapAngle,ve=re.snapThreshold||fe,pe=Math.ceil(ce/fe)*fe,we=Math.floor(ce/fe)*fe;Math.abs(ce-we)<ve?ce=we:Math.abs(ce-pe)<ve&&(ce=pe)}return ce<0&&(ce=360+ce),ce%=360,le=re.angle!==ce,re.angle=ce,le})),r.scalingEqually=K("scaling",Q(function(U,V,X,te){return ee(U,V,X,te)})),r.scalingX=K("scaling",Q(function(U,V,X,te){return ee(U,V,X,te,{by:"x"})})),r.scalingY=K("scaling",Q(function(U,V,X,te){return ee(U,V,X,te,{by:"y"})})),r.scalingYOrSkewingX=function(U,V,X,te){return U[V.target.canvas.altActionKey]?r.skewHandlerX(U,V,X,te):r.scalingY(U,V,X,te)},r.scalingXOrSkewingY=function(U,V,X,te){return U[V.target.canvas.altActionKey]?r.skewHandlerY(U,V,X,te):r.scalingX(U,V,X,te)},r.changeWidth=K("resizing",Q(function(U,V,X,te){var Z=V.target,re=Y(V,V.originX,V.originY,X,te),he=Z.strokeWidth/(Z.strokeUniform?Z.scaleX:1),le=M(V)?2:1,se=Z.width,ue=Math.abs(re.x*le/Z.scaleX)-he;return Z.set("width",Math.max(ue,0)),se!==ue})),r.skewHandlerX=function(U,V,X,te){var Z,re=V.target,he=re.skewX,le=V.originY;return!re.lockSkewingX&&(he===0?Z=Y(V,p,p,X,te).x>0?o:m:(he>0&&(Z=le===h?o:m),he<0&&(Z=le===h?m:o),N(re)&&(Z=Z===o?m:o)),V.originX=Z,K("skewing",Q(H))(U,V,X,te))},r.skewHandlerY=function(U,V,X,te){var Z,re=V.target,he=re.skewY,le=V.originX;return!re.lockSkewingY&&(he===0?Z=Y(V,p,p,X,te).y>0?h:g:(he>0&&(Z=le===o?h:g),he<0&&(Z=le===o?g:h),N(re)&&(Z=Z===h?g:h)),V.originY=Z,K("skewing",Q(q))(U,V,X,te))},r.dragHandler=function(U,V,X,te){var Z=V.target,re=X-V.offsetX,he=te-V.offsetY,le=!Z.get("lockMovementX")&&Z.left!==re,se=!Z.get("lockMovementY")&&Z.top!==he;return le&&Z.set("left",re),se&&Z.set("top",he),(le||se)&&E("moving",G(U,V,X,te)),le||se},r.scaleOrSkewActionName=function(U,V,X){var te=U[X.canvas.altActionKey];return V.x===0?te?"skewX":"scaleY":V.y===0?te?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(U,V,X){return X.lockRotation?"not-allowed":V.cursorStyle},r.fireEvent=E,r.wrapWithFixedAnchor=Q,r.wrapWithFireEvent=K,r.getLocalPoint=Y,a.controlsUtils=r}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.degreesToRadians,f=a.controlsUtils;f.renderCircleControl=function(r,o,h,m,g){m=m||{};var p,v=this.sizeX||m.cornerSize||g.cornerSize,C=this.sizeY||m.cornerSize||g.cornerSize,x=m.transparentCorners!==void 0?m.transparentCorners:g.transparentCorners,b=x?"stroke":"fill",E=!x&&(m.cornerStrokeColor||g.cornerStrokeColor),O=o,M=h;r.save(),r.fillStyle=m.cornerColor||g.cornerColor,r.strokeStyle=m.cornerStrokeColor||g.cornerStrokeColor,v>C?(p=v,r.scale(1,C/v),M=h*v/C):C>v?(p=C,r.scale(v/C,1),O=o*C/v):p=v,r.lineWidth=1,r.beginPath(),r.arc(O,M,p/2,0,2*Math.PI,!1),r[b](),E&&r.stroke(),r.restore()},f.renderSquareControl=function(r,o,h,m,g){m=m||{};var p=this.sizeX||m.cornerSize||g.cornerSize,v=this.sizeY||m.cornerSize||g.cornerSize,C=m.transparentCorners!==void 0?m.transparentCorners:g.transparentCorners,x=C?"stroke":"fill",b=!C&&(m.cornerStrokeColor||g.cornerStrokeColor),E=p/2,O=v/2;r.save(),r.fillStyle=m.cornerColor||g.cornerColor,r.strokeStyle=m.cornerStrokeColor||g.cornerStrokeColor,r.lineWidth=1,r.translate(o,h),r.rotate(c(g.angle)),r[x+"Rect"](-E,-O,p,v),b&&r.strokeRect(-E,-O,p,v),r.restore()}}(e),function(u){var a=u.fabric||(u.fabric={});a.Control=function(c){for(var f in c)this[f]=c[f]},a.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(c,f){return f.cursorStyle},getActionName:function(c,f){return f.actionName},getVisibility:function(c,f){var r=c._controlsVisibility;return r&&r[f]!==void 0?r[f]:this.visible},setVisibility:function(c){this.visible=c},positionHandler:function(c,f){return a.util.transformPoint({x:this.x*c.x+this.offsetX,y:this.y*c.y+this.offsetY},f)},calcCornerCoords:function(c,f,r,o,h){var m,g,p,v,C=h?this.touchSizeX:this.sizeX,x=h?this.touchSizeY:this.sizeY;if(C&&x&&C!==x){var b=Math.atan2(x,C),E=Math.sqrt(C*C+x*x)/2,O=b-a.util.degreesToRadians(c),M=Math.PI/2-b-a.util.degreesToRadians(c);m=E*a.util.cos(O),g=E*a.util.sin(O),p=E*a.util.cos(M),v=E*a.util.sin(M)}else E=.7071067812*(C&&x?C:f),O=a.util.degreesToRadians(45-c),m=p=E*a.util.cos(O),g=v=E*a.util.sin(O);return{tl:{x:r-v,y:o-p},tr:{x:r+m,y:o-g},bl:{x:r-m,y:o+g},br:{x:r+v,y:o+p}}},render:function(c,f,r,o,h){((o=o||{}).cornerStyle||h.cornerStyle)==="circle"?a.controlsUtils.renderCircleControl.call(this,c,f,r,o,h):a.controlsUtils.renderSquareControl.call(this,c,f,r,o,h)}}}(e),function(){function u(c,f){var r,o,h,m,g=c.getAttribute("style"),p=c.getAttribute("offset")||0;if(p=(p=parseFloat(p)/(/%$/.test(p)?100:1))<0?0:p>1?1:p,g){var v=g.split(/\s*;\s*/);for(v[v.length-1]===""&&v.pop(),m=v.length;m--;){var C=v[m].split(/\s*:\s*/),x=C[0].trim(),b=C[1].trim();x==="stop-color"?r=b:x==="stop-opacity"&&(h=b)}}return r||(r=c.getAttribute("stop-color")||"rgb(0,0,0)"),h||(h=c.getAttribute("stop-opacity")),o=(r=new y.Color(r)).getAlpha(),h=isNaN(parseFloat(h))?1:parseFloat(h),h*=o*f,{offset:p,color:r.toRgb(),opacity:h}}var a=y.util.object.clone;y.Gradient=y.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(c){c||(c={}),c.coords||(c.coords={});var f,r=this;Object.keys(c).forEach(function(o){r[o]=c[o]}),this.id?this.id+="_"+y.Object.__uid++:this.id=y.Object.__uid++,f={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0},this.type==="radial"&&(f.r1=c.coords.r1||0,f.r2=c.coords.r2||0),this.coords=f,this.colorStops=c.colorStops.slice()},addColorStop:function(c){for(var f in c){var r=new y.Color(c[f]);this.colorStops.push({offset:parseFloat(f),color:r.toRgb(),opacity:r.getAlpha()})}return this},toObject:function(c){var f={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return y.util.populateWithProperties(this,f,c),f},toSVG:function(c,f){var r,o,h,m,g=a(this.coords,!0),p=(f=f||{},a(this.colorStops,!0)),v=g.r1>g.r2,C=this.gradientTransform?this.gradientTransform.concat():y.iMatrix.concat(),x=-this.offsetX,b=-this.offsetY,E=!!f.additionalTransform,O=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(p.sort(function(Q,K){return Q.offset-K.offset}),O==="objectBoundingBox"?(x/=c.width,b/=c.height):(x+=c.width/2,b+=c.height/2),c.type==="path"&&this.gradientUnits!=="percentage"&&(x-=c.pathOffset.x,b-=c.pathOffset.y),C[4]-=x,C[5]-=b,m='id="SVGID_'+this.id+'" gradientUnits="'+O+'"',m+=' gradientTransform="'+(E?f.additionalTransform+" ":"")+y.util.matrixToSVG(C)+'" ',this.type==="linear"?h=["<linearGradient ",m,' x1="',g.x1,'" y1="',g.y1,'" x2="',g.x2,'" y2="',g.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",m,' cx="',v?g.x1:g.x2,'" cy="',v?g.y1:g.y2,'" r="',v?g.r1:g.r2,'" fx="',v?g.x2:g.x1,'" fy="',v?g.y2:g.y1,`">
`]),this.type==="radial"){if(v)for((p=p.concat()).reverse(),r=0,o=p.length;r<o;r++)p[r].offset=1-p[r].offset;var M=Math.min(g.r1,g.r2);if(M>0){var W=M/Math.max(g.r1,g.r2);for(r=0,o=p.length;r<o;r++)p[r].offset+=W*(1-p[r].offset)}}for(r=0,o=p.length;r<o;r++){var G=p[r];h.push("<stop ",'offset="',100*G.offset+"%",'" style="stop-color:',G.color,G.opacity!==void 0?";stop-opacity: "+G.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(c){var f,r,o,h=y.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?f=c.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(f=c.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2)),r=0,o=this.colorStops.length;r<o;r++){var m=this.colorStops[r].color,g=this.colorStops[r].opacity,p=this.colorStops[r].offset;g!==void 0&&(m=new y.Color(m).setAlpha(g).toRgba()),f.addColorStop(p,m)}return f}}}),y.util.object.extend(y.Gradient,{fromElement:function(c,f,r,o){var h=parseFloat(r)/(/%$/.test(r)?100:1);h=h<0?0:h>1?1:h,isNaN(h)&&(h=1);var m,g,p,v,C=c.getElementsByTagName("stop"),x=c.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",b=c.getAttribute("gradientTransform")||"",E=[],O=0,M=0;for(c.nodeName==="linearGradient"||c.nodeName==="LINEARGRADIENT"?(m="linear",g=function(W){return{x1:W.getAttribute("x1")||0,y1:W.getAttribute("y1")||0,x2:W.getAttribute("x2")||"100%",y2:W.getAttribute("y2")||0}}(c)):(m="radial",g=function(W){return{x1:W.getAttribute("fx")||W.getAttribute("cx")||"50%",y1:W.getAttribute("fy")||W.getAttribute("cy")||"50%",r1:0,x2:W.getAttribute("cx")||"50%",y2:W.getAttribute("cy")||"50%",r2:W.getAttribute("r")||"50%"}}(c)),p=C.length;p--;)E.push(u(C[p],h));return v=y.parseTransformAttribute(b),function(W,G,Q,K){var Y,N;Object.keys(G).forEach(function(P){(Y=G[P])==="Infinity"?N=1:Y==="-Infinity"?N=0:(N=parseFloat(G[P],10),typeof Y=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(Y)&&(N*=.01,K==="pixels"&&(P!=="x1"&&P!=="x2"&&P!=="r2"||(N*=Q.viewBoxWidth||Q.width),P!=="y1"&&P!=="y2"||(N*=Q.viewBoxHeight||Q.height)))),G[P]=N})}(0,g,o,x),x==="pixels"&&(O=-f.left,M=-f.top),new y.Gradient({id:c.getAttribute("id"),type:m,coords:g,colorStops:E,gradientUnits:x,gradientTransform:v,offsetX:O,offsetY:M})}})}(),D=y.util.toFixed,y.Pattern=y.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(u,a){if(u||(u={}),this.id=y.Object.__uid++,this.setOptions(u),!u.source||u.source&&typeof u.source!="string")a&&a(this);else{var c=this;this.source=y.util.createImage(),y.util.loadImage(u.source,function(f,r){c.source=f,a&&a(c,r)},null,this.crossOrigin)}},toObject:function(u){var a,c,f=y.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?a=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(a=this.source.toDataURL()),c={type:"pattern",source:a,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:D(this.offsetX,f),offsetY:D(this.offsetY,f),patternTransform:this.patternTransform?this.patternTransform.concat():null},y.util.populateWithProperties(this,c,u),c},toSVG:function(u){var a=typeof this.source=="function"?this.source():this.source,c=a.width/u.width,f=a.height/u.height,r=this.offsetX/u.width,o=this.offsetY/u.height,h="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(f=1,o&&(f+=Math.abs(o))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(c=1,r&&(c+=Math.abs(r))),a.src?h=a.src:a.toDataURL&&(h=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+c+'" height="'+f+`">
<image x="0" y="0" width="`+a.width+'" height="'+a.height+'" xlink:href="'+h+`"></image>
</pattern>
`},setOptions:function(u){for(var a in u)this[a]=u[a]},toLive:function(u){var a=this.source;return!a||a.src!==void 0&&(!a.complete||a.naturalWidth===0||a.naturalHeight===0)?"":u.createPattern(a,this.repeat)}}),function(u){var a=u.fabric||(u.fabric={}),c=a.util.toFixed;a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(f){for(var r in typeof f=="string"&&(f=this._parseShadow(f)),f)this[r]=f[r];this.id=a.Object.__uid++},_parseShadow:function(f){var r=f.trim(),o=a.Shadow.reOffsetsAndBlur.exec(r)||[];return{color:(r.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(o[1],10)||0,offsetY:parseFloat(o[2],10)||0,blur:parseFloat(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var r=40,o=40,h=a.Object.NUM_FRACTION_DIGITS,m=a.util.rotateVector({x:this.offsetX,y:this.offsetY},a.util.degreesToRadians(-f.angle)),g=new a.Color(this.color);return f.width&&f.height&&(r=100*c((Math.abs(m.x)+this.blur)/f.width,h)+20,o=100*c((Math.abs(m.y)+this.blur)/f.height,h)+20),f.flipX&&(m.x*=-1),f.flipY&&(m.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+o+'%" height="'+(100+2*o)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+c(this.blur?this.blur/2:0,h)+`"></feGaussianBlur>
	<feOffset dx="`+c(m.x,h)+'" dy="'+c(m.y,h)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+g.toRgb()+'" flood-opacity="'+g.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var f={},r=a.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(o){this[o]!==r[o]&&(f[o]=this[o])},this),f}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(y.StaticCanvas)y.warn("fabric.StaticCanvas is already defined.");else{var u=y.util.object.extend,a=y.util.getElementOffset,c=y.util.removeFromArray,f=y.util.toFixed,r=y.util.transformPoint,o=y.util.invertTransform,h=y.util.getNodeCanvas,m=y.util.createCanvasElement,g=new Error("Could not initialize `canvas` element");y.StaticCanvas=y.util.createClass(y.CommonMethods,{initialize:function(p,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(p,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:y.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(p,v){var C=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(p),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,C),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,C),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,C),v.overlayColor&&this.setOverlayColor(v.overlayColor,C),this.calcOffset()},_isRetinaScaling:function(){return y.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,y.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var p=y.devicePixelRatio;this.__initRetinaScaling(p,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(p,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(p,v,C){v.setAttribute("width",this.width*p),v.setAttribute("height",this.height*p),C.scale(p,p)},calcOffset:function(){return this._offset=a(this.lowerCanvasEl),this},setOverlayImage:function(p,v,C){return this.__setBgOverlayImage("overlayImage",p,v,C)},setBackgroundImage:function(p,v,C){return this.__setBgOverlayImage("backgroundImage",p,v,C)},setOverlayColor:function(p,v){return this.__setBgOverlayColor("overlayColor",p,v)},setBackgroundColor:function(p,v){return this.__setBgOverlayColor("backgroundColor",p,v)},__setBgOverlayImage:function(p,v,C,x){return typeof v=="string"?y.util.loadImage(v,function(b,E){if(b){var O=new y.Image(b,x);this[p]=O,O.canvas=this}C&&C(b,E)},this,x&&x.crossOrigin):(x&&v.setOptions(x),this[p]=v,v&&(v.canvas=this),C&&C(v,!1)),this},__setBgOverlayColor:function(p,v,C){return this[p]=v,this._initGradient(v,p),this._initPattern(v,p,C),this},_createCanvasElement:function(){var p=m();if(!p||(p.style||(p.style={}),p.getContext===void 0))throw g;return p},_initOptions:function(p){var v=this.lowerCanvasEl;this._setOptions(p),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(p){p&&p.getContext?this.lowerCanvasEl=p:this.lowerCanvasEl=y.util.getById(p)||this._createCanvasElement(),y.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(p,v){return this.setDimensions({width:p},v)},setHeight:function(p,v){return this.setDimensions({height:p},v)},setDimensions:function(p,v){var C;for(var x in v=v||{},p)C=p[x],v.cssOnly||(this._setBackstoreDimension(x,p[x]),C+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(x,C);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(p,v){return this.lowerCanvasEl[p]=v,this.upperCanvasEl&&(this.upperCanvasEl[p]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[p]=v),this[p]=v,this},_setCssDimension:function(p,v){return this.lowerCanvasEl.style[p]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[p]=v),this.wrapperEl&&(this.wrapperEl.style[p]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(p){var v,C,x,b=this._activeObject,E=this.backgroundImage,O=this.overlayImage;for(this.viewportTransform=p,C=0,x=this._objects.length;C<x;C++)(v=this._objects[C]).group||v.setCoords(!0);return b&&b.setCoords(),E&&E.setCoords(!0),O&&O.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(p,v){var C=p,x=this.viewportTransform.slice(0);p=r(p,o(this.viewportTransform)),x[0]=v,x[3]=v;var b=r(p,x);return x[4]+=C.x-b.x,x[5]+=C.y-b.y,this.setViewportTransform(x)},setZoom:function(p){return this.zoomToPoint(new y.Point(0,0),p),this},absolutePan:function(p){var v=this.viewportTransform.slice(0);return v[4]=-p.x,v[5]=-p.y,this.setViewportTransform(v)},relativePan:function(p){return this.absolutePan(new y.Point(-p.x-this.viewportTransform[4],-p.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(p){this.stateful&&p.setupState(),p._set("canvas",this),p.setCoords(),this.fire("object:added",{target:p}),p.fire("added")},_onObjectRemoved:function(p){this.fire("object:removed",{target:p}),p.fire("removed"),delete p.canvas},clearContext:function(p){return p.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var p=this.contextContainer;return this.renderCanvas(p,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=y.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var p={},v=this.width,C=this.height,x=o(this.viewportTransform);return p.tl=r({x:0,y:0},x),p.br=r({x:v,y:C},x),p.tr=new y.Point(p.br.x,p.tl.y),p.bl=new y.Point(p.tl.x,p.br.y),this.vptCoords=p,p},cancelRequestedRender:function(){this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(p,v){var C=this.viewportTransform,x=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(p),y.util.setImageSmoothing(p,this.imageSmoothingEnabled),this.fire("before:render",{ctx:p}),this._renderBackground(p),p.save(),p.transform(C[0],C[1],C[2],C[3],C[4],C[5]),this._renderObjects(p,v),p.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(p),x&&(x.canvas=this,x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(p)),this._renderOverlay(p),this.controlsAboveOverlay&&this.interactive&&this.drawControls(p),this.fire("after:render",{ctx:p})},drawClipPathOnCanvas:function(p){var v=this.viewportTransform,C=this.clipPath;p.save(),p.transform(v[0],v[1],v[2],v[3],v[4],v[5]),p.globalCompositeOperation="destination-in",C.transform(p),p.scale(1/C.zoomX,1/C.zoomY),p.drawImage(C._cacheCanvas,-C.cacheTranslationX,-C.cacheTranslationY),p.restore()},_renderObjects:function(p,v){var C,x;for(C=0,x=v.length;C<x;++C)v[C]&&v[C].render(p)},_renderBackgroundOrOverlay:function(p,v){var C=this[v+"Color"],x=this[v+"Image"],b=this.viewportTransform,E=this[v+"Vpt"];if(C||x){if(C){p.save(),p.beginPath(),p.moveTo(0,0),p.lineTo(this.width,0),p.lineTo(this.width,this.height),p.lineTo(0,this.height),p.closePath(),p.fillStyle=C.toLive?C.toLive(p,this):C,E&&p.transform(b[0],b[1],b[2],b[3],b[4],b[5]),p.transform(1,0,0,1,C.offsetX||0,C.offsetY||0);var O=C.gradientTransform||C.patternTransform;O&&p.transform(O[0],O[1],O[2],O[3],O[4],O[5]),p.fill(),p.restore()}x&&(p.save(),E&&p.transform(b[0],b[1],b[2],b[3],b[4],b[5]),x.render(p),p.restore())}},_renderBackground:function(p){this._renderBackgroundOrOverlay(p,"background")},_renderOverlay:function(p){this._renderBackgroundOrOverlay(p,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new y.Point(this.width/2,this.height/2)},centerObjectH:function(p){return this._centerObject(p,new y.Point(this.getCenterPoint().x,p.getCenterPoint().y))},centerObjectV:function(p){return this._centerObject(p,new y.Point(p.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(p){var v=this.getCenterPoint();return this._centerObject(p,v)},viewportCenterObject:function(p){var v=this.getVpCenter();return this._centerObject(p,v)},viewportCenterObjectH:function(p){var v=this.getVpCenter();return this._centerObject(p,new y.Point(v.x,p.getCenterPoint().y)),this},viewportCenterObjectV:function(p){var v=this.getVpCenter();return this._centerObject(p,new y.Point(p.getCenterPoint().x,v.y))},getVpCenter:function(){var p=this.getCenterPoint(),v=o(this.viewportTransform);return r(p,v)},_centerObject:function(p,v){return p.setPositionByOrigin(v,"center","center"),p.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(p){return this.toDatalessObject(p)},toObject:function(p){return this._toObjectMethod("toObject",p)},toDatalessObject:function(p){return this._toObjectMethod("toDatalessObject",p)},_toObjectMethod:function(p,v){var C=this.clipPath,x={version:y.version,objects:this._toObjects(p,v)};return C&&!C.excludeFromExport&&(x.clipPath=this._toObject(this.clipPath,p,v)),u(x,this.__serializeBgOverlay(p,v)),y.util.populateWithProperties(this,x,v),x},_toObjects:function(p,v){return this._objects.filter(function(C){return!C.excludeFromExport}).map(function(C){return this._toObject(C,p,v)},this)},_toObject:function(p,v,C){var x;this.includeDefaultValues||(x=p.includeDefaultValues,p.includeDefaultValues=!1);var b=p[v](C);return this.includeDefaultValues||(p.includeDefaultValues=x),b},__serializeBgOverlay:function(p,v){var C={},x=this.backgroundImage,b=this.overlayImage,E=this.backgroundColor,O=this.overlayColor;return E&&E.toObject?E.excludeFromExport||(C.background=E.toObject(v)):E&&(C.background=E),O&&O.toObject?O.excludeFromExport||(C.overlay=O.toObject(v)):O&&(C.overlay=O),x&&!x.excludeFromExport&&(C.backgroundImage=this._toObject(x,p,v)),b&&!b.excludeFromExport&&(C.overlayImage=this._toObject(b,p,v)),C},svgViewportTransformation:!0,toSVG:function(p,v){p||(p={}),p.reviver=v;var C=[];return this._setSVGPreamble(C,p),this._setSVGHeader(C,p),this.clipPath&&C.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(C,"background"),this._setSVGBgOverlayImage(C,"backgroundImage",v),this._setSVGObjects(C,v),this.clipPath&&C.push(`</g>
`),this._setSVGBgOverlayColor(C,"overlay"),this._setSVGBgOverlayImage(C,"overlayImage",v),C.push("</svg>"),C.join("")},_setSVGPreamble:function(p,v){v.suppressPreamble||p.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(p,v){var C,x=v.width||this.width,b=v.height||this.height,E='viewBox="0 0 '+this.width+" "+this.height+'" ',O=y.Object.NUM_FRACTION_DIGITS;v.viewBox?E='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(C=this.viewportTransform,E='viewBox="'+f(-C[4]/C[0],O)+" "+f(-C[5]/C[3],O)+" "+f(this.width/C[0],O)+" "+f(this.height/C[3],O)+'" '),p.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',x,'" ','height="',b,'" ',E,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",y.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(p){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+y.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(p.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var p=this;return["background","overlay"].map(function(v){var C=p[v+"Color"];if(C&&C.toLive){var x=p[v+"Vpt"],b=p.viewportTransform,E={width:p.width/(x?b[0]:1),height:p.height/(x?b[3]:1)};return C.toSVG(E,{additionalTransform:x?y.util.matrixToSVG(b):""})}}).join("")},createSVGFontFacesMarkup:function(){var p,v,C,x,b,E,O,M,W="",G={},Q=y.fontPaths,K=[];for(this._objects.forEach(function N(P){K.push(P),P._objects&&P._objects.forEach(N)}),O=0,M=K.length;O<M;O++)if(v=(p=K[O]).fontFamily,p.type.indexOf("text")!==-1&&!G[v]&&Q[v]&&(G[v]=!0,p.styles))for(b in C=p.styles)for(E in x=C[b])!G[v=x[E].fontFamily]&&Q[v]&&(G[v]=!0);for(var Y in G)W+=[`		@font-face {
`,"			font-family: '",Y,`';
`,"			src: url('",Q[Y],`');
`,`		}
`].join("");return W&&(W=['	<style type="text/css">',`<![CDATA[
`,W,"]]>",`</style>
`].join("")),W},_setSVGObjects:function(p,v){var C,x,b,E=this._objects;for(x=0,b=E.length;x<b;x++)(C=E[x]).excludeFromExport||this._setSVGObject(p,C,v)},_setSVGObject:function(p,v,C){p.push(v.toSVG(C))},_setSVGBgOverlayImage:function(p,v,C){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&p.push(this[v].toSVG(C))},_setSVGBgOverlayColor:function(p,v){var C=this[v+"Color"],x=this.viewportTransform,b=this.width,E=this.height;if(C)if(C.toLive){var O=C.repeat,M=y.util.invertTransform(x),W=this[v+"Vpt"]?y.util.matrixToSVG(M):"";p.push('<rect transform="'+W+" translate(",b/2,",",E/2,')"',' x="',C.offsetX-b/2,'" y="',C.offsetY-E/2,'" ','width="',O==="repeat-y"||O==="no-repeat"?C.source.width:b,'" height="',O==="repeat-x"||O==="no-repeat"?C.source.height:E,'" fill="url(#SVGID_'+C.id+')"',`></rect>
`)}else p.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',C,'"',`></rect>
`)},sendToBack:function(p){if(!p)return this;var v,C,x,b=this._activeObject;if(p===b&&p.type==="activeSelection")for(v=(x=b._objects).length;v--;)C=x[v],c(this._objects,C),this._objects.unshift(C);else c(this._objects,p),this._objects.unshift(p);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(p){if(!p)return this;var v,C,x,b=this._activeObject;if(p===b&&p.type==="activeSelection")for(x=b._objects,v=0;v<x.length;v++)C=x[v],c(this._objects,C),this._objects.push(C);else c(this._objects,p),this._objects.push(p);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(p,v){if(!p)return this;var C,x,b,E,O,M=this._activeObject,W=0;if(p===M&&p.type==="activeSelection")for(O=M._objects,C=0;C<O.length;C++)x=O[C],(b=this._objects.indexOf(x))>0+W&&(E=b-1,c(this._objects,x),this._objects.splice(E,0,x)),W++;else(b=this._objects.indexOf(p))!==0&&(E=this._findNewLowerIndex(p,b,v),c(this._objects,p),this._objects.splice(E,0,p));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(p,v,C){var x,b;if(C){for(x=v,b=v-1;b>=0;--b)if(p.intersectsWithObject(this._objects[b])||p.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(p)){x=b;break}}else x=v-1;return x},bringForward:function(p,v){if(!p)return this;var C,x,b,E,O,M=this._activeObject,W=0;if(p===M&&p.type==="activeSelection")for(C=(O=M._objects).length;C--;)x=O[C],(b=this._objects.indexOf(x))<this._objects.length-1-W&&(E=b+1,c(this._objects,x),this._objects.splice(E,0,x)),W++;else(b=this._objects.indexOf(p))!==this._objects.length-1&&(E=this._findNewUpperIndex(p,b,v),c(this._objects,p),this._objects.splice(E,0,p));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(p,v,C){var x,b,E;if(C){for(x=v,b=v+1,E=this._objects.length;b<E;++b)if(p.intersectsWithObject(this._objects[b])||p.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(p)){x=b;break}}else x=v+1;return x},moveTo:function(p,v){return c(this._objects,p),this._objects.splice(v,0,p),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),y.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),y.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),u(y.StaticCanvas.prototype,y.Observable),u(y.StaticCanvas.prototype,y.Collection),u(y.StaticCanvas.prototype,y.DataURLExporter),u(y.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(p){var v=m();if(!v||!v.getContext)return null;var C=v.getContext("2d");return C&&p==="setLineDash"?C.setLineDash!==void 0:null}}),y.StaticCanvas.prototype.toJSON=y.StaticCanvas.prototype.toObject,y.isLikelyNode&&(y.StaticCanvas.prototype.createPNGStream=function(){var p=h(this.lowerCanvasEl);return p&&p.createPNGStream()},y.StaticCanvas.prototype.createJPEGStream=function(p){var v=h(this.lowerCanvasEl);return v&&v.createJPEGStream(p)})}}(),y.BaseBrush=y.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(u){u.strokeStyle=this.color,u.lineWidth=this.width,u.lineCap=this.strokeLineCap,u.miterLimit=this.strokeMiterLimit,u.lineJoin=this.strokeLineJoin,u.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(u){var a=this.canvas.viewportTransform;u.save(),u.transform(a[0],a[1],a[2],a[3],a[4],a[5])},_setShadow:function(){if(this.shadow){var u=this.canvas,a=this.shadow,c=u.contextTop,f=u.getZoom();u&&u._isRetinaScaling()&&(f*=y.devicePixelRatio),c.shadowColor=a.color,c.shadowBlur=a.blur*f,c.shadowOffsetX=a.offsetX*f,c.shadowOffsetY=a.offsetY*f}},needsFullRender:function(){return new y.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var u=this.canvas.contextTop;u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0},_isOutSideCanvas:function(u){return u.x<0||u.x>this.canvas.getWidth()||u.y<0||u.y>this.canvas.getHeight()}}),y.PencilBrush=y.util.createClass(y.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(u){this.canvas=u,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(u,a,c){var f=a.midPointFrom(c);return u.quadraticCurveTo(a.x,a.y,f.x,f.y),f},onMouseDown:function(u,a){this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],this._prepareForDrawing(u),this._captureDrawingPath(u),this._render())},onMouseMove:function(u,a){if(this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(u))&&this._captureDrawingPath(u)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var c=this._points,f=c.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,c[f-2],c[f-1],!0),r.stroke(),r.restore()}},onMouseUp:function(u){return!this.canvas._isMainEvent(u.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(u){var a=new y.Point(u.x,u.y);this._reset(),this._addPoint(a),this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(u){return!(this._points.length>1&&u.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(u),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(u){var a=new y.Point(u.x,u.y);return this._addPoint(a)},_render:function(u){var a,c,f=this._points[0],r=this._points[1];if(u=u||this.canvas.contextTop,this._saveAndTransform(u),u.beginPath(),this._points.length===2&&f.x===r.x&&f.y===r.y){var o=this.width/1e3;f=new y.Point(f.x,f.y),r=new y.Point(r.x,r.y),f.x-=o,r.x+=o}for(u.moveTo(f.x,f.y),a=1,c=this._points.length;a<c;a++)this._drawSegment(u,f,r),f=this._points[a],r=this._points[a+1];u.lineTo(f.x,f.y),u.stroke(),u.restore()},convertPointsToSVGPath:function(u){var a=this.width/1e3;return y.util.getSmoothPathFromPoints(u,a)},_isEmptySVGPath:function(u){return y.util.joinPath(u)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(u){var a=new y.Path(u,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,a.shadow=new y.Shadow(this.shadow)),a},decimatePoints:function(u,a){if(u.length<=2)return u;var c,f=this.canvas.getZoom(),r=Math.pow(a/f,2),o=u.length-1,h=u[0],m=[h];for(c=1;c<o-1;c++)Math.pow(h.x-u[c].x,2)+Math.pow(h.y-u[c].y,2)>=r&&(h=u[c],m.push(h));return m.push(u[o]),m},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var u=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(u))this.canvas.requestRenderAll();else{var a=this.createPath(u);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.requestRenderAll(),a.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:a})}}}),y.CircleBrush=y.util.createClass(y.BaseBrush,{width:10,initialize:function(u){this.canvas=u,this.points=[]},drawDot:function(u){var a=this.addPoint(u),c=this.canvas.contextTop;this._saveAndTransform(c),this.dot(c,a),c.restore()},dot:function(u,a){u.fillStyle=a.fill,u.beginPath(),u.arc(a.x,a.y,a.radius,0,2*Math.PI,!1),u.closePath(),u.fill()},onMouseDown:function(u){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(u)},_render:function(){var u,a,c=this.canvas.contextTop,f=this.points;for(this._saveAndTransform(c),u=0,a=f.length;u<a;u++)this.dot(c,f[u]);c.restore()},onMouseMove:function(u){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(u),this._render()):this.drawDot(u))},onMouseUp:function(){var u,a,c=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var f=[];for(u=0,a=this.points.length;u<a;u++){var r=this.points[u],o=new y.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(o.shadow=new y.Shadow(this.shadow)),f.push(o)}var h=new y.Group(f);h.canvas=this.canvas,this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},addPoint:function(u){var a=new y.Point(u.x,u.y),c=y.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,f=new y.Color(this.color).setAlpha(y.util.getRandomInt(0,100)/100).toRgba();return a.radius=c,a.fill=f,this.points.push(a),a}}),y.SprayBrush=y.util.createClass(y.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(u){this.canvas=u,this.sprayChunks=[]},onMouseDown:function(u){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseMove:function(u){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u)||(this.addSprayChunk(u),this.render(this.sprayChunkPoints))},onMouseUp:function(){var u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],c=0,f=this.sprayChunks.length;c<f;c++)for(var r=this.sprayChunks[c],o=0,h=r.length;o<h;o++){var m=new y.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});a.push(m)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));var g=new y.Group(a);this.shadow&&g.set("shadow",new y.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:g}),this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},_getOptimizedRects:function(u){var a,c,f,r={};for(c=0,f=u.length;c<f;c++)r[a=u[c].left+""+u[c].top]||(r[a]=u[c]);var o=[];for(a in r)o.push(r[a]);return o},render:function(u){var a,c,f=this.canvas.contextTop;for(f.fillStyle=this.color,this._saveAndTransform(f),a=0,c=u.length;a<c;a++){var r=u[a];r.opacity!==void 0&&(f.globalAlpha=r.opacity),f.fillRect(r.x,r.y,r.width,r.width)}f.restore()},_render:function(){var u,a,c=this.canvas.contextTop;for(c.fillStyle=this.color,this._saveAndTransform(c),u=0,a=this.sprayChunks.length;u<a;u++)this.render(this.sprayChunks[u]);c.restore()},addSprayChunk:function(u){this.sprayChunkPoints=[];var a,c,f,r,o=this.width/2;for(r=0;r<this.density;r++){a=y.util.getRandomInt(u.x-o,u.x+o),c=y.util.getRandomInt(u.y-o,u.y+o),f=this.dotWidthVariance?y.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var h=new y.Point(a,c);h.width=f,this.randomOpacity&&(h.opacity=y.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),y.PatternBrush=y.util.createClass(y.PencilBrush,{getPatternSrc:function(){var u=y.util.createCanvasElement(),a=u.getContext("2d");return u.width=u.height=25,a.fillStyle=this.color,a.beginPath(),a.arc(10,10,10,0,2*Math.PI,!1),a.closePath(),a.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(u){return u.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(u){this.callSuper("_setBrushStyles",u),u.strokeStyle=this.getPattern(u)},createPath:function(u){var a=this.callSuper("createPath",u),c=a._getLeftTopCoords().scalarAdd(a.strokeWidth/2);return a.stroke=new y.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),a}}),function(){var u=y.util.getPointer,a=y.util.degreesToRadians,c=y.util.isTouchEvent;for(var f in y.Canvas=y.util.createClass(y.StaticCanvas,{initialize:function(r,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,o),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=y.PencilBrush&&new y.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r,o,h,m=this.getActiveObjects();if(m.length>0&&!this.preserveObjectStacking){o=[],h=[];for(var g=0,p=this._objects.length;g<p;g++)r=this._objects[g],m.indexOf(r)===-1?o.push(r):h.push(r);m.length>1&&(this._activeObject._objects=h),o.push.apply(o,h)}else o=this._objects;return o},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,o){var h=r.calcTransformMatrix(),m=y.util.invertTransform(h),g=this.restorePointerVpt(o);return y.util.transformPoint(g,m)},isTargetTransparent:function(r,o,h){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var m=this._normalizePointer(r,{x:o,y:h}),g=Math.max(r.cacheTranslationX+m.x*r.zoomX,0),p=Math.max(r.cacheTranslationY+m.y*r.zoomY,0);return y.util.isTransparent(r._cacheContext,Math.round(g),Math.round(p),this.targetFindTolerance)}var v=this.contextCache,C=r.selectionBackgroundColor,x=this.viewportTransform;return r.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(x[0],x[1],x[2],x[3],x[4],x[5]),r.render(v),v.restore(),r.selectionBackgroundColor=C,y.util.isTransparent(v,o,h,this.targetFindTolerance)},_isSelectionKeyPressed:function(r){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(o){return r[o]===!0}):r[this.selectionKey]},_shouldClearSelection:function(r,o){var h=this.getActiveObjects(),m=this._activeObject;return!o||o&&m&&h.length>1&&h.indexOf(o)===-1&&m!==o&&!this._isSelectionKeyPressed(r)||o&&!o.evented||o&&!o.selectable&&m&&m!==o},_shouldCenterTransform:function(r,o,h){var m;if(r)return o==="scale"||o==="scaleX"||o==="scaleY"||o==="resizing"?m=this.centeredScaling||r.centeredScaling:o==="rotate"&&(m=this.centeredRotation||r.centeredRotation),m?!h:h},_getOriginFromCorner:function(r,o){var h={x:r.originX,y:r.originY};return o==="ml"||o==="tl"||o==="bl"?h.x="right":o!=="mr"&&o!=="tr"&&o!=="br"||(h.x="left"),o==="tl"||o==="mt"||o==="tr"?h.y="bottom":o!=="bl"&&o!=="mb"&&o!=="br"||(h.y="top"),h},_getActionFromCorner:function(r,o,h,m){if(!o||!r)return"drag";var g=m.controls[o];return g.getActionName(h,g,m)},_setupCurrentTransform:function(r,o,h){if(o){var m=this.getPointer(r),g=o.__corner,p=o.controls[g],v=h&&g?p.getActionHandler(r,o,p):y.controlsUtils.dragHandler,C=this._getActionFromCorner(h,g,r,o),x=this._getOriginFromCorner(o,g),b=r[this.centeredKey],E={target:o,action:C,actionHandler:v,corner:g,scaleX:o.scaleX,scaleY:o.scaleY,skewX:o.skewX,skewY:o.skewY,offsetX:m.x-o.left,offsetY:m.y-o.top,originX:x.x,originY:x.y,ex:m.x,ey:m.y,lastX:m.x,lastY:m.y,theta:a(o.angle),width:o.width*o.scaleX,shiftKey:r.shiftKey,altKey:b,original:y.util.saveObjectTransform(o)};this._shouldCenterTransform(o,C,b)&&(E.originX="center",E.originY="center"),E.original.originX=x.x,E.original.originY=x.y,this._currentTransform=E,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var o=this._groupSelector,h=new y.Point(o.ex,o.ey),m=y.util.transformPoint(h,this.viewportTransform),g=new y.Point(o.ex+o.left,o.ey+o.top),p=y.util.transformPoint(g,this.viewportTransform),v=Math.min(m.x,p.x),C=Math.min(m.y,p.y),x=Math.max(m.x,p.x),b=Math.max(m.y,p.y),E=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(v,C,x-v,b-C)),this.selectionLineWidth&&this.selectionBorderColor&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,v+=E,C+=E,x-=E,b-=E,y.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(v,C,x-v,b-C))},findTarget:function(r,o){if(!this.skipTargetFind){var h,m,g=this.getPointer(r,!0),p=this._activeObject,v=this.getActiveObjects(),C=c(r),x=v.length>1&&!o||v.length===1;if(this.targets=[],x&&p._findTargetCorner(g,C)||v.length>1&&!o&&p===this._searchPossibleTargets([p],g))return p;if(v.length===1&&p===this._searchPossibleTargets([p],g)){if(!this.preserveObjectStacking)return p;h=p,m=this.targets,this.targets=[]}var b=this._searchPossibleTargets(this._objects,g);return r[this.altSelectionKey]&&b&&h&&b!==h&&(b=h,this.targets=m),b}},_checkTarget:function(r,o,h){if(o&&o.visible&&o.evented&&o.containsPoint(r)&&(!this.perPixelTargetFind&&!o.perPixelTargetFind||o.isEditing||!this.isTargetTransparent(o,h.x,h.y)))return!0},_searchPossibleTargets:function(r,o){for(var h,m,g=r.length;g--;){var p=r[g],v=p.group?this._normalizePointer(p.group,o):o;if(this._checkTarget(v,p,o)){(h=r[g]).subTargetCheck&&h instanceof y.Group&&(m=this._searchPossibleTargets(h._objects,o))&&this.targets.push(m);break}}return h},restorePointerVpt:function(r){return y.util.transformPoint(r,y.util.invertTransform(this.viewportTransform))},getPointer:function(r,o){if(this._absolutePointer&&!o)return this._absolutePointer;if(this._pointer&&o)return this._pointer;var h,m=u(r),g=this.upperCanvasEl,p=g.getBoundingClientRect(),v=p.width||0,C=p.height||0;v&&C||("top"in p&&"bottom"in p&&(C=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(v=Math.abs(p.right-p.left))),this.calcOffset(),m.x=m.x-this._offset.left,m.y=m.y-this._offset.top,o||(m=this.restorePointerVpt(m));var x=this.getRetinaScaling();return x!==1&&(m.x/=x,m.y/=x),h=v===0||C===0?{width:1,height:1}:{width:g.width/v,height:g.height/C},{x:m.x*h.width,y:m.y*h.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),o=this.lowerCanvasEl,h=this.upperCanvasEl;h?h.className="":(h=this._createCanvasElement(),this.upperCanvasEl=h),y.util.addClass(h,"upper-canvas "+r),this.wrapperEl.appendChild(h),this._copyCanvasStyle(o,h),this._applyCanvasStyle(h),this.contextTop=h.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=y.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),y.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),y.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var o=this.width||r.width,h=this.height||r.height;y.util.setStyle(r,{position:"absolute",width:o+"px",height:h+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=o,r.height=h,y.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,o){o.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,o){var h=!1,m=this.getActiveObjects(),g=[],p=[];r.forEach(function(v){m.indexOf(v)===-1&&(h=!0,v.fire("deselected",{e:o,target:v}),p.push(v))}),m.forEach(function(v){r.indexOf(v)===-1&&(h=!0,v.fire("selected",{e:o,target:v}),g.push(v))}),r.length>0&&m.length>0?h&&this.fire("selection:updated",{e:o,selected:g,deselected:p}):m.length>0?this.fire("selection:created",{e:o,selected:g}):r.length>0&&this.fire("selection:cleared",{e:o,deselected:p})},setActiveObject:function(r,o){var h=this.getActiveObjects();return this._setActiveObject(r,o),this._fireSelectionEvents(h,o),this},_setActiveObject:function(r,o){return this._activeObject!==r&&!!this._discardActiveObject(o,r)&&!r.onSelect({e:o})&&(this._activeObject=r,!0)},_discardActiveObject:function(r,o){var h=this._activeObject;if(h){if(h.onDeselect({e:r,object:o}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var o=this.getActiveObjects(),h=this.getActiveObject();return o.length&&this.fire("before:selection:cleared",{target:h,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(o,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(o){y.util.cleanUpJsdomNode(this[o]),this[o]=void 0}.bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,y.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var o=this._activeObject;o&&o._renderControls(r)},_toObject:function(r,o,h){var m=this._realizeGroupTransformOnObject(r),g=this.callSuper("_toObject",r,o,h);return this._unwindGroupTransformOnObject(r,m),g},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var o={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(h){o[h]=r[h]}),y.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),o}return null},_unwindGroupTransformOnObject:function(r,o){o&&r.set(o)},_setSVGObject:function(r,o,h){var m=this._realizeGroupTransformOnObject(o);this.callSuper("_setSVGObject",r,o,h),this._unwindGroupTransformOnObject(o,m)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),y.StaticCanvas.prototype.setViewportTransform.call(this,r)}}),y.StaticCanvas)f!=="prototype"&&(y.Canvas[f]=y.StaticCanvas[f])}(),function(){var u=y.util.addListener,a=y.util.removeListener,c={passive:!1};function f(r,o){return r.button&&r.button===o-1}y.util.object.extend(y.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(u,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(r,o){var h=this.upperCanvasEl,m=this._getEventPrefix();r(y.window,"resize",this._onResize),r(h,m+"down",this._onMouseDown),r(h,m+"move",this._onMouseMove,c),r(h,m+"out",this._onMouseOut),r(h,m+"enter",this._onMouseEnter),r(h,"wheel",this._onMouseWheel),r(h,"contextmenu",this._onContextMenu),r(h,"dblclick",this._onDoubleClick),r(h,"dragover",this._onDragOver),r(h,"dragenter",this._onDragEnter),r(h,"dragleave",this._onDragLeave),r(h,"drop",this._onDrop),this.enablePointerEvents||r(h,"touchstart",this._onTouchStart,c),typeof eventjs<"u"&&o in eventjs&&(eventjs[o](h,"gesture",this._onGesture),eventjs[o](h,"drag",this._onDrag),eventjs[o](h,"orientation",this._onOrientationChange),eventjs[o](h,"shake",this._onShake),eventjs[o](h,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(a,"remove");var r=this._getEventPrefix();a(y.document,r+"up",this._onMouseUp),a(y.document,"touchend",this._onTouchEnd,c),a(y.document,r+"move",this._onMouseMove,c),a(y.document,"touchmove",this._onMouseMove,c)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(r,o){this.__onTransformGesture&&this.__onTransformGesture(r,o)},_onDrag:function(r,o){this.__onDrag&&this.__onDrag(r,o)},_onMouseWheel:function(r){this.__onMouseWheel(r)},_onMouseOut:function(r){var o=this._hoveredTarget;this.fire("mouse:out",{target:o,e:r}),this._hoveredTarget=null,o&&o.fire("mouseout",{e:r});var h=this;this._hoveredTargets.forEach(function(m){h.fire("mouse:out",{target:o,e:r}),m&&o.fire("mouseout",{e:r})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(m){m.isEditing&&m.hiddenTextarea.focus()})},_onMouseEnter:function(r){this._currentTransform||this.findTarget(r)||(this.fire("mouse:over",{target:null,e:r}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(r,o){this.__onOrientationChange&&this.__onOrientationChange(r,o)},_onShake:function(r,o){this.__onShake&&this.__onShake(r,o)},_onLongPress:function(r,o){this.__onLongPress&&this.__onLongPress(r,o)},_onDragOver:function(r){r.preventDefault();var o=this._simpleEventHandler("dragover",r);this._fireEnterLeaveEvents(o,r)},_onDrop:function(r){return this._simpleEventHandler("drop:before",r),this._simpleEventHandler("drop",r)},_onContextMenu:function(r){return this.stopContextMenu&&(r.stopPropagation(),r.preventDefault()),!1},_onDoubleClick:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"dblclick"),this._resetTransformEventData(r)},getPointerId:function(r){var o=r.changedTouches;return o?o[0]&&o[0].identifier:this.enablePointerEvents?r.pointerId:-1},_isMainEvent:function(r){return r.isPrimary===!0||r.isPrimary!==!1&&(r.type==="touchend"&&r.touches.length===0||!r.changedTouches||r.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(r){r.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(r)),this.__onMouseDown(r),this._resetTransformEventData();var o=this.upperCanvasEl,h=this._getEventPrefix();u(y.document,"touchend",this._onTouchEnd,c),u(y.document,"touchmove",this._onMouseMove,c),a(o,h+"down",this._onMouseDown)},_onMouseDown:function(r){this.__onMouseDown(r),this._resetTransformEventData();var o=this.upperCanvasEl,h=this._getEventPrefix();a(o,h+"move",this._onMouseMove,c),u(y.document,h+"up",this._onMouseUp),u(y.document,h+"move",this._onMouseMove,c)},_onTouchEnd:function(r){if(!(r.touches.length>0)){this.__onMouseUp(r),this._resetTransformEventData(),this.mainTouchId=null;var o=this._getEventPrefix();a(y.document,"touchend",this._onTouchEnd,c),a(y.document,"touchmove",this._onMouseMove,c);var h=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){u(h.upperCanvasEl,o+"down",h._onMouseDown),h._willAddMouseDown=0},400)}},_onMouseUp:function(r){this.__onMouseUp(r),this._resetTransformEventData();var o=this.upperCanvasEl,h=this._getEventPrefix();this._isMainEvent(r)&&(a(y.document,h+"up",this._onMouseUp),a(y.document,h+"move",this._onMouseMove,c),u(o,h+"move",this._onMouseMove,c))},_onMouseMove:function(r){!this.allowTouchScrolling&&r.preventDefault&&r.preventDefault(),this.__onMouseMove(r)},_onResize:function(){this.calcOffset()},_shouldRender:function(r){var o=this._activeObject;return!!(!!o!=!!r||o&&r&&o!==r)||(o&&o.isEditing,!1)},__onMouseUp:function(r){var o,h=this._currentTransform,m=this._groupSelector,g=!1,p=!m||m.left===0&&m.top===0;if(this._cacheTransformEventData(r),o=this._target,this._handleEvent(r,"up:before"),f(r,3))this.fireRightClick&&this._handleEvent(r,"up",3,p);else{if(f(r,2))return this.fireMiddleClick&&this._handleEvent(r,"up",2,p),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(r);else if(this._isMainEvent(r)){if(h&&(this._finalizeCurrentTransform(r),g=h.actionPerformed),!p){var v=o===this._activeObject;this._maybeGroupObjects(r),g||(g=this._shouldRender(o)||!v&&o===this._activeObject)}var C,x;if(o){if(C=o._findTargetCorner(this.getPointer(r,!0),y.util.isTouchEvent(r)),o.selectable&&o!==this._activeObject&&o.activeOn==="up")this.setActiveObject(o,r),g=!0;else{var b=o.controls[C],E=b&&b.getMouseUpHandler(r,o,b);E&&E(r,h,(x=this.getPointer(r)).x,x.y)}o.isMoving=!1}if(h&&(h.target!==o||h.corner!==C)){var O=h.target&&h.target.controls[h.corner],M=O&&O.getMouseUpHandler(r,o,b);x=x||this.getPointer(r),M&&M(r,h,x.x,x.y)}this._setCursorFromEvent(r,o),this._handleEvent(r,"up",1,p),this._groupSelector=null,this._currentTransform=null,o&&(o.__corner=0),g?this.requestRenderAll():p||this.renderTop()}}},_simpleEventHandler:function(r,o){var h=this.findTarget(o),m=this.targets,g={e:o,target:h,subTargets:m};if(this.fire(r,g),h&&h.fire(r,g),!m)return h;for(var p=0;p<m.length;p++)m[p].fire(r,g);return h},_handleEvent:function(r,o,h,m){var g=this._target,p=this.targets||[],v={e:r,target:g,subTargets:p,button:h||1,isClick:m||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};o==="up"&&(v.currentTarget=this.findTarget(r),v.currentSubTargets=this.targets),this.fire("mouse:"+o,v),g&&g.fire("mouse"+o,v);for(var C=0;C<p.length;C++)p[C].fire("mouse"+o,v)},_finalizeCurrentTransform:function(r){var o=this._currentTransform,h=o.target,m={e:r,target:h,transform:o,action:o.action};h._scaling&&(h._scaling=!1),h.setCoords(),(o.actionPerformed||this.stateful&&h.hasStateChanged())&&this._fire("modified",m)},_onMouseDownInDrawingMode:function(r){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(r).requestRenderAll();var o=this.getPointer(r);this.freeDrawingBrush.onMouseDown(o,{e:r,pointer:o}),this._handleEvent(r,"down")},_onMouseMoveInDrawingMode:function(r){if(this._isCurrentlyDrawing){var o=this.getPointer(r);this.freeDrawingBrush.onMouseMove(o,{e:r,pointer:o})}this.setCursor(this.freeDrawingCursor),this._handleEvent(r,"move")},_onMouseUpInDrawingMode:function(r){var o=this.getPointer(r);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:r,pointer:o}),this._handleEvent(r,"up")},__onMouseDown:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"down:before");var o=this._target;if(f(r,3))this.fireRightClick&&this._handleEvent(r,"down",3);else if(f(r,2))this.fireMiddleClick&&this._handleEvent(r,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(r);else if(this._isMainEvent(r)&&!this._currentTransform){var h=this._pointer;this._previousPointer=h;var m=this._shouldRender(o),g=this._shouldGroup(r,o);if(this._shouldClearSelection(r,o)?this.discardActiveObject(r):g&&(this._handleGrouping(r,o),o=this._activeObject),!this.selection||o&&(o.selectable||o.isEditing||o===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),o){var p=o===this._activeObject;o.selectable&&o.activeOn==="down"&&this.setActiveObject(o,r);var v=o._findTargetCorner(this.getPointer(r,!0),y.util.isTouchEvent(r));if(o.__corner=v,o===this._activeObject&&(v||!g)){this._setupCurrentTransform(r,o,p);var C=o.controls[v],x=(h=this.getPointer(r),C&&C.getMouseDownHandler(r,o,C));x&&x(r,this._currentTransform,h.x,h.y)}}this._handleEvent(r,"down"),(m||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(r){this._resetTransformEventData(),this._pointer=this.getPointer(r,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(r)||null},_beforeTransform:function(r){var o=this._currentTransform;this.stateful&&o.target.saveState(),this.fire("before:transform",{e:r,transform:o})},__onMouseMove:function(r){var o,h;if(this._handleEvent(r,"move:before"),this._cacheTransformEventData(r),this.isDrawingMode)this._onMouseMoveInDrawingMode(r);else if(this._isMainEvent(r)){var m=this._groupSelector;m?(h=this._absolutePointer,m.left=h.x-m.ex,m.top=h.y-m.ey,this.renderTop()):this._currentTransform?this._transformObject(r):(o=this.findTarget(r)||null,this._setCursorFromEvent(r,o),this._fireOverOutEvents(o,r)),this._handleEvent(r,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(r,o){var h=this._hoveredTarget,m=this._hoveredTargets,g=this.targets,p=Math.max(m.length,g.length);this.fireSyntheticInOutEvents(r,o,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<p;v++)this.fireSyntheticInOutEvents(g[v],o,{oldTarget:m[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(r,o){var h=this._draggedoverTarget,m=this._hoveredTargets,g=this.targets,p=Math.max(m.length,g.length);this.fireSyntheticInOutEvents(r,o,{oldTarget:h,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<p;v++)this.fireSyntheticInOutEvents(g[v],o,{oldTarget:m[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=r},fireSyntheticInOutEvents:function(r,o,h){var m,g,p,v=h.oldTarget,C=v!==r,x=h.canvasEvtIn,b=h.canvasEvtOut;C&&(m={e:o,target:r,previousTarget:v},g={e:o,target:v,nextTarget:r}),p=r&&C,v&&C&&(b&&this.fire(b,g),v.fire(h.evtOut,g)),p&&(x&&this.fire(x,m),r.fire(h.evtIn,m))},__onMouseWheel:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"wheel"),this._resetTransformEventData()},_transformObject:function(r){var o=this.getPointer(r),h=this._currentTransform;h.reset=!1,h.shiftKey=r.shiftKey,h.altKey=r[this.centeredKey],this._performTransformAction(r,h,o),h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(r,o,h){var m=h.x,g=h.y,p=o.action,v=!1,C=o.actionHandler;C&&(v=C(r,o,m,g)),p==="drag"&&v&&(o.target.isMoving=!0,this.setCursor(o.target.moveCursor||this.moveCursor)),o.actionPerformed=o.actionPerformed||v},_fire:y.controlsUtils.fireEvent,_setCursorFromEvent:function(r,o){if(!o)return this.setCursor(this.defaultCursor),!1;var h=o.hoverCursor||this.hoverCursor,m=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!m||!m.contains(o))&&o._findTargetCorner(this.getPointer(r,!0));g?this.setCursor(this.getCornerCursor(g,o,r)):(o.subTargetCheck&&this.targets.concat().reverse().map(function(p){h=p.hoverCursor||h}),this.setCursor(h))},getCornerCursor:function(r,o,h){var m=o.controls[r];return m.cursorStyleHandler(h,m,o)}})}(),R=Math.min,L=Math.max,y.util.object.extend(y.Canvas.prototype,{_shouldGroup:function(u,a){var c=this._activeObject;return c&&this._isSelectionKeyPressed(u)&&a&&a.selectable&&this.selection&&(c!==a||c.type==="activeSelection")&&!a.onSelect({e:u})},_handleGrouping:function(u,a){var c=this._activeObject;c.__corner||(a!==c||(a=this.findTarget(u,!0))&&a.selectable)&&(c&&c.type==="activeSelection"?this._updateActiveSelection(a,u):this._createActiveSelection(a,u))},_updateActiveSelection:function(u,a){var c=this._activeObject,f=c._objects.slice(0);c.contains(u)?(c.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),c.size()===1&&this._setActiveObject(c.item(0),a)):(c.addWithUpdate(u),this._hoveredTarget=c,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(f,a)},_createActiveSelection:function(u,a){var c=this.getActiveObjects(),f=this._createGroup(u);this._hoveredTarget=f,this._setActiveObject(f,a),this._fireSelectionEvents(c,a)},_createGroup:function(u){var a=this._objects,c=a.indexOf(this._activeObject)<a.indexOf(u)?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new y.ActiveSelection(c,{canvas:this})},_groupSelectedObjects:function(u){var a,c=this._collectObjects(u);c.length===1?this.setActiveObject(c[0],u):c.length>1&&(a=new y.ActiveSelection(c.reverse(),{canvas:this}),this.setActiveObject(a,u))},_collectObjects:function(u){for(var a,c=[],f=this._groupSelector.ex,r=this._groupSelector.ey,o=f+this._groupSelector.left,h=r+this._groupSelector.top,m=new y.Point(R(f,o),R(r,h)),g=new y.Point(L(f,o),L(r,h)),p=!this.selectionFullyContained,v=f===o&&r===h,C=this._objects.length;C--&&!((a=this._objects[C])&&a.selectable&&a.visible&&(p&&a.intersectsWithRect(m,g,!0)||a.isContainedWithinRect(m,g,!0)||p&&a.containsPoint(m,null,!0)||p&&a.containsPoint(g,null,!0))&&(c.push(a),v)););return c.length>1&&(c=c.filter(function(x){return!x.onSelect({e:u})})),c},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}}),y.util.object.extend(y.StaticCanvas.prototype,{toDataURL:function(u){u||(u={});var a=u.format||"png",c=u.quality||1,f=(u.multiplier||1)*(u.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(f,u);return y.util.toDataURL(r,a,c)},toCanvasElement:function(u,a){u=u||1;var c=((a=a||{}).width||this.width)*u,f=(a.height||this.height)*u,r=this.getZoom(),o=this.width,h=this.height,m=r*u,g=this.viewportTransform,p=(g[4]-(a.left||0))*u,v=(g[5]-(a.top||0))*u,C=this.interactive,x=[m,0,0,m,p,v],b=this.enableRetinaScaling,E=y.util.createCanvasElement(),O=this.contextTop;return E.width=c,E.height=f,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=x,this.width=c,this.height=f,this.calcViewportBoundaries(),this.renderCanvas(E.getContext("2d"),this._objects),this.viewportTransform=g,this.width=o,this.height=h,this.calcViewportBoundaries(),this.interactive=C,this.enableRetinaScaling=b,this.contextTop=O,E}}),y.util.object.extend(y.StaticCanvas.prototype,{loadFromJSON:function(u,a,c){if(u){var f=typeof u=="string"?JSON.parse(u):y.util.object.clone(u),r=this,o=f.clipPath,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete f.clipPath,this._enlivenObjects(f.objects,function(m){r.clear(),r._setBgOverlay(f,function(){o?r._enlivenObjects([o],function(g){r.clipPath=g[0],r.__setupCanvas.call(r,f,m,h,a)}):r.__setupCanvas.call(r,f,m,h,a)})},c),this}},__setupCanvas:function(u,a,c,f){var r=this;a.forEach(function(o,h){r.insertAt(o,h)}),this.renderOnAddRemove=c,delete u.objects,delete u.backgroundImage,delete u.overlayImage,delete u.background,delete u.overlay,this._setOptions(u),this.renderAll(),f&&f()},_setBgOverlay:function(u,a){var c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(u.backgroundImage||u.overlayImage||u.background||u.overlay){var f=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&a&&a()};this.__setBgOverlay("backgroundImage",u.backgroundImage,c,f),this.__setBgOverlay("overlayImage",u.overlayImage,c,f),this.__setBgOverlay("backgroundColor",u.background,c,f),this.__setBgOverlay("overlayColor",u.overlay,c,f)}else a&&a()},__setBgOverlay:function(u,a,c,f){var r=this;if(!a)return c[u]=!0,void(f&&f());u==="backgroundImage"||u==="overlayImage"?y.util.enlivenObjects([a],function(o){r[u]=o[0],c[u]=!0,f&&f()}):this["set"+y.util.string.capitalize(u,!0)](a,function(){c[u]=!0,f&&f()})},_enlivenObjects:function(u,a,c){u&&u.length!==0?y.util.enlivenObjects(u,function(f){a&&a(f)},null,c):a&&a([])},_toDataURL:function(u,a){this.clone(function(c){a(c.toDataURL(u))})},_toDataURLWithMultiplier:function(u,a,c){this.clone(function(f){c(f.toDataURLWithMultiplier(u,a))})},clone:function(u,a){var c=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(f){f.loadFromJSON(c,function(){u&&u(f)})})},cloneWithoutData:function(u){var a=y.util.createCanvasElement();a.width=this.width,a.height=this.height;var c=new y.Canvas(a);this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),u&&u(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):u&&u(c)}}),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.object.clone,r=a.util.toFixed,o=a.util.string.capitalize,h=a.util.degreesToRadians,m=!a.isLikelyNode;a.Object||(a.Object=a.util.createClass(a.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:m,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(g){g&&this.setOptions(g)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=a.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(g){var p=a.perfLimitSizeTotal,v=g.width,C=g.height,x=a.maxCacheSideLimit,b=a.minCacheSideLimit;if(v<=x&&C<=x&&v*C<=p)return v<b&&(g.width=b),C<b&&(g.height=b),g;var E=v/C,O=a.util.limitDimsByArea(E,p),M=a.util.capValue,W=M(b,O.x,x),G=M(b,O.y,x);return v>W&&(g.zoomX/=v/W,g.width=W,g.capped=!0),C>G&&(g.zoomY/=C/G,g.height=G,g.capped=!0),g},_getCacheCanvasDimensions:function(){var g=this.getTotalObjectScaling(),p=this._getTransformedDimensions(0,0),v=p.x*g.scaleX/this.scaleX,C=p.y*g.scaleY/this.scaleY;return{width:v+2,height:C+2,zoomX:g.scaleX,zoomY:g.scaleY,x:v,y:C}},_updateCacheCanvas:function(){var g=this.canvas;if(this.noScaleCache&&g&&g._currentTransform){var p=g._currentTransform.target,v=g._currentTransform.action;if(this===p&&v.slice&&v.slice(0,5)==="scale")return!1}var C,x,b=this._cacheCanvas,E=this._limitCacheSize(this._getCacheCanvasDimensions()),O=a.minCacheSideLimit,M=E.width,W=E.height,G=E.zoomX,Q=E.zoomY,K=M!==this.cacheWidth||W!==this.cacheHeight,Y=this.zoomX!==G||this.zoomY!==Q,N=K||Y,P=0,H=0,q=!1;if(K){var ee=this._cacheCanvas.width,U=this._cacheCanvas.height,V=M>ee||W>U;q=V||(M<.9*ee||W<.9*U)&&ee>O&&U>O,V&&!E.capped&&(M>O||W>O)&&(P=.1*M,H=.1*W)}return this instanceof a.Text&&this.path&&(N=!0,q=!0,P+=this.getHeightOfLine(0)*this.zoomX,H+=this.getHeightOfLine(0)*this.zoomY),!!N&&(q?(b.width=Math.ceil(M+P),b.height=Math.ceil(W+H)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,b.width,b.height)),C=E.x/2,x=E.y/2,this.cacheTranslationX=Math.round(b.width/2-C)+C,this.cacheTranslationY=Math.round(b.height/2-x)+x,this.cacheWidth=M,this.cacheHeight=W,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(G,Q),this.zoomX=G,this.zoomY=Q,!0)},setOptions:function(g){this._setOptions(g),this._initGradient(g.fill,"fill"),this._initGradient(g.stroke,"stroke"),this._initPattern(g.fill,"fill"),this._initPattern(g.stroke,"stroke")},transform:function(g){var p=this.group&&!this.group._transformDone||this.group&&this.canvas&&g===this.canvas.contextTop,v=this.calcTransformMatrix(!p);g.transform(v[0],v[1],v[2],v[3],v[4],v[5])},toObject:function(g){var p=a.Object.NUM_FRACTION_DIGITS,v={type:this.type,version:a.version,originX:this.originX,originY:this.originY,left:r(this.left,p),top:r(this.top,p),width:r(this.width,p),height:r(this.height,p),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,p),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,p),scaleX:r(this.scaleX,p),scaleY:r(this.scaleY,p),angle:r(this.angle,p),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,p),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,p),skewY:r(this.skewY,p)};return this.clipPath&&!this.clipPath.excludeFromExport&&(v.clipPath=this.clipPath.toObject(g),v.clipPath.inverted=this.clipPath.inverted,v.clipPath.absolutePositioned=this.clipPath.absolutePositioned),a.util.populateWithProperties(this,v,g),this.includeDefaultValues||(v=this._removeDefaultValues(v)),v},toDatalessObject:function(g){return this.toObject(g)},_removeDefaultValues:function(g){var p=a.util.getKlass(g.type).prototype;return p.stateProperties.forEach(function(v){v!=="left"&&v!=="top"&&(g[v]===p[v]&&delete g[v],Array.isArray(g[v])&&Array.isArray(p[v])&&g[v].length===0&&p[v].length===0&&delete g[v])}),g},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var g=a.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(g.scaleX),scaleY:Math.abs(g.scaleY)}},getTotalObjectScaling:function(){var g=this.getObjectScaling(),p=g.scaleX,v=g.scaleY;if(this.canvas){var C=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();p*=C*x,v*=C*x}return{scaleX:p,scaleY:v}},getObjectOpacity:function(){var g=this.opacity;return this.group&&(g*=this.group.getObjectOpacity()),g},_set:function(g,p){var v=g==="scaleX"||g==="scaleY",C=this[g]!==p,x=!1;return v&&(p=this._constrainScale(p)),g==="scaleX"&&p<0?(this.flipX=!this.flipX,p*=-1):g==="scaleY"&&p<0?(this.flipY=!this.flipY,p*=-1):g!=="shadow"||!p||p instanceof a.Shadow?g==="dirty"&&this.group&&this.group.set("dirty",p):p=new a.Shadow(p),this[g]=p,C&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(g)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(g)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:a.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(g){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(g.save(),this._setupCompositeOperation(g),this.drawSelectionBackground(g),this.transform(g),this._setOpacity(g),this._setShadow(g,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(g)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(g),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),g.restore())},renderCache:function(g){g=g||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,g.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(g,p){if(g.save(),p.inverted?g.globalCompositeOperation="destination-out":g.globalCompositeOperation="destination-in",p.absolutePositioned){var v=a.util.invertTransform(this.calcTransformMatrix());g.transform(v[0],v[1],v[2],v[3],v[4],v[5])}p.transform(g),g.scale(1/p.zoomX,1/p.zoomY),g.drawImage(p._cacheCanvas,-p.cacheTranslationX,-p.cacheTranslationY),g.restore()},drawObject:function(g,p){var v=this.fill,C=this.stroke;p?(this.fill="black",this.stroke="",this._setClippingProperties(g)):this._renderBackground(g),this._render(g),this._drawClipPath(g,this.clipPath),this.fill=v,this.stroke=C},_drawClipPath:function(g,p){p&&(p.canvas=this.canvas,p.shouldCache(),p._transformDone=!0,p.renderCache({forClipping:!0}),this.drawClipPathOnCache(g,p))},drawCacheOnCanvas:function(g){g.scale(1/this.zoomX,1/this.zoomY),g.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(g){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!g&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!g){var p=this.cacheWidth/this.zoomX,v=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-v/2,p,v)}return!0}return!1},_renderBackground:function(g){if(this.backgroundColor){var p=this._getNonTransformedDimensions();g.fillStyle=this.backgroundColor,g.fillRect(-p.x/2,-p.y/2,p.x,p.y),this._removeShadow(g)}},_setOpacity:function(g){this.group&&!this.group._transformDone?g.globalAlpha=this.getObjectOpacity():g.globalAlpha*=this.opacity},_setStrokeStyles:function(g,p){var v=p.stroke;v&&(g.lineWidth=p.strokeWidth,g.lineCap=p.strokeLineCap,g.lineDashOffset=p.strokeDashOffset,g.lineJoin=p.strokeLineJoin,g.miterLimit=p.strokeMiterLimit,v.toLive?v.gradientUnits==="percentage"||v.gradientTransform||v.patternTransform?this._applyPatternForTransformedGradient(g,v):(g.strokeStyle=v.toLive(g,this),this._applyPatternGradientTransform(g,v)):g.strokeStyle=p.stroke)},_setFillStyles:function(g,p){var v=p.fill;v&&(v.toLive?(g.fillStyle=v.toLive(g,this),this._applyPatternGradientTransform(g,p.fill)):g.fillStyle=v)},_setClippingProperties:function(g){g.globalAlpha=1,g.strokeStyle="transparent",g.fillStyle="#000000"},_setLineDash:function(g,p){p&&p.length!==0&&(1&p.length&&p.push.apply(p,p),g.setLineDash(p))},_renderControls:function(g,p){var v,C,x,b=this.getViewportTransform(),E=this.calcTransformMatrix();C=(p=p||{}).hasBorders!==void 0?p.hasBorders:this.hasBorders,x=p.hasControls!==void 0?p.hasControls:this.hasControls,E=a.util.multiplyTransformMatrices(b,E),v=a.util.qrDecompose(E),g.save(),g.translate(v.translateX,v.translateY),g.lineWidth=1*this.borderScaleFactor,this.group||(g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(v.angle-=180),g.rotate(h(this.group?v.angle:this.angle)),p.forActiveSelection||this.group?C&&this.drawBordersInGroup(g,v,p):C&&this.drawBorders(g,p),x&&this.drawControls(g,p),g.restore()},_setShadow:function(g){if(this.shadow){var p,v=this.shadow,C=this.canvas,x=C&&C.viewportTransform[0]||1,b=C&&C.viewportTransform[3]||1;p=v.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),C&&C._isRetinaScaling()&&(x*=a.devicePixelRatio,b*=a.devicePixelRatio),g.shadowColor=v.color,g.shadowBlur=v.blur*a.browserShadowBlurConstant*(x+b)*(p.scaleX+p.scaleY)/4,g.shadowOffsetX=v.offsetX*x*p.scaleX,g.shadowOffsetY=v.offsetY*b*p.scaleY}},_removeShadow:function(g){this.shadow&&(g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0)},_applyPatternGradientTransform:function(g,p){if(!p||!p.toLive)return{offsetX:0,offsetY:0};var v=p.gradientTransform||p.patternTransform,C=-this.width/2+p.offsetX||0,x=-this.height/2+p.offsetY||0;return p.gradientUnits==="percentage"?g.transform(this.width,0,0,this.height,C,x):g.transform(1,0,0,1,C,x),v&&g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),{offsetX:C,offsetY:x}},_renderPaintInOrder:function(g){this.paintFirst==="stroke"?(this._renderStroke(g),this._renderFill(g)):(this._renderFill(g),this._renderStroke(g))},_render:function(){},_renderFill:function(g){this.fill&&(g.save(),this._setFillStyles(g,this),this.fillRule==="evenodd"?g.fill("evenodd"):g.fill(),g.restore())},_renderStroke:function(g){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this.strokeUniform&&this.group){var p=this.getObjectScaling();g.scale(1/p.scaleX,1/p.scaleY)}else this.strokeUniform&&g.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(g,this.strokeDashArray),this._setStrokeStyles(g,this),g.stroke(),g.restore()}},_applyPatternForTransformedGradient:function(g,p){var v,C=this._limitCacheSize(this._getCacheCanvasDimensions()),x=a.util.createCanvasElement(),b=this.canvas.getRetinaScaling(),E=C.x/this.scaleX/b,O=C.y/this.scaleY/b;x.width=E,x.height=O,(v=x.getContext("2d")).beginPath(),v.moveTo(0,0),v.lineTo(E,0),v.lineTo(E,O),v.lineTo(0,O),v.closePath(),v.translate(E/2,O/2),v.scale(C.zoomX/this.scaleX/b,C.zoomY/this.scaleY/b),this._applyPatternGradientTransform(v,p),v.fillStyle=p.toLive(g),v.fill(),g.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),g.scale(b*this.scaleX/C.zoomX,b*this.scaleY/C.zoomY),g.strokeStyle=v.createPattern(x,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var g=a.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",g.scaleX),this.set("scaleY",g.scaleY),this.angle=g.angle,this.skewX=g.skewX,this.skewY=0}},_removeTransformMatrix:function(g){var p=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),p=a.util.transformPoint(p,this.transformMatrix)),this.transformMatrix=null,g&&(this.scaleX*=g.scaleX,this.scaleY*=g.scaleY,this.cropX=g.cropX,this.cropY=g.cropY,p.x+=g.offsetLeft,p.y+=g.offsetTop,this.width=g.width,this.height=g.height),this.setPositionByOrigin(p,"center","center")},clone:function(g,p){var v=this.toObject(p);this.constructor.fromObject?this.constructor.fromObject(v,g):a.Object._fromObject("Object",v,g)},cloneAsImage:function(g,p){var v=this.toCanvasElement(p);return g&&g(new a.Image(v)),this},toCanvasElement:function(g){g||(g={});var p=a.util,v=p.saveObjectTransform(this),C=this.group,x=this.shadow,b=Math.abs,E=(g.multiplier||1)*(g.enableRetinaScaling?a.devicePixelRatio:1);delete this.group,g.withoutTransform&&p.resetObjectTransform(this),g.withoutShadow&&(this.shadow=null);var O,M,W,G,Q=a.util.createCanvasElement(),K=this.getBoundingRect(!0,!0),Y=this.shadow,N={x:0,y:0};Y&&(M=Y.blur,O=Y.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),N.x=2*Math.round(b(Y.offsetX)+M)*b(O.scaleX),N.y=2*Math.round(b(Y.offsetY)+M)*b(O.scaleY)),W=K.width+N.x,G=K.height+N.y,Q.width=Math.ceil(W),Q.height=Math.ceil(G);var P=new a.StaticCanvas(Q,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});g.format==="jpeg"&&(P.backgroundColor="#fff"),this.setPositionByOrigin(new a.Point(P.width/2,P.height/2),"center","center");var H=this.canvas;P.add(this);var q=P.toCanvasElement(E||1,g);return this.shadow=x,this.set("canvas",H),C&&(this.group=C),this.set(v).setCoords(),P._objects=[],P.dispose(),P=null,q},toDataURL:function(g){return g||(g={}),a.util.toDataURL(this.toCanvasElement(g),g.format||"png",g.quality||1)},isType:function(g){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===g},complexity:function(){return 1},toJSON:function(g){return this.toObject(g)},rotate:function(g){var p=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return p&&this._setOriginToCenter(),this.set("angle",g),p&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(g,p){p=p||this.canvas.getPointer(g);var v=new a.Point(p.x,p.y),C=this._getLeftTopCoords();return this.angle&&(v=a.util.rotatePoint(v,C,h(-this.angle))),{x:v.x-C.x,y:v.y-C.y}},_setupCompositeOperation:function(g){this.globalCompositeOperation&&(g.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){a.runningAnimations&&a.runningAnimations.cancelByTarget(this)}}),a.util.createAccessors&&a.util.createAccessors(a.Object),c(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.ENLIVEN_PROPS=["clipPath"],a.Object._fromObject=function(g,p,v,C){var x=a[g];p=f(p,!0),a.util.enlivenPatterns([p.fill,p.stroke],function(b){b[0]!==void 0&&(p.fill=b[0]),b[1]!==void 0&&(p.stroke=b[1]),a.util.enlivenObjectEnlivables(p,p,function(){var E=C?new x(p[C],p):new x(p);v&&v(E)})})},a.Object.__uid=0)}(e),$=y.util.degreesToRadians,ie={left:-.5,center:0,right:.5},ne={top:-.5,center:0,bottom:.5},y.util.object.extend(y.Object.prototype,{translateToGivenOrigin:function(u,a,c,f,r){var o,h,m,g=u.x,p=u.y;return typeof a=="string"?a=ie[a]:a-=.5,typeof f=="string"?f=ie[f]:f-=.5,typeof c=="string"?c=ne[c]:c-=.5,typeof r=="string"?r=ne[r]:r-=.5,h=r-c,((o=f-a)||h)&&(m=this._getTransformedDimensions(),g=u.x+o*m.x,p=u.y+h*m.y),new y.Point(g,p)},translateToCenterPoint:function(u,a,c){var f=this.translateToGivenOrigin(u,a,c,"center","center");return this.angle?y.util.rotatePoint(f,u,$(this.angle)):f},translateToOriginPoint:function(u,a,c){var f=this.translateToGivenOrigin(u,"center","center",a,c);return this.angle?y.util.rotatePoint(f,u,$(this.angle)):f},getCenterPoint:function(){var u=new y.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,a){var c=this.getCenterPoint();return this.translateToOriginPoint(c,u,a)},toLocalPoint:function(u,a,c){var f,r,o=this.getCenterPoint();return f=a!==void 0&&c!==void 0?this.translateToGivenOrigin(o,"center","center",a,c):new y.Point(this.left,this.top),r=new y.Point(u.x,u.y),this.angle&&(r=y.util.rotatePoint(r,o,-$(this.angle))),r.subtractEquals(f)},setPositionByOrigin:function(u,a,c){var f=this.translateToCenterPoint(u,a,c),r=this.translateToOriginPoint(f,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(u){var a,c,f=$(this.angle),r=this.getScaledWidth(),o=y.util.cos(f)*r,h=y.util.sin(f)*r;a=typeof this.originX=="string"?ie[this.originX]:this.originX-.5,c=typeof u=="string"?ie[u]:u-.5,this.left+=o*(c-a),this.top+=h*(c-a),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var u=y.util,a=u.degreesToRadians,c=u.multiplyTransformMatrices,f=u.transformPoint;u.object.extend(y.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,o){return o?r?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,o){return h=this._getCoords(r,o),[new y.Point(h.tl.x,h.tl.y),new y.Point(h.tr.x,h.tr.y),new y.Point(h.br.x,h.br.y),new y.Point(h.bl.x,h.bl.y)];var h},intersectsWithRect:function(r,o,h,m){var g=this.getCoords(h,m);return y.Intersection.intersectPolygonRectangle(g,r,o).status==="Intersection"},intersectsWithObject:function(r,o,h){return y.Intersection.intersectPolygonPolygon(this.getCoords(o,h),r.getCoords(o,h)).status==="Intersection"||r.isContainedWithinObject(this,o,h)||this.isContainedWithinObject(r,o,h)},isContainedWithinObject:function(r,o,h){for(var m=this.getCoords(o,h),g=o?r.aCoords:r.lineCoords,p=0,v=r._getImageLines(g);p<4;p++)if(!r.containsPoint(m[p],v))return!1;return!0},isContainedWithinRect:function(r,o,h,m){var g=this.getBoundingRect(h,m);return g.left>=r.x&&g.left+g.width<=o.x&&g.top>=r.y&&g.top+g.height<=o.y},containsPoint:function(r,o,h,m){var g=this._getCoords(h,m),p=(o=o||this._getImageLines(g),this._findCrossPoints(r,o));return p!==0&&p%2==1},isOnScreen:function(r){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.getCoords(!0,r).some(function(m){return m.x<=h.x&&m.x>=o.x&&m.y<=h.y&&m.y>=o.y})||!!this.intersectsWithRect(o,h,!0,r)||this._containsCenterOfCanvas(o,h,r)},_containsCenterOfCanvas:function(r,o,h){var m={x:(r.x+o.x)/2,y:(r.y+o.y)/2};return!!this.containsPoint(m,null,!0,h)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.intersectsWithRect(o,h,!0,r)||this.getCoords(!0,r).every(function(m){return(m.x>=h.x||m.x<=o.x)&&(m.y>=h.y||m.y<=o.y)})&&this._containsCenterOfCanvas(o,h,r)},_getImageLines:function(r){return{topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}}},_findCrossPoints:function(r,o){var h,m,g,p=0;for(var v in o)if(!((g=o[v]).o.y<r.y&&g.d.y<r.y||g.o.y>=r.y&&g.d.y>=r.y||(g.o.x===g.d.x&&g.o.x>=r.x?m=g.o.x:(h=(g.d.y-g.o.y)/(g.d.x-g.o.x),m=-(r.y-0*r.x-(g.o.y-h*g.o.x))/(0-h)),m>=r.x&&(p+=1),p!==2)))break;return p},getBoundingRect:function(r,o){var h=this.getCoords(r,o);return u.makeBoundingBoxFromPoints(h)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,o){var h=this.getBoundingRect(o).width/this.getScaledWidth();return this.scale(r/this.width/h)},scaleToHeight:function(r,o){var h=this.getBoundingRect(o).height/this.getScaledHeight();return this.scale(r/this.height/h)},calcLineCoords:function(){var r=this.getViewportTransform(),o=this.padding,h=a(this.angle),m=u.cos(h)*o,g=u.sin(h)*o,p=m+g,v=m-g,C=this.calcACoords(),x={tl:f(C.tl,r),tr:f(C.tr,r),bl:f(C.bl,r),br:f(C.br,r)};return o&&(x.tl.x-=v,x.tl.y-=p,x.tr.x+=p,x.tr.y-=v,x.bl.x-=p,x.bl.y+=v,x.br.x+=v,x.br.y+=p),x},calcOCoords:function(){var r=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),h=this.getViewportTransform(),m=c(h,o),g=c(m,r),p=(g=c(g,[1/h[0],0,0,1/h[3],0,0]),this._calculateCurrentDimensions()),v={};return this.forEachControl(function(C,x,b){v[x]=C.positionHandler(p,g,b)}),v},calcACoords:function(){var r=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),h=c(o,r),m=this._getTransformedDimensions(),g=m.x/2,p=m.y/2;return{tl:f({x:-g,y:-p},h),tr:f({x:g,y:-p},h),bl:f({x:-g,y:p},h),br:f({x:g,y:p},h)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return u.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var o="_",h="";return!r&&this.group&&(h=this.group.transformMatrixKey(r)+o),h+this.top+o+this.left+o+this.scaleX+o+this.scaleY+o+this.skewX+o+this.skewY+o+this.angle+o+this.originX+o+this.originY+o+this.width+o+this.height+o+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var o=this.calcOwnMatrix();if(r||!this.group)return o;var h=this.transformMatrixKey(r),m=this.matrixCache||(this.matrixCache={});return m.key===h?m.value:(this.group&&(o=c(this.group.calcTransformMatrix(!1),o)),m.key=h,m.value=o,o)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),o=this.ownMatrixCache||(this.ownMatrixCache={});if(o.key===r)return o.value;var h=this._calcTranslateMatrix(),m={angle:this.angle,translateX:h[4],translateY:h[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return o.key=r,o.value=u.composeMatrix(m),o.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth;return{x:this.width+r,y:this.height+r}},_getTransformedDimensions:function(r,o){r===void 0&&(r=this.skewX),o===void 0&&(o=this.skewY);var h,m,g,p=r===0&&o===0;if(this.strokeUniform?(m=this.width,g=this.height):(m=(h=this._getNonTransformedDimensions()).x,g=h.y),p)return this._finalizeDimensions(m*this.scaleX,g*this.scaleY);var v=u.sizeAfterTransform(m,g,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:o});return this._finalizeDimensions(v.x,v.y)},_finalizeDimensions:function(r,o){return this.strokeUniform?{x:r+this.strokeWidth,y:o+this.strokeWidth}:{x:r,y:o}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),o=this._getTransformedDimensions();return f(o,r,!0).scalarAdd(2*this.padding)}})}(),y.util.object.extend(y.Object.prototype,{sendToBack:function(){return this.group?y.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?y.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(u){return this.group?y.StaticCanvas.prototype.sendBackwards.call(this.group,this,u):this.canvas&&this.canvas.sendBackwards(this,u),this},bringForward:function(u){return this.group?y.StaticCanvas.prototype.bringForward.call(this.group,this,u):this.canvas&&this.canvas.bringForward(this,u),this},moveTo:function(u){return this.group&&this.group.type!=="activeSelection"?y.StaticCanvas.prototype.moveTo.call(this.group,this,u):this.canvas&&this.canvas.moveTo(this,u),this}}),function(){function u(c,f){if(f){if(f.toLive)return c+": url(#SVGID_"+f.id+"); ";var r=new y.Color(f),o=c+": "+r.toRgb()+"; ",h=r.getAlpha();return h!==1&&(o+=c+"-opacity: "+h.toString()+"; "),o}return c+": none; "}var a=y.util.toFixed;y.util.object.extend(y.Object.prototype,{getSvgStyles:function(c){var f=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",h=this.strokeDashOffset?this.strokeDashOffset:"0",m=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",p=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=this.opacity!==void 0?this.opacity:"1",C=this.visible?"":" visibility: hidden;",x=c?"":this.getSvgFilter(),b=u("fill",this.fill);return[u("stroke",this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",m,"; ","stroke-dashoffset: ",h,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",p,"; ",b,"fill-rule: ",f,"; ","opacity: ",v,";",x,C].join("")},getSvgSpanStyles:function(c,f){var r="; ",o=c.fontFamily?"font-family: "+(c.fontFamily.indexOf("'")===-1&&c.fontFamily.indexOf('"')===-1?"'"+c.fontFamily+"'":c.fontFamily)+r:"",h=c.strokeWidth?"stroke-width: "+c.strokeWidth+r:"",m=c.fontSize?"font-size: "+c.fontSize+"px"+r:"",g=c.fontStyle?"font-style: "+c.fontStyle+r:"",p=c.fontWeight?"font-weight: "+c.fontWeight+r:"",v=c.fill?u("fill",c.fill):"",C=c.stroke?u("stroke",c.stroke):"",x=this.getSvgTextDecoration(c);return x&&(x="text-decoration: "+x+r),[C,h,o,m,g,p,x,v,c.deltaY?"baseline-shift: "+-c.deltaY+"; ":"",f?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(c){return["overline","underline","line-through"].filter(function(f){return c[f.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(c,f){var r=c?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+y.util.matrixToSVG(r)+(f||"")+'" '},_setSVGBg:function(c){if(this.backgroundColor){var f=y.Object.NUM_FRACTION_DIGITS;c.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,f),'" y="',a(-this.height/2,f),'" width="',a(this.width,f),'" height="',a(this.height,f),`"></rect>
`)}},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(c),{reviver:c})},toClipPathSVG:function(c){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(c),{reviver:c})},_createBaseClipPathSVGMarkup:function(c,f){var r=(f=f||{}).reviver,o=f.additionalTransform||"",h=[this.getSvgTransform(!0,o),this.getSvgCommons()].join(""),m=c.indexOf("COMMON_PARTS");return c[m]=h,r?r(c.join("")):c.join("")},_createBaseSVGMarkup:function(c,f){var r,o,h=(f=f||{}).noStyle,m=f.reviver,g=h?"":'style="'+this.getSvgStyles()+'" ',p=f.withShadow?'style="'+this.getSvgFilter()+'" ':"",v=this.clipPath,C=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",x=v&&v.absolutePositioned,b=this.stroke,E=this.fill,O=this.shadow,M=[],W=c.indexOf("COMMON_PARTS"),G=f.additionalTransform;return v&&(v.clipPathId="CLIPPATH_"+y.Object.__uid++,o='<clipPath id="'+v.clipPathId+`" >
`+v.toClipPathSVG(m)+`</clipPath>
`),x&&M.push("<g ",p,this.getSvgCommons(),` >
`),M.push("<g ",this.getSvgTransform(!1),x?"":p+this.getSvgCommons(),` >
`),r=[g,C,h?"":this.addPaintOrder()," ",G?'transform="'+G+'" ':""].join(""),c[W]=r,E&&E.toLive&&M.push(E.toSVG(this)),b&&b.toLive&&M.push(b.toSVG(this)),O&&M.push(O.toSVG(this)),v&&M.push(o),M.push(c.join("")),M.push(`</g>
`),x&&M.push(`</g>
`),m?m(M.join("")):M.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var u=y.util.object.extend,a="stateProperties";function c(r,o,h){var m={};h.forEach(function(g){m[g]=r[g]}),u(r[o],m,!0)}function f(r,o,h){if(r===o)return!0;if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(var m=0,g=r.length;m<g;m++)if(!f(r[m],o[m]))return!1;return!0}if(r&&typeof r=="object"){var p,v=Object.keys(r);if(!o||typeof o!="object"||!h&&v.length!==Object.keys(o).length)return!1;for(m=0,g=v.length;m<g;m++)if((p=v[m])!=="canvas"&&p!=="group"&&!f(r[p],o[p]))return!1;return!0}}y.util.object.extend(y.Object.prototype,{hasStateChanged:function(r){var o="_"+(r=r||a);return Object.keys(this[o]).length<this[r].length||!f(this[o],this,!0)},saveState:function(r){var o=r&&r.propertySet||a,h="_"+o;return this[h]?(c(this,h,this[o]),r&&r.stateProperties&&c(this,h,r.stateProperties),this):this.setupState(r)},setupState:function(r){var o=(r=r||{}).propertySet||a;return r.propertySet=o,this["_"+o]={},this.saveState(r),this}})}(),function(){var u=y.util.degreesToRadians;y.util.object.extend(y.Object.prototype,{_findTargetCorner:function(a,c){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var f,r,o,h=a.x,m=a.y,g=Object.keys(this.oCoords),p=g.length-1;for(this.__corner=0;p>=0;p--)if(o=g[p],this.isControlVisible(o)&&(r=this._getImageLines(c?this.oCoords[o].touchCorner:this.oCoords[o].corner),(f=this._findCrossPoints({x:h,y:m},r))!==0&&f%2==1))return this.__corner=o,o;return!1},forEachControl:function(a){for(var c in this.controls)a(this.controls[c],c,this)},_setCornerCoords:function(){var a=this.oCoords;for(var c in a){var f=this.controls[c];a[c].corner=f.calcCornerCoords(this.angle,this.cornerSize,a[c].x,a[c].y,!1),a[c].touchCorner=f.calcCornerCoords(this.angle,this.touchCornerSize,a[c].x,a[c].y,!0)}},drawSelectionBackground:function(a){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;a.save();var c=this.getCenterPoint(),f=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return a.translate(c.x,c.y),a.scale(1/r[0],1/r[3]),a.rotate(u(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-f.x/2,-f.y/2,f.x,f.y),a.restore(),this},drawBorders:function(a,c){c=c||{};var f=this._calculateCurrentDimensions(),r=this.borderScaleFactor,o=f.x+r,h=f.y+r,m=c.hasControls!==void 0?c.hasControls:this.hasControls,g=!1;return a.save(),a.strokeStyle=c.borderColor||this.borderColor,this._setLineDash(a,c.borderDashArray||this.borderDashArray),a.strokeRect(-o/2,-h/2,o,h),m&&(a.beginPath(),this.forEachControl(function(p,v,C){p.withConnection&&p.getVisibility(C,v)&&(g=!0,a.moveTo(p.x*o,p.y*h),a.lineTo(p.x*o+p.offsetX,p.y*h+p.offsetY))}),g&&a.stroke()),a.restore(),this},drawBordersInGroup:function(a,c,f){f=f||{};var r=y.util.sizeAfterTransform(this.width,this.height,c),o=this.strokeWidth,h=this.strokeUniform,m=this.borderScaleFactor,g=r.x+o*(h?this.canvas.getZoom():c.scaleX)+m,p=r.y+o*(h?this.canvas.getZoom():c.scaleY)+m;return a.save(),this._setLineDash(a,f.borderDashArray||this.borderDashArray),a.strokeStyle=f.borderColor||this.borderColor,a.strokeRect(-g/2,-p/2,g,p),a.restore(),this},drawControls:function(a,c){c=c||{},a.save();var f,r,o=this.canvas.getRetinaScaling();return a.setTransform(o,0,0,o,0,0),a.strokeStyle=a.fillStyle=c.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=c.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(a,c.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(f=this.group.calcTransformMatrix()),this.forEachControl(function(h,m,g){r=g.oCoords[m],h.getVisibility(g,m)&&(f&&(r=y.util.transformPoint(r,f)),h.render(a,r.x,r.y,c,g))}),a.restore(),this},isControlVisible:function(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)},setControlVisible:function(a,c){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=c,this},setControlsVisibility:function(a){for(var c in a||(a={}),a)this.setControlVisible(c,a[c]);return this},onDeselect:function(){},onSelect:function(){}})}(),y.util.object.extend(y.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(u,a){var c=function(){},f=(a=a||{}).onComplete||c,r=a.onChange||c,o=this;return y.util.animate({target:this,startValue:u.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(h){u.set("left",h),o.requestRenderAll(),r()},onComplete:function(){u.setCoords(),f()}})},fxCenterObjectV:function(u,a){var c=function(){},f=(a=a||{}).onComplete||c,r=a.onChange||c,o=this;return y.util.animate({target:this,startValue:u.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(h){u.set("top",h),o.requestRenderAll(),r()},onComplete:function(){u.setCoords(),f()}})},fxRemove:function(u,a){var c=function(){},f=(a=a||{}).onComplete||c,r=a.onChange||c,o=this;return y.util.animate({target:this,startValue:u.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(h){u.set("opacity",h),o.requestRenderAll(),r()},onComplete:function(){o.remove(u),f()}})}}),y.util.object.extend(y.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var u,a,c=[],f=[];for(u in arguments[0])c.push(u);for(var r=0,o=c.length;r<o;r++)u=c[r],a=r!==o-1,f.push(this._animate(u,arguments[0][u],arguments[1],a));return f}return this._animate.apply(this,arguments)},_animate:function(u,a,c,f){var r,o=this;a=a.toString(),c=c?y.util.object.clone(c):{},~u.indexOf(".")&&(r=u.split("."));var h=o.colorProperties.indexOf(u)>-1||r&&o.colorProperties.indexOf(r[1])>-1,m=r?this.get(r[0])[r[1]]:this.get(u);"from"in c||(c.from=m),h||(a=~a.indexOf("=")?m+parseFloat(a.replace("=","")):parseFloat(a));var g={target:this,startValue:c.from,endValue:a,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(p,v,C){return c.abort.call(o,p,v,C)},onChange:function(p,v,C){r?o[r[0]][r[1]]=p:o.set(u,p),f||c.onChange&&c.onChange(p,v,C)},onComplete:function(p,v,C){f||(o.setCoords(),c.onComplete&&c.onComplete(p,v,C))}};return h?y.util.animateColor(g.startValue,g.endValue,g.duration,g):y.util.animate(g)}}),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function o(h,m){var g=h.origin,p=h.axis1,v=h.axis2,C=h.dimension,x=m.nearest,b=m.center,E=m.farthest;return function(){switch(this.get(g)){case x:return Math.min(this.get(p),this.get(v));case b:return Math.min(this.get(p),this.get(v))+.5*this.get(C);case E:return Math.max(this.get(p),this.get(v))}}}a.Line?a.warn("fabric.Line is already defined"):(a.Line=a.util.createClass(a.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:a.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,m){h||(h=[0,0,0,0]),this.callSuper("initialize",m),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(m)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in h?h.left:this._getLeftToOriginX(),this.top="top"in h?h.top:this._getTopToOriginY()},_set:function(h,m){return this.callSuper("_set",h,m),r[h]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var m=this.calcLinePoints();h.moveTo(m.x1,m.y1),h.lineTo(m.x2,m.y2),h.lineWidth=this.strokeWidth;var g=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle,this.stroke&&this._renderStroke(h),h.strokeStyle=g},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(h){return c(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(h.y-=this.strokeWidth),this.height===0&&(h.x-=this.strokeWidth)),h},calcLinePoints:function(){var h=this.x1<=this.x2?-1:1,m=this.y1<=this.y2?-1:1,g=h*this.width*.5,p=m*this.height*.5;return{x1:g,x2:h*this.width*-.5,y1:p,y2:m*this.height*-.5}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`" />
`]}}),a.Line.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),a.Line.fromElement=function(h,m,g){g=g||{};var p=a.parseAttributes(h,a.Line.ATTRIBUTE_NAMES),v=[p.x1||0,p.y1||0,p.x2||0,p.y2||0];m(new a.Line(v,c(p,g)))},a.Line.fromObject=function(h,m){var g=f(h,!0);g.points=[h.x1,h.y1,h.x2,h.y2],a.Object._fromObject("Line",g,function(p){delete p.points,m&&m(p)},"points")})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.degreesToRadians;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:a.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(f,r){return this.callSuper("_set",f,r),f==="radius"&&this.setRadius(r),this},toObject:function(f){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(f))},_toSVG:function(){var f,r=(this.endAngle-this.startAngle)%360;if(r===0)f=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var o=c(this.startAngle),h=c(this.endAngle),m=this.radius;f=['<path d="M '+a.util.cos(o)*m+" "+a.util.sin(o)*m," A "+m+" "+m," 0 ",+(r>180?"1":"0")+" 1"," "+a.util.cos(h)*m+" "+a.util.sin(h)*m,'" ',"COMMON_PARTS",` />
`]}return f},_render:function(f){f.beginPath(),f.arc(0,0,this.radius,c(this.startAngle),c(this.endAngle),!1),this._renderPaintInOrder(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){return this.radius=f,this.set("width",2*f).set("height",2*f)}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(f,r){var o,h=a.parseAttributes(f,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in(o=h)&&o.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");h.left=(h.left||0)-h.radius,h.top=(h.top||0)-h.radius,r(new a.Circle(h))},a.Circle.fromObject=function(f,r){a.Object._fromObject("Circle",f,r)})}(e),function(u){var a=u.fabric||(u.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",width:100,height:100,_render:function(c){var f=this.width/2,r=this.height/2;c.beginPath(),c.moveTo(-f,r),c.lineTo(0,-r),c.lineTo(f,r),c.closePath(),this._renderPaintInOrder(c)},_toSVG:function(){var c=this.width/2,f=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-c+" "+f,"0 "+-f,c+" "+f].join(","),'" />']}}),a.Triangle.fromObject=function(c,f){return a.Object._fromObject("Triangle",c,f)})}(e),function(u){var a=u.fabric||(u.fabric={}),c=2*Math.PI;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this.set("rx",f&&f.rx||0),this.set("ry",f&&f.ry||0)},_set:function(f,r){switch(this.callSuper("_set",f,r),f){case"rx":this.rx=r,this.set("width",2*r);break;case"ry":this.ry=r,this.set("height",2*r)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,c,!1),f.restore(),this._renderPaintInOrder(f)}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),a.Ellipse.fromElement=function(f,r){var o=a.parseAttributes(f,a.Ellipse.ATTRIBUTE_NAMES);o.left=(o.left||0)-o.rx,o.top=(o.top||0)-o.ry,r(new a.Ellipse(o))},a.Ellipse.fromObject=function(f,r){a.Object._fromObject("Ellipse",f,r)})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend;a.Rect?a.warn("fabric.Rect is already defined"):(a.Rect=a.util.createClass(a.Object,{stateProperties:a.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(f){var r=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,m=this.height,g=-this.width/2,p=-this.height/2,v=r!==0||o!==0,C=.4477152502;f.beginPath(),f.moveTo(g+r,p),f.lineTo(g+h-r,p),v&&f.bezierCurveTo(g+h-C*r,p,g+h,p+C*o,g+h,p+o),f.lineTo(g+h,p+m-o),v&&f.bezierCurveTo(g+h,p+m-C*o,g+h-C*r,p+m,g+h-r,p+m),f.lineTo(g+r,p+m),v&&f.bezierCurveTo(g+C*r,p+m,g,p+m-C*o,g,p+m-o),f.lineTo(g,p+o),v&&f.bezierCurveTo(g,p+C*o,g+C*r,p,g+r,p),f.closePath(),this._renderPaintInOrder(f)},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(f,r,o){if(!f)return r(null);o=o||{};var h=a.parseAttributes(f,a.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0,h.height=h.height||0,h.width=h.width||0;var m=new a.Rect(c(o?a.util.object.clone(o):{},h));m.visible=m.visible&&m.width>0&&m.height>0,r(m)},a.Rect.fromObject=function(f,r){return a.Object._fromObject("Rect",f,r)})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.array.min,r=a.util.array.max,o=a.util.toFixed,h=a.util.projectStrokeOnPoints;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:a.Object.prototype.cacheProperties.concat("points"),initialize:function(m,g){g=g||{},this.points=m||[],this.callSuper("initialize",g),this._setPositionDimensions(g)},_projectStrokeOnPoints:function(){return h(this.points,this,!0)},_setPositionDimensions:function(m){var g,p=this._calcDimensions(m),v=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-v,this.height=p.height-v,m.fromSVG||(g=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+v/2,y:p.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),m.left===void 0&&(this.left=m.fromSVG?p.left:g.x),m.top===void 0&&(this.top=m.fromSVG?p.top:g.y),this.pathOffset={x:p.left+this.width/2+v/2,y:p.top+this.height/2+v/2}},_calcDimensions:function(){var m=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,g=f(m,"x")||0,p=f(m,"y")||0;return{left:g,top:p,width:(r(m,"x")||0)-g,height:(r(m,"y")||0)-p}},toObject:function(m){return c(this.callSuper("toObject",m),{points:this.points.concat()})},_toSVG:function(){for(var m=[],g=this.pathOffset.x,p=this.pathOffset.y,v=a.Object.NUM_FRACTION_DIGITS,C=0,x=this.points.length;C<x;C++)m.push(o(this.points[C].x-g,v),",",o(this.points[C].y-p,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',m.join(""),`" />
`]},commonRender:function(m){var g,p=this.points.length,v=this.pathOffset.x,C=this.pathOffset.y;if(!p||isNaN(this.points[p-1].y))return!1;m.beginPath(),m.moveTo(this.points[0].x-v,this.points[0].y-C);for(var x=0;x<p;x++)g=this.points[x],m.lineTo(g.x-v,g.y-C);return!0},_render:function(m){this.commonRender(m)&&this._renderPaintInOrder(m)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElementGenerator=function(m){return function(g,p,v){if(!g)return p(null);v||(v={});var C=a.parsePointsAttribute(g.getAttribute("points")),x=a.parseAttributes(g,a[m].ATTRIBUTE_NAMES);x.fromSVG=!0,p(new a[m](C,c(x,v)))}},a.Polyline.fromElement=a.Polyline.fromElementGenerator("Polyline"),a.Polyline.fromObject=function(m,g){return a.Object._fromObject("Polyline",m,g,"points")})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.projectStrokeOnPoints;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return c(this.points,this)},_render:function(f){this.commonRender(f)&&(f.closePath(),this._renderPaintInOrder(f))}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=a.Polyline.fromElementGenerator("Polygon"),a.Polygon.fromObject=function(f,r){a.Object._fromObject("Polygon",f,r,"points")})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.array.min,f=a.util.array.max,r=a.util.object.extend,o=a.util.object.clone,h=a.util.toFixed;a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,cacheProperties:a.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:a.Object.prototype.stateProperties.concat("path"),initialize:function(m,g){delete(g=o(g||{})).path,this.callSuper("initialize",g),this._setPath(m||[],g)},_setPath:function(m,g){this.path=a.util.makePathSimpler(Array.isArray(m)?m:a.util.parsePath(m)),a.Polyline.prototype._setPositionDimensions.call(this,g||{})},_renderPathCommands:function(m){var g,p=0,v=0,C=0,x=0,b=0,E=0,O=-this.pathOffset.x,M=-this.pathOffset.y;m.beginPath();for(var W=0,G=this.path.length;W<G;++W)switch((g=this.path[W])[0]){case"L":C=g[1],x=g[2],m.lineTo(C+O,x+M);break;case"M":p=C=g[1],v=x=g[2],m.moveTo(C+O,x+M);break;case"C":C=g[5],x=g[6],b=g[3],E=g[4],m.bezierCurveTo(g[1]+O,g[2]+M,b+O,E+M,C+O,x+M);break;case"Q":m.quadraticCurveTo(g[1]+O,g[2]+M,g[3]+O,g[4]+M),C=g[3],x=g[4],b=g[1],E=g[2];break;case"z":case"Z":C=p,x=v,m.closePath()}},_render:function(m){this._renderPathCommands(m),this._renderPaintInOrder(m)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(m){return r(this.callSuper("toObject",m),{path:this.path.map(function(g){return g.slice()})})},toDatalessObject:function(m){var g=this.toObject(["sourcePath"].concat(m));return g.sourcePath&&delete g.path,g},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',a.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var m=a.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,m)+", "+h(-this.pathOffset.y,m)+")"},toClipPathSVG:function(m){var g=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:g})},toSVG:function(m){var g=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:g})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var m,g,p=[],v=[],C=0,x=0,b=0,E=0,O=0,M=this.path.length;O<M;++O){switch((m=this.path[O])[0]){case"L":b=m[1],E=m[2],g=[];break;case"M":C=b=m[1],x=E=m[2],g=[];break;case"C":g=a.util.getBoundsOfCurve(b,E,m[1],m[2],m[3],m[4],m[5],m[6]),b=m[5],E=m[6];break;case"Q":g=a.util.getBoundsOfCurve(b,E,m[1],m[2],m[1],m[2],m[3],m[4]),b=m[3],E=m[4];break;case"z":case"Z":b=C,E=x}g.forEach(function(Q){p.push(Q.x),v.push(Q.y)}),p.push(b),v.push(E)}var W=c(p)||0,G=c(v)||0;return{left:W,top:G,width:(f(p)||0)-W,height:(f(v)||0)-G}}}),a.Path.fromObject=function(m,g){if(typeof m.sourcePath=="string"){var p=m.sourcePath;a.loadSVGFromURL(p,function(v){var C=v[0];C.setOptions(m),g&&g(C)})}else a.Object._fromObject("Path",m,g,"path")},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(m,g,p){var v=a.parseAttributes(m,a.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,g(new a.Path(v.d,r(v,p)))})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.array.min,f=a.util.array.max;a.Group||(a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,o,h){o=o||{},this._objects=[],h&&this.callSuper("initialize",o),this._objects=r||[];for(var m=this._objects.length;m--;)this._objects[m].group=this;if(h)this._updateObjectsACoords();else{var g=o&&o.centerPoint;o.originX!==void 0&&(this.originX=o.originX),o.originY!==void 0&&(this.originY=o.originY),g||this._calcBounds(),this._updateObjectsCoords(g),delete o.centerPoint,this.callSuper("initialize",o)}this.setCoords()},_updateObjectsACoords:function(){for(var r=this._objects.length;r--;)this._objects[r].setCoords(!0)},_updateObjectsCoords:function(r){r=r||this.getCenterPoint();for(var o=this._objects.length;o--;)this._updateObjectCoords(this._objects[o],r)},_updateObjectCoords:function(r,o){var h=r.left,m=r.top;r.set({left:h-o.x,top:m-o.y}),r.group=this,r.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var o=!!this.group;return this._restoreObjectsState(),a.util.resetObjectTransform(this),r&&(o&&a.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,o?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),a.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,o){var h=this._objects.length;if(this.useSetOnGroup)for(;h--;)this._objects[h].setOnGroup(r,o);if(r==="canvas")for(;h--;)this._objects[h]._set(r,o);a.Object.prototype._set.call(this,r,o)},toObject:function(r){var o=this.includeDefaultValues,h=this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){var p=g.includeDefaultValues;g.includeDefaultValues=o;var v=g.toObject(r);return g.includeDefaultValues=p,v}),m=a.Object.prototype.toObject.call(this,r);return m.objects=h,m},toDatalessObject:function(r){var o,h=this.sourcePath;if(h)o=h;else{var m=this.includeDefaultValues;o=this._objects.map(function(p){var v=p.includeDefaultValues;p.includeDefaultValues=m;var C=p.toDatalessObject(r);return p.includeDefaultValues=v,C})}var g=a.Object.prototype.toDatalessObject.call(this,r);return g.objects=o,g},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=a.Object.prototype.shouldCache.call(this);if(r){for(var o=0,h=this._objects.length;o<h;o++)if(this._objects[o].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(a.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,o=this._objects.length;r<o;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var o=0,h=this._objects.length;o<h;o++)this._objects[o].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var o=0,h=this._objects.length;o<h;o++)if(this._objects[o].isCacheDirty(!0)){if(this._cacheCanvas){var m=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-m/2,-g/2,m,g)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(o){a.util.addTransformToObject(o,r),delete o.group,o.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,o=this.canvas;this._objects=[];var h=this.toObject();delete h.objects;var m=new a.ActiveSelection([]);return m.set(h),m.type="activeSelection",o.remove(this),r.forEach(function(g){g.group=m,g.dirty=!0,o.add(g)}),m.canvas=o,m._objects=r,o._activeObject=m,m.setCoords(),m}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(r){r.setCoords(!0)}),this},_calcBounds:function(r){for(var o,h,m,g,p=[],v=[],C=["tr","br","bl","tl"],x=0,b=this._objects.length,E=C.length;x<b;++x){for(m=(o=this._objects[x]).calcACoords(),g=0;g<E;g++)h=C[g],p.push(m[h].x),v.push(m[h].y);o.aCoords=m}this._getBounds(p,v,r)},_getBounds:function(r,o,h){var m=new a.Point(c(r),c(o)),g=new a.Point(f(r),f(o)),p=m.y||0,v=m.x||0,C=g.x-m.x||0,x=g.y-m.y||0;this.width=C,this.height=x,h||this.setPositionByOrigin({x:v,y:p},"left","top")},_toSVG:function(r){for(var o=["<g ","COMMON_PARTS",` >
`],h=0,m=this._objects.length;h<m;h++)o.push("		",this._objects[h].toSVG(r));return o.push(`</g>
`),o},getSvgStyles:function(){var r=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",o=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),o].join("")},toClipPathSVG:function(r){for(var o=[],h=0,m=this._objects.length;h<m;h++)o.push("	",this._objects[h].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(o,{reviver:r})}}),a.Group.fromObject=function(r,o){var h=r.objects,m=a.util.object.clone(r,!0);delete m.objects,typeof h!="string"?a.util.enlivenObjects(h,function(g){var p=a.util.object.clone(r,!0);delete p.objects,a.util.enlivenObjectEnlivables(r,p,function(){o&&o(new a.Group(g,p,!0))})}):a.loadSVGFromURL(h,function(g){var p=a.util.groupSVGElements(g,r,h);p.set(m),o&&o(p)})})}(e),function(u){var a=u.fabric||(u.fabric={});a.ActiveSelection||(a.ActiveSelection=a.util.createClass(a.Group,{type:"activeSelection",initialize:function(c,f){f=f||{},this._objects=c||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;f.originX&&(this.originX=f.originX),f.originY&&(this.originY=f.originY),this._calcBounds(),this._updateObjectsCoords(),a.Object.prototype.initialize.call(this,f),this.setCoords()},toGroup:function(){var c=this._objects.concat();this._objects=[];var f=a.Object.prototype.toObject.call(this),r=new a.Group([]);if(delete f.type,r.set(f),c.forEach(function(h){h.canvas.remove(h),h.group=r}),r._objects=c,!this.canvas)return r;var o=this.canvas;return o.add(r),o._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(c,f,r){c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",c,f),(r=r||{}).hasControls===void 0&&(r.hasControls=!1),r.forActiveSelection=!0;for(var o=0,h=this._objects.length;o<h;o++)this._objects[o]._renderControls(c,r);c.restore()}}),a.ActiveSelection.fromObject=function(c,f){a.util.enlivenObjects(c.objects,function(r){delete c.objects,f&&f(new a.ActiveSelection(r,c,!0))})})}(e),function(u){var a=y.util.object.extend;u.fabric||(u.fabric={}),u.fabric.Image?y.warn("fabric.Image is already defined."):(y.Image=y.util.createClass(y.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:y.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:y.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(c,f){f||(f={}),this.filters=[],this.cacheKey="texture"+y.Object.__uid++,this.callSuper("initialize",f),this._initElement(c,f)},getElement:function(){return this._element||{}},setElement:function(c,f){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=c,this._originalElement=c,this._initConfig(f),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(c){var f=y.filterBackend;f&&f.evictCachesForKey&&f.evictCachesForKey(c)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(c){y.util.cleanUpJsdomNode(this[c]),this[c]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var c=this.getElement();return{width:c.naturalWidth||c.width,height:c.naturalHeight||c.height}},_stroke:function(c){if(this.stroke&&this.strokeWidth!==0){var f=this.width/2,r=this.height/2;c.beginPath(),c.moveTo(-f,-r),c.lineTo(f,-r),c.lineTo(f,r),c.lineTo(-f,r),c.lineTo(-f,-r),c.closePath()}},toObject:function(c){var f=[];this.filters.forEach(function(o){o&&f.push(o.toObject())});var r=a(this.callSuper("toObject",["cropX","cropY"].concat(c)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:f});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var c,f=[],r=[],o=this._element,h=-this.width/2,m=-this.height/2,g="",p="";if(!o)return[];if(this.hasCrop()){var v=y.Object.__uid++;f.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+h+'" y="'+m+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),g=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(p='" image-rendering="optimizeSpeed'),r.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',h-this.cropX,'" y="',m-this.cropY,'" width="',o.width||o.naturalWidth,'" height="',o.height||o.height,p,'"',g,`></image>
`),this.stroke||this.strokeDashArray){var C=this.fill;this.fill=null,c=["	<rect ",'x="',h,'" y="',m,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=C}return this.paintFirst!=="fill"?f.concat(c,r):f.concat(r,c)},getSrc:function(c){var f=c?this._element:this._originalElement;return f?f.toDataURL?f.toDataURL():this.srcFromAttribute?f.getAttribute("src"):f.src:this.src||""},setSrc:function(c,f,r){return y.util.loadImage(c,function(o,h){this.setElement(o,r),this._setWidthHeight(),f&&f(this,h)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var c=this.resizeFilter,f=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),o=r.scaleX,h=r.scaleY,m=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!c||o>f&&h>f)return this._element=m,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=o,void(this._lastScaleY=h);y.filterBackend||(y.filterBackend=y.initFilterBackend());var g=y.util.createCanvasElement(),p=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=m.width,C=m.height;g.width=v,g.height=C,this._element=g,this._lastScaleX=c.scaleX=o,this._lastScaleY=c.scaleY=h,y.filterBackend.applyFilters([c],m,v,C,this._element,p),this._filterScalingX=g.width/this._originalElement.width,this._filterScalingY=g.height/this._originalElement.height},applyFilters:function(c){if(c=(c=c||this.filters||[]).filter(function(m){return m&&!m.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),c.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var f=this._originalElement,r=f.naturalWidth||f.width,o=f.naturalHeight||f.height;if(this._element===this._originalElement){var h=y.util.createCanvasElement();h.width=r,h.height=o,this._element=h,this._filteredEl=h}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,o),this._lastScaleX=1,this._lastScaleY=1;return y.filterBackend||(y.filterBackend=y.initFilterBackend()),y.filterBackend.applyFilters(c,this._originalElement,r,o,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(c){y.util.setImageSmoothing(c,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(c),this._renderPaintInOrder(c)},drawCacheOnCanvas:function(c){y.util.setImageSmoothing(c,this.imageSmoothing),y.Object.prototype.drawCacheOnCanvas.call(this,c)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(c){var f=this._element;if(f){var r=this._filterScalingX,o=this._filterScalingY,h=this.width,m=this.height,g=Math.min,p=Math.max,v=p(this.cropX,0),C=p(this.cropY,0),x=f.naturalWidth||f.width,b=f.naturalHeight||f.height,E=v*r,O=C*o,M=g(h*r,x-E),W=g(m*o,b-O),G=-h/2,Q=-m/2,K=g(h,x/r-v),Y=g(m,b/o-C);f&&c.drawImage(f,E,O,M,W,G,Q,K,Y)}},_needsResize:function(){var c=this.getTotalObjectScaling();return c.scaleX!==this._lastScaleX||c.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(c,f){this.setElement(y.util.getById(c),f),y.util.addClass(this.getElement(),y.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={}),this.setOptions(c),this._setWidthHeight(c)},_initFilters:function(c,f){c&&c.length?y.util.enlivenObjects(c,function(r){f&&f(r)},"fabric.Image.filters"):f&&f()},_setWidthHeight:function(c){c||(c={});var f=this.getElement();this.width=c.width||f.naturalWidth||f.width||0,this.height=c.height||f.naturalHeight||f.height||0},parsePreserveAspectRatioAttribute:function(){var c,f=y.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),r=this._element.width,o=this._element.height,h=1,m=1,g=0,p=0,v=0,C=0,x=this.width,b=this.height,E={width:x,height:b};return!f||f.alignX==="none"&&f.alignY==="none"?(h=x/r,m=b/o):(f.meetOrSlice==="meet"&&(c=(x-r*(h=m=y.util.findScaleToFit(this._element,E)))/2,f.alignX==="Min"&&(g=-c),f.alignX==="Max"&&(g=c),c=(b-o*m)/2,f.alignY==="Min"&&(p=-c),f.alignY==="Max"&&(p=c)),f.meetOrSlice==="slice"&&(c=r-x/(h=m=y.util.findScaleToCover(this._element,E)),f.alignX==="Mid"&&(v=c/2),f.alignX==="Max"&&(v=c),c=o-b/m,f.alignY==="Mid"&&(C=c/2),f.alignY==="Max"&&(C=c),r=x/h,o=b/m)),{width:r,height:o,scaleX:h,scaleY:m,offsetLeft:g,offsetTop:p,cropX:v,cropY:C}}}),y.Image.CSS_CANVAS="canvas-img",y.Image.prototype.getSvgSrc=y.Image.prototype.getSrc,y.Image.fromObject=function(c,f){var r=y.util.object.clone(c);y.util.loadImage(r.src,function(o,h){h?f&&f(null,!0):y.Image.prototype._initFilters.call(r,r.filters,function(m){r.filters=m||[],y.Image.prototype._initFilters.call(r,[r.resizeFilter],function(g){r.resizeFilter=g[0],y.util.enlivenObjectEnlivables(r,r,function(){var p=new y.Image(o,r);f(p,!1)})})})},null,r.crossOrigin)},y.Image.fromURL=function(c,f,r){y.util.loadImage(c,function(o,h){f&&f(new y.Image(o,r),h)},null,r&&r.crossOrigin)},y.Image.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),y.Image.fromElement=function(c,f,r){var o=y.parseAttributes(c,y.Image.ATTRIBUTE_NAMES);y.Image.fromURL(o["xlink:href"],f,a(r?y.util.object.clone(r):{},o))})}(e),y.util.object.extend(y.Object.prototype,{_getAngleValueForStraighten:function(){var u=this.angle%360;return u>0?90*Math.round((u-1)/90):90*Math.round(u/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(u){var a=function(){},c=(u=u||{}).onComplete||a,f=u.onChange||a,r=this;return y.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(o){r.rotate(o),f()},onComplete:function(){r.setCoords(),c()}})}}),y.util.object.extend(y.StaticCanvas.prototype,{straightenObject:function(u){return u.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(u){return u.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function u(c,f){var r="precision "+f+` float;
void main(){}`,o=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(o,r),c.compileShader(o),!!c.getShaderParameter(o,c.COMPILE_STATUS)}function a(c){c&&c.tileSize&&(this.tileSize=c.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}y.isWebglSupported=function(c){if(y.isLikelyNode)return!1;c=c||y.WebglFilterBackend.prototype.tileSize;var f=document.createElement("canvas"),r=f.getContext("webgl")||f.getContext("experimental-webgl"),o=!1;if(r){y.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),o=y.maxTextureSize>=c;for(var h=["highp","mediump","lowp"],m=0;m<3;m++)if(u(r,h[m])){y.webGlPrecision=h[m];break}}return this.isSupported=o,o},y.WebglFilterBackend=a,a.prototype={tileSize:2048,resources:{},setupGLContext:function(c,f){this.dispose(),this.createWebGLCanvas(c,f),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(c,f)},chooseFastestCopyGLTo2DMethod:function(c,f){var r,o=window.performance!==void 0;try{new ImageData(1,1),r=!0}catch{r=!1}var h=typeof ArrayBuffer<"u",m=typeof Uint8ClampedArray<"u";if(o&&r&&h&&m){var g=y.util.createCanvasElement(),p=new ArrayBuffer(c*f*4);if(y.forceGLPutImageData)return this.imageBuffer=p,void(this.copyGLTo2D=be);var v,C,x={imageBuffer:p,destinationWidth:c,destinationHeight:f,targetCanvas:g};g.width=c,g.height=f,v=window.performance.now(),ge.call(x,this.gl,x),C=window.performance.now()-v,v=window.performance.now(),be.call(x,this.gl,x),C>window.performance.now()-v?(this.imageBuffer=p,this.copyGLTo2D=be):this.copyGLTo2D=ge}},createWebGLCanvas:function(c,f){var r=y.util.createCanvasElement();r.width=c,r.height=f;var o={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},h=r.getContext("webgl",o);h||(h=r.getContext("experimental-webgl",o)),h&&(h.clearColor(0,0,0,0),this.canvas=r,this.gl=h)},applyFilters:function(c,f,r,o,h,m){var g,p=this.gl;m&&(g=this.getCachedTexture(m,f));var v={originalWidth:f.width||f.originalWidth,originalHeight:f.height||f.originalHeight,sourceWidth:r,sourceHeight:o,destinationWidth:r,destinationHeight:o,context:p,sourceTexture:this.createTexture(p,r,o,!g&&f),targetTexture:this.createTexture(p,r,o),originalTexture:g||this.createTexture(p,r,o,!g&&f),passes:c.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:h},C=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,C),c.forEach(function(x){x&&x.applyTo(v)}),function(x){var b=x.targetCanvas,E=b.width,O=b.height,M=x.destinationWidth,W=x.destinationHeight;E===M&&O===W||(b.width=M,b.height=W)}(v),this.copyGLTo2D(p,v),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(v.sourceTexture),p.deleteTexture(v.targetTexture),p.deleteFramebuffer(C),h.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(c,f,r,o){var h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),o?c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,o):c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f,r,0,c.RGBA,c.UNSIGNED_BYTE,null),h},getCachedTexture:function(c,f){if(this.textureCache[c])return this.textureCache[c];var r=this.createTexture(this.gl,f.width,f.height,f);return this.textureCache[c]=r,r},evictCachesForKey:function(c){this.textureCache[c]&&(this.gl.deleteTexture(this.textureCache[c]),delete this.textureCache[c])},copyGLTo2D:ge,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var c=this.gl,f={renderer:"",vendor:""};if(!c)return f;var r=c.getExtension("WEBGL_debug_renderer_info");if(r){var o=c.getParameter(r.UNMASKED_RENDERER_WEBGL),h=c.getParameter(r.UNMASKED_VENDOR_WEBGL);o&&(f.renderer=o.toLowerCase()),h&&(f.vendor=h.toLowerCase())}return this.gpuInfo=f,f}}}(),function(){var u=function(){};function a(){}y.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:u,dispose:u,clearWebGLCaches:u,resources:{},applyFilters:function(c,f,r,o,h){var m=h.getContext("2d");m.drawImage(f,0,0,r,o);var g={sourceWidth:r,sourceHeight:o,imageData:m.getImageData(0,0,r,o),originalEl:f,originalImageData:m.getImageData(0,0,r,o),canvasEl:h,ctx:m,filterBackend:this};return c.forEach(function(p){p.applyTo(g)}),g.imageData.width===r&&g.imageData.height===o||(h.width=g.imageData.width,h.height=g.imageData.height),m.putImageData(g.imageData,0,0),g}}}(),y.Image=y.Image||{},y.Image.filters=y.Image.filters||{},y.Image.filters.BaseFilter=y.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(u){u&&this.setOptions(u)},setOptions:function(u){for(var a in u)this[a]=u[a]},createProgram:function(u,a,c){a=a||this.fragmentSource,c=c||this.vertexSource,y.webGlPrecision!=="highp"&&(a=a.replace(/precision highp float/g,"precision "+y.webGlPrecision+" float"));var f=u.createShader(u.VERTEX_SHADER);if(u.shaderSource(f,c),u.compileShader(f),!u.getShaderParameter(f,u.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+u.getShaderInfoLog(f));var r=u.createShader(u.FRAGMENT_SHADER);if(u.shaderSource(r,a),u.compileShader(r),!u.getShaderParameter(r,u.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+u.getShaderInfoLog(r));var o=u.createProgram();if(u.attachShader(o,f),u.attachShader(o,r),u.linkProgram(o),!u.getProgramParameter(o,u.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+u.getProgramInfoLog(o));var h=this.getAttributeLocations(u,o),m=this.getUniformLocations(u,o)||{};return m.uStepW=u.getUniformLocation(o,"uStepW"),m.uStepH=u.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:h,uniformLocations:m}},getAttributeLocations:function(u,a){return{aPosition:u.getAttribLocation(a,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(u,a,c){var f=a.aPosition,r=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,r),u.enableVertexAttribArray(f),u.vertexAttribPointer(f,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,c,u.STATIC_DRAW)},_setupFrameBuffer:function(u){var a,c,f=u.context;u.passes>1?(a=u.destinationWidth,c=u.destinationHeight,u.sourceWidth===a&&u.sourceHeight===c||(f.deleteTexture(u.targetTexture),u.targetTexture=u.filterBackend.createTexture(f,a,c)),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,u.targetTexture,0)):(f.bindFramebuffer(f.FRAMEBUFFER,null),f.finish())},_swapTextures:function(u){u.passes--,u.pass++;var a=u.targetTexture;u.targetTexture=u.sourceTexture,u.sourceTexture=a},isNeutralState:function(){var u=this.mainParameter,a=y.Image.filters[this.type].prototype;if(u){if(Array.isArray(a[u])){for(var c=a[u].length;c--;)if(this[u][c]!==a[u][c])return!1;return!0}return a[u]===this[u]}return!1},applyTo:function(u){u.webgl?(this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u)):this.applyTo2d(u)},retrieveShader:function(u){return u.programCache.hasOwnProperty(this.type)||(u.programCache[this.type]=this.createProgram(u.context)),u.programCache[this.type]},applyToWebGL:function(u){var a=u.context,c=this.retrieveShader(u);u.pass===0&&u.originalTexture?a.bindTexture(a.TEXTURE_2D,u.originalTexture):a.bindTexture(a.TEXTURE_2D,u.sourceTexture),a.useProgram(c.program),this.sendAttributeData(a,c.attributeLocations,u.aPosition),a.uniform1f(c.uniformLocations.uStepW,1/u.sourceWidth),a.uniform1f(c.uniformLocations.uStepH,1/u.sourceHeight),this.sendUniformData(a,c.uniformLocations),a.viewport(0,0,u.destinationWidth,u.destinationHeight),a.drawArrays(a.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(u,a,c){u.activeTexture(c),u.bindTexture(u.TEXTURE_2D,a),u.activeTexture(u.TEXTURE0)},unbindAdditionalTexture:function(u,a){u.activeTexture(a),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(u){this[this.mainParameter]=u},sendUniformData:function(){},createHelpLayer:function(u){if(!u.helpLayer){var a=document.createElement("canvas");a.width=u.sourceWidth,a.height=u.sourceHeight,u.helpLayer=a}},toObject:function(){var u={type:this.type},a=this.mainParameter;return a&&(u[a]=this[a]),u},toJSON:function(){return this.toObject()}}),y.Image.filters.BaseFilter.fromObject=function(u,a){var c=new y.Image.filters[u.type](u);return a&&a(c),c},function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.ColorMatrix=f(c.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var o,h,m,g,p,v=r.imageData.data,C=v.length,x=this.matrix,b=this.colorsOnly;for(p=0;p<C;p+=4)o=v[p],h=v[p+1],m=v[p+2],b?(v[p]=o*x[0]+h*x[1]+m*x[2]+255*x[4],v[p+1]=o*x[5]+h*x[6]+m*x[7]+255*x[9],v[p+2]=o*x[10]+h*x[11]+m*x[12]+255*x[14]):(g=v[p+3],v[p]=o*x[0]+h*x[1]+m*x[2]+g*x[3]+255*x[4],v[p+1]=o*x[5]+h*x[6]+m*x[7]+g*x[8]+255*x[9],v[p+2]=o*x[10]+h*x[11]+m*x[12]+g*x[13]+255*x[14],v[p+3]=o*x[15]+h*x[16]+m*x[17]+g*x[18]+255*x[19])},getUniformLocations:function(r,o){return{uColorMatrix:r.getUniformLocation(o,"uColorMatrix"),uConstants:r.getUniformLocation(o,"uConstants")}},sendUniformData:function(r,o){var h=this.matrix,m=[h[0],h[1],h[2],h[3],h[5],h[6],h[7],h[8],h[10],h[11],h[12],h[13],h[15],h[16],h[17],h[18]],g=[h[4],h[9],h[14],h[19]];r.uniformMatrix4fv(o.uColorMatrix,!1,m),r.uniform4fv(o.uConstants,g)}}),a.Image.filters.ColorMatrix.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Brightness=f(c.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var o,h=r.imageData.data,m=h.length,g=Math.round(255*this.brightness);for(o=0;o<m;o+=4)h[o]=h[o]+g,h[o+1]=h[o+1]+g,h[o+2]=h[o+2]+g}},getUniformLocations:function(r,o){return{uBrightness:r.getUniformLocation(o,"uBrightness")}},sendUniformData:function(r,o){r.uniform1f(o.uBrightness,this.brightness)}}),a.Image.filters.Brightness.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.Image.filters,r=a.util.createClass;f.Convolute=r(f.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(o){var h=Math.sqrt(this.matrix.length),m=this.type+"_"+h+"_"+(this.opaque?1:0),g=this.fragmentSource[m];return o.programCache.hasOwnProperty(m)||(o.programCache[m]=this.createProgram(o.context,g)),o.programCache[m]},applyTo2d:function(o){var h,m,g,p,v,C,x,b,E,O,M,W,G,Q=o.imageData,K=Q.data,Y=this.matrix,N=Math.round(Math.sqrt(Y.length)),P=Math.floor(N/2),H=Q.width,q=Q.height,ee=o.ctx.createImageData(H,q),U=ee.data,V=this.opaque?1:0;for(M=0;M<q;M++)for(O=0;O<H;O++){for(v=4*(M*H+O),h=0,m=0,g=0,p=0,G=0;G<N;G++)for(W=0;W<N;W++)C=O+W-P,(x=M+G-P)<0||x>=q||C<0||C>=H||(b=4*(x*H+C),E=Y[G*N+W],h+=K[b]*E,m+=K[b+1]*E,g+=K[b+2]*E,V||(p+=K[b+3]*E));U[v]=h,U[v+1]=m,U[v+2]=g,U[v+3]=V?K[v+3]:p}o.imageData=ee},getUniformLocations:function(o,h){return{uMatrix:o.getUniformLocation(h,"uMatrix"),uOpaque:o.getUniformLocation(h,"uOpaque"),uHalfSize:o.getUniformLocation(h,"uHalfSize"),uSize:o.getUniformLocation(h,"uSize")}},sendUniformData:function(o,h){o.uniform1fv(h.uMatrix,this.matrix)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),a.Image.filters.Convolute.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Grayscale=f(c.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var o,h,m=r.imageData.data,g=m.length,p=this.mode;for(o=0;o<g;o+=4)p==="average"?h=(m[o]+m[o+1]+m[o+2])/3:p==="lightness"?h=(Math.min(m[o],m[o+1],m[o+2])+Math.max(m[o],m[o+1],m[o+2]))/2:p==="luminosity"&&(h=.21*m[o]+.72*m[o+1]+.07*m[o+2]),m[o]=h,m[o+1]=h,m[o+2]=h},retrieveShader:function(r){var o=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(o)){var h=this.fragmentSource[this.mode];r.programCache[o]=this.createProgram(r.context,h)}return r.programCache[o]},getUniformLocations:function(r,o){return{uMode:r.getUniformLocation(o,"uMode")}},sendUniformData:function(r,o){r.uniform1i(o.uMode,1)},isNeutralState:function(){return!1}}),a.Image.filters.Grayscale.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Invert=f(c.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var o,h=r.imageData.data,m=h.length;for(o=0;o<m;o+=4)h[o]=255-h[o],h[o+1]=255-h[o+1],h[o+2]=255-h[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,o){return{uInvert:r.getUniformLocation(o,"uInvert")}},sendUniformData:function(r,o){r.uniform1i(o.uInvert,this.invert)}}),a.Image.filters.Invert.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.Image.filters,r=a.util.createClass;f.Noise=r(f.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(o){if(this.noise!==0){var h,m,g=o.imageData.data,p=g.length,v=this.noise;for(h=0,p=g.length;h<p;h+=4)m=(.5-Math.random())*v,g[h]+=m,g[h+1]+=m,g[h+2]+=m}},getUniformLocations:function(o,h){return{uNoise:o.getUniformLocation(h,"uNoise"),uSeed:o.getUniformLocation(h,"uSeed")}},sendUniformData:function(o,h){o.uniform1f(h.uNoise,this.noise/255),o.uniform1f(h.uSeed,Math.random())},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),a.Image.filters.Noise.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Pixelate=f(c.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var o,h,m,g,p,v,C,x,b,E,O,M=r.imageData,W=M.data,G=M.height,Q=M.width;for(h=0;h<G;h+=this.blocksize)for(m=0;m<Q;m+=this.blocksize)for(g=W[o=4*h*Q+4*m],p=W[o+1],v=W[o+2],C=W[o+3],E=Math.min(h+this.blocksize,G),O=Math.min(m+this.blocksize,Q),x=h;x<E;x++)for(b=m;b<O;b++)W[o=4*x*Q+4*b]=g,W[o+1]=p,W[o+2]=v,W[o+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,o){return{uBlocksize:r.getUniformLocation(o,"uBlocksize"),uStepW:r.getUniformLocation(o,"uStepW"),uStepH:r.getUniformLocation(o,"uStepH")}},sendUniformData:function(r,o){r.uniform1f(o.uBlocksize,this.blocksize)}}),a.Image.filters.Pixelate.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.Image.filters,r=a.util.createClass;f.RemoveColor=r(f.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(o){var h,m,g,p,v=o.imageData.data,C=255*this.distance,x=new a.Color(this.color).getSource(),b=[x[0]-C,x[1]-C,x[2]-C],E=[x[0]+C,x[1]+C,x[2]+C];for(h=0;h<v.length;h+=4)m=v[h],g=v[h+1],p=v[h+2],m>b[0]&&g>b[1]&&p>b[2]&&m<E[0]&&g<E[1]&&p<E[2]&&(v[h+3]=0)},getUniformLocations:function(o,h){return{uLow:o.getUniformLocation(h,"uLow"),uHigh:o.getUniformLocation(h,"uHigh")}},sendUniformData:function(o,h){var m=new a.Color(this.color).getSource(),g=parseFloat(this.distance),p=[0+m[0]/255-g,0+m[1]/255-g,0+m[2]/255-g,1],v=[m[0]/255+g,m[1]/255+g,m[2]/255+g,1];o.uniform4fv(h.uLow,p),o.uniform4fv(h.uHigh,v)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),a.Image.filters.RemoveColor.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in r)c[o]=f(c.ColorMatrix,{type:o,matrix:r[o],mainParameter:!1,colorsOnly:!0}),a.Image.filters[o].fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric,c=a.Image.filters,f=a.util.createClass;c.BlendColor=f(c.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var o,h=this.type+"_"+this.mode;return r.programCache.hasOwnProperty(h)||(o=this.buildSource(this.mode),r.programCache[h]=this.createProgram(r.context,o)),r.programCache[h]},applyTo2d:function(r){var o,h,m,g,p,v,C,x=r.imageData.data,b=x.length,E=1-this.alpha;o=(C=new a.Color(this.color).getSource())[0]*this.alpha,h=C[1]*this.alpha,m=C[2]*this.alpha;for(var O=0;O<b;O+=4)switch(g=x[O],p=x[O+1],v=x[O+2],this.mode){case"multiply":x[O]=g*o/255,x[O+1]=p*h/255,x[O+2]=v*m/255;break;case"screen":x[O]=255-(255-g)*(255-o)/255,x[O+1]=255-(255-p)*(255-h)/255,x[O+2]=255-(255-v)*(255-m)/255;break;case"add":x[O]=g+o,x[O+1]=p+h,x[O+2]=v+m;break;case"diff":case"difference":x[O]=Math.abs(g-o),x[O+1]=Math.abs(p-h),x[O+2]=Math.abs(v-m);break;case"subtract":x[O]=g-o,x[O+1]=p-h,x[O+2]=v-m;break;case"darken":x[O]=Math.min(g,o),x[O+1]=Math.min(p,h),x[O+2]=Math.min(v,m);break;case"lighten":x[O]=Math.max(g,o),x[O+1]=Math.max(p,h),x[O+2]=Math.max(v,m);break;case"overlay":x[O]=o<128?2*g*o/255:255-2*(255-g)*(255-o)/255,x[O+1]=h<128?2*p*h/255:255-2*(255-p)*(255-h)/255,x[O+2]=m<128?2*v*m/255:255-2*(255-v)*(255-m)/255;break;case"exclusion":x[O]=o+g-2*o*g/255,x[O+1]=h+p-2*h*p/255,x[O+2]=m+v-2*m*v/255;break;case"tint":x[O]=o+g*E,x[O+1]=h+p*E,x[O+2]=m+v*E}},getUniformLocations:function(r,o){return{uColor:r.getUniformLocation(o,"uColor")}},sendUniformData:function(r,o){var h=new a.Color(this.color).getSource();h[0]=this.alpha*h[0]/255,h[1]=this.alpha*h[1]/255,h[2]=this.alpha*h[2]/255,h[3]=this.alpha,r.uniform4fv(o.uColor,h)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendColor.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric,c=a.Image.filters,f=a.util.createClass;c.BlendImage=f(c.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var o=this.type+"_"+this.mode,h=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(o)||(r.programCache[o]=this.createProgram(r.context,h)),r.programCache[o]},applyToWebGL:function(r){var o=r.context,h=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(o,h,o.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(o,o.TEXTURE1)},createTexture:function(r,o){return r.getCachedTexture(o.cacheKey,o._element)},calculateMatrix:function(){var r=this.image,o=r._element.width,h=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/o,-r.top/h,1]},applyTo2d:function(r){var o,h,m,g,p,v,C,x,b,E,O,M=r.imageData,W=r.filterBackend.resources,G=M.data,Q=G.length,K=M.width,Y=M.height,N=this.image;W.blendImage||(W.blendImage=a.util.createCanvasElement()),E=(b=W.blendImage).getContext("2d"),b.width!==K||b.height!==Y?(b.width=K,b.height=Y):E.clearRect(0,0,K,Y),E.setTransform(N.scaleX,0,0,N.scaleY,N.left,N.top),E.drawImage(N._element,0,0,K,Y),O=E.getImageData(0,0,K,Y).data;for(var P=0;P<Q;P+=4)switch(p=G[P],v=G[P+1],C=G[P+2],x=G[P+3],o=O[P],h=O[P+1],m=O[P+2],g=O[P+3],this.mode){case"multiply":G[P]=p*o/255,G[P+1]=v*h/255,G[P+2]=C*m/255,G[P+3]=x*g/255;break;case"mask":G[P+3]=g}},getUniformLocations:function(r,o){return{uTransformMatrix:r.getUniformLocation(o,"uTransformMatrix"),uImage:r.getUniformLocation(o,"uImage")}},sendUniformData:function(r,o){var h=this.calculateMatrix();r.uniform1i(o.uImage,1),r.uniformMatrix3fv(o.uTransformMatrix,!1,h)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendImage.fromObject=function(r,o){a.Image.fromObject(r.image,function(h){var m=a.util.object.clone(r);m.image=h,o(new a.Image.filters.BlendImage(m))})}}(e),function(u){var a=u.fabric||(u.fabric={}),c=Math.pow,f=Math.floor,r=Math.sqrt,o=Math.abs,h=Math.round,m=Math.sin,g=Math.ceil,p=a.Image.filters,v=a.util.createClass;p.Resize=v(p.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(C,x){return{uDelta:C.getUniformLocation(x,"uDelta"),uTaps:C.getUniformLocation(x,"uTaps")}},sendUniformData:function(C,x){C.uniform2fv(x.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),C.uniform1fv(x.uTaps,this.taps)},retrieveShader:function(C){var x=this.getFilterWindow(),b=this.type+"_"+x;if(!C.programCache.hasOwnProperty(b)){var E=this.generateShader(x);C.programCache[b]=this.createProgram(C.context,E)}return C.programCache[b]},getFilterWindow:function(){var C=this.tempScale;return Math.ceil(this.lanczosLobes/C)},getTaps:function(){for(var C=this.lanczosCreate(this.lanczosLobes),x=this.tempScale,b=this.getFilterWindow(),E=new Array(b),O=1;O<=b;O++)E[O-1]=C(O*x);return E},generateShader:function(C){for(var x=new Array(C),b=this.fragmentSourceTOP,E=1;E<=C;E++)x[E-1]=E+".0 * uDelta";return b+="uniform float uTaps["+C+`];
`,b+=`void main() {
`,b+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,b+=`  float sum = 1.0;
`,x.forEach(function(O,M){b+="  color += texture2D(uTexture, vTexCoord + "+O+") * uTaps["+M+`];
`,b+="  color += texture2D(uTexture, vTexCoord - "+O+") * uTaps["+M+`];
`,b+="  sum += 2.0 * uTaps["+M+`];
`}),b+=`  gl_FragColor = color / sum;
`,b+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(C){C.webgl?(C.passes++,this.width=C.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=C.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),C.destinationWidth=this.dW,this._setupFrameBuffer(C),this.applyToWebGL(C),this._swapTextures(C),C.sourceWidth=C.destinationWidth,this.height=C.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),C.destinationHeight=this.dH,this._setupFrameBuffer(C),this.applyToWebGL(C),this._swapTextures(C),C.sourceHeight=C.destinationHeight):this.applyTo2d(C)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(C){return function(x){if(x>=C||x<=-C)return 0;if(x<11920929e-14&&x>-11920929e-14)return 1;var b=(x*=Math.PI)/C;return m(x)/x*m(b)/b}},applyTo2d:function(C){var x=C.imageData,b=this.scaleX,E=this.scaleY;this.rcpScaleX=1/b,this.rcpScaleY=1/E;var O,M=x.width,W=x.height,G=h(M*b),Q=h(W*E);this.resizeType==="sliceHack"?O=this.sliceByTwo(C,M,W,G,Q):this.resizeType==="hermite"?O=this.hermiteFastResize(C,M,W,G,Q):this.resizeType==="bilinear"?O=this.bilinearFiltering(C,M,W,G,Q):this.resizeType==="lanczos"&&(O=this.lanczosResize(C,M,W,G,Q)),C.imageData=O},sliceByTwo:function(C,x,b,E,O){var M,W,G=C.imageData,Q=.5,K=!1,Y=!1,N=x*Q,P=b*Q,H=a.filterBackend.resources,q=0,ee=0,U=x,V=0;for(H.sliceByTwo||(H.sliceByTwo=document.createElement("canvas")),((M=H.sliceByTwo).width<1.5*x||M.height<b)&&(M.width=1.5*x,M.height=b),(W=M.getContext("2d")).clearRect(0,0,1.5*x,b),W.putImageData(G,0,0),E=f(E),O=f(O);!K||!Y;)x=N,b=P,E<f(N*Q)?N=f(N*Q):(N=E,K=!0),O<f(P*Q)?P=f(P*Q):(P=O,Y=!0),W.drawImage(M,q,ee,x,b,U,V,N,P),q=U,ee=V,V+=P;return W.getImageData(q,ee,E,O)},lanczosResize:function(C,x,b,E,O){var M=C.imageData.data,W=C.ctx.createImageData(E,O),G=W.data,Q=this.lanczosCreate(this.lanczosLobes),K=this.rcpScaleX,Y=this.rcpScaleY,N=2/this.rcpScaleX,P=2/this.rcpScaleY,H=g(K*this.lanczosLobes/2),q=g(Y*this.lanczosLobes/2),ee={},U={},V={};return function X(te){var Z,re,he,le,se,ue,ce,fe,ve,pe,we;for(U.x=(te+.5)*K,V.x=f(U.x),Z=0;Z<O;Z++){for(U.y=(Z+.5)*Y,V.y=f(U.y),se=0,ue=0,ce=0,fe=0,ve=0,re=V.x-H;re<=V.x+H;re++)if(!(re<0||re>=x)){pe=f(1e3*o(re-U.x)),ee[pe]||(ee[pe]={});for(var Ie=V.y-q;Ie<=V.y+q;Ie++)Ie<0||Ie>=b||(we=f(1e3*o(Ie-U.y)),ee[pe][we]||(ee[pe][we]=Q(r(c(pe*N,2)+c(we*P,2))/1e3)),(he=ee[pe][we])>0&&(se+=he,ue+=he*M[le=4*(Ie*x+re)],ce+=he*M[le+1],fe+=he*M[le+2],ve+=he*M[le+3]))}G[le=4*(Z*E+te)]=ue/se,G[le+1]=ce/se,G[le+2]=fe/se,G[le+3]=ve/se}return++te<E?X(te):W}(0)},bilinearFiltering:function(C,x,b,E,O){var M,W,G,Q,K,Y,N,P,H,q=0,ee=this.rcpScaleX,U=this.rcpScaleY,V=4*(x-1),X=C.imageData.data,te=C.ctx.createImageData(E,O),Z=te.data;for(G=0;G<O;G++)for(Q=0;Q<E;Q++)for(K=ee*Q-(M=f(ee*Q)),Y=U*G-(W=f(U*G)),H=4*(W*x+M),N=0;N<4;N++)P=X[H+N]*(1-K)*(1-Y)+X[H+4+N]*K*(1-Y)+X[H+V+N]*Y*(1-K)+X[H+V+4+N]*K*Y,Z[q++]=P;return te},hermiteFastResize:function(C,x,b,E,O){for(var M=this.rcpScaleX,W=this.rcpScaleY,G=g(M/2),Q=g(W/2),K=C.imageData.data,Y=C.ctx.createImageData(E,O),N=Y.data,P=0;P<O;P++)for(var H=0;H<E;H++){for(var q=4*(H+P*E),ee=0,U=0,V=0,X=0,te=0,Z=0,re=0,he=(P+.5)*W,le=f(P*W);le<(P+1)*W;le++)for(var se=o(he-(le+.5))/Q,ue=(H+.5)*M,ce=se*se,fe=f(H*M);fe<(H+1)*M;fe++){var ve=o(ue-(fe+.5))/G,pe=r(ce+ve*ve);pe>1&&pe<-1||(ee=2*pe*pe*pe-3*pe*pe+1)>0&&(re+=ee*K[3+(ve=4*(fe+le*x))],V+=ee,K[ve+3]<255&&(ee=ee*K[ve+3]/250),X+=ee*K[ve],te+=ee*K[ve+1],Z+=ee*K[ve+2],U+=ee)}N[q]=X/U,N[q+1]=te/U,N[q+2]=Z/U,N[q+3]=re/V}return Y},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),a.Image.filters.Resize.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Contrast=f(c.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var o,h=r.imageData.data,m=h.length,g=Math.floor(255*this.contrast),p=259*(g+255)/(255*(259-g));for(o=0;o<m;o+=4)h[o]=p*(h[o]-128)+128,h[o+1]=p*(h[o+1]-128)+128,h[o+2]=p*(h[o+2]-128)+128}},getUniformLocations:function(r,o){return{uContrast:r.getUniformLocation(o,"uContrast")}},sendUniformData:function(r,o){r.uniform1f(o.uContrast,this.contrast)}}),a.Image.filters.Contrast.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Saturation=f(c.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var o,h,m=r.imageData.data,g=m.length,p=-this.saturation;for(o=0;o<g;o+=4)h=Math.max(m[o],m[o+1],m[o+2]),m[o]+=h!==m[o]?(h-m[o])*p:0,m[o+1]+=h!==m[o+1]?(h-m[o+1])*p:0,m[o+2]+=h!==m[o+2]?(h-m[o+2])*p:0}},getUniformLocations:function(r,o){return{uSaturation:r.getUniformLocation(o,"uSaturation")}},sendUniformData:function(r,o){r.uniform1f(o.uSaturation,-this.saturation)}}),a.Image.filters.Saturation.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Vibrance=f(c.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var o,h,m,g,p=r.imageData.data,v=p.length,C=-this.vibrance;for(o=0;o<v;o+=4)h=Math.max(p[o],p[o+1],p[o+2]),m=(p[o]+p[o+1]+p[o+2])/3,g=2*Math.abs(h-m)/255*C,p[o]+=h!==p[o]?(h-p[o])*g:0,p[o+1]+=h!==p[o+1]?(h-p[o+1])*g:0,p[o+2]+=h!==p[o+2]?(h-p[o+2])*g:0}},getUniformLocations:function(r,o){return{uVibrance:r.getUniformLocation(o,"uVibrance")}},sendUniformData:function(r,o){r.uniform1f(o.uVibrance,-this.vibrance)}}),a.Image.filters.Vibrance.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Blur=f(c.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var o,h,m=r.filterBackend.resources,g=r.imageData.width,p=r.imageData.height;m.blurLayer1||(m.blurLayer1=a.util.createCanvasElement(),m.blurLayer2=a.util.createCanvasElement()),o=m.blurLayer1,h=m.blurLayer2,o.width===g&&o.height===p||(h.width=o.width=g,h.height=o.height=p);var v,C,x,b,E=o.getContext("2d"),O=h.getContext("2d"),M=.06*this.blur*.5;for(E.putImageData(r.imageData,0,0),O.clearRect(0,0,g,p),b=-15;b<=15;b++)x=M*(C=b/15)*g+(v=(Math.random()-.5)/4),O.globalAlpha=1-Math.abs(C),O.drawImage(o,x,v),E.drawImage(h,0,0),O.globalAlpha=1,O.clearRect(0,0,h.width,h.height);for(b=-15;b<=15;b++)x=M*(C=b/15)*p+(v=(Math.random()-.5)/4),O.globalAlpha=1-Math.abs(C),O.drawImage(o,v,x),E.drawImage(h,0,0),O.globalAlpha=1,O.clearRect(0,0,h.width,h.height);r.ctx.drawImage(o,0,0);var W=r.ctx.getImageData(0,0,o.width,o.height);return E.globalAlpha=1,E.clearRect(0,0,o.width,o.height),W},getUniformLocations:function(r,o){return{delta:r.getUniformLocation(o,"uDelta")}},sendUniformData:function(r,o){var h=this.chooseRightDelta();r.uniform2fv(o.delta,h)},chooseRightDelta:function(){var r,o=1,h=[0,0];return this.horizontal?this.aspectRatio>1&&(o=1/this.aspectRatio):this.aspectRatio<1&&(o=this.aspectRatio),r=o*this.blur*.12,this.horizontal?h[0]=r:h[1]=r,h}}),c.Blur.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Gamma=f(c.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],c.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var o,h=r.imageData.data,m=this.gamma,g=h.length,p=1/m[0],v=1/m[1],C=1/m[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),o=0,g=256;o<g;o++)this.rVals[o]=255*Math.pow(o/255,p),this.gVals[o]=255*Math.pow(o/255,v),this.bVals[o]=255*Math.pow(o/255,C);for(o=0,g=h.length;o<g;o+=4)h[o]=this.rVals[h[o]],h[o+1]=this.gVals[h[o+1]],h[o+2]=this.bVals[h[o+2]]},getUniformLocations:function(r,o){return{uGamma:r.getUniformLocation(o,"uGamma")}},sendUniformData:function(r,o){r.uniform3fv(o.uGamma,this.gamma)}}),a.Image.filters.Gamma.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Composed=f(c.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(o){o.applyTo(r)})},toObject:function(){return a.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),a.Image.filters.Composed.fromObject=function(r,o){var h=(r.subFilters||[]).map(function(g){return new a.Image.filters[g.type](g)}),m=new a.Image.filters.Composed({subFilters:h});return o&&o(m),m}}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.HueRotation=f(c.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,o=a.util.cos(r),h=a.util.sin(r),m=1/3,g=Math.sqrt(m)*h,p=1-o;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=o+p/3,this.matrix[1]=m*p-g,this.matrix[2]=m*p+g,this.matrix[5]=m*p+g,this.matrix[6]=o+m*p,this.matrix[7]=m*p-g,this.matrix[10]=m*p-g,this.matrix[11]=m*p+g,this.matrix[12]=o+m*p},isNeutralState:function(r){return this.calculateMatrix(),c.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),c.BaseFilter.prototype.applyTo.call(this,r)}}),a.Image.filters.HueRotation.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.clone;if(a.Text)a.warn("fabric.Text is already defined");else{var f="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:a.Object.prototype.stateProperties.concat(f),cacheProperties:a.Object.prototype.cacheProperties.concat(f),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,o){this.styles=o&&o.styles||{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",o),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=a.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return a._measuringContext||(a._measuringContext=this.canvas&&this.canvas.contextCache||a.util.createCanvasElement().getContext("2d")),a._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,o,h,m,g,p,v,C=0,x=this._textLines.length;C<x;C++)if((this.textAlign==="justify"||C!==x-1&&!this.isEndOfWrapping(C))&&(m=0,g=this._textLines[C],(o=this.getLineWidth(C))<this.width&&(v=this.textLines[C].match(this._reSpacesAndTabs)))){h=v.length,r=(this.width-o)/h;for(var b=0,E=g.length;b<=E;b++)p=this.__charBounds[C][b],this._reSpaceAndTab.test(g[b])?(p.width+=r,p.kernedWidth+=r,p.left+=m,m+=r):p.left+=m}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),o=this.fontSize;return r.width+=o*r.zoomX,r.height+=o*r.zoomY,r},_render:function(r){var o=this.path;o&&!o.isNotVisible()&&o._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,o,h){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom"}r.font=this._getFontDeclaration(o,h)},calcTextWidth:function(){for(var r=this.getLineWidth(0),o=1,h=this._textLines.length;o<h;o++){var m=this.getLineWidth(o);m>r&&(r=m)}return r},_renderTextLine:function(r,o,h,m,g,p){this._renderChars(r,o,h,m,g,p)},_renderTextLinesBackground:function(r){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var o,h,m,g,p,v,C,x=r.fillStyle,b=this._getLeftOffset(),E=this._getTopOffset(),O=0,M=0,W=this.path,G=0,Q=this._textLines.length;G<Q;G++)if(o=this.getHeightOfLine(G),this.textBackgroundColor||this.styleHas("textBackgroundColor",G)){m=this._textLines[G],h=this._getLineLeftOffset(G),M=0,O=0,g=this.getValueOfPropertyAt(G,0,"textBackgroundColor");for(var K=0,Y=m.length;K<Y;K++)p=this.__charBounds[G][K],v=this.getValueOfPropertyAt(G,K,"textBackgroundColor"),W?(r.save(),r.translate(p.renderLeft,p.renderTop),r.rotate(p.angle),r.fillStyle=v,v&&r.fillRect(-p.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),p.width,o/this.lineHeight),r.restore()):v!==g?(C=b+h+O,this.direction==="rtl"&&(C=this.width-C-M),r.fillStyle=g,g&&r.fillRect(C,E,M,o/this.lineHeight),O=p.left,M=p.width,g=v):M+=p.kernedWidth;v&&!W&&(C=b+h+O,this.direction==="rtl"&&(C=this.width-C-M),r.fillStyle=v,r.fillRect(C,E,M,o/this.lineHeight)),E+=o}else E+=o;r.fillStyle=x,this._removeShadow(r)}},getFontCache:function(r){var o=r.fontFamily.toLowerCase();a.charWidthsCache[o]||(a.charWidthsCache[o]={});var h=a.charWidthsCache[o],m=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return h[m]||(h[m]={}),h[m]},_measureChar:function(r,o,h,m){var g,p,v,C,x=this.getFontCache(o),b=h+r,E=this._getFontDeclaration(o)===this._getFontDeclaration(m),O=o.fontSize/this.CACHE_FONT_SIZE;if(h&&x[h]!==void 0&&(v=x[h]),x[r]!==void 0&&(C=g=x[r]),E&&x[b]!==void 0&&(C=(p=x[b])-v),g===void 0||v===void 0||p===void 0){var M=this.getMeasuringContext();this._setTextStyles(M,o,!0)}return g===void 0&&(C=g=M.measureText(r).width,x[r]=g),v===void 0&&E&&h&&(v=M.measureText(h).width,x[h]=v),E&&p===void 0&&(p=M.measureText(b).width,x[b]=p,C=p-v),{width:g*O,kernedWidth:C*O}},getHeightOfChar:function(r,o){return this.getValueOfPropertyAt(r,o,"fontSize")},measureLine:function(r){var o=this._measureLine(r);return this.charSpacing!==0&&(o.width-=this._getWidthOfCharSpacing()),o.width<0&&(o.width=0),o},_measureLine:function(r){var o,h,m,g,p,v,C=0,x=this._textLines[r],b=new Array(x.length),E=0,O=this.path,M=this.pathSide==="right";for(this.__charBounds[r]=b,o=0;o<x.length;o++)h=x[o],g=this._getGraphemeBox(h,r,o,m),b[o]=g,C+=g.kernedWidth,m=h;if(b[o]={left:g?g.left+g.width:0,width:0,kernedWidth:0,height:this.fontSize},O){switch(v=O.segmentsInfo[O.segmentsInfo.length-1].length,(p=a.util.getPointOnPath(O.path,0,O.segmentsInfo)).x+=O.pathOffset.x,p.y+=O.pathOffset.y,this.textAlign){case"left":E=M?v-C:0;break;case"center":E=(v-C)/2;break;case"right":E=M?0:v-C}for(E+=this.pathStartOffset*(M?-1:1),o=M?x.length-1:0;M?o>=0:o<x.length;M?o--:o++)g=b[o],E>v?E%=v:E<0&&(E+=v),this._setGraphemeOnPath(E,g,p),E+=g.kernedWidth}return{width:C,numOfSpaces:0}},_setGraphemeOnPath:function(r,o,h){var m=r+o.kernedWidth/2,g=this.path,p=a.util.getPointOnPath(g.path,m,g.segmentsInfo);o.renderLeft=p.x-h.x,o.renderTop=p.y-h.y,o.angle=p.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,o,h,m,g){var p,v=this.getCompleteStyleDeclaration(o,h),C=m?this.getCompleteStyleDeclaration(o,h-1):{},x=this._measureChar(r,v,m,C),b=x.kernedWidth,E=x.width;this.charSpacing!==0&&(E+=p=this._getWidthOfCharSpacing(),b+=p);var O={width:E,left:0,height:v.fontSize,kernedWidth:b,deltaY:v.deltaY};if(h>0&&!g){var M=this.__charBounds[o][h-1];O.left=M.left+M.width+x.kernedWidth-x.width}return O},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var o=this._textLines[r],h=this.getHeightOfChar(r,0),m=1,g=o.length;m<g;m++)h=Math.max(this.getHeightOfChar(r,m),h);return this.__lineHeights[r]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,o=0,h=0,m=this._textLines.length;h<m;h++)r=this.getHeightOfLine(h),o+=h===m-1?r/this.lineHeight:r;return o},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,o){r.save();for(var h=0,m=this._getLeftOffset(),g=this._getTopOffset(),p=0,v=this._textLines.length;p<v;p++){var C=this.getHeightOfLine(p),x=C/this.lineHeight,b=this._getLineLeftOffset(p);this._renderTextLine(o,r,this._textLines[p],m+b,g+h+x,p),h+=C}r.restore()},_renderTextFill:function(r){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,o,h,m,g,p){var v,C,x,b,E,O=this.getHeightOfLine(p),M=this.textAlign.indexOf("justify")!==-1,W="",G=0,Q=this.path,K=!M&&this.charSpacing===0&&this.isEmptyStyles(p)&&!Q,Y=this.direction==="ltr",N=this.direction==="ltr"?1:-1,P=o.canvas.getAttribute("dir");if(o.save(),P!==this.direction&&(o.canvas.setAttribute("dir",Y?"ltr":"rtl"),o.direction=Y?"ltr":"rtl",o.textAlign=Y?"left":"right"),g-=O*this._fontSizeFraction/this.lineHeight,K)return this._renderChar(r,o,p,0,h.join(""),m,g,O),void o.restore();for(var H=0,q=h.length-1;H<=q;H++)b=H===q||this.charSpacing||Q,W+=h[H],x=this.__charBounds[p][H],G===0?(m+=N*(x.kernedWidth-x.width),G+=x.width):G+=x.kernedWidth,M&&!b&&this._reSpaceAndTab.test(h[H])&&(b=!0),b||(v=v||this.getCompleteStyleDeclaration(p,H),C=this.getCompleteStyleDeclaration(p,H+1),b=this._hasStyleChanged(v,C)),b&&(Q?(o.save(),o.translate(x.renderLeft,x.renderTop),o.rotate(x.angle),this._renderChar(r,o,p,H,W,-G/2,0,O),o.restore()):(E=m,this._renderChar(r,o,p,H,W,E,g,O)),W="",v=C,m+=N*G,G=0);o.restore()},_applyPatternGradientTransformText:function(r){var o,h=a.util.createCanvasElement(),m=this.width+this.strokeWidth,g=this.height+this.strokeWidth;return h.width=m,h.height=g,(o=h.getContext("2d")).beginPath(),o.moveTo(0,0),o.lineTo(m,0),o.lineTo(m,g),o.lineTo(0,g),o.closePath(),o.translate(m/2,g/2),o.fillStyle=r.toLive(o),this._applyPatternGradientTransform(o,r),o.fill(),o.createPattern(h,"no-repeat")},handleFiller:function(r,o,h){var m,g;return h.toLive?h.gradientUnits==="percentage"||h.gradientTransform||h.patternTransform?(m=-this.width/2,g=-this.height/2,r.translate(m,g),r[o]=this._applyPatternGradientTransformText(h),{offsetX:m,offsetY:g}):(r[o]=h.toLive(r,this),this._applyPatternGradientTransform(r,h)):(r[o]=h,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,o){return r.lineWidth=o.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",o.stroke)},_setFillStyles:function(r,o){return this.handleFiller(r,"fillStyle",o.fill)},_renderChar:function(r,o,h,m,g,p,v){var C,x,b=this._getStyleDeclaration(h,m),E=this.getCompleteStyleDeclaration(h,m),O=r==="fillText"&&E.fill,M=r==="strokeText"&&E.stroke&&E.strokeWidth;(M||O)&&(o.save(),O&&(C=this._setFillStyles(o,E)),M&&(x=this._setStrokeStyles(o,E)),o.font=this._getFontDeclaration(E),b&&b.textBackgroundColor&&this._removeShadow(o),b&&b.deltaY&&(v+=b.deltaY),O&&o.fillText(g,p-C.offsetX,v-C.offsetY),M&&o.strokeText(g,p-x.offsetX,v-x.offsetY),o.restore())},setSuperscript:function(r,o){return this._setScript(r,o,this.superscript)},setSubscript:function(r,o){return this._setScript(r,o,this.subscript)},_setScript:function(r,o,h){var m=this.get2DCursorLocation(r,!0),g=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"fontSize"),p=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"deltaY"),v={fontSize:g*h.size,deltaY:p+g*h.baseline};return this.setSelectionStyles(v,r,o),this},_hasStyleChanged:function(r,o){return r.fill!==o.fill||r.stroke!==o.stroke||r.strokeWidth!==o.strokeWidth||r.fontSize!==o.fontSize||r.fontFamily!==o.fontFamily||r.fontWeight!==o.fontWeight||r.fontStyle!==o.fontStyle||r.deltaY!==o.deltaY},_hasStyleChangedForSvg:function(r,o){return this._hasStyleChanged(r,o)||r.overline!==o.overline||r.underline!==o.underline||r.linethrough!==o.linethrough},_getLineLeftOffset:function(r){var o=this.getLineWidth(r),h=this.width-o,m=this.textAlign,g=this.direction,p=0,v=this.isEndOfWrapping(r);return m==="justify"||m==="justify-center"&&!v||m==="justify-right"&&!v||m==="justify-left"&&!v?0:(m==="center"&&(p=h/2),m==="right"&&(p=h),m==="justify-center"&&(p=h/2),m==="justify-right"&&(p=h),g==="rtl"&&(p-=h),p)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var o=this.measureLine(r).width;return this.__lineWidths[r]=o,o},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,o,h){var m=this._getStyleDeclaration(r,o);return m&&m[h]!==void 0?m[h]:this[h]},_renderTextDecoration:function(r,o){if(this[o]||this.styleHas(o)){for(var h,m,g,p,v,C,x,b,E,O,M,W,G,Q,K,Y,N=this._getLeftOffset(),P=this._getTopOffset(),H=this.path,q=this._getWidthOfCharSpacing(),ee=this.offsets[o],U=0,V=this._textLines.length;U<V;U++)if(h=this.getHeightOfLine(U),this[o]||this.styleHas(o,U)){x=this._textLines[U],Q=h/this.lineHeight,p=this._getLineLeftOffset(U),O=0,M=0,b=this.getValueOfPropertyAt(U,0,o),Y=this.getValueOfPropertyAt(U,0,"fill"),E=P+Q*(1-this._fontSizeFraction),m=this.getHeightOfChar(U,0),v=this.getValueOfPropertyAt(U,0,"deltaY");for(var X=0,te=x.length;X<te;X++)if(W=this.__charBounds[U][X],G=this.getValueOfPropertyAt(U,X,o),K=this.getValueOfPropertyAt(U,X,"fill"),g=this.getHeightOfChar(U,X),C=this.getValueOfPropertyAt(U,X,"deltaY"),H&&G&&K)r.save(),r.fillStyle=Y,r.translate(W.renderLeft,W.renderTop),r.rotate(W.angle),r.fillRect(-W.kernedWidth/2,ee*g+C,W.kernedWidth,this.fontSize/15),r.restore();else if((G!==b||K!==Y||g!==m||C!==v)&&M>0){var Z=N+p+O;this.direction==="rtl"&&(Z=this.width-Z-M),b&&Y&&(r.fillStyle=Y,r.fillRect(Z,E+ee*m+v,M,this.fontSize/15)),O=W.left,M=W.width,b=G,Y=K,m=g,v=C}else M+=W.kernedWidth;Z=N+p+O,this.direction==="rtl"&&(Z=this.width-Z-M),r.fillStyle=K,G&&K&&r.fillRect(Z,E+ee*m+v,M-q,this.fontSize/15),P+=h}else P+=h;this._removeShadow(r)}},_getFontDeclaration:function(r,o){var h=r||this,m=this.fontFamily,g=a.Text.genericFonts.indexOf(m.toLowerCase())>-1,p=m===void 0||m.indexOf("'")>-1||m.indexOf(",")>-1||m.indexOf('"')>-1||g?h.fontFamily:'"'+h.fontFamily+'"';return[a.isLikelyNode?h.fontWeight:h.fontStyle,a.isLikelyNode?h.fontStyle:h.fontWeight,o?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",p].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var o=r.split(this._reNewline),h=new Array(o.length),m=[`
`],g=[],p=0;p<o.length;p++)h[p]=a.util.string.graphemeSplit(o[p]),g=g.concat(h[p],m);return g.pop(),{_unwrappedLines:h,lines:o,graphemeText:g,graphemeLines:h}},toObject:function(r){var o=f.concat(r),h=this.callSuper("toObject",o);return h.styles=c(this.styles,!0),h.path&&(h.path=this.path.toObject()),h},set:function(r,o){this.callSuper("set",r,o);var h=!1,m=!1;if(typeof r=="object")for(var g in r)g==="path"&&this.setPathInfo(),h=h||this._dimensionAffectingProps.indexOf(g)!==-1,m=m||g==="path";else h=this._dimensionAffectingProps.indexOf(r)!==-1,m=r==="path";return m&&this.setPathInfo(),h&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(r,o,h){if(!r)return o(null);var m=a.parseAttributes(r,a.Text.ATTRIBUTE_NAMES),g=m.textAnchor||"left";if((h=a.util.object.extend(h?c(h):{},m)).top=h.top||0,h.left=h.left||0,m.textDecoration){var p=m.textDecoration;p.indexOf("underline")!==-1&&(h.underline=!0),p.indexOf("overline")!==-1&&(h.overline=!0),p.indexOf("line-through")!==-1&&(h.linethrough=!0),delete h.textDecoration}"dx"in m&&(h.left+=m.dx),"dy"in m&&(h.top+=m.dy),"fontSize"in h||(h.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in r?v=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(v=r.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var C=h.strokeWidth;h.strokeWidth=0;var x=new a.Text(v,h),b=x.getScaledHeight()/x.height,E=((x.height+x.strokeWidth)*x.lineHeight-x.height)*b,O=x.getScaledHeight()+E,M=0;g==="center"&&(M=x.getScaledWidth()/2),g==="right"&&(M=x.getScaledWidth()),x.set({left:x.left-M,top:x.top-(O-x.fontSize*(.07+x._fontSizeFraction))/x.lineHeight,strokeWidth:C!==void 0?C:1}),o(x)},a.Text.fromObject=function(r,o){var h=c(r),m=r.path;return delete h.path,a.Object._fromObject("Text",h,function(g){m?a.Object._fromObject("Path",m,function(p){g.set("path",p),o(g)},"path"):o(g)},"text")},a.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],a.util.createAccessors&&a.util.createAccessors(a.Text)}}(e),y.util.object.extend(y.Text.prototype,{isEmptyStyles:function(u){if(!this.styles||u!==void 0&&!this.styles[u])return!0;var a=u===void 0?this.styles:{line:this.styles[u]};for(var c in a)for(var f in a[c])for(var r in a[c][f])return!1;return!0},styleHas:function(u,a){if(!this.styles||!u||u===""||a!==void 0&&!this.styles[a])return!1;var c=a===void 0?this.styles:{0:this.styles[a]};for(var f in c)for(var r in c[f])if(c[f][r][u]!==void 0)return!0;return!1},cleanStyle:function(u){if(!this.styles||!u||u==="")return!1;var a,c,f=this.styles,r=0,o=!0,h=0;for(var m in f){for(var g in a=0,f[m]){var p;r++,(p=f[m][g]).hasOwnProperty(u)?(c?p[u]!==c&&(o=!1):c=p[u],p[u]===this[u]&&delete p[u]):o=!1,Object.keys(p).length!==0?a++:delete f[m][g]}a===0&&delete f[m]}for(var v=0;v<this._textLines.length;v++)h+=this._textLines[v].length;o&&r===h&&(this[u]=c,this.removeStyle(u))},removeStyle:function(u){if(this.styles&&u&&u!==""){var a,c,f,r=this.styles;for(c in r){for(f in a=r[c])delete a[f][u],Object.keys(a[f]).length===0&&delete a[f];Object.keys(a).length===0&&delete r[c]}}},_extendStyles:function(u,a){var c=this.get2DCursorLocation(u);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex),this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{}),y.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),a)},get2DCursorLocation:function(u,a){u===void 0&&(u=this.selectionStart);for(var c=a?this._unwrappedTextLines:this._textLines,f=c.length,r=0;r<f;r++){if(u<=c[r].length)return{lineIndex:r,charIndex:u};u-=c[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:c[r-1].length<u?c[r-1].length:u}},getSelectionStyles:function(u,a,c){u===void 0&&(u=this.selectionStart||0),a===void 0&&(a=this.selectionEnd||u);for(var f=[],r=u;r<a;r++)f.push(this.getStyleAtPosition(r,c));return f},getStyleAtPosition:function(u,a){var c=this.get2DCursorLocation(u);return(a?this.getCompleteStyleDeclaration(c.lineIndex,c.charIndex):this._getStyleDeclaration(c.lineIndex,c.charIndex))||{}},setSelectionStyles:function(u,a,c){a===void 0&&(a=this.selectionStart||0),c===void 0&&(c=this.selectionEnd||a);for(var f=a;f<c;f++)this._extendStyles(f,u);return this._forceClearCache=!0,this},_getStyleDeclaration:function(u,a){var c=this.styles&&this.styles[u];return c?c[a]:null},getCompleteStyleDeclaration:function(u,a){for(var c,f=this._getStyleDeclaration(u,a)||{},r={},o=0;o<this._styleProperties.length;o++)r[c=this._styleProperties[o]]=f[c]===void 0?this[c]:f[c];return r},_setStyleDeclaration:function(u,a,c){this.styles[u][a]=c},_deleteStyleDeclaration:function(u,a){delete this.styles[u][a]},_getLineStyle:function(u){return!!this.styles[u]},_setLineStyle:function(u){this.styles[u]={}},_deleteLineStyle:function(u){delete this.styles[u]}}),function(){function u(a){a.textDecoration&&(a.textDecoration.indexOf("underline")>-1&&(a.underline=!0),a.textDecoration.indexOf("line-through")>-1&&(a.linethrough=!0),a.textDecoration.indexOf("overline")>-1&&(a.overline=!0),delete a.textDecoration)}y.IText=y.util.createClass(y.Text,y.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(a,c){this.callSuper("initialize",a,c),this.initBehavior()},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,c){this[a]!==c&&(this._fireSelectionChanged(),this[a]=c),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(a){this.clearContextTop(),this.callSuper("render",a),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a)},clearContextTop:function(a){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var c=this.canvas.contextTop,f=this.canvas.viewportTransform;c.save(),c.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this.transform(c),this._clearTextArea(c),a||c.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this._getCursorBoundaries(),c=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(a,c):this.renderSelection(a,c),c.restore()}},_clearTextArea:function(a){var c=this.width+4,f=this.height+4;a.clearRect(-c/2,-f/2,c,f)},_getCursorBoundaries:function(a){a===void 0&&(a=this.selectionStart);var c=this._getLeftOffset(),f=this._getTopOffset(),r=this._getCursorBoundariesOffsets(a);return{left:c,top:f,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(a){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var c,f,r,o,h=0,m=0,g=this.get2DCursorLocation(a);r=g.charIndex,f=g.lineIndex;for(var p=0;p<f;p++)h+=this.getHeightOfLine(p);c=this._getLineLeftOffset(f);var v=this.__charBounds[f][r];return v&&(m=v.left),this.charSpacing!==0&&r===this._textLines[f].length&&(m-=this._getWidthOfCharSpacing()),o={top:h,left:c+(m>0?m:0)},this.direction==="rtl"&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(a,c){var f=this.get2DCursorLocation(),r=f.lineIndex,o=f.charIndex>0?f.charIndex-1:0,h=this.getValueOfPropertyAt(r,o,"fontSize"),m=this.scaleX*this.canvas.getZoom(),g=this.cursorWidth/m,p=a.topOffset,v=this.getValueOfPropertyAt(r,o,"deltaY");p+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-h*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(a,c),c.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,o,"fill"),c.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,c.fillRect(a.left+a.leftOffset-g/2,p+a.top+v,g,h)},renderSelection:function(a,c){for(var f=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,o=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(f),m=this.get2DCursorLocation(r),g=h.lineIndex,p=m.lineIndex,v=h.charIndex<0?0:h.charIndex,C=m.charIndex<0?0:m.charIndex,x=g;x<=p;x++){var b,E=this._getLineLeftOffset(x)||0,O=this.getHeightOfLine(x),M=0,W=0;if(x===g&&(M=this.__charBounds[g][v].left),x>=g&&x<p)W=o&&!this.isEndOfWrapping(x)?this.width:this.getLineWidth(x)||5;else if(x===p)if(C===0)W=this.__charBounds[p][C].left;else{var G=this._getWidthOfCharSpacing();W=this.__charBounds[p][C-1].left+this.__charBounds[p][C-1].width-G}b=O,(this.lineHeight<1||x===p&&this.lineHeight>1)&&(O/=this.lineHeight);var Q=a.left+E+M,K=W-M,Y=O,N=0;this.inCompositionMode?(c.fillStyle=this.compositionColor||"black",Y=1,N=O):c.fillStyle=this.selectionColor,this.direction==="rtl"&&(Q=this.width-Q-K),c.fillRect(Q,a.top+a.topOffset+N,K,Y),a.topOffset+=b}},getCurrentCharFontSize:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")},getCurrentCharColor:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fill")},_getCurrentCharIndex:function(){var a=this.get2DCursorLocation(this.selectionStart,!0),c=a.charIndex>0?a.charIndex-1:0;return{l:a.lineIndex,c}}}),y.IText.fromObject=function(a,c){if(u(a),a.styles)for(var f in a.styles)for(var r in a.styles[f])u(a.styles[f][r]);y.Object._fromObject("IText",a,c,"text")}}(),J=y.util.object.clone,y.util.object.extend(y.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var u=this;this.on("added",function(){var a=u.canvas;a&&(a._hasITextHandlers||(a._hasITextHandlers=!0,u._initCanvasHandlers(a)),a._iTextInstances=a._iTextInstances||[],a._iTextInstances.push(u))})},initRemovedHandler:function(){var u=this;this.on("removed",function(){var a=u.canvas;a&&(a._iTextInstances=a._iTextInstances||[],y.util.removeFromArray(a._iTextInstances,u),a._iTextInstances.length===0&&(a._hasITextHandlers=!1,u._removeCanvasHandlers(a)))})},_initCanvasHandlers:function(u){u._mouseUpITextHandler=function(){u._iTextInstances&&u._iTextInstances.forEach(function(a){a.__isMousedown=!1})},u.on("mouse:up",u._mouseUpITextHandler)},_removeCanvasHandlers:function(u){u.off("mouse:up",u._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(u,a,c,f){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},u.animate("_currentCursorOpacity",a,{duration:c,onComplete:function(){r.isAborted||u[f]()},onChange:function(){u.canvas&&u.selectionStart===u.selectionEnd&&u.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var u=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){u._currentTickCompleteState=u._animateCursor(u,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(u){var a=this,c=u?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){a._tick()},c)},abortCursorAnimation:function(){var u=this._currentTickState||this._currentTickCompleteState,a=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,u&&a&&a.clearContext(a.contextTop||a.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(u){var a=0,c=u-1;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)a++,c--;for(;/\S/.test(this._text[c])&&c>-1;)a++,c--;return u-a},findWordBoundaryRight:function(u){var a=0,c=u;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)a++,c++;for(;/\S/.test(this._text[c])&&c<this._text.length;)a++,c++;return u+a},findLineBoundaryLeft:function(u){for(var a=0,c=u-1;!/\n/.test(this._text[c])&&c>-1;)a++,c--;return u-a},findLineBoundaryRight:function(u){for(var a=0,c=u;!/\n/.test(this._text[c])&&c<this._text.length;)a++,c++;return u+a},searchWordBoundary:function(u,a){for(var c=this._text,f=this._reSpace.test(c[u])?u-1:u,r=c[f],o=y.reNonWord;!o.test(r)&&f>0&&f<c.length;)r=c[f+=a];return o.test(r)&&(f+=a===1?0:1),f},selectWord:function(u){u=u||this.selectionStart;var a=this.searchWordBoundary(u,-1),c=this.searchWordBoundary(u,1);this.selectionStart=a,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(u){u=u||this.selectionStart;var a=this.findLineBoundaryLeft(u),c=this.findLineBoundaryRight(u);return this.selectionStart=a,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(u){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(u),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(u){u._iTextInstances&&u._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(u){if(this.__isMousedown&&this.isEditing){var a=this.getSelectionStartFromPointer(u.e),c=this.selectionStart,f=this.selectionEnd;(a===this.__selectionStartOnMouseDown&&c!==f||c!==a&&f!==a)&&(a>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=a):(this.selectionStart=a,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===c&&this.selectionEnd===f||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(u,a,c){var f=c.slice(0,u),r=y.util.string.graphemeSplit(f).length;if(u===a)return{selectionStart:r,selectionEnd:r};var o=c.slice(u,a);return{selectionStart:r,selectionEnd:r+y.util.string.graphemeSplit(o).length}},fromGraphemeToStringSelection:function(u,a,c){var f=c.slice(0,u).join("").length;return u===a?{selectionStart:f,selectionEnd:f}:{selectionStart:f,selectionEnd:f+c.slice(u,a).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var u=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=u.selectionStart,this.hiddenTextarea.selectionEnd=u.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var u=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=u.selectionEnd,this.inCompositionMode||(this.selectionStart=u.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var u=this._calcTextareaPosition();this.hiddenTextarea.style.left=u.left,this.hiddenTextarea.style.top=u.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var u=this.inCompositionMode?this.compositionStart:this.selectionStart,a=this._getCursorBoundaries(u),c=this.get2DCursorLocation(u),f=c.lineIndex,r=c.charIndex,o=this.getValueOfPropertyAt(f,r,"fontSize")*this.lineHeight,h=a.leftOffset,m=this.calcTransformMatrix(),g={x:a.left+h,y:a.top+a.topOffset+o},p=this.canvas.getRetinaScaling(),v=this.canvas.upperCanvasEl,C=v.width/p,x=v.height/p,b=C-o,E=x-o,O=v.clientWidth/C,M=v.clientHeight/x;return g=y.util.transformPoint(g,m),(g=y.util.transformPoint(g,this.canvas.viewportTransform)).x*=O,g.y*=M,g.x<0&&(g.x=0),g.x>b&&(g.x=b),g.y<0&&(g.y=0),g.y>E&&(g.y=E),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:g.x+"px",top:g.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var u=this._textBeforeEdit!==this.text,a=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),u&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),u&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var u in this.styles)this._textLines[u]||delete this.styles[u]},removeStyleFromTo:function(u,a){var c,f,r=this.get2DCursorLocation(u,!0),o=this.get2DCursorLocation(a,!0),h=r.lineIndex,m=r.charIndex,g=o.lineIndex,p=o.charIndex;if(h!==g){if(this.styles[h])for(c=m;c<this._unwrappedTextLines[h].length;c++)delete this.styles[h][c];if(this.styles[g])for(c=p;c<this._unwrappedTextLines[g].length;c++)(f=this.styles[g][c])&&(this.styles[h]||(this.styles[h]={}),this.styles[h][m+c-p]=f);for(c=h+1;c<=g;c++)delete this.styles[c];this.shiftLineStyles(g,h-g)}else if(this.styles[h]){f=this.styles[h];var v,C,x=p-m;for(c=m;c<p;c++)delete f[c];for(C in this.styles[h])(v=parseInt(C,10))>=p&&(f[v-x]=f[C],delete f[C])}},shiftLineStyles:function(u,a){var c=J(this.styles);for(var f in this.styles){var r=parseInt(f,10);r>u&&(this.styles[r+a]=c[r],c[r-a]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(u,a,c,f){var r,o={},h=!1,m=this._unwrappedTextLines[u].length===a;for(var g in c||(c=1),this.shiftLineStyles(u,c),this.styles[u]&&(r=this.styles[u][a===0?a:a-1]),this.styles[u]){var p=parseInt(g,10);p>=a&&(h=!0,o[p-a]=this.styles[u][g],m&&a===0||delete this.styles[u][g])}var v=!1;for(h&&!m&&(this.styles[u+c]=o,v=!0),v&&c--;c>0;)f&&f[c-1]?this.styles[u+c]={0:J(f[c-1])}:r?this.styles[u+c]={0:J(r)}:delete this.styles[u+c],c--;this._forceClearCache=!0},insertCharStyleObject:function(u,a,c,f){this.styles||(this.styles={});var r=this.styles[u],o=r?J(r):{};for(var h in c||(c=1),o){var m=parseInt(h,10);m>=a&&(r[m+c]=o[m],o[m-c]||delete r[m])}if(this._forceClearCache=!0,f)for(;c--;)Object.keys(f[c]).length&&(this.styles[u]||(this.styles[u]={}),this.styles[u][a+c]=J(f[c]));else if(r)for(var g=r[a?a-1:1];g&&c--;)this.styles[u][a+c]=J(g)},insertNewStyleBlock:function(u,a,c){for(var f=this.get2DCursorLocation(a,!0),r=[0],o=0,h=0;h<u.length;h++)u[h]===`
`?r[++o]=0:r[o]++;for(r[0]>0&&(this.insertCharStyleObject(f.lineIndex,f.charIndex,r[0],c),c=c&&c.slice(r[0]+1)),o&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+r[0],o),h=1;h<o;h++)r[h]>0?this.insertCharStyleObject(f.lineIndex+h,0,r[h],c):c&&this.styles[f.lineIndex+h]&&c[0]&&(this.styles[f.lineIndex+h][0]=c[0]),c=c&&c.slice(r[h]+1);r[h]>0&&this.insertCharStyleObject(f.lineIndex+h,0,r[h],c)},setSelectionStartEndWithShift:function(u,a,c){c<=u?(a===u?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=u),this.selectionStart=c):c>u&&c<a?this._selectionDirection==="right"?this.selectionEnd=c:this.selectionStart=c:(a===u?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=a),this.selectionEnd=c)},setSelectionInBoundaries:function(){var u=this.text.length;this.selectionStart>u?this.selectionStart=u:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>u?this.selectionEnd=u:this.selectionEnd<0&&(this.selectionEnd=0)}}),y.util.object.extend(y.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(u){if(this.canvas){this.__newClickTime=+new Date;var a=u.pointer;this.isTripleClick(a)&&(this.fire("tripleclick",u),this._stopEvent(u.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=a,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(u){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===u.x&&this.__lastPointer.y===u.y},_stopEvent:function(u){u.preventDefault&&u.preventDefault(),u.stopPropagation&&u.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(u){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(u.e))},tripleClickHandler:function(u){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(u.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(u.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(u){if(this.__isMousedown=!1,!(!this.editable||this.group||u.transform&&u.transform.actionPerformed||u.e.button&&u.e.button!==1)){if(this.canvas){var a=this.canvas._activeObject;if(a&&a!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(u.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(u){var a=this.getSelectionStartFromPointer(u),c=this.selectionStart,f=this.selectionEnd;u.shiftKey?this.setSelectionStartEndWithShift(c,f,a):(this.selectionStart=a,this.selectionEnd=a),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(u){for(var a,c=this.getLocalPointer(u),f=0,r=0,o=0,h=0,m=0,g=0,p=this._textLines.length;g<p&&o<=c.y;g++)o+=this.getHeightOfLine(g)*this.scaleY,m=g,g>0&&(h+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));r=this._getLineLeftOffset(m)*this.scaleX,a=this._textLines[m],this.direction==="rtl"&&(c.x=this.width*this.scaleX-c.x+r);for(var v=0,C=a.length;v<C&&(f=r,(r+=this.__charBounds[m][v].kernedWidth*this.scaleX)<=c.x);v++)h++;return this._getNewSelectionStartFromOffset(c,f,r,h,C)},_getNewSelectionStartFromOffset:function(u,a,c,f,r){var o=u.x-a,h=c-u.x,m=f+(h>o||h<0?0:1);return this.flipX&&(m=r-m),m>this._text.length&&(m=this._text.length),m}}),y.util.object.extend(y.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=y.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var u=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+u.top+"; left: "+u.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingtop: "+u.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):y.document.body.appendChild(this.hiddenTextarea),y.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),y.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),y.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),y.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(y.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(u){if(this.isEditing){var a=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(u.keyCode in a)this[a[u.keyCode]](u);else{if(!(u.keyCode in this.ctrlKeysMapDown)||!u.ctrlKey&&!u.metaKey)return;this[this.ctrlKeysMapDown[u.keyCode]](u)}u.stopImmediatePropagation(),u.preventDefault(),u.keyCode>=33&&u.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(u){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:u.keyCode in this.ctrlKeysMapUp&&(u.ctrlKey||u.metaKey)&&(this[this.ctrlKeysMapUp[u.keyCode]](u),u.stopImmediatePropagation(),u.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(u){var a=this.fromPaste;if(this.fromPaste=!1,u&&u.stopPropagation(),this.isEditing){var c,f,r,o,h,m=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,g=this._text.length,p=m.length,v=p-g,C=this.selectionStart,x=this.selectionEnd,b=C!==x;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var E=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),O=C>E.selectionStart;b?(c=this._text.slice(C,x),v+=x-C):p<g&&(c=O?this._text.slice(x+v,x):this._text.slice(C,C-v)),f=m.slice(E.selectionEnd-v,E.selectionEnd),c&&c.length&&(f.length&&(r=this.getSelectionStyles(C,C+1,!1),r=f.map(function(){return r[0]})),b?(o=C,h=x):O?(o=x-c.length,h=x):(o=x,h=x+c.length),this.removeStyleFromTo(o,h)),f.length&&(a&&f.join("")===y.copiedText&&!y.disableStyleCopyPaste&&(r=y.copiedTextStyle),this.insertNewStyleBlock(f,C,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(u){this.compositionStart=u.target.selectionStart,this.compositionEnd=u.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(y.copiedText=this.getSelectedText(),y.disableStyleCopyPaste?y.copiedTextStyle=null:y.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(u){return u&&u.clipboardData||y.window.clipboardData},_getWidthBeforeCursor:function(u,a){var c,f=this._getLineLeftOffset(u);return a>0&&(f+=(c=this.__charBounds[u][a-1]).left+c.width),f},getDownCursorOffset:function(u,a){var c=this._getSelectionForOffset(u,a),f=this.get2DCursorLocation(c),r=f.lineIndex;if(r===this._textLines.length-1||u.metaKey||u.keyCode===34)return this._text.length-c;var o=f.charIndex,h=this._getWidthBeforeCursor(r,o),m=this._getIndexOnLine(r+1,h);return this._textLines[r].slice(o).length+m+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(u,a){return u.shiftKey&&this.selectionStart!==this.selectionEnd&&a?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(u,a){var c=this._getSelectionForOffset(u,a),f=this.get2DCursorLocation(c),r=f.lineIndex;if(r===0||u.metaKey||u.keyCode===33)return-c;var o=f.charIndex,h=this._getWidthBeforeCursor(r,o),m=this._getIndexOnLine(r-1,h),g=this._textLines[r].slice(0,o),p=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+m-g.length+(1-p)},_getIndexOnLine:function(u,a){for(var c,f,r=this._textLines[u],o=this._getLineLeftOffset(u),h=0,m=0,g=r.length;m<g;m++)if((o+=c=this.__charBounds[u][m].width)>a){f=!0;var p=o-c,v=o,C=Math.abs(p-a);h=Math.abs(v-a)<C?m:m-1;break}return f||(h=r.length-1),h},moveCursorDown:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",u)},moveCursorUp:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",u)},_moveCursorUpOrDown:function(u,a){var c=this["get"+u+"CursorOffset"](a,this._selectionDirection==="right");a.shiftKey?this.moveCursorWithShift(c):this.moveCursorWithoutShift(c),c!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(u){var a=this._selectionDirection==="left"?this.selectionStart+u:this.selectionEnd+u;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a),u!==0},moveCursorWithoutShift:function(u){return u<0?(this.selectionStart+=u,this.selectionEnd=this.selectionStart):(this.selectionEnd+=u,this.selectionStart=this.selectionEnd),u!==0},moveCursorLeft:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",u)},_move:function(u,a,c){var f;if(u.altKey)f=this["findWordBoundary"+c](this[a]);else{if(!u.metaKey&&u.keyCode!==35&&u.keyCode!==36)return this[a]+=c==="Left"?-1:1,!0;f=this["findLineBoundary"+c](this[a])}if(typeof f!==void 0&&this[a]!==f)return this[a]=f,!0},_moveLeft:function(u,a){return this._move(u,a,"Left")},_moveRight:function(u,a){return this._move(u,a,"Right")},moveCursorLeftWithoutShift:function(u){var a=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(a=this._moveLeft(u,"selectionStart")),this.selectionEnd=this.selectionStart,a},moveCursorLeftWithShift:function(u){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(u,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(u,"selectionStart")):void 0},moveCursorRight:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",u)},_moveCursorLeftOrRight:function(u,a){var c="moveCursor"+u+"With";this._currentCursorOpacity=1,a.shiftKey?c+="Shift":c+="outShift",this[c](a)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(u){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(u,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(u,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(u){var a=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(a=this._moveRight(u,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,a},removeChars:function(u,a){a===void 0&&(a=u+1),this.removeStyleFromTo(u,a),this._text.splice(u,a-u),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(u,a,c,f){f===void 0&&(f=c),f>c&&this.removeStyleFromTo(c,f);var r=y.util.string.graphemeSplit(u);this.insertNewStyleBlock(r,c,a),this._text=[].concat(this._text.slice(0,c),r,this._text.slice(f)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var u=y.util.toFixed,a=/  +/g;y.util.object.extend(y.Text.prototype,{_toSVG:function(){var c=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(c.textTop,c.textLeft);return this._wrapSVGTextAndBg(f)},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(),{reviver:c,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(c){var f=this.getSvgTextDecoration(this);return[c.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",f?'text-decoration="'+f+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",c.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(c,f){var r,o=[],h=[],m=c;this._setSVGBg(h);for(var g=0,p=this._textLines.length;g<p;g++)r=this._getLineLeftOffset(g),(this.textBackgroundColor||this.styleHas("textBackgroundColor",g))&&this._setSVGTextLineBg(h,g,f+r,m),this._setSVGTextLineText(o,g,f+r,m),m+=this.getHeightOfLine(g);return{textSpans:o,textBgRects:h}},_createTextCharSpan:function(c,f,r,o){var h=c!==c.trim()||c.match(a),m=this.getSvgSpanStyles(f,h),g=m?'style="'+m+'"':"",p=f.deltaY,v="",C=y.Object.NUM_FRACTION_DIGITS;return p&&(v=' dy="'+u(p,C)+'" '),['<tspan x="',u(r,C),'" y="',u(o,C),'" ',v,g,">",y.util.string.escapeXml(c),"</tspan>"].join("")},_setSVGTextLineText:function(c,f,r,o){var h,m,g,p,v,C=this.getHeightOfLine(f),x=this.textAlign.indexOf("justify")!==-1,b="",E=0,O=this._textLines[f];o+=C*(1-this._fontSizeFraction)/this.lineHeight;for(var M=0,W=O.length-1;M<=W;M++)v=M===W||this.charSpacing,b+=O[M],g=this.__charBounds[f][M],E===0?(r+=g.kernedWidth-g.width,E+=g.width):E+=g.kernedWidth,x&&!v&&this._reSpaceAndTab.test(O[M])&&(v=!0),v||(h=h||this.getCompleteStyleDeclaration(f,M),m=this.getCompleteStyleDeclaration(f,M+1),v=this._hasStyleChangedForSvg(h,m)),v&&(p=this._getStyleDeclaration(f,M)||{},c.push(this._createTextCharSpan(b,p,r,o)),b="",h=m,r+=E,E=0)},_pushTextBgRect:function(c,f,r,o,h,m){var g=y.Object.NUM_FRACTION_DIGITS;c.push("		<rect ",this._getFillAttributes(f),' x="',u(r,g),'" y="',u(o,g),'" width="',u(h,g),'" height="',u(m,g),`"></rect>
`)},_setSVGTextLineBg:function(c,f,r,o){for(var h,m,g=this._textLines[f],p=this.getHeightOfLine(f)/this.lineHeight,v=0,C=0,x=this.getValueOfPropertyAt(f,0,"textBackgroundColor"),b=0,E=g.length;b<E;b++)h=this.__charBounds[f][b],(m=this.getValueOfPropertyAt(f,b,"textBackgroundColor"))!==x?(x&&this._pushTextBgRect(c,x,r+C,o,v,p),C=h.left,v=h.width,x=m):v+=h.kernedWidth;m&&this._pushTextBgRect(c,m,r+C,o,v,p)},_getFillAttributes:function(c){var f=c&&typeof c=="string"?new y.Color(c):"";return f&&f.getSource()&&f.getAlpha()!==1?'opacity="'+f.getAlpha()+'" fill="'+f.setAlpha(1).toRgb()+'"':'fill="'+c+'"'},_getSVGLineTopOffset:function(c){for(var f,r=0,o=0;o<c;o++)r+=this.getHeightOfLine(o);return f=this.getHeightOfLine(o),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*f/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(c){return y.Object.prototype.getSvgStyles.call(this,c)+" white-space: pre;"}})}(),function(u){var a=u.fabric||(u.fabric={});a.Textbox=a.util.createClass(a.IText,a.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:a.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(c){for(var f=0,r=0,o=0,h={},m=0;m<c.graphemeLines.length;m++)c.graphemeText[o]===`
`&&m>0?(r=0,o++,f++):!this.splitByGrapheme&&this._reSpaceAndTab.test(c.graphemeText[o])&&m>0&&(r++,o++),h[m]={line:f,offset:r},o+=c.graphemeLines[m].length,r+=c.graphemeLines[m].length;return h},styleHas:function(c,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[f];r&&(f=r.line)}return a.Text.prototype.styleHas.call(this,c,f)},isEmptyStyles:function(c){if(!this.styles)return!0;var f,r,o=0,h=!1,m=this._styleMap[c],g=this._styleMap[c+1];for(var p in m&&(c=m.line,o=m.offset),g&&(h=g.line===c,f=g.offset),r=c===void 0?this.styles:{line:this.styles[c]})for(var v in r[p])if(v>=o&&(!h||v<f))for(var C in r[p][v])return!1;return!0},_getStyleDeclaration:function(c,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[c];if(!r)return null;c=r.line,f=r.offset+f}return this.callSuper("_getStyleDeclaration",c,f)},_setStyleDeclaration:function(c,f,r){var o=this._styleMap[c];c=o.line,f=o.offset+f,this.styles[c][f]=r},_deleteStyleDeclaration:function(c,f){var r=this._styleMap[c];c=r.line,f=r.offset+f,delete this.styles[c][f]},_getLineStyle:function(c){var f=this._styleMap[c];return!!this.styles[f.line]},_setLineStyle:function(c){var f=this._styleMap[c];this.styles[f.line]={}},_wrapText:function(c,f){var r,o=[];for(this.isWrapping=!0,r=0;r<c.length;r++)o=o.concat(this._wrapLine(c[r],r,f));return this.isWrapping=!1,o},_measureWord:function(c,f,r){var o,h=0;r=r||0;for(var m=0,g=c.length;m<g;m++)h+=this._getGraphemeBox(c[m],f,m+r,o,!0).kernedWidth,o=c[m];return h},_wrapLine:function(c,f,r,o){var h=0,m=this.splitByGrapheme,g=[],p=[],v=m?a.util.string.graphemeSplit(c):c.split(this._wordJoiners),C="",x=0,b=m?"":" ",E=0,O=0,M=0,W=!0,G=this._getWidthOfCharSpacing();o=o||0,v.length===0&&v.push([]),r-=o;for(var Q=0;Q<v.length;Q++)C=m?v[Q]:a.util.string.graphemeSplit(v[Q]),E=this._measureWord(C,f,x),x+=C.length,(h+=O+E-G)>r&&!W?(g.push(p),p=[],h=E,W=!0):h+=G,W||m||p.push(b),p=p.concat(C),O=m?0:this._measureWord([b],f,x),x++,W=!1,E>M&&(M=E);return Q&&g.push(p),M+o>this.dynamicMinWidth&&(this.dynamicMinWidth=M-G+o),g},isEndOfWrapping:function(c){return!this._styleMap[c+1]||this._styleMap[c+1].line!==this._styleMap[c].line},missingNewlineOffset:function(c){return this.splitByGrapheme?this.isEndOfWrapping(c)?1:0:1},_splitTextIntoLines:function(c){for(var f=a.Text.prototype._splitTextIntoLines.call(this,c),r=this._wrapText(f.lines,this.width),o=new Array(r.length),h=0;h<r.length;h++)o[h]=r[h].join("");return f.lines=o,f.graphemeLines=r,f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var c={};for(var f in this._styleMap)this._textLines[f]&&(c[this._styleMap[f].line]=1);for(var f in this.styles)c[f]||delete this.styles[f]},toObject:function(c){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(c))}}),a.Textbox.fromObject=function(c,f){return a.Object._fromObject("Textbox",c,f,"text")}}(e),function(){var u=y.controlsUtils,a=u.scaleSkewCursorStyleHandler,c=u.scaleCursorStyleHandler,f=u.scalingEqually,r=u.scalingYOrSkewingX,o=u.scalingXOrSkewingY,h=u.scaleOrSkewActionName,m=y.Object.prototype.controls;if(m.ml=new y.Control({x:-.5,y:0,cursorStyleHandler:a,actionHandler:o,getActionName:h}),m.mr=new y.Control({x:.5,y:0,cursorStyleHandler:a,actionHandler:o,getActionName:h}),m.mb=new y.Control({x:0,y:.5,cursorStyleHandler:a,actionHandler:r,getActionName:h}),m.mt=new y.Control({x:0,y:-.5,cursorStyleHandler:a,actionHandler:r,getActionName:h}),m.tl=new y.Control({x:-.5,y:-.5,cursorStyleHandler:c,actionHandler:f}),m.tr=new y.Control({x:.5,y:-.5,cursorStyleHandler:c,actionHandler:f}),m.bl=new y.Control({x:-.5,y:.5,cursorStyleHandler:c,actionHandler:f}),m.br=new y.Control({x:.5,y:.5,cursorStyleHandler:c,actionHandler:f}),m.mtr=new y.Control({x:0,y:-.5,actionHandler:u.rotationWithSnapping,cursorStyleHandler:u.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),y.Textbox){var g=y.Textbox.prototype.controls={};g.mtr=m.mtr,g.tr=m.tr,g.br=m.br,g.tl=m.tl,g.bl=m.bl,g.mt=m.mt,g.mb=m.mb,g.mr=new y.Control({x:.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:a,actionName:"resizing"}),g.ml=new y.Control({x:-.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:a,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Zc={};function Di(t){var e=Zc[t];if(e!==void 0)return e.exports;var i=Zc[t]={exports:{}};return $p[t](i,i.exports,Di),i.exports}Di.d=(t,e)=>{for(var i in e)Di.o(e,i)&&!Di.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},Di.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Wd={};(()=>{let t;Di.d(Wd,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?Di(653).fabric:{version:"5.2.1"}})();var Ce=Wd.R;const Zo=typeof self>"u";let Bn,Yt,jr,Ro,He;if(typeof navigator<"u"&&(Bn=navigator,Yt=Bn.userAgent,jr=Bn.platform,Ro=Bn.mediaDevices),!Zo){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Bn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:jr,search:"Win"},Mac:{str:jr},Linux:{str:jr}};let i="unknownBrowser",n=0,s="unknownOS";for(let l in t){const d=t[l]||{};let _=d.str||Yt,S=d.search||l,w=d.verStr||Yt,T=d.verSearch||l;if(T instanceof Array||(T=[T]),_.indexOf(S)!=-1){i=l;for(let A of T){let I=w.indexOf(A);if(I!=-1){n=parseFloat(w.substring(I+A.length+1));break}}break}}for(let l in e){const d=e[l]||{};let _=d.str||Yt,S=d.search||l;if(_.indexOf(S)!=-1){s=l;break}}s=="Linux"&&Yt.indexOf("Windows NT")!=-1&&(s="HarmonyOS"),He={browser:i,version:n,OS:s}}Zo&&(He={browser:"ssr",version:0,OS:"ssr"});const Kp=typeof WebAssembly<"u"&&Yt&&!(/Safari/.test(Yt)&&!/Chrome/.test(Yt)&&/\(.+\s11_2_([2-6]).*\)/.test(Yt)),Zp=!(typeof Worker>"u"),Gd=!(!Ro||!Ro.getUserMedia),Jp=async()=>{let t=!1;if(Gd)try{(await Ro.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};He.browser==="Chrome"&&He.version>66||He.browser==="Safari"&&He.version>13||He.browser==="OPR"&&He.version>43||He.browser==="Edge"&&He.version;const Qp=(()=>{if(!Zo&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let i=t.indexOf("#");i!=-1&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();class pt{constructor(e,i){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=i}get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.styleSelector="selected"}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.styleSelector="selected":this.styleSelector="default",this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,i){if(!i)return;const n=e.toLowerCase(),s=this.mapEvent_Callbacks.get(n);if(!s)throw new Error(`Event '${e}' does not exist.`);let l=s.get(i);l||(l=d=>{const _=d.e;if(!_)return void(i&&i.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const S={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let w,T,A,I;const k=_.target.getBoundingClientRect();w=k.left,T=k.top,A=w+window.scrollX,I=T+window.scrollY;const B=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,F=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,z=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),D=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),R=z/D,L=B/F,$=this._drawingLayer._getObjectFit();let ie,ne,J,y,de=1;if($==="contain")R<L?(de=z/B,ie=w+this.get("x")*de,ne=T+this.get("y")*de+(D-F*de)/2,J=A+this.get("x")*de,y=I+this.get("y")*de+(D-F*de)/2):(de=D/F,ie=w+this.get("x")*de+(z-B*de)/2,ne=T+this.get("y")*de,J=A+this.get("x")*de+(z-B*de)/2,y=I+this.get("y")*de);else if($==="cover")if(R<L){de=D/F;let ge=this.get("x")*de-(B*de-z)/2;ge=Math.max(ge,0),ge=Math.min(ge,z),ie=w+ge,ne=T+this.get("y")*de,J=A+ge,y=I+this.get("y")*de}else{de=z/B;let ge=this.get("y")*de-(F*de-D)/2;ge=Math.max(ge,0),ge=Math.min(ge,D),ie=w+this.get("x")*de,ne=T+ge,J=A+this.get("x")*de,y=I+ge}S.itemClientX=Math.round(ie),S.itemClientY=Math.round(ne),S.itemPageX=Math.round(J),S.itemPageY=Math.round(y)}for(let w of Object.getOwnPropertyNames(S))Object.defineProperty(_,w,{value:S[w],writable:!0});i&&i.apply(this,[_])},s.set(i,l),this._fabricObject.on(n==="dblclick"?"mousedblclick":n,l))}on(e,i){this._on(e,i)}_off(e,i){const n=e.toLowerCase(),s=this.mapEvent_Callbacks.get(n);if(!s)throw new Error(`Event '${e}' does not exist.`);let l=s.get(i);l&&(s.delete(i),this._fabricObject.off(n==="dblclick"?"mousedblclick":n,l))}off(e,i){this._off(e,i)}_setEditable(e){const i=this._fabricObject;e?(i.selectable=!0,i.hasControls=!0,i.hoverCursor=null):(i.selectable=!1,i.hasControls=!1,i.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,i){if(this.hasNote(e.name)&&!i)throw new Error("A note with the same name already exists, please use a different name.");const n=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[n])}getNote(e){const i=this.mapNoteName_Content.get(e);return i?i.length===1?{name:e,content:i[0]?JSON.parse(JSON.stringify(i[0])):i[0]}:{name:e,content:JSON.parse(JSON.stringify(i))}:null}getNotes(){const e=[];for(let i of this.mapNoteName_Content){let n=i[1].length===1?i[1][0]:i[1];n=n&&JSON.parse(JSON.stringify(n)),e.push({name:i[0],content:n})}return e}updateNote(e,i,n){const s=this.mapNoteName_Content.get(e);if(!s)throw new Error("The note name does not exist.");n||(s.length=0),i=i&&JSON.parse(JSON.stringify(i)),s.push(i)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,i){return!1}_extendGet(e){}set(e,i){if(!this._extendSet(e,i))if(e==="x"){const n=this._fabricObject.group;n?(this._fabricObject.set("left",i-n.left-n.width/2),n.addWithUpdate()):this._fabricObject.set("left",i)}else if(e==="y"){const n=this._fabricObject.group;n?(this._fabricObject.set("top",i-n.top-n.height/2),n.addWithUpdate()):this._fabricObject.set("top",i)}else e==="styleId"?this.styleId=i:this._fabricObject.set(e,i);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let i=this._extendGet(e);if(i===void 0)if(e==="x"){const n=this._fabricObject.group;i=n?this._fabricObject.get("left")+n.left+n.width/2:this._fabricObject.get("left")}else if(e==="y"){const n=this._fabricObject.group;i=n?this._fabricObject.get("top")+n.top+n.height/2:this._fabricObject.get("top")}else i=["type","mediaType"].includes(e)?this.mediaType:e==="styleSelector"?this.styleSelector:e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return i}setAttribute(e,i){this.set(e,i)}getAttribute(e){return this.get(e)}}function Ea(t,e,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,s=i.points[this.pointIndex].y-i.pathOffset.y;return Ce.util.transformPoint({x:n,y:s},i.calcTransformMatrix())}function zd(t){let e=new Ce.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new Ce.Point(t.width+e.x,t.height+e.y)}function Ia(t,e,i,n){let s=e.target,l=s.controls[s.__corner],d=s.toLocalPoint(new Ce.Point(i,n),"center","center"),_=zd(s),S=s._getTransformedDimensions(0,0),w={x:d.x*_.x/S.x+s.pathOffset.x,y:d.y*_.y/S.y+s.pathOffset.y};return s.points[l.pointIndex]=w,!0}function Aa(t,e){return function(i,n,s,l){let d=n.target,_=Ce.util.transformPoint({x:d.points[t].x-d.pathOffset.x,y:d.points[t].y-d.pathOffset.y},d.calcTransformMatrix()),S=e(i,n,s,l);d._setPositionDimensions({});let w=zd(d),T=(d.points[t].x-d.pathOffset.x)/w.x,A=(d.points[t].y-d.pathOffset.y)/w.y;return d.setPositionByOrigin(_,T+.5,A+.5),S}}pt.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],pt.arrStyleSelectors=["default","selected"];class Jc extends pt{constructor(e,i){super(new Ce.Polygon(e,{objectCaching:!1}),i);const n=this._fabricObject;let s=n.points.length-1;n.controls=n.points.reduce(function(l,d,_){return l["p"+_]=new Ce.Control({positionHandler:Ea,actionHandler:Aa(_>0?_-1:s,Ia),actionName:"modifyPolygon",pointIndex:_}),l},{})}_extendSet(e,i){if(e==="vertices"){const n=this._fabricObject;if(n.group){const l=n.group;n.points=i.map(d=>({x:d.x-l.left-l.width/2,y:d.y-l.top-l.height/2})),l.addWithUpdate()}else n.points=i;const s=n.points.length-1;return n.controls=n.points.reduce(function(l,d,_){return l["p"+_]=new Ce.Control({positionHandler:Ea,actionHandler:Aa(_>0?_-1:s,Ia),actionName:"modifyPolygon",pointIndex:_}),l},{}),n._setPositionDimensions({}),!0}}_extendGet(e){if(e==="vertices"){const i=[],n=this._fabricObject;if(n.selectable&&!n.group)for(let s in n.oCoords)i.push({x:n.oCoords[s].x,y:n.oCoords[s].y});else for(let s of n.points){let l=s.x-n.pathOffset.x,d=s.y-n.pathOffset.y;const _=Ce.util.transformPoint({x:l,y:d},n.calcTransformMatrix());i.push({x:_.x,y:_.y})}return i}}}const Qc=t=>{let e=(i=>i.split(`
`).map(n=>n.split("	")))(t);return(i=>{for(let n=0;;n++){let s=-1;for(let l=0;l<i.length;l++){let d=i[l][n];d!==void 0&&d.length>s&&(s=d.length)}if(s===-1)break;for(let l=0;l<i.length;l++){if(n>=i[l].length-1)continue;let d=" ".repeat(s+2-i[l][n].length);i[l][n]=i[l][n].concat(d)}}})(e),(i=>{let n="";for(let s=0;s<i.length;s++)n=n.concat(...i[s],s===i.length-1?"":`
`);return n})(e)};class Hd extends pt{constructor(e,i,n,s,l){if(typeof s!="number"||s<=0)throw new RangeError("Invalid width.");super(new Ce.Textbox(Qc(e),{left:i,top:n,width:s}),l),this._mediaType="text",this._text=e}_extendSet(e,i){if(e==="text")return this._text=i,this._fabricObject.set("text",Qc(i)),!0}_extendGet(e){if(e==="text")return this._text}}typeof document<"u"&&typeof window<"u"&&(Ce.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Ce.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Ce.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Ce.Object.prototype.transparentCorners=!1,Ce.Object.prototype.cornerSize=20,Ce.Object.prototype.touchCornerSize=100,Ce.Object.prototype.cornerColor="rgb(254,142,20)",Ce.Object.prototype.cornerStyle="circle",Ce.Object.prototype.strokeUniform=!0,Ce.Object.prototype.hasBorders=!1,Ce.Canvas.prototype.containerClass="",Ce.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var i,n=this.upperCanvasEl,s=Ce.util.getPointer(t,n),l=n.getBoundingClientRect(),d=l.width||0,_=l.height||0;d&&_||("top"in l&&"bottom"in l&&(_=Math.abs(l.top-l.bottom)),"right"in l&&"left"in l&&(d=Math.abs(l.right-l.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=this.restorePointerVpt(s));var S=this.getRetinaScaling();if(S!==1&&(s.x/=S,s.y/=S),d!==0&&_!==0){var w=window.getComputedStyle(n).objectFit,T=n.width,A=n.height,I=d,k=_;i={width:T/I,height:A/k};var B,F,z=T/A,D=I/k;return w==="contain"?z>D?(B=I,F=I/z,{x:s.x*i.width,y:(s.y-(k-F)/2)*i.width}):(B=k*z,F=k,{x:(s.x-(I-B)/2)*i.height,y:s.y*i.height}):w==="cover"?z>D?{x:(T-i.height*I)/2+s.x*i.height,y:s.y*i.height}:{x:s.x*i.width,y:(A-i.width*k)/2+s.y*i.width}:{x:s.x*i.width,y:s.y*i.height}}return i={width:1,height:1},{x:s.x*i.width,y:s.y*i.height}},Ce.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();Ce.util.addListener(Ce.document,"touchend",this._onTouchEnd,{passive:!1}),Ce.util.addListener(Ce.document,"touchmove",this._onMouseMove,{passive:!1}),Ce.util.removeListener(i,n+"down",this._onMouseDown)},Ce.Textbox.prototype._wrapLine=function(t,e,i,n){const s=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),l=!(!s||!s.length);var d=0,_=this.splitByGrapheme||l,S=[],w=[],T=_?Ce.util.string.graphemeSplit(t):t.split(this._wordJoiners),A="",I=0,k=_?"":" ",B=0,F=0,z=0,D=!0,R=this._getWidthOfCharSpacing();n=n||0,T.length===0&&T.push([]),i-=n;for(var L=0;L<T.length;L++)A=_?T[L]:Ce.util.string.graphemeSplit(T[L]),B=this._measureWord(A,e,I),I+=A.length,(d+=F+B-R)>i&&!D?(S.push(w),w=[],d=B,D=!0):d+=R,D||_||w.push(k),w=w.concat(A),F=_?0:this._measureWord([k],e,I),I++,D=!1,B>z&&(z=B);return L&&S.push(w),z+n>this.dynamicMinWidth&&(this.dynamicMinWidth=z-R+n),S});class qp{constructor(e,i,n,s){let l,d;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new Ce.Canvas(e,Object.assign(s,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(_){const S=_.selected,w=[];for(let T of S){const A=T.getDrawingItem()._drawingLayer;A&&!w.includes(A)&&w.push(A)}for(let T of w){const A=[];for(let I of S){const k=I.getDrawingItem();k._drawingLayer===T&&A.push(k)}setTimeout(()=>{T.onSelectionChange&&T.onSelectionChange(A,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(_){const S=this.getActiveObjects(),w=[];for(let T of S){const A=T.getDrawingItem()._drawingLayer;A&&!w.includes(A)&&w.push(A)}for(let T of w){const A=[];for(let I of S){const k=I.getDrawingItem();k._drawingLayer===T&&A.push(k)}setTimeout(()=>{const I=[];for(let k of A)T.hasDrawingItem(k)&&I.push(k);I.length>0&&T.onSelectionChange&&T.onSelectionChange([],I)},0)}}),this.fabricCanvas.on("selection:updated",function(_){const S=_.selected,w=_.deselected,T=[];for(let A of S){const I=A.getDrawingItem()._drawingLayer;I&&!T.includes(I)&&T.push(I)}for(let A of w){const I=A.getDrawingItem()._drawingLayer;I&&!T.includes(I)&&T.push(I)}for(let A of T){const I=[],k=[];for(let B of S){const F=B.getDrawingItem();F._drawingLayer===A&&I.push(F)}for(let B of w){const F=B.getDrawingItem();F._drawingLayer===A&&k.push(F)}setTimeout(()=>{A.onSelectionChange&&A.onSelectionChange(I,k)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=i,this._mapDrawingStyles=n,i){case 1:l=n.get(1),d=n.get(5);break;case 2:l=n.get(2),d=n.get(6);break;case 3:l=n.get(3),d=n.get(7);break;default:l=n.get(4),d=n.get(8)}for(let _ of pt.arrMediaTypes)this.mapMediaType_Style.set(_,{default:l,selected:d})}getId(){return this.id}_getDrawingStyle(e,i){if(typeof e!="number")throw new Error("Invalid style id.");const n=this._mapDrawingStyles.get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}setVisible(e){if(e){for(let i of this._arrFabricObject)i.visible=!0;this._visible=!0}else{for(let i of this._arrFabricObject)i.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){return e.styleId?this._getDrawingStyle(e.styleId):e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,i,n,s){let l;switch(e){case"rect":l=this.fabricCanvas.getObjects("rect");break;case"arc":l=this.fabricCanvas.getObjects("circle");break;case"polygon":l=this.fabricCanvas.getObjects("polygon");break;case"image":l=this.fabricCanvas.getObjects("image");break;case"text":l=this.fabricCanvas.getObjects("textbox");break;case"line":l=this.fabricCanvas.getObjects("line");break;case"path":l=this.fabricCanvas.getObjects("path")}for(let d of l){if(!this._arrFabricObject.includes(d))continue;const _=d.getDrawingItem();_.styleSelector===i&&this._changeItemStyle(_,n,!0)}s||this.fabricCanvas.renderAll()}_changeItemStyle(e,i,n){if(!e||!i)return;const s=e._getFabricObject();typeof e.styleId=="number"&&(i=this._getDrawingStyle(e.styleId)),s.strokeWidth=i.lineWidth,i.paintMode==="fill"?(s.fill=i.fillStyle,s.stroke=i.fillStyle):i.paintMode==="stroke"?(s.fill="transparent",s.stroke=i.strokeStyle):i.paintMode==="strokeAndFill"&&(s.fill=i.fillStyle,s.stroke=i.strokeStyle),s.fontFamily&&(s.fontFamily=i.fontFamily),s.fontSize&&(s.fontSize=i.fontSize),s.group||(s.dirty=!0),n||this.fabricCanvas.renderAll()}_updateGroupItem(e,i,n){if(!e||!i)return;const s=e.getChildItems();if(n==="add"){if(s.includes(i))return;const l=i._getFabricObject();if(this.fabricCanvas.getObjects().includes(l)){if(!this._arrFabricObject.includes(l))throw new Error("Existed in other drawing layers.");i._zIndex=null}else{let d;if(i.styleId)d=this._getDrawingStyle(i.styleId);else{d=this.mapMediaType_Style.get(i._mediaType)[e.styleSelector];const _=()=>{this._changeItemStyle(i,this.mapMediaType_Style.get(i._mediaType).selected,!0)},S=()=>{this._changeItemStyle(i,this.mapMediaType_Style.get(i._mediaType).default,!0)};i._on("selected",_),i._on("deselected",S),i._funcChangeStyleToSelected=_,i._funcChangeStyleToDefault=S}i._drawingLayer=this,i._drawingLayerId=this.id,this._changeItemStyle(i,d,!0)}e._fabricObject.addWithUpdate(i._getFabricObject())}else{if(n!=="remove"||!s.includes(i))return;i._zIndex=null,i._drawingLayer=null,i._drawingLayerId=null,i._off("selected",i._funcChangeStyleToSelected),i._off("deselected",i._funcChangeStyleToDefault),i._funcChangeStyleToSelected=null,i._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(i._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,i){let n=e._getFabricObject();const s=this.fabricCanvas.getObjects();let l,d;if(s.includes(n)){if(this._arrFabricObject.includes(n))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){l=e.getChildItems();for(let w of l)if(w._drawingLayer&&w._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(i&&typeof i=="object"&&!Array.isArray(i))for(let w in i)n.set(w,i[w]);if(l){for(let w of l){const T=this.mapMediaType_Style.get(w._mediaType);for(let A of pt.arrStyleSelectors)w._mapStyle.set(A,T[A]);if(w.styleId)d=this._getDrawingStyle(w.styleId);else{d=T.default;const A=()=>{this._changeItemStyle(w,this.mapMediaType_Style.get(w._mediaType).selected,!0)},I=()=>{this._changeItemStyle(w,this.mapMediaType_Style.get(w._mediaType).default,!0)};w._on("selected",A),w._on("deselected",I),w._funcChangeStyleToSelected=A,w._funcChangeStyleToDefault=I}w._drawingLayer=this,w._drawingLayerId=this.id,this._changeItemStyle(w,d,!0)}n.dirty=!0,this.fabricCanvas.renderAll()}else{const w=this.mapMediaType_Style.get(e._mediaType);for(let T of pt.arrStyleSelectors)e._mapStyle.set(T,w[T]);if(e.styleId)d=this._getDrawingStyle(e.styleId);else{d=w.default;const T=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},A=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",T),e._on("deselected",A),e._funcChangeStyleToSelected=T,e._funcChangeStyleToDefault=A}this._changeItemStyle(e,d)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const _=this._arrFabricObject.length;let S=s.length;if(_)S=s.indexOf(this._arrFabricObject[_-1])+1;else for(let w=0;w<s.length;w++)if(e._zIndex<s[w].getDrawingItem()._zIndex){S=w;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(n),this._visible?n.visible=!0:n.visible=!1,this.fabricCanvas.insertAt(n,S,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let i of e)this.addDrawingItem(i)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const n=e.getChildItems();for(let s of n)s._zIndex=null,s._drawingLayer=null,s._drawingLayerId=null,s._off("selected",s._funcChangeStyleToSelected),s._off("deselected",s._funcChangeStyleToDefault),s._funcChangeStyleToSelected=null,s._funcChangeStyleToDefault=null,s._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const i=e._getFabricObject();e.styleSelector==="selected"&&(i.group?i.group.removeWithUpdate(i):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(i),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(i),1)}removeDrawingItems(e){for(let i of e)this.removeDrawingItem(i)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),i=[];for(let n of e)this._arrFabricObject.includes(n)&&i.push(n.getDrawingItem());return i}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,i,n){i=i?i.toLocaleLowerCase():"all",n=n?n.toLocaleLowerCase():"all";let s,l=this._getDrawingStyle(e);if(i==="all"){const d=this.mapMediaType_Style.keys();for(let _ of d)if(s=this.mapMediaType_Style.get(_),n==="all")for(let S of pt.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(_,S,l,!0),s[S]=l;for(let w of this._arrDrwaingItem)w._mapStyle.set(S,l)}else{this._changeMediaTypeCurStyleInStyleSelector(_,n,l,!0),s[n]=l;for(let S of this._arrDrwaingItem)S._mapStyle.set(n,l)}this.fabricCanvas.renderAll()}else if(s=this.mapMediaType_Style.get(i),n==="all")for(let d of pt.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(i,d,l,!0),s[d]=l;for(let _ of this._arrDrwaingItem)_._mediaType===i&&_._mapStyle.set(d,l)}else{this._changeMediaTypeCurStyleInStyleSelector(i,n,l,!0),s[n]=l;for(let d of this._arrDrwaingItem)d._mediaType===i&&d._mapStyle.set(n,l)}}setMode(e){if((e=e.toLocaleLowerCase())==="viewer"){for(let i of this._arrDrwaingItem)i._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let i of this._arrDrwaingItem)i._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,i){this.fabricCanvas.setDimensions(e,i)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const i=this._getItemCurrentStyle(e);this._changeItemStyle(e,i,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class em{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let i;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");i=e.id}else{let s=100;for(;this._mapDrawingStyles.has(s);)s++;i=s}const n=JSON.parse(JSON.stringify(e));n.id=i;for(let s in this._defaultStyleTemplate)n.hasOwnProperty(s)||(n[s]=this._defaultStyleTemplate[s]);return this._mapDrawingStyles.set(i,n),n.id}_getDrawingStyle(e,i){if(typeof e!="number")throw new Error("Invalid style id.");const n=this._mapDrawingStyles.get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,i){const n=this._mapDrawingStyles.get(e);if(n)for(let s in i)n.hasOwnProperty(s)&&(n[s]=i[s])}updateDrawingStyle(e,i){this._updateDrawingStyle(e,i);for(let n of this._arrDrawingLayer)n.renderAll()}createDrawingLayer(e,i){const n=l=>{for(let d of this._arrDrawingLayer)if(d.getId()===l)return!0;return!1};if(i===void 0){for(let l=100;;l++)if(!n(l)){i=l;break}}else if(n(i))throw new Error("Existed drawing layer id.");const s=new qp(e,i,this._mapDrawingStyles,{enableRetinaScaling:!1});return s._manager=this,this._arrDrawingLayer.push(s),this._switchPointerEvent(),s}deleteDrawingLayer(e){const i=this.getDrawingLayer(e);if(!i)return;const n=this._arrDrawingLayer;i.dispose(),n.splice(n.indexOf(i),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let i of this._arrDrawingLayer)if(i.getId()===e)return i;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),i=[];for(let n of e)i.push(n.getDrawingItem());return i}setDimensions(e,i){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,i)}setObjectFit(e){for(let i of this._arrDrawingLayer)i&&i._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class tm{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const i=this._arrUsers.indexOf(e);i!==-1&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(i,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,i,n,s){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");s&&(this._controlTarget[i]=n),this._mapProperty_UserValue.get(i)?this._mapProperty_UserValue.get(i).set(e,n):this._mapProperty_UserValue.set(i,new Map([[e,n]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const i=this._mapProperty_UserValue.get(e.property);if(!i)return;i.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let i of this._mapProperty_UserValue.values())i.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const i=[],n=this._mapProperty_UserValue.get(e);for(let s of n.values())i.push(s);return i}return null}setDisiredAction(e,i,n,s){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return n||(n=[]),s?this._controlTarget[i](...n):(this._mapAction_UserArgs.get(i)?this._mapAction_UserArgs.get(i).set(e,n):this._mapAction_UserArgs.set(i,new Map([[e,n]])),this._render(i))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const i=this._mapAction_UserArgs.get(e.actionName);if(!i)return;i.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let i of this._mapAction_UserArgs.values())i.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,i){const n=this._mapAction_Callbacks.get(e);n?n.push(i):this._mapAction_Callbacks.set(e,[i])}removeCallback(e,i){const n=this._mapAction_Callbacks.get(e);if(!n)return;const s=n.indexOf(i);s!==-1&&n.splice(s,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const i=this._mapAction_Callbacks.get(e);if(i)for(let n of i){if(!n)return;setTimeout(n.bind(this._controlTarget),0)}}_render(e){const i=this._mapAction_UserArgs.get(e);if(!i)throw new Error("Unrecorded action.");if(i.size===this._arrUsers.length){let n=[];for(let s of i.values())s.length>0&&(n=s);if(this._controlTarget[e]){const s=this._controlTarget[e](...n);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),s}}}render(e){if(e)return this._render(e);for(let i of this._mapAction_UserArgs.keys())this._render(i)}}class dt{static multiply(e,i){const n=[];for(let s=0;s<3;s++){const l=i.slice(3*s,3*s+3);for(let d=0;d<3;d++){const _=[e[d],e[d+3],e[d+6]].reduce((S,w,T)=>S+w*l[T],0);n.push(_)}}return n}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,i,n){return dt.multiply(e,[1,0,0,0,1,0,i,n,1])}static rotate(e,i){var n=Math.cos(i),s=Math.sin(i);return dt.multiply(e,[n,-s,0,s,n,0,0,0,1])}static scale(e,i,n){return dt.multiply(e,[i,0,0,0,n,0,0,0,1])}}var xe;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(xe||(xe={}));const ht=(t,e,i)=>e+Math.round((t-e)/i)*i;class Se{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameModeIpt=null,this._clickIptSingleFrameMode=()=>{if(this.singleFrameMode&&!this.getDrawingLayers().some(e=>e.getMode()=="editor")){if(!this._singleFrameModeIpt){const e=document.createElement("input");this._singleFrameModeIpt=e,e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.addEventListener("change",async()=>{const i=e.files[0];e.value="";const n=await(async w=>{let T=null,A=null;if(typeof createImageBitmap<"u")try{if(T=await createImageBitmap(w),T)return T}catch{}var I;return T||(A=await(I=w,new Promise((k,B)=>{let F=URL.createObjectURL(I),z=new Image;z.dbrObjUrl=F,z.src=F,z.onload=()=>{k(z)},z.onerror=D=>{B(new Error("Can't convert blob to image : "+(D instanceof Event?D.type:D)))}}))),A})(i),s=n instanceof HTMLImageElement?n.naturalWidth:n.width,l=n instanceof HTMLImageElement?n.naturalHeight:n.height;this._imgWidth=s,this._imgHeight=l;const d=w=>{const T=Date.now();if(s===0||l===0)return null;if(w instanceof HTMLImageElement&&!w.complete)throw new Error("The source is not loaded.");const A=this._scanRegion,I=this.getFrameSize(s,l,A,this.maxCvsSideLength);if(!I)return null;let k=!0;s===I.sWidth&&l===I.sHeight&&(k=!1);const B=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase()),F={data:null,region:A?JSON.parse(JSON.stringify(A)):null,sx:I.sx,sy:I.sy,width:I.dWidth,height:I.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:k,toCanvas:this._toCanvas,_sWidth:I.sWidth,_sHeight:I.sHeight,_bUseWebGL:null},z=this._getImageData(w,s,l,I,null,{pixelFormat:B});if(!z)return null;const D=Date.now();return F.data=z.data,F.pixelFormat=F.colorMode=z.pixelFormat,F._bUseWebGL=z._bUseWebGL,F.timeSpent=D-T,F.timeStamp=D,z.pixelFormat===xe.GREY?F.stride=F.width:F.stride=4*F.width,F};(w=>{let T=this._cvsSingleFrameMode;if(!T){if(T=document.createElement("canvas"),T.style.pointerEvents="none",!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(T),T.style.position="absolute",T.style.width="100%",T.style.height="100%",T.style.left="0",T.style.top="0",T.style.objectFit="contain",this._cvsSingleFrameMode=T}T.width==s&&T.height==l||(T.width=s,T.height=l);const A=T.getContext("2d");A.clearRect(0,0,T.width,T.height),A.drawImage(w,0,0)})(n),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let w of this._arrScanRegionOverlays)w&&this._updateScanRegionOverlay(w);let _;this._updateDrawingLayersSize();try{_=d(n)}catch(w){throw w}const S=this.mapCameraEvents.get("singleframeacquired");for(let w of S)if(w)try{const T={data:new Uint8Array(_.data),region:JSON.parse(JSON.stringify(_.region)),sx:_.sx,sy:_.sy,width:_.width,height:_.height,stride:_.stride,colorMode:_.colorMode,pixelFormat:_.pixelFormat,timeSpent:_.timeSpent,timeStamp:_.timeStamp,isCropped:_.isCropped,toCanvas:_.toCanvas,_sWidth:_._sWidth,_sHeight:_._sHeight,_bUseWebGL:_._bUseWebGL};await w.apply(this,[T])}catch(T){console.error(T)}}),e.style.position="fixed",e.style.left="-1px",e.style.top="-1px",e.style.width="1px",e.style.height="1px",e.style.backgroundColor="transparent",e.style.color="transparent",document.body.appendChild(e)}this._singleFrameModeIpt.click()}},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",xe.GREY],["grey32",xe.GREY32],["rgba",xe.RGBA],["rbga",xe.RBGA],["grba",xe.GRBA],["gbra",xe.GBRA],["brga",xe.BRGA],["bgra",xe.BGRA]]),this.shaderPixelFormat=xe.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._focusArea=null,this._tapDoFocus=async e=>{if(this._touchMoved)return void(this._touchMoved=!1);if(!this._tapFocusEnabled||!this._bOpen||this.singleFrameMode||!this._video||this._video.paused||!this._videoTrack||!this._focusSupported||this.getDrawingLayers().some(ie=>ie.getMode()=="editor"))return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let i,n,s,l;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)i=e.clientX,n=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY}const d=this.getVideoFit(),_=this._video.videoWidth,S=this._video.videoHeight,w=this._elContainer.getBoundingClientRect(),T=w.left,A=w.top,I=window.getComputedStyle(this._elContainer),k=parseFloat(I.width),B=parseFloat(I.height),F=k/B,z=_/S;let D=1;if(d==="contain")z>F?(D=k/_,s=(i-T)/D,l=(n-A-(B-k/z)/2)/D):(D=B/S,l=(n-A)/D,s=(i-T-(k-B*z)/2)/D);else{if(d!=="cover")throw new Error("Unsupported object-fit.");z>F?(D=B/S,l=(n-A)/D,s=(i-T+(B*z-k)/2)/D):(D=k/_,s=(i-T)/D,l=(n-A+(k/z-B)/2)/D)}const R={x:s+"px",y:l+"px"},L=2*Math.round(Math.min(_,S)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px",$=L;await this._setLocalFocus(R,L,$,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance),this._focusParameters.taskBackToContinous=setTimeout(()=>{this.isDisposed&&this.disposed||this._videoTrack&&this._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime)},this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const e=document.createElement("canvas");let i;if(e.width=this.width,e.height=this.height,(this.pixelFormat||this.colorMode)==="grey"){i=new Uint8ClampedArray(this.width*this.height*4);for(let s=0;s<i.length;s+=4)i[s]=this.data[s/4],i[s+1]=this.data[s/4],i[s+2]=this.data[s/4],i[s+3]=255}else i=new Uint8ClampedArray(this.data.buffer);const n=new ImageData(i,this.width,this.height);return e.getContext("2d").putImageData(n,0,0),e},this._onCameraSelChange=async()=>{await this.selectCamera(this._selCam.value),this._bOpen||this.stop()},this._onResolutionSelChange=async()=>{let e,i;if(this._selRsl&&this._selRsl.selectedIndex!=-1){let n=this._selRsl.options[this._selRsl.selectedIndex];e=n.getAttribute("data-width"),i=n.getAttribute("data-height")}await this.setResolution(e,i),this._bOpen||this.stop()},this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{document.visibilityState==="visible"?this._vc_bPlayingVideoBeforeHide&&(He.browser=="Firefox"?this.play():this._video.play(),this._vc_bPlayingVideoBeforeHide=!1):this._video&&!this._video.paused&&(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause())},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout(()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&(e.style.display="",this._updateScanRegionOverlay(e));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}},this._updateLayersTimeout)},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null}static getVersion(){return this._version}static async detectEnvironment(){return await(async()=>({wasm:Kp,worker:Zp,getUserMedia:Gd,camera:await Jp(),browser:He.browser,version:He.version,OS:He.OS}))()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");Se._engineResourcePath=(i=>{if(i==null&&(i="./"),!Zo){let n=document.createElement("a");n.href=i,i=n.href}return i.endsWith("/")||(i+="/"),i})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let i;try{i=window[e];const n="__storage_test__";return i.setItem(n,n),i.removeItem(n),!0}catch(n){return n instanceof DOMException&&(n.code===22||n.code===1014||n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED")&&i&&i.length!==0}}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static async testCameraAccess(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()})}catch(e){if(e.name==="OverconstrainedError"||e.name==="NotFoundError")return{ok:!1,message:"No camera detected."};if(e.name==="NotAllowedError")return{ok:!1,message:"No permission to access camera."};if(e.name==="AbortError")return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if(e.name==="NotReadableError")return{ok:!1,message:"A hardware error occurred."};if(e.name==="SecurityError")return{ok:!1,message:"User media support is disabled."};throw e}return{ok:!0,message:"Successfully accessed the camera."}}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(this._maxCvsSideLength!==void 0)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&e.length===1)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){Se._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=Se._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",Se.engineResourcePath)}getUIElement(){return this.UIElement}async setUIElement(e){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if(typeof e=="string"||e instanceof String){if(!e.trim().startsWith("<")){let n=await fetch(e);if(!n.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+n.statusText);e=await n.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let i=document.createElement("div");i.innerHTML=e;for(let n=0;n<i.childElementCount;++n){let s=i.children[n];s instanceof HTMLStyleElement&&(this.styleEls.push(s),document.head.append(s))}(e=i.childElementCount==1?i.children[0]:i).remove()}this.UIElement=e,this._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),this.UIElement.style.display=="none"&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayersManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?Se.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this.singleFrameMode)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i);this._updateVideoContainerStyle(),this._drawingLayersManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame")}_hideElClassName(){this._cvsScanRegion&&this._cvsScanRegion.classList.remove("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.remove("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.remove("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.remove("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.remove("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.remove("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.remove("cvs-single-frame")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display=="none"&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(this._bShowScanRegionLaser!==void 0)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let i=0;for(let n of e)n||i++;return i!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return!(e!==null&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){if(!this._bOpen)return null;let e,i,n;if(this.singleFrameMode)e=this._imgWidth,i=this._imgHeight,n="contain";else{if(!this._video)return null;e=this._video.videoWidth,i=this._video.videoHeight,n=this.getVideoFit()}return{width:e,height:i,objectFit:n}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const i=document.createElement("div");if(this._scanRegionOverlayContainer=i,i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.overflow="hidden",i.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(i);else if(this._cvsScanRegion)this._cvsScanRegion.before(i);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(i);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(i)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const i=this._arrScanRegionOverlays.indexOf(e);i!==-1&&(e.remove(),this._arrScanRegionOverlays.splice(i,1))}_updateScanRegionOverlay(e){if(!e)return;const i=this._calculateCvsSize();if(!i)return;const{width:n,height:s,objectFit:l}=i;if(n<=0||s<=0)return e.width=0,void(e.height=0);const d=this._getRegionInPixels(n,s,this._scanRegion),_=this.getFrameSize(n,s,this._scanRegion,this.maxCvsSideLength),S=_.dWidth,w=_.dHeight;e.width==S&&e.height==w||(e.width=S,e.height=w);const T=window.getComputedStyle(this._elContainer),A=parseFloat(T.width),I=parseFloat(T.height),k=A/I,B=n/s;let F,z,D,R,L=1;l==="contain"?(B>k?(L=A/n,F=0,z=(I-s*L)/2):(L=I/s,F=(A-n*L)/2,z=0),F+=d.regionLeft*L,z+=d.regionTop*L,D=(d.regionRight-d.regionLeft)*L,R=(d.regionBottom-d.regionTop)*L):l==="cover"?(B>k?(L=I/s,F=d.regionLeft*L-(n*L-A)/2,z=d.regionTop*L):(L=A/n,F=d.regionLeft*L,z=d.regionTop*L-(s*L-I)/2),D=(d.regionRight-d.regionLeft)*L,R=(d.regionBottom-d.regionTop)*L):(F=0,z=0,D=0,R=0),e.style.position="absolute",e.style.left=F+"px",e.style.top=z+"px",e.style.width=D+"px",e.style.height=R+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display=="none"&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,i){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!i)throw new Error("Invalid area.");this._assertOpen();let n=[];if(typeof e=="string"?n.push(e):Array.isArray(e)&&(n=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._cvsViewDecorator.style.pointerEvents="none",this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(i)),this._decoratorType.length=0;const s=["rectangle","focus"],l=["crossline","crosshair"];let d=!1,_=!1;for(let S of n)S=S.toLowerCase(),s.includes(S)&&!d&&(d=!0,this._decoratorType.push(S)),l.includes(S)&&!_&&(_=!0,!this._decoratorType.includes(S)&&this._decoratorType.push(S));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display=="none"&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=i,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=i,this._updateViewDecorator()}setViewDecoratorFillStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=i,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=i,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen||!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this.singleFrameMode)e="contain";else{if(!this._video)return;e=this.getVideoFit()}const i=this._cvsViewDecorator;i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.left="0",i.style.top="0",i.style.objectFit=e;const n=this.getVisibleRegion(!0),s=n.regionRight-n.regionLeft,l=n.regionBottom-n.regionTop;if(i.width==s&&i.height==l||(i.width=s,i.height=l),s<=0||l<=0)return;const d=i.getContext("2d");d.clearRect(0,0,i.width,i.height);const _=this._decoratorArea.x/100*s,S=this._decoratorArea.y/100*l,w=this._decoratorArea.width/100*s,T=this._decoratorArea.height/100*l;for(let A of this._decoratorType){if(A==="rectangle"){d.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,d.fillRect(0,0,i.width,i.height),d.clearRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,d.fillRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,d.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const I=d.lineWidth/2;d.strokeRect(Math.round(_-I),Math.round(S-I),Math.round(w+d.lineWidth),Math.round(T+d.lineWidth))}if(A==="focus"){d.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,d.fillRect(0,0,i.width,i.height),d.clearRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.fillStyle=this._viewDecoratorInfo.focus.fillStyle,d.fillRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.lineWidth=this._viewDecoratorInfo.focus.lineWidth,d.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const I=d.lineWidth/2,k=[0,.25,.75,1],B=[0,.25,.75,1];d.beginPath();for(let F=0;F<k.length;F++)if(F==0||F==3)for(let z=0;z<B.length;z+=2)d.moveTo(Math.round(_+k[F]*w),Math.round(S+B[z]*T)),d.lineTo(Math.round(_+k[F]*w),Math.round(S+B[z+1]*T));for(let F=0;F<B.length;F++)if(F==0||F==3)for(let z=0;z<k.length;z+=2)d.moveTo(Math.round(_+k[z]*w-I),Math.round(S+B[F]*T)),d.lineTo(Math.round(_+k[z+1]*w+I),Math.round(S+B[F]*T));d.stroke()}if(A==="crossline"&&(d.beginPath(),d.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,d.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,d.moveTo(Math.round(_),Math.round(S+T/2)),d.lineTo(Math.round(_+w),Math.round(S+T/2)),d.moveTo(Math.round(_+w/2),Math.round(S)),d.lineTo(Math.round(_+w/2),Math.round(S+T)),d.stroke()),A==="crosshair"){d.beginPath();const I=.05*Math.min(w,T);d.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,d.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,d.moveTo(Math.round(_+(w-I)/2),Math.round(S+T/2)),d.lineTo(Math.round(_+(w+I)/2),Math.round(S+T/2)),d.moveTo(Math.round(_+w/2),Math.round(S+(T-I)/2)),d.lineTo(Math.round(_+w/2),Math.round(S+(T+I)/2)),d.stroke()}}}getVisibleRegion(e){this._assertOpen();const i=this._calculateCvsSize();if(!i)return null;const{width:n,height:s,objectFit:l}=i;let d=(()=>{const _=parseFloat(window.getComputedStyle(this._elContainer).width),S=parseFloat(window.getComputedStyle(this._elContainer).height);let w,T={regionBottom:s,regionRight:n,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return l==="cover"?_/S<n/s?(w=S/s,T.regionLeft=Math.floor((n-_/w)/2),T.regionRight=Math.ceil(n-T.regionLeft),T.regionTop=0,T.regionBottom=s):(w=_/n,T.regionTop=Math.floor((s-S/w)/2),T.regionBottom=Math.ceil(s-T.regionTop),T.regionLeft=0,T.regionRight=n):l==="none"&&(_<n&&S<s?(T.regionLeft=Math.floor((n-_)/2),T.regionRight=Math.ceil(n-T.regionLeft),T.regionTop=Math.floor((s-S)/2),T.regionBottom=Math.ceil(s-T.regionTop)):_<n?(T.regionLeft=Math.floor((n-_)/2),T.regionRight=Math.ceil(n-T.regionLeft),T.regionTop=0,T.regionBottom=s):S<s&&(T.regionTop=Math.floor((s-S)/2),T.regionBottom=Math.ceil(s-T.regionTop),T.regionLeft=0,T.regionRight=n)),T})();return e?d.regionMeasuredByPercentage=!1:(d.regionBottom=Math.ceil(d.regionBottom/s*100),d.regionRight=Math.ceil(d.regionRight/n*100),d.regionLeft=Math.floor(d.regionLeft/n*100),d.regionTop=Math.floor(d.regionTop/s*100),d.regionMeasuredByPercentage=!0),d}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,i,n){if(!(e<=0||i<=0))return n?n.regionMeasuredByPercentage?{regionLeft:Math.round(n.regionLeft/100*e),regionTop:Math.round(n.regionTop/100*i),regionRight:Math.round(n.regionRight/100*e),regionBottom:Math.round(n.regionBottom/100*i),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(n)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:i,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;const e=this._calculateCvsSize();if(!e)return;const{width:i,height:n,objectFit:s}=e;if(i<=0||n<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const l=this._getRegionInPixels(i,n,this._scanRegion);this._cvsScanRegion||(this._cvsScanRegion=document.createElement("canvas"),this._cvsScanRegion.style.pointerEvents="none",this._scanRegionOverlayContainer?this._scanRegionOverlayContainer.after(this._cvsScanRegion):this._layerBaseCvs?this._layerBaseCvs.parentElement.after(this._cvsScanRegion):this._cvsSingleFrameMode?this._cvsSingleFrameMode.after(this._cvsScanRegion):this._videoContainer.after(this._cvsScanRegion),this._recordedStates.maskShow=!0);const d=this._cvsScanRegion;d.style.position="absolute",d.style.width="100%",d.style.height="100%",d.style.left="0",d.style.top="0",d.style.objectFit=s,d.width==i&&d.height==n||(d.width=i,d.height=n);const _=d.getContext("2d");if(_.clearRect(0,0,d.width,d.height),l.regionLeft!=0||l.regionRight!=i||l.regionTop!=0||l.regionBottom!=n){const S=l.regionLeft,w=l.regionTop,T=l.regionRight-l.regionLeft,A=l.regionBottom-l.regionTop;_.fillStyle=this.regionMaskFillStyle,_.fillRect(0,0,d.width,d.height),_.clearRect(Math.round(S),Math.round(w),Math.round(T),Math.round(A)),_.strokeStyle=this.regionMaskStrokeStyle,_.lineWidth=this.regionMaskLineWidth;const I=_.lineWidth/2;_.strokeRect(Math.round(S-I),Math.round(w-I),Math.round(T+_.lineWidth),Math.round(A+_.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;const e=this._calculateCvsSize();if(!e)return;const{width:i,height:n,objectFit:s}=e;if(!this._divScanArea)return;if(i<=0||n<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const l=this._getRegionInPixels(i,n,this._scanRegion),d=window.getComputedStyle(this._elContainer),_=parseFloat(d.width),S=parseFloat(d.height),w=_/S,T=i/n;let A,I,k,B,F=1;if(s==="contain")w<T?(F=_/i,A=0,I=(S-n*F)/2):(F=S/n,A=(_-i*F)/2,I=0),A+=l.regionLeft*F,I+=l.regionTop*F,k=(l.regionRight-l.regionLeft)*F,B=(l.regionBottom-l.regionTop)*F;else if(s==="cover")if(w<T){F=S/n,A=l.regionLeft*F-(i*F-_)/2,A=Math.max(A,0),A=Math.min(A,parseFloat(d.width)),I=l.regionTop*F;let z=l.regionRight*F-(i*F-_)/2;z=Math.max(z,0),z=Math.min(z,parseFloat(d.width)),k=z-A,B=(l.regionBottom-l.regionTop)*F}else{F=_/i,A=l.regionLeft*F,I=l.regionTop*F-(n*F-S)/2,I=Math.max(I,0),I=Math.min(I,parseFloat(d.height));let z=l.regionBottom*F-(n*F-S)/2;z=Math.max(z,0),z=Math.min(z,parseFloat(d.height)),k=(l.regionRight-l.regionLeft)*F,B=z-I}else A=0,I=0,k=0,B=0;this._divScanArea.style.left=A+"px",this._divScanArea.style.top=I+"px",this._divScanArea.style.width=k+"px",this._divScanArea.style.height=B+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(this._croppingRegions!==void 0)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&e.length===1)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(this._loopInterval!==void 0)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&e.length===1)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(this._maxNumberOfFramesInBuffer!==void 0)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&e.length===1)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(this._refreshInterval!==void 0)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&e.length===1)return e[0]}return this._defaultRefreshInterval}static async createInstance(e){let i=new Se;(typeof e=="string"||e instanceof String)&&(e=JSON.parse(e));for(let n in e)i[n]=e[n];return this._hasEngineResourceLoaded=!0,i._drawingLayersManager=new em,i}static async playVideo(e,i,n){return new Promise((s,l)=>{e||l(new Error("Invalid video element.")),i||l(new Error("Invalid source.")),e.onloadedmetadata=async()=>{e.onloadedmetadata=null,await e.play(),s(e)},typeof i=="string"||i instanceof String?e.src=i:e.srcObject=i,n!==void 0&&setTimeout(()=>l(new Error("Failed to play video. Timeout.")),n)})}static findBestRearCamera(e){if(!e||!e.length)return null;const i=["rear","back","rck","arrire","trasera","trs","traseira","posteriore","","","","","","","","","","arka","achterzijde","","baksidan","bagside","sau","bak","tylny","takakamera","belakang","","","spate","hts","zadn","darrere","zadn","","stranja","belakang",""];for(let n of e){const s=n.label.toLowerCase();if(s&&i.some(l=>s.includes(l))&&/\b0(\b)?/.test(s))return n.deviceId}return["Android","HarmonyOS"].includes(He.OS)?e[e.length-1].deviceId:null}async play(e,i,n,s){if(this._video&&this.videoSrc){const _=await Se.playVideo(this._video,this.videoSrc,4e3);if(!this._video)return _.pause(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const S={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.playCallbackInfo=JSON.parse(JSON.stringify(S));const w=this.mapCameraEvents.get("played");for(let T of w){if(!T)continue;const A=JSON.parse(JSON.stringify(S));setTimeout(()=>{this.isDisposed&&this.disposed||T.apply(this,[A])},0)}return this._recordedStates.videoPlaying=!0,S}if(this.singleFrameMode)return s&&s.notTriggerSingleFrameClick||this._clickIptSingleFrameMode(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!this._video)throw new Error("'video' is null or undefined.");const l=++this.iPlayRound;if(this.promisePlay&&(await this.promisePlay,l<this.iPlayRound))return this.playCallbackInfo={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId},{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.promisePlay=(async()=>{var _;try{this._video&&this._video.srcObject&&this.stop(),Se._onLog&&Se._onLog("DCE: ======before video========");const S=()=>{if(!this._video)throw A&&A.getTracks().forEach($=>{$.stop()}),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null or undefined.")},w=this.getVideoSettings();let T,A;if(typeof w.video=="boolean"&&(w.video={}),e)delete w.video.facingMode,w.video.deviceId={exact:e};else if(!w.video.deviceId){if(this._lastDeviceId)delete w.video.facingMode,w.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&Se.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete w.video.facingMode,w.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const $=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),ie=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));$&&ie&&(w.video.width=$,w.video.height=ie)}else if(!this.ifSkipCameraInspection){if(w.video.facingMode){if(await this.getAllCameras(!1),!this._video)throw new Error("'video' is null or undefined.");let $=w.video.facingMode;if($ instanceof Array&&$.length&&($=$[0]),$=$.exact||$.ideal||$,$==="environment"){T=!0;const ie=Se.findBestRearCamera(this._allCameras);ie&&(delete w.video.facingMode,w.video.deviceId={ideal:ie})}}}}i&&(w.video.width={ideal:i}),n&&(w.video.height={ideal:n}),Se._onLog&&Se._onLog("DCE: ======try getUserMedia========");let I=[0,500],k=null;const B=async $=>{for(let ie of I){ie&&await new Promise(ne=>setTimeout(ne,ie)),S();try{Se._onLog&&Se._onLog("DCE: ask "+JSON.stringify($)),A=await navigator.mediaDevices.getUserMedia($);break}catch(ne){k=ne,Se._onLog&&Se._onLog("DCE: "+ne.message||ne)}}};let F;if(await B(w),A||(Se._onLog&&Se._onLog("DCE: ======try getUserMedia again========"),F=JSON.parse(JSON.stringify(w)),typeof F.video=="object"&&(["iPhone","iPad"].includes(He.OS)?(i>=1280||n>=1280?F.video.width=1280:i>=640||n>=640?F.video.width=640:(i<640||n<640)&&(F.video.width=320),delete F.video.height):T&&!w.video.deviceId?(delete F.video.facingMode,this._allCameras.length&&(F.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):F.video=!0),Se._onLog&&Se._onLog("DCE: "+F),await B(F)),A||(I=[1e3,2e3],await B(w)),A||await B(F),!A)throw k;const z=()=>{const $=A.getVideoTracks();let ie,ne;if($.length&&(ie=this._videoTrack=$[0]),this._video&&ie){const J=ie.getSettings();if(J){for(let y of this._allCameras)if(J.deviceId===y.deviceId){y._checked=!0,y.label=ie.label,ne=y;break}}}this._currentCamera=ne};if(await this.getAllCameras(!1),S(),T){z();const $=Se.findBestRearCamera(this._allCameras),ie=(_=this._currentCamera)===null||_===void 0?void 0:_.deviceId;$&&$!=ie&&(A.getTracks().forEach(ne=>{ne.stop()}),I=[0,500,1e3,2e3],await B(w))}Se._onLog&&Se._onLog("DCE: ======play video========"),S(),await Se.playVideo(this._video,A,4e3),S(),Se._onLog&&Se._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const D=this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=D,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),Se._onLog&&Se._onLog("DCE: got "+D),z(),this._renderSelCameraInfo();const R={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};R.deviceId&&(this._lastDeviceId=R.deviceId,this.ifSaveLastUsedCamera&&Se.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),w.video.width&&w.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(w.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(w.video.height)))));const L=this.mapCameraEvents.get("played");for(let $ of L){if(!$)continue;const ie=JSON.parse(JSON.stringify(R));setTimeout(()=>{this.isDisposed&&this.disposed||$.apply(this,[ie])},0)}return this.promisePlay=null,R}catch(S){throw this.promisePlay=null,this._bgLoading&&(this._bgLoading.style.display="none"),S.name==="NotFoundError"&&(DOMException?S=new DOMException("No camera available, please use a device with an accessible camera.",S.name):(S=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),S}})();const d=await this.promisePlay;return this.playCallbackInfo=JSON.parse(JSON.stringify(d)),this._recordedStates.videoPlaying=!0,d}async resume(){this._assertOpen(),await this.play(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);this._updateDrawingLayersSize(),this._updateVideoContainerStyle(),this.ifShowScanRegionLaser&&this.showScanRegionLaser()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let i=0;i<e.length;++i)for(let n of e[i].children)e.push(n);for(let i of e){if(!this._video&&i.classList.contains(this.containerClassName)){this._elContainer=i;const n=document.createElement("video");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.objectFit=this.getVideoFit(),n.setAttribute("playsinline","true"),n.setAttribute("muted","true"),this._video=n;const s=document.createElement("div");s.append(n),s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.overflow="hidden",this._videoContainer=s,i.prepend(s)}else!this._divScanArea&&i.classList.contains("dce-scanarea")?this._divScanArea=i:!this._divScanLight&&i.classList.contains("dce-scanlight")?this._divScanLight=i:!this._bgLoading&&i.classList.contains("dce-bg-loading")?this._bgLoading=i:!this._bgCamera&&i.classList.contains("dce-bg-camera")?this._bgCamera=i:!this._selCam&&i.classList.contains("dce-sel-camera")?this._selCam=i:!this._selRsl&&i.classList.contains("dce-sel-resolution")?(this._selRsl=i,this.videoSrc||this.singleFrameMode||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">1920x1080</option>','<option data-width="1280" data-height="720">1280x720</option>','<option data-width="640" data-height="480">640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&i.classList.contains("dce-opt-gotResolution")?this._optGotRsl=i:!this._btnClose&&i.classList.contains("dce-btn-close")?this._btnClose=i:!this._selMinLtr&&i.classList.contains("dlr-sel-minletter")?(this._selMinLtr=i,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&i.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=i);if(this.extraBindings&&this.extraBindings.length)for(let n of this.extraBindings)try{n(i)}catch{}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this.singleFrameMode||this.videoSrc?(this.singleFrameMode&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(He.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver(i=>{for(let n of i)n.target===this._elContainer&&this._updateLayers()})),this._elContainer&&this._resizeObserver.observe(this._elContainer)),window.addEventListener("resize",this._updateLayers)}_unbindUI(){this.singleFrameMode?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayersManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameModeIpt&&(this._singleFrameModeIpt.remove(),this._singleFrameModeIpt=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._updateLayers)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}async open(e){this.UIElement||await this.setUIElement(Se.defaultUIElementURL),this._bindUI(),e&&this.appendAndShowUI();let i=await this.play();this.bOpen=!0,this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this.singleFrameMode&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1));const n=this.mapCameraEvents.get("cameraopen");for(let s of n){if(!s)continue;const l=JSON.parse(JSON.stringify(i));setTimeout(()=>{this.isDisposed&&this.disposed||s.apply(this,[l])},0)}return i}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const i=this.mapCameraEvents.get("cameraclose");for(let n of i){if(!n)continue;const s={width:0,height:0,deviceId:null};setTimeout(()=>{this.isDisposed&&this.disposed||n.apply(this,[s])},0)}}stop(){this._video&&this._video.srcObject&&(this._video.srcObject.getTracks().forEach(e=>{e.stop()}),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}async getAllCameras(e=!0){let i=(await navigator.mediaDevices.enumerateDevices()).filter(l=>l.kind==="videoinput");if(e&&i&&i.length&&!i[0].deviceId){let l=await navigator.mediaDevices.getUserMedia({video:!0});i=(await navigator.mediaDevices.enumerateDevices()).filter(d=>d.kind==="videoinput"),l.getTracks().forEach(d=>{d.stop()})}const n=[],s=[];if(this._allCameras)for(let l of this._allCameras)l._checked&&s.push(l);for(let l=0;l<i.length;l++){let d,_=i[l];for(let S of s)if(_.deviceId==S.deviceId){d=S;break}d||(d={deviceId:_.deviceId,label:_.label?_.label:"camera "+l,_checked:!1}),d.deviceId&&n.push(d)}return this._allCameras=n,n}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let i of this._allCameras){const n=document.createElement("option");n.value=i.deviceId,n.innerText=i.label,this._selCam.append(n),i.deviceId&&this._currentCamera&&this._currentCamera.deviceId==i.deviceId&&(e=n)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const i=this.videoSettings.video.deviceId;i&&(e=i.exact||i.ideal||i);for(let n of this._allCameras)if(n.deviceId===e)return JSON.parse(JSON.stringify(n));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}async selectCamera(e){let i="";if(e&&(i=e.deviceId||e),this.videoSettings.video.deviceId={exact:i},!this._bOpen||this._video.paused)return null;let n=null;this._currentCamera&&(n=this._currentCamera.deviceId);const s=this._video.videoWidth,l=this._video.videoHeight,d=await this.play(e.deviceId||e);if(this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this.singleFrameMode&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1)),n!==d.deviceId){const _=this.mapCameraEvents.get("camerachange");for(let S of _){if(!S)continue;const w=JSON.parse(JSON.stringify(d));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[w])},0)}}if(s!==d.width||l!==d.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let S of this._arrScanRegionOverlays)S&&this._updateScanRegionOverlay(S);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const _=this.mapCameraEvents.get("resolutionchange");for(let S of _){if(!S)continue;const w=JSON.parse(JSON.stringify(d));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[w])},0)}}return d}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,i=0;const n=this.videoSettings.video.width,s=this.videoSettings.video.height;return n&&(e=n.exact||n.ideal||n),s&&(i=s.exact||s.ideal||s),[e,i]}}async setResolution(e,i){let n,s;if(e instanceof Array?(n=e[0],s=e[1]):(n=e,s=i),this.videoSettings.video.width={ideal:n},this.videoSettings.video.height={ideal:s},!this._bOpen||this._video.paused)return null;const l=this._video.videoWidth,d=this._video.videoHeight,_=await this.play(null,n,s);if(l!==_.width||d!==_.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let w of this._arrScanRegionOverlays)w&&this._updateScanRegionOverlay(w);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const S=this.mapCameraEvents.get("resolutionchange");for(let w of S){if(!w)continue;const T=JSON.parse(JSON.stringify(_));setTimeout(()=>{this.isDisposed&&this.disposed||w.apply(this,[T])},0)}}return _}async getResolutions(e){let i="";const n=(l,d)=>{const _=this._mapCameraResolutions.get(l);if(!_||!_.length)return!1;for(let S of _)if(S[0]===d.width&&S[1]===d.height)return!0;return!1},s=async(l,d,_)=>{const S={video:{deviceId:{exact:l},width:{ideal:d},height:{ideal:_}}};let w=null;try{w=await navigator.mediaDevices.getUserMedia(S)}catch{return null}if(!w)return null;const T=w.getVideoTracks();let A=null;try{const I=T[0].getSettings();A={width:I.width,height:I.height}}catch{const k=document.createElement("video");k.srcObject=w,A={width:k.videoWidth,height:k.videoHeight},k.srcObject=null}return T.forEach(I=>{I.stop()}),A};if(!this._bOpen){const l=this.videoSettings.video.deviceId;if(!l||(i=l.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:l.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!i))return null;let d=this._mapCameraResolutions.get(i);if(d&&!e)return this._mapCameraResolutions.get(i);this._mapCameraResolutions.set(i,[]),d=this._mapCameraResolutions.get(i);for(let _ of this._predefinedResolutions){const S=await s(i,_.width,_.height);S&&!n(i,S)&&d.push([S.width,S.height])}return d}if(this._currentCamera){i=this._currentCamera.deviceId;let l=this._mapCameraResolutions.get(i);if(l&&!e)return this._mapCameraResolutions.get(i);this._mapCameraResolutions.set(i,[]),l=this._mapCameraResolutions.get(i);const d=this.getConstraints();for(let _ of this._predefinedResolutions){await this._videoTrack.applyConstraints({width:{ideal:_.width},height:{ideal:_.height}});const S=this._videoTrack.getSettings(),w={width:S.width,height:S.height};n(i,w)||l.push([w.width,w.height])}return await this._videoTrack.applyConstraints(d),l}return null}on(e,i){if(!i)return;const n=this.mapCameraEvents.get(e.toLowerCase());if(!n)throw new Error(`Event '${e}' does not exist.`);n.includes(i)||n.push(i)}off(e,i){const n=this.mapCameraEvents.get(e.toLowerCase());if(!n)throw new Error(`Event '${e}' does not exist.`);const s=n.indexOf(i);s!==-1&&n.splice(s,1)}offAll(e){if(e){if(typeof e=="string"){const i=this.mapCameraEvents.get(e);i&&(i.length=0)}}else for(let i of this.mapCameraEvents.values())i&&(i.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}async applyConstraints(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return await this._videoTrack.applyConstraints(e)}async turnOnTorch(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}async turnOffTorch(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}async setColorTemperature(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let i=this.getCapabilities().colorTemperature;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})}getColorTemperature(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}async setExposureCompensation(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let i=this.getCapabilities().exposureCompensation;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}getExposureCompensation(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}async _setHardwareScale(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!this._videoTrack)return;const i=this.getCapabilities().zoom;if(!i)throw new Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),e=ht(e,i.min,i.step),await this._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e}_getHardwareScale(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,i){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");i&&this._setScaleCenter(i),this._softwareScale=e,this._scaleVideo(e,i)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid center.");const i=this._video.videoWidth,n=this._video.videoHeight;let s=0,l=0;if(e.x.endsWith("px"))s=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");s=parseFloat(e.x)/100*i}if(e.y.endsWith("px"))l=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");l=parseFloat(e.y)/100*n}if(s==NaN||l==NaN)throw new Error("Invalid scale center.");this._scaleCenter={x:s,y:l}}_resetScaleCenter(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");const e=this._video.videoWidth,i=this._video.videoHeight;this._scaleCenter={x:e/2,y:i/2}}_isVideoCenter(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}async _setZoom(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const i=await this._setHardwareScale(e);let n=this._getHardwareScale();n==1&&i!=1&&(n=i),e>n?this._setSoftwareScale(e/n):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e)}catch(i){if((i.message||i)!=="Not supported.")throw i;this._setSoftwareScale(e)}}async setZoom(e){if(typeof e!="number"&&typeof e!="object")throw new TypeError("Illegal type of argument.");if(typeof e=="number")return this._setZoom(e);if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?this._setScaleCenter(e.centerPoint):this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const i=await this._setHardwareScale(e.factor);let n=this._getHardwareScale();n==1&&i!=1&&(n=i),e.factor>n?this._setSoftwareScale(e.factor/n):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e.factor)}catch(i){if((i.message||i)!=="Not supported.")throw i;this._setSoftwareScale(e.factor)}}}getZoom(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}async resetZoom(){await this.setZoom({factor:1})}async setFrameRate(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let i=this.getCapabilities().frameRate;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}getFrameRate(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}async _setFocus(e,i){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(typeof e!="string")throw Error("Invalid focus mode.");e=e.toLowerCase();const n=this.getCapabilities().focusMode,s=this.getCapabilities().focusDistance;if(!n)throw Error("Not supported.");if(!n.includes(e))throw Error("Unsupported mode.");if(i>=0){if(!s)throw Error("Manual focus unsupported.");return i<s.min?i=s.min:i>s.max&&(i=s.max),i=ht(i,s.min,s.step),await this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:i}]})}return await this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}async setFocus(e,i){if(typeof e=="string")return this._setFocus(e,i);if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const n=this.getCapabilities(),s=n.focusMode,l=n.focusDistance;if(!s)throw Error("Not supported.");if(typeof e.mode!="string")throw Error("Invalid focus mode.");const d=e.mode.toLowerCase();if(!s.includes(d))throw Error("Unsupported focus mode.");if(d!=="manual")return this._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:d}]});if(!l)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let _=e.distance;return _<l.min?_=l.min:_>l.max&&(_=l.max),_=ht(_,l.min,l.step),this._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:d,focusDistance:_}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const _=e.area.centerPoint;let S=e.area.width,w=e.area.height;if(!S||!w){const T=this._video.videoWidth,A=this._video.videoHeight;S||(S=2*Math.round(Math.min(T,A)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),w||(w=2*Math.round(Math.min(T,A)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusArea={centerPoint:{x:_.x,y:_.y},width:S,height:w},await this._setLocalFocus(_,S,w)}}getFocus(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?e==="continuous"?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),i=e.focusMode;return i?i==="manual"?this._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:i}:null}async _setFocusAndGetContract(e,i){const n=I=>{if(this.disposed||!this._bOpen||!this._videoTrack||this.video.paused||I.focusTaskId!=this._focusParameters.curFocusTaskId){this._bOpen&&this._videoTrack&&!this.video.paused||(this._focusParameters.isDoingFocus=0);const k=new Error(`Focus task ${I.focusTaskId} canceled.`);throw k.name="DeprecatedTaskError",k}this._focusParameters.isDoingFocus===1&&Date.now()-I.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let s;i=ht(i,this._focusParameters.fds.min,this._focusParameters.fds.step),await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(e),s=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise(I=>{setTimeout(I,s)}),n(e);let l=e.focusL-e.focusW/2,d=e.focusT-e.focusH/2,_=e.focusW,S=e.focusH;if(l>=this.video.videoWidth||d>=this.video.videoHeight)throw new Error("Invalid area.");l+_>this.video.videoWidth&&(_=this.video.videoWidth-l),d+S>this.video.videoHeight&&(S=this.video.videoHeight-d);const w=this._getImageData(this.video,this.video.videoWidth,this.video.videoHeight,{sx:l,sy:d,sWidth:_,sHeight:S,dWidth:_,dHeight:S},null,{pixelFormat:xe.RGBA});if(!w)return this._setFocusAndGetContract(e,i);const T=w.data;let A=0;for(let I=0,k=T.length-8;I<k;++I){let B=T[I]-T[I+8];++I;let F=T[I]-T[I+8];++I;let z=T[I]-T[I+8];++I,A+=B*B+F*F+z*z}return-A}async _doFocusDetail(e,i,n,s,l,d,_){let S;if(i=ht(i,this._focusParameters.fds.min,this._focusParameters.fds.step),s=ht(s,this._focusParameters.fds.min,this._focusParameters.fds.step),d?d=ht(d,this._focusParameters.fds.min,this._focusParameters.fds.step):(d=ht(Math.sqrt((i||this._focusParameters.fds.step)*(s||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step),_=await this._setFocusAndGetContract(e,d)),_<=n&&_<=l?S=3:n<l&&n<_?S=1:l<n&&l<_&&(S=2),(s-i)/2<=this._focusParameters.fds.step)return S===3||(S===1?await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):S===2&&await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:s}]})),!0;if(S===1)return await this._doFocusDetail(e,i,n,d,_);if(S===2)return await this._doFocusDetail(e,d,_,s,l);if(S!==3)return n=await this._setFocusAndGetContract(e,i),l=await this._setFocusAndGetContract(e,s),await this._doFocusDetail(e,i,n,s,l);let w=ht(Math.sqrt((i||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step),T=ht(Math.sqrt((s||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step);if(Math.abs(1/this._focusParameters.oldDistance-1/w)<=Math.abs(1/this._focusParameters.oldDistance-1/T)){let A=await this._setFocusAndGetContract(e,w);if(A<_)return await this._doFocusDetail(e,i,n,d,_,w,A);if(A==_)return await this._doFocusDetail(e,w,A,d,_);let I=await this._setFocusAndGetContract(e,T);if(A>_&&_<I)return await this._doFocusDetail(e,w,A,T,I,d,_);if(_==I)return await this._doFocusDetail(e,d,_,T,I);if(_>I)return await this._doFocusDetail(e,d,_,s,l,T,I)}else{let A=await this._setFocusAndGetContract(e,T);if(_>A)return await this._doFocusDetail(e,d,_,s,l,T,A);if(_==A)return await this._doFocusDetail(e,d,_,T,A);let I=await this._setFocusAndGetContract(e,w);if(I>_&&_<A)return await this._doFocusDetail(e,w,I,T,A,d,_);if(I==_)return await this._doFocusDetail(e,w,I,d,_);if(I<_)return await this._doFocusDetail(e,i,n,d,_,w,I)}return!1}async _setLocalFocus(e,i,n,s,l){if(this._focusParameters.isDoingFocus==1)return!1;if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid centerPoint.");if(!i||typeof i!="string")throw new Error("Invalid width.");if(!n||typeof n!="string")throw new Error("Invalid height.");const d=this._video.videoWidth,_=this._video.videoHeight;let S=0,w=0;if(e.x.endsWith("px"))S=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");S=parseFloat(e.x)/100*d}if(e.y.endsWith("px"))w=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");w=parseFloat(e.y)/100*_}if(S==NaN||w==NaN)throw new Error("Invalid centerPoint.");let T=0;if(i.endsWith("px"))T=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid width.");T=parseFloat(i)/100*d}if(T==NaN)throw new Error("Invalid width.");let A=0;if(n.endsWith("px"))A=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid height.");A=parseFloat(n)/100*_}if(A==NaN)throw new Error("Invalid height.");if(this._softwareScale!==1){const B=this._softwareScale,F=this._scaleCenter;T/=B,A/=B,S=(1-1/B)*F.x+S/B,w=(1-1/B)*F.y+w/B}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const I={focusL:S,focusT:w,focusW:T,focusH:A,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},k=async(B,F,z)=>{try{(F==null||F<this._focusParameters.fds.min)&&(F=this._focusParameters.fds.min),(z==null||z>this._focusParameters.fds.max)&&(z=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let D=ht(Math.sqrt(z*(F||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step),R=ht(Math.sqrt((F||this._focusParameters.fds.step)*D),this._focusParameters.fds.min,this._focusParameters.fds.step),L=ht(Math.sqrt(D*z),this._focusParameters.fds.min,this._focusParameters.fds.step),$=await this._setFocusAndGetContract(B,L),ie=await this._setFocusAndGetContract(B,R),ne=await this._setFocusAndGetContract(B,D);if(ie>ne&&ne<$){const J=await this._doFocusDetail(B,R,ie,L,$,D,ne);return this._focusParameters.isDoingFocus=0,J}if(ie<ne&&ie<$){let J=await this._setFocusAndGetContract(B,F);const y=await this._doFocusDetail(B,F,J,D,ne,R,ie);return this._focusParameters.isDoingFocus=0,y}if(ne>$&&ie>$){let J=await this._setFocusAndGetContract(B,z);const y=await this._doFocusDetail(B,D,ne,z,J,L,$);return this._focusParameters.isDoingFocus=0,y}if(ie==ne&&ne<$){const J=await this._doFocusDetail(B,R,ie,D,ne);return this._focusParameters.isDoingFocus=0,J}if(ne==$&&ie>ne){const J=await this._doFocusDetail(B,D,ne,L,$);return this._focusParameters.isDoingFocus=0,J}return k(B,F,z)}catch(D){if(D.name!=="DeprecatedTaskError")throw D}};return k(I,s,l)}async enableTapToFocus(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error("Video is not playing.");if(!this._focusSupported)throw new Error("Tapping to focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,this._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");this._tapFocusEnabled=!0}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video||this.singleFrameMode)return;const e=this._getSoftwareScale(),i=this._videoContainer;if(this.videoFit==="contain"&&e>1){const n=this._video.videoWidth,s=this._video.videoHeight,l=window.getComputedStyle(this._elContainer),d=parseFloat(l.width),_=parseFloat(l.height),S=n/s;if(d/_<S){let w=d/S;i.style.left="0",i.style.top=(_-w)/2/_*100+"%",i.style.width="100%",i.style.height=w/_*100+"%"}else{let w=_*S;i.style.left=(d-w)/2/d*100+"%",i.style.top="0",i.style.width=w/d*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}_scaleVideo(e,i){if(this._video&&!this.singleFrameMode){if(e<1)throw new RangeError("Invalid scale value.");if(i&&this._setScaleCenter(i),e===1)this._video.style.transform="";else{const n=this.getVideoFit(),s=this._video.videoWidth,l=this._video.videoHeight,d=window.getComputedStyle(this._elContainer),_=parseFloat(d.width),S=parseFloat(d.height),w=_/S,T=s/l;let A=1;n==="contain"?A=w<T?_/(s/e):S/(l/e):n==="cover"&&(A=T>w?S/(s/e):_/(l/e));const I=A*(1-1/e)*(s/2-this._scaleCenter.x),k=A*(1-1/e)*(l/2-this._scaleCenter.y);this._video.style.transform=`translate(${I}px, ${k}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,i,n,s){if(!e||!i)return null;let l,d,_,S,w=e,T=i;const A={regionLeft:0,regionTop:0,regionRight:w,regionBottom:T,regionMeasuredByPercentage:!1};n?(n.regionMeasuredByPercentage?(A.regionLeft=n.regionLeft*w/100,A.regionTop=n.regionTop*T/100,A.regionRight=n.regionRight*w/100,A.regionBottom=n.regionBottom*T/100):(A.regionLeft=n.regionLeft,A.regionTop=n.regionTop,A.regionRight=n.regionRight,A.regionBottom=n.regionBottom),l=Math.round(A.regionLeft),d=Math.round(A.regionTop),w=Math.round(A.regionRight-A.regionLeft),T=Math.round(A.regionBottom-A.regionTop)):(l=0,d=0,w=Math.round(w),T=Math.round(T));const I=Math.max(w,T);if(s&&s>0&&I>s){const k=s/I;w>T?(_=s,S=Math.round(T*k)):(_=Math.round(w*k),S=s)}else _=w,S=T;return _<=0||S<=0?null:{sx:l,sy:d,sWidth:w,sHeight:T,dWidth:_,dHeight:S}}getFrame(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,i,n,s,l,d,_){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!n||!s)return null;if(i instanceof HTMLVideoElement&&i.readyState!==4||i instanceof HTMLImageElement&&!i.complete)throw new Error("The source is not loaded.");let S=0,w=0,T=n,A=s,I=0,k=0,B=n,F=s;l&&(l.sx&&(S=Math.round(l.sx)),l.sy&&(w=Math.round(l.sy)),l.sWidth&&(T=Math.round(l.sWidth)),l.sHeight&&(A=Math.round(l.sHeight)),l.dx&&(I=Math.round(l.dx)),l.dy&&(k=Math.round(l.dy)),l.dWidth&&(B=Math.round(l.dWidth)),l.dHeight&&(F=Math.round(l.dHeight)));let z=xe.RGBA;_&&_.pixelFormat&&(z=_.pixelFormat);const D=e;if(_&&_.bUseWebGL){(D.width<I+B||D.height<k+F)&&(D.width=I+B,D.height=k+F,D.ctxWebGL&&D.ctxWebGL.viewport(0,0,I+B,k+F));const R=D.ctxWebGL||D.getContext("webgl",{antialias:!1})||D.getContext("experimental-webgl",{antialias:!1});if(!R){const J=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw J.name="WebGLError",J}if(!D.ctxWebGL||z!==this.shaderPixelFormat){D.ctxWebGL=R;const J=f=>{const r=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,r),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),f.STATIC_DRAW);const o=f.createBuffer();return f.bindBuffer(f.ARRAY_BUFFER,o),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),f.STATIC_DRAW),{positions:r,texCoords:o}},y=f=>{const r=f.createTexture();return f.bindTexture(f.TEXTURE_2D,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),r},de=(f,r)=>{const o=f.createProgram();if(r.forEach(h=>f.attachShader(o,h)),f.linkProgram(o),!f.getProgramParameter(o,f.LINK_STATUS)){const h=new Error(`An error occured linking the program: ${f.getProgramInfoLog(o)}.`);throw h.name="WebGLError",h}return f.useProgram(o),o},ge=(f,r,o)=>{const h=f.createShader(r);if(f.shaderSource(h,o),f.compileShader(h),!f.getShaderParameter(h,f.COMPILE_STATUS)){const m=new Error(`An error occured compiling the shader: ${f.getShaderInfoLog(h)}.`);throw m.name="WebGLError",m}return h},be=`
                    attribute vec2 a_position;
                    attribute vec2 a_texCoord;

                    uniform mat3 u_matrix;
                    uniform mat3 u_textureMatrix;

                    varying vec2 v_texCoord;
                    void main(void) {
                    gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                    v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                    }
                `;let u="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(z)&&(u=z.slice(0,3));const a=`
                    precision mediump float;
                    varying vec2 v_texCoord;
                    uniform sampler2D u_image;
                    uniform float uColorFactor;

                    void main() {
                        vec4 sample = texture2D(u_image, v_texCoord);
                        float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                        gl_FragColor = vec4(sample.${u} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                    }
                `,c=de(R,[ge(R,R.VERTEX_SHADER,be),ge(R,R.FRAGMENT_SHADER,a)]);this._webGLProgramInfo={program:c,attribLocations:{vertexPosition:R.getAttribLocation(c,"a_position"),texPosition:R.getAttribLocation(c,"a_texCoord")},uniformLocations:{uSampler:R.getUniformLocation(c,"u_image"),uColorFactor:R.getUniformLocation(c,"uColorFactor"),uMatrix:R.getUniformLocation(c,"u_matrix"),uTextureMatrix:R.getUniformLocation(c,"u_textureMatrix")}},this._webGLBuffers=J(R),this._webGLTexture=y(R),this.shaderPixelFormat=z}const L=(J,y,de)=>{J.bindBuffer(J.ARRAY_BUFFER,y),J.enableVertexAttribArray(de),J.vertexAttribPointer(de,2,J.FLOAT,!1,0,0)},$=(J,y,de)=>{const ge=J.RGBA,be=J.RGBA,u=J.UNSIGNED_BYTE;J.bindTexture(J.TEXTURE_2D,y),J.texImage2D(J.TEXTURE_2D,0,ge,be,u,de)},ie=(J,y,de,ge)=>{J.clearColor(0,0,0,1),J.clearDepth(1),J.enable(J.DEPTH_TEST),J.depthFunc(J.LEQUAL),J.clear(J.COLOR_BUFFER_BIT|J.DEPTH_BUFFER_BIT),L(J,de.positions,y.attribLocations.vertexPosition),L(J,de.texCoords,y.attribLocations.texPosition),J.activeTexture(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,ge),J.uniform1i(y.uniformLocations.uSampler,0),J.uniform1f(y.uniformLocations.uColorFactor,[xe.GREY,xe.GREY32].includes(z)?1:0);let be,u,a=dt.translate(dt.identity(),-1,-1);a=dt.scale(a,2,2),a=dt.scale(a,1/J.canvas.width,1/J.canvas.height),be=dt.translate(a,I,k),be=dt.scale(be,B,F),J.uniformMatrix3fv(y.uniformLocations.uMatrix,!1,be),u=dt.translate(dt.identity(),S/n,w/s),u=dt.scale(u,T/n,A/s),J.uniformMatrix3fv(y.uniformLocations.uTextureMatrix,!1,u),J.drawArrays(J.TRIANGLES,0,6)};let ne;if($(R,this._webGLTexture,i),ie(R,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),d){if(d.length<B*F*4)throw new Error("Unexpected size of the 'bufferContainer'.");ne=d}else ne=new Uint8Array(B*F*4);if(R.readPixels(I,k,B,F,R.RGBA,R.UNSIGNED_BYTE,ne),ne[3]!==255){this._bWebGLSupported=!1;const J=new Error("WebGL error: incorrect WebGL drawing.");throw J.name="WebGLError",J}return{context:R,pixelFormat:z===xe.GREY?xe.GREY32:z,_bUseWebGL:!0}}{D.ctx2d||(D.ctx2d=D.getContext("2d",{willReadFrequently:!0}));const R=D.ctx2d;if(!R)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(D.width<I+B||D.height<k+F)&&(D.width=I+B,D.height=k+F),R.drawImage(i,S,w,T,A,I,k,B,F),{context:R,pixelFormat:xe.RGBA,_bUseWebGL:!1}}}_readCvsData(e,i,n){let s,l=0,d=0,_=e.canvas.width,S=e.canvas.height;if(i&&(i.x&&(l=i.x),i.y&&(d=i.y),i.width&&(_=i.width),i.height&&(S=i.height)),e instanceof WebGLRenderingContext){const w=e;if(n){if(n.length<_*S*4)throw new Error("Unexpected size of the 'bufferContainer'.");w.readPixels(l,d,_,S,w.RGBA,w.UNSIGNED_BYTE,n),s=new Uint8Array(n.buffer,0,_*S*4)}else s=new Uint8Array(_*S*4),w.readPixels(l,d,_,S,w.RGBA,w.UNSIGNED_BYTE,s)}else if(e instanceof CanvasRenderingContext2D){let w;if(w=e.getImageData(l,d,_,S),s=new Uint8Array(w.data.buffer),n){if(n.length<s.length)throw new Error("Unexpected size of the 'bufferContainer'.");n.set(s)}}return s}_transformPixelFormat(e,i,n,s){let l;if(i===n)return s?new Uint8Array(e):e;const d=[xe.RGBA,xe.RBGA,xe.GRBA,xe.GBRA,xe.BRGA,xe.BGRA];if(d.includes(i))if(n===xe.GREY){l=new Uint8Array(e.length/4);for(let _=0;_<e.length;_+=4){const S=.21*e[_]+.71*e[_+1]+.07*e[_+2];l[_/4]=S}}else if(n===xe.GREY32){l=s?new Uint8Array(e):e;for(let _=0;_<e.length;_+=4){const S=.21*e[_]+.71*e[_+1]+.07*e[_+2];l[_]=S,l[_+1]=S,l[_+2]=S}}else{if(!d.includes(n))throw new Error("Unable to transform.");if(s){l=new Uint8Array(e);const _=i.indexOf("r"),S=i.indexOf("g"),w=i.indexOf("b"),T=n.indexOf("r"),A=n.indexOf("g"),I=n.indexOf("b");for(let k=0;k<e.length;k+=4)l[k+T]=e[k+_],l[k+A]=e[k+S],l[k+I]=e[k+w]}else{l=e;const _=i.indexOf("r"),S=i.indexOf("g"),w=i.indexOf("b"),T=n.indexOf("r"),A=n.indexOf("g"),I=n.indexOf("b");for(let k=0;k<e.length;k+=4){let B=[e[k],e[k+1],e[k+2]];l[k+T]=B[_],l[k+A]=B[S],l[k+I]=B[w]}}}else if(i===xe.GREY){if(n!==xe.GREY32)throw new Error("Unable to transform.");l=new Uint8Array(4*e.length);for(let _=0;_<e.length;_++)l[4*_]=e[_],l[4*_+1]=e[_],l[4*_+2]=e[_],l[4*_+3]=255}else{if(i!==xe.GREY32)throw new Error("Unable to transform.");if(n!==xe.GREY)throw new Error("Unable to transform.");l=new Uint8Array(new Uint32Array(e.buffer))}return l}_getImageData(e,i,n,s,l,d){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!i||!n)return null;if(s.sx>i||s.sy>n||s.sx+s.sWidth>i||s.sy+s.sHeight>n)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");const _=Math.round(s.sx),S=Math.round(s.sy),w=Math.round(s.sWidth),T=Math.round(s.sHeight),A=Math.round(s.dWidth),I=Math.round(s.dHeight);let k=xe.RGBA;d&&d.pixelFormat&&(k=d.pixelFormat);let B,F,z,D=this._bWebGLSupported;d&&d.bUseWebGL==0&&(D=!1),D?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),B=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),B=this._reusedCvs);try{if(D)if(Se._onLog&&Se._onLog("DCE: _getImageData() in WebGL."),l)if(k===xe.GREY){if(z=new Uint8Array(A*I*4),F=this._drawImage(B,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},z,{pixelFormat:k,bUseWebGL:D}),z=this._transformPixelFormat(z,F.pixelFormat,k),l){if(l.length<z.length)throw new Error("Unexpected size of the 'bufferContainer'.");l.set(z)}}else F=this._drawImage(B,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},l,{pixelFormat:k,bUseWebGL:D}),z=new Uint8Array(l.buffer,0,A*I*4),z=this._transformPixelFormat(z,F.pixelFormat,k);else k===xe.GREY?((!this._tempDataContainer||this._tempDataContainer.length<A*I*4)&&(this._tempDataContainer=new Uint8Array(A*I*4)),z=new Uint8Array(this._tempDataContainer.buffer,0,A*I*4)):z=new Uint8Array(A*I*4),F=this._drawImage(B,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},z,{pixelFormat:k,bUseWebGL:D}),z=this._transformPixelFormat(z,F.pixelFormat,k);else if(Se._onLog&&Se._onLog("DCE: _getImageData() in context2d."),F=this._drawImage(B,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},null,{pixelFormat:xe.RGBA,bUseWebGL:D}),z=this._readCvsData(F.context,null,null),z=this._transformPixelFormat(z,F.pixelFormat,k),l){if(l.length<z.length)throw new Error("Unexpected size of the 'bufferContainer'.");l.set(z)}}catch(R){if(R.name==="WebGLError")return this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},l,d);throw R}return{data:z,pixelFormat:k,_bUseWebGL:F._bUseWebGL}}_getVideoData(e,i){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||this._video.readyState!==4)return null;const n=Date.now();let s=this._scanRegion;i&&i.hasOwnProperty("region")&&(s=i.region);let l=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());i&&i.pixelFormat&&(l=this.mapPixelFormatString_Enum.get(i.pixelFormat.toLowerCase()));let d=this._softwareScale;i&&i.scale&&(d=i.scale);const _=this._video.videoWidth,S=this._video.videoHeight;let w=this._scaleCenter;if(i&&i.scaleCenter){if(typeof i.scaleCenter.x!="string"||typeof i.scaleCenter.y!="string")throw new Error("Invalid scale center.");let F=0,z=0;if(i.scaleCenter.x.endsWith("px"))F=parseFloat(i.scaleCenter.x);else{if(!i.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");F=parseFloat(i.scaleCenter.x)/100*_}if(i.scaleCenter.y.endsWith("px"))z=parseFloat(i.scaleCenter.y);else{if(!i.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");z=parseFloat(i.scaleCenter.y)/100*S}if(F==NaN||z==NaN)throw new Error("Invalid scale center.");w.x=Math.round(F),w.y=Math.round(z)}if(_===0||S===0)return null;const T=this.getFrameSize(_,S,s,this.maxCvsSideLength);if(!T)return null;let A=!0;_===T.sWidth&&S===T.sHeight&&(A=!1);const I={data:null,region:s?JSON.parse(JSON.stringify(s)):null,sx:T.sx,sy:T.sy,width:T.dWidth,height:T.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:A,toCanvas:this._toCanvas,_sWidth:T.sWidth,_sHeight:T.sHeight,_bUseWebGL:null};d!==1&&(T.sWidth=Math.round(T.sWidth/d),T.sHeight=Math.round(T.sHeight/d),T.sx=Math.round((1-1/d)*w.x+T.sx/d),T.sy=Math.round((1-1/d)*w.y+T.sy/d));const k=this._getImageData(this._video,_,S,T,e,{pixelFormat:l});if(!k)return null;const B=Date.now();return I.data=k.data,I.pixelFormat=I.colorMode=k.pixelFormat,I._bUseWebGL=k._bUseWebGL,I.timeSpent=B-n,I.timeStamp=B,k.pixelFormat===xe.GREY?I.stride=I.width:I.stride=4*I.width,I}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const i=()=>{const s=this.getCurrentRegion();let l=this._getVideoData(null,{region:s});if(!l)return void Se._onLog;for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(l);const d=this.mapCameraEvents.get("frameaddedtobuffer");for(let _ of d)_&&setTimeout(()=>{this.isDisposed&&this.disposed||_.apply(this)},0)},n=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout(()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(i(),n()):this.stopFetchingLoop())},this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(i(),this.refreshInterval>0&&n()):this.refreshInterval>0?(i(),n()):this.refreshInterval===0?i():this.refreshInterval),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)},this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this.singleFrameMode)throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_createDrawingLayerBaseCvs(){this._assertOpen();const e=this._calculateCvsSize();if(!e)throw new Error("Camera is not open.");const{width:i,height:n,objectFit:s}=e;if(i<=0||n<=0)throw new Error("Invalid dimension of video or image.");const l=document.createElement("canvas");if(l.width==i&&l.height==n||(l.width=i,l.height=n),l.style.objectFit=s,this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.before(l);else if(this._cvsScanRegion)this._cvsScanRegion.before(l);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(l);else{if(!this._videoContainer)throw new Error("'_video' is lost.");this._videoContainer.after(l)}return l}_updateDrawingLayersSize(e){let i;if(i=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize(),!i)return;const{width:n,height:s,objectFit:l}=i;this._drawingLayersManager.setDimensions({width:n,height:s},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(l)}_createDrawingLayer(e){this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs());const i=this._layerBaseCvs;return this._drawingLayersManager.createDrawingLayer(i,e)}deleteDrawingLayer(e){this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayersManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayersManager.getDrawingLayers().filter(e=>e.getId()>=0)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayersManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayersManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayersManager.getDrawingStyles()}updateDrawingStyle(e,i){return this._drawingLayersManager.updateDrawingStyle(e,i)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let i of e)this.deleteDrawingLayer(i.getId())}showTip(e,i,n,s,l=3e3,d=!0){this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=i,this._tipArgs.width=n,this._tipArgs.autoShowSuggestedTip=!!d,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const _=new Hd(s||"",e,i,n,this._tipStyleId);_._fabricObject.paddingTop=15,_._fabricObject.calcTextHeight=function(){for(var S=0,w=0,T=this._textLines.length;w<T;w++)S+=this.getHeightOfLine(w);return S+2*this.paddingTop},_._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},_.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),_.setAttribute("lineHeight",1.3),_.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(_),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=l===void 0?3e3:l,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this.hideTip()},this._tipArgs.duration))}hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this.hideTip()},this._tipArgs.duration))}suggestTip(e,i){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(i):this._tipArgs.x!==void 0&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,i,this._tipArgs.duration)),this.onTipSuggested&&setTimeout(()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,i])},0)}_createControler(){if(this._controler||(this._controler=new tm(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,i,n){if(!e||!i||!n)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:i,height:n};let s=this._cvsOriginalImage;s||(s=document.createElement("canvas"),s.style.position="absolute",s.style.width="100%",s.style.height="100%",s.style.left="0",s.style.top="0",s.style.backgroundColor="white",s.style.objectFit="contain",this._cvsOriginalImage=s),s.width===i&&s.height===n||(s.width=i,s.height=n);const l=s.getContext("2d");l.clearRect(0,0,s.width,s.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),l.putImageData(new ImageData(e,i,n),0,0)):e instanceof HTMLCanvasElement&&l.drawImage(e,0,0),document.body.contains(s)&&s.style.display===""&&this._updateDrawingLayersSize({width:i,height:n,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}async deleteOriginalImage(){await this.hideOriginalImage(),this._cvsOriginalImage&&(this._cvsOriginalImage.remove(),this._cvsOriginalImage=null),this._originalImageData=null}_showOriginalImageCvs(){this._cvsOriginalImage&&this._cvsOriginalImage.style.display=="none"&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(e.style.display===""&&document.body.contains(e))return;const{width:i,height:n}=this._originalImageData;if(this._updateDrawingLayersSize({width:i,height:n,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}async _hideOriginalImage(e){this._originalImageData&&this._cvsOriginalImage&&this._cvsOriginalImage.style.display!=="none"&&(this._updateDrawingLayersSize(),this._bOpen&&e&&(this._video&&this._recordedStates.videoPlaying&&await this.play(null,null,null,{notTriggerSingleFrameClick:!0}),this._recordedStates.fetchingLoopStart&&!this.singleFrameMode&&this.startFetchingLoop(),this.ifShowScanRegionMask&&this._cvsScanRegion&&this._recordedStates.maskShow&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this._divScanLight&&this._recordedStates.laserShow&&this.showScanRegionLaser(),this._cvsViewDecorator&&this._recordedStates.decoratorShow&&this.showViewDecorator(),this._scanRegionOverlayContainer&&this._recordedStates.overlayShow&&this.showScanRegionOverlays()),this._selCam&&(this._selCam.parentElement.style.display=""),this._hideOriginalImageCvs())}async hideOriginalImage(){return this._hideOriginalImage(!0)}dispose(e){this.UIElement&&(this._uiOriginalState&&this._uiOriginalState.inDom?this.UIElement.style.display=this._uiOriginalState.display:this.UIElement.style.display="none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let i in this)delete this[i];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}Se._jsVersion="3.2.0",Se._jsEditVersion="20221213",Se._version="JS "+Se._jsVersion+"."+Se._jsEditVersion,Se.browserInfo=He,Se._hasEngineResourceLoaded=!1,Se._engineResourcePath=Qp,Se._defaultUIElementURL="@engineResourcePath/dce.ui.html";const im={DT_Arc:class extends pt{constructor(t,e,i,n,s,l){super(new Ce.Circle({left:t,top:e,radius:i,startAngle:n,endAngle:s}),l),this._mediaType="arc"}},DT_Polygon:Jc,DT_Rect:class extends pt{constructor(t,e,i,n,s){super(new Ce.Rect({left:t,top:e,width:i,height:n}),s)}},DT_Image:class extends pt{constructor(t,e,i,n){super(new Ce.Image(t,{left:e,top:i}),n),this.image=t}_extendSet(t,e){if(t==="image"){if(e instanceof HTMLImageElement)return this._fabricObject.setElement(e),this.image=e,!0;if(e instanceof HTMLCanvasElement){const i=new Image;return i.src=e.toDataURL(),this._fabricObject.setElement(i),this.image=e,!0}throw new Error("Unsupported value.")}}_extendGet(t){if(t==="image")return this.image}},DT_Text:Hd,DT_Line:class extends Jc{constructor(t,e,i){super([t,e],i),this._mediaType="line"}_extendSet(t,e){if(t==="startPoint"||t==="endPoint"){e=t==="startPoint"?[e,this.get("endPoint")]:[this.get("startPoint"),e];const i=this._fabricObject;if(i.group){const s=i.group;i.points=e.map(l=>({x:l.x-s.left-s.width/2,y:l.y-s.top-s.height/2})),s.addWithUpdate()}else i.points=e;const n=i.points.length-1;return i.controls=i.points.reduce(function(s,l,d){return s["p"+d]=new Ce.Control({positionHandler:Ea,actionHandler:Aa(d>0?d-1:n,Ia),actionName:"modifyPolygon",pointIndex:d}),s},{}),i._setPositionDimensions({}),!0}}_extendGet(t){if(t==="startPoint"||t==="endPoint"){const e=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let n in i.oCoords)e.push({x:i.oCoords[n].x,y:i.oCoords[n].y});else for(let n of i.points){let s=n.x-i.pathOffset.x,l=n.y-i.pathOffset.y;const d=Ce.util.transformPoint({x:s,y:l},i.calcTransformMatrix());e.push({x:d.x,y:d.y})}return t==="startPoint"?e[0]:e[1]}}},DT_Group:class extends pt{constructor(t){super(new Ce.Group(t.map(e=>e._getFabricObject()))),this._fabricObject.on("selected",()=>{this.styleSelector="selected";const e=this._fabricObject._objects;for(let i of e)setTimeout(()=>{i&&i.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.styleSelector="default";const e=this._fabricObject._objects;for(let i of e)setTimeout(()=>{i&&i.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)})}getChildItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}addChildItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}};function nm(t,e,i){return(i.x-t.x)*(e.y-t.y)==(e.x-t.x)*(i.y-t.y)&&Math.min(t.x,e.x)<=i.x&&i.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=i.y&&i.y<=Math.max(t.y,e.y)}function bs(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Vr(t,e,i,n){let s=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),l=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return!((s^l)>=0&&s!==0&&l!==0)&&(s=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),l=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),!((s^l)>=0&&s!==0&&l!==0))}class Nt extends j{constructor(){super(),this._barcodeFillStyle="rgba(254,180,32,0.3)",this._barcodeStrokeStyle="rgba(254,180,32,0.9)",this._barcodeLineWidth=1,this._barcodeFillStyleBeforeVerification="rgba(248,252,0,0.2)",this._barcodeStrokeStyleBeforeVerification="transparent",this._barcodeLineWidthBeforeVerification=2,this.bFilterRegionInJs=!0,this._onCameraSelChange=()=>{},this._onResolutionSelChange=()=>{},this._onCloseBtnClick=()=>{},this._onPlayed=null}static get version(){return this._version+`(DCE ${Se.getVersion()})`}static _fireHTTPSWarnning(){Nt.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{Nt.onWarning&&Nt.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}_fireResolutionWarning(){if(!this.singleFrameMode&&this.onWarning&&this.dce.isOpen()){const e=this.dce.getConstraints();e&&e.width<1280&&e.height<720&&setTimeout(()=>{this.onWarning&&this.onWarning({id:3,message:"Camera resolution too low, please use a higher resolution (720P or better)."})},0)}}getUIElement(){return this.dce.getUIElement()}async setUIElement(e){await this.dce.setUIElement(e)}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,(async()=>{let i=await this.getScanSettings();i.oneDTrustFrameCount=1,await this.updateScanSettings(i)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}get video(){return this.dce&&this.dce.video}set videoSrc(e){this.dce&&(this.dce.videoSrc=e)}get videoSrc(){return this.dce&&this.dce.videoSrc}set onTipSuggested(e){this.dce&&(this.dce.onTipSuggested=e)}get onTipSuggested(){return this.dce&&this.dce.onTipSuggested}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set barcodeFillStyle(e){this._barcodeFillStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{fillStyle:e})}get barcodeFillStyle(){return this._barcodeFillStyle}set barcodeStrokeStyle(e){this._barcodeStrokeStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{strokeStyle:e})}get barcodeStrokeStyle(){return this._barcodeStrokeStyle}set barcodeLineWidth(e){this._barcodeLineWidth=e,this.dce&&this.dce.updateDrawingStyle(3,{lineWidth:e})}get barcodeLineWidth(){return this._barcodeLineWidth}set barcodeFillStyleBeforeVerification(e){this._barcodeFillStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{fillStyle:e})}get barcodeFillStyleBeforeVerification(){return this._barcodeFillStyleBeforeVerification}set barcodeStrokeStyleBeforeVerification(e){this._barcodeStrokeStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{strokeStyle:e})}get barcodeStrokeStyleBeforeVerification(){return this._barcodeStrokeStyleBeforeVerification}set barcodeLineWidthBeforeVerification(e){this._barcodeLineWidthBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{lineWidth:e})}get barcodeLineWidthBeforeVerification(){return this._barcodeLineWidthBeforeVerification}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.framePixelFormat=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}async createDCEInstance(){this.dce||(j._onLog&&j._onLog("createDCEInstance()"),Se.defaultUIElementURL=null,this.dce=await Se.createInstance(),this.dce.refreshInterval=200,this.dce.framePixelFormat="grey",this.dce.maxCvsSideLength=this.maxCvsSideLength,this._drawingItemNamespace=im,["iPhone","iPad","Android","HarmonyOS"].includes(j.browserInfo.OS)||this.dce.setResolution(1920,1080),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"}),this.barcodeLineWidth=this._barcodeLineWidth,this.dce.on("cameraChange",()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("resolutionChange",()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("cameraClose",()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1}),this.dce.on("singleFrameAcquired",async e=>{if(!e||!e.data)return;let i;this._drawResults(null),this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:n,sx:s,sy:l,width:d,height:_,stride:S,pixelFormat:w,timeStamp:T,_sWidth:A,_sHeight:I}=e,k={timeStamp:T};if(w==="grey")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_GrayScaled,k);else if(w==="rgba")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ABGR_8888,k);else{if(w!=="bgra")throw new Error(`Pixel format '${w}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ARGB_8888,k)}if(await this.clearMapDecodeRecord(),j.recalculateResultLocation(i,s,l,A,I,d,_),this._drawResults(i),this.onFrameRead&&this.isOpen()&&!this._bPauseScan){let B=this._cloneDecodeResults(i);this.onFrameRead(B)}if(this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let B of i)this.onUniqueRead(B.barcodeText,this._cloneDecodeResults(B))}))}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}static async createInstance(e){let i=new Nt;i._instanceID=await Nt.createInstanceInWorker(!0),await i.createDCEInstance(),typeof e=="string"&&(e=JSON.parse(e));for(let n in e)i[n]=e[n];return await i.dce.setUIElement(Nt.defaultUIElementURL),i.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),Nt._fireHTTPSWarnning(),i.singleFrameMode||await i.updateRuntimeSettings("single"),i}async decodeCurrentFrame(e){this._assertOpen();let i=null;e&&e.region&&(i=e.region);const n=this.dce._getVideoData(null,{region:i});return this._decode_DCEFrame(n)}async updateRuntimeSettings(e){let i;if(typeof e=="string")if(e=="speed"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9}else if(e=="balance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=512,i.deblurLevel=3,i.localizationModes=[2,16,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="coverage"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=512,i.deblurLevel=5,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="single"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region)}else if(e=="dense"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.deblurLevel=7,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.minResultConfidence=0,i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="distance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else i=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let n=e.region;[n.regionLeft,n.regionTop,n.regionLeft,n.regionBottom,n.regionMeasuredByPercentage].some(s=>s!==void 0)&&(i.region={regionLeft:n.regionLeft||0,regionTop:n.regionTop||0,regionRight:n.regionRight||0,regionBottom:n.regionBottom||0,regionMeasuredByPercentage:n.regionMeasuredByPercentage||0})}}if(!j._bUseFullFeature){if(i.barcodeFormatIds&~(gt.BF_ONED|gt.BF_QR_CODE|gt.BF_PDF417|gt.BF_DATAMATRIX)||i.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(i.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let n=i.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(n)):this.userDefinedRegion=null,n instanceof Array)if(n.length){for(let s=0;s<n.length;++s){let l=n[s];l&&((l.regionLeft||l.regionTop||l.regionRight||l.regionBottom||l.regionMeasuredByPercentage)&&(l.regionLeft||l.regionTop||l.regionRight!=100||l.regionBottom!=100||!l.regionMeasuredByPercentage)||(n[s]=null))}this.region=n}else this.region=null;else n&&(n.regionLeft||n.regionTop||n.regionRight||n.regionBottom||n.regionMeasuredByPercentage)&&(n.regionLeft||n.regionTop||n.regionRight!=100||n.regionBottom!=100||!n.regionMeasuredByPercentage)?this.region=n:this.region=null;this.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}(this.autoZoom||this.autoFocus)&&(i.intermediateResultTypes|=Sn.IRT_TYPED_BARCODE_ZONE),await new Promise((n,s)=>{let l=j._nextTaskID++;j._taskCallbackMap.set(l,d=>{if(d.success){try{this._handleRetJsonString(d.updateReturn)}catch(_){s(_)}return n()}{let _=new Error(d.message);return _.stack=d.stack+`
`+_.stack,s(_)}}),j._dbrWorker.postMessage({type:"updateRuntimeSettings",id:l,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})}),typeof e=="string"&&["speed","balance","coverage","dense","distance"].includes(e)&&(await this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","1"),await this.setModeArgument("BinarizationModes",0,"BlockSizeX","0"),await this.setModeArgument("BinarizationModes",0,"BlockSizeY","0"))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}async getAllCameras(){return this.dce.getAllCameras()}async getCurrentCamera(){return this.dce.getSelectedCamera()}async setCurrentCamera(e){const i=await this.dce.selectCamera(e);return this._fireResolutionWarning(),i}getResolution(){return this.dce.getResolution()}async setResolution(e,i){const n=await this.dce.setResolution(e,i);return this._fireResolutionWarning(),n}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}set ifSaveLastUsedCamera(e){this.dce&&(this.dce.ifSaveLastUsedCamera=e)}get ifSaveLastUsedCamera(){return this.dce&&this.dce.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){this.dce&&(this.dce.ifSkipCameraInspection=e)}get ifSkipCameraInspection(){return this.dce&&this.dce.ifSkipCameraInspection}stop(){this._drawResults(null),this.dce.stop(),this.dce.ifShowScanRegionLaser=!1,this.dce.hideViewDecorator(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}async play(e,i,n){this.dce.ifShowScanRegionLaser=!0;const s=await this.dce.play(e,i,n);return this._fireResolutionWarning(),s}pauseScan(e){this._assertOpen(),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}async applyConstraints(e){return this.dce.applyConstraints(e)}async turnOnTorch(){return this.dce.turnOnTorch()}async turnOffTorch(){return this.dce.turnOffTorch()}async setColorTemperature(e){return this.dce.setColorTemperature(e)}getColorTemperature(){return this.dce.getColorTemperature()}async setExposureCompensation(e){return this.dce.setExposureCompensation(e)}getExposureCompensation(){return this.dce.getExposureCompensation()}async setZoom(e){return this.dce.setZoom(e)}getZoomSettings(){return this.dce.getZoomSettings()}resetZoom(){return this.dce.resetZoom()}async setFrameRate(e){return this.dce.setFrameRate(e)}getFrameRate(){return this.dce.getFrameRate()}async setFocus(e,i){return this.dce.setFocus(e,i)}getFocus(){return this.dce.getFocus()}getFocusSettings(){return this.dce.getFocusSettings()}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),void this._drawResults(null);if(!this.isOpen())return this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return j._onLog&&j._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));j._onLog&&j._onLog("======= once read ======="),j._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return j._onLog&&j._onLog("Get invalid frame."),this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{e._bUseWebGL||e.pixelFormat!=="grey"||(this.dce.framePixelFormat="rgba");let i=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:n,sx:s,sy:l,width:d,height:_,stride:S,pixelFormat:w,timeStamp:T,_sWidth:A,_sHeight:I}=e,k={timeStamp:T};if(w==="grey")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_GrayScaled,k);else if(w==="rgba")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ABGR_8888,k);else{if(w!=="bgra")throw new Error(`Pixel format '${w}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ARGB_8888,k)}if(j.recalculateResultLocation(i,s,l,A,I,d,_),this._drawResults(i),this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan&&(this.autoZoom||this.autoFocus||this.autoSuggestTip))if(i.length)this.autoZoomInFrameArray.length=0,this.autoZoomOutFrameCount=0,this.frameArrayInIdealZoom.length=0,this.suggestTipFrameArray.length=0,this.autoZoom&&this.autoFocus&&(this.nextActionInIdealZoom="focus"),this.autoFocusFrameArray.length=0,this.noIntermediateResultsCount=0;else{const B=await this.getIntermediateResults(),F=(R,L,$,ie,ne,J,y)=>{let de=J/ie,ge=y/ne;R.x1=R.x1/de+L,R.x2=R.x2/de+L,R.x3=R.x3/de+L,R.x4=R.x4/de+L,R.y1=R.y1/ge+$,R.y2=R.y2/ge+$,R.y3=R.y3/ge+$,R.y4=R.y4/ge+$},z=R=>{if(!R)return null;const L={};let $,ie,ne,J,y;{const g=this.video.videoWidth*(1-this.autoZoomDetectionArea)/2,p=this.video.videoWidth*(1+this.autoZoomDetectionArea)/2,v=p,C=g,x=this.video.videoHeight*(1-this.autoZoomDetectionArea)/2,b=x,E=this.video.videoHeight*(1+this.autoZoomDetectionArea)/2;y={x1:g,x2:p,x3:v,x4:C,y1:x,y2:b,y3:E,y4:E}}const de=(g,p)=>{const v=(x,b)=>{if(!x&&!b)throw new Error("Invalid arguments.");return function(E,O,M){let W=!1;const G=E.length;if(G<=2)return!1;for(let Q=0;Q<G;Q++){const K=E[Q],Y=E[(Q+1)%G];if(nm(K,Y,{x:O,y:M}))return!0;bs(K.y-M)>0!=bs(Y.y-M)>0&&bs(O-(M-K.y)*(K.x-Y.x)/(K.y-Y.y)-K.x)<0&&(W=!W)}return W}([{x:b.x1,y:b.y1},{x:b.x2,y:b.y2},{x:b.x3,y:b.y3},{x:b.x4,y:b.y4}],x.x,x.y)},C=(x,b)=>!!(Vr([x[0],x[1]],[x[2],x[3]],[b.x1,b.y1],[b.x2,b.y2])||Vr([x[0],x[1]],[x[2],x[3]],[b.x2,b.y2],[b.x3,b.y3])||Vr([x[0],x[1]],[x[2],x[3]],[b.x3,b.y3],[b.x4,b.y4])||Vr([x[0],x[1]],[x[2],x[3]],[b.x4,b.y4],[b.x1,b.y1]));return!!(v({x:g.x1,y:g.y1},p)||v({x:g.x2,y:g.y2},p)||v({x:g.x3,y:g.y3},p)||v({x:g.x4,y:g.y4},p))||!!(v({x:p.x1,y:p.y1},g)||v({x:p.x2,y:p.y2},g)||v({x:p.x3,y:p.y3},g)||v({x:p.x4,y:p.y4},g))||!!(C([p.x1,p.y1,p.x2,p.y2],g)||C([p.x2,p.y2,p.x3,p.y3],g)||C([p.x3,p.y3,p.x4,p.y4],g)||C([p.x4,p.y4,p.x1,p.y1],g))},ge=[];for(let g of R){if(g.resultType!==Sn.IRT_TYPED_BARCODE_ZONE)continue;const p=g.scaleDownRatio;for(let v of g.results){if(!v)continue;const C={x1:v.x1=v.x1*p,x2:v.x2=v.x2*p,x3:v.x3=v.x3*p,x4:v.x4=v.x4*p,y1:v.y1=v.y1*p,y2:v.y2=v.y2*p,y3:v.y4=v.y3*p,y4:v.y4=v.y4*p};F(C,s,l,A,I,d,_),de(y,C)&&ge.push(v)}}const be=(g=>{if(!g||!g.length)return null;const p=b=>{const E=(b.x1+b.x2+b.x3+b.x4)/4,O=(b.y1+b.y2+b.y3+b.y4)/4;return(E-d/2)*(E-d/2)+(O-_/2)*(O-_/2)};let v,C=g.filter(b=>b.barcodeFormat==gt.BF_QR_CODE||b.barcodeFormat==gt.BF_DATAMATRIX);if(C.length||(C=g.filter(b=>b.barcodeFormat==gt.BF_ONED),C.length||(C=g)),!C.length)return null;v=C[0];let x=p(v);if(C.length!=1)for(let b=1;b<C.length;b++){const E=p(C[b]);(C[b].confidence>1.1*v.confidence||C[b].confidence>.9*v.confidence&&E<x)&&(v=C[b],x=E)}return v})(ge);if(!be)return null;const u=be.x1,a=be.x2,c=be.x3,f=be.x4,r=be.y1,o=be.y2,h=be.y3,m=be.y4;return $=Math.min(u,a,c,f),ie=Math.max(u,a,c,f),ne=Math.min(r,o,h,m),J=Math.max(r,o,h,m),L.x1=L.x4=$,L.x2=L.x3=ie,L.y1=L.y2=ne,L.y3=L.y4=J,L.result=be,L},D=z(B);if(D&&D.x1,D&&D.x1){if(this.autoZoomOutFrameCount=0,this.noIntermediateResultsCount=0,this.suggestTipFrameArray.push(!0),this.suggestTipFrameArray.splice(0,this.suggestTipFrameArray.length-this.suggestTipFrameLimit[0]),this.autoSuggestTip&&this.suggestTipFrameArray.filter(R=>R===!0).length>=this.suggestTipFrameLimit[1]){this.suggestTipFrameArray.length=0;const R=D.x3-D.x1,L=D.y3-D.y1;D.result.moduleSize<this.tinyBarcodeTipModuleSizeLimit?this.dce&&this.dce.suggestTip("tiny-barcode","Please zoom in or move closer."):R>L?R>d*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):R>.6*d&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."):R<=L&&(L>_*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):L>.6*_&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."))}if(this.autoZoom){let R=(1-this.autoZoomTargetBorder)/2;const L=D.x1/A,$=(A-D.x3)/A,ie=D.y1/I,ne=(I-D.y3)/I;if(D.result.moduleSize<this.autoZoomInIdealModuleSize){if(this.autoZoomInFrameArray.push(!0),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.frameArrayInIdealZoom.length=0,this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(()=>{})),this.autoZoomInFrameArray.filter(J=>J===!0).length>=this.autoZoomInFrameLimit[1]){this.autoZoomInFrameArray.length=0;const J=this.autoZoomInIdealModuleSize/D.result.moduleSize,y=this.dce.getZoomSettings().factor;let de=Math.max(Math.pow(y*J,1/this.autoZoomInMaxTimes),this.autoZoomInMinStep);de=Math.min(de,J);const ge=y*de;await this.setZoom({factor:ge}),this.dce.clearFrameBuffer()}}else if(this.autoZoomInFrameArray.length=0,this.frameArrayInIdealZoom.push(!0),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.frameArrayInIdealZoom.filter(J=>J===!0).length>=this.frameLimitInIdealZoom[1])if(this.frameArrayInIdealZoom.length=0,this.nextActionInIdealZoom==="focus"&&this.autoFocus){F(D,s,l,A,I,d,_);try{await this.setFocus({mode:"manual",area:{centerPoint:{x:(D.x1+D.x3)/2+"px",y:(D.y1+D.y3)/2+"px"},width:D.x3-D.x1+"px",height:D.y3-D.y1+"px"}})}catch{}this.dce.clearFrameBuffer(),this.nextActionInIdealZoom="zoomOut"}else{if(this.nextActionInIdealZoom!=="zoomOut"&&this.autoFocus)throw new Error("Invalid action.");if(this.enableZoomOutInIdealZoom){R=this.autoZoomIdealArea[1]+this.autoZoomOutStepRate_2;const J=[(.5-R)/(.5-L),(.5-R)/(.5-$),(.5-R)/(.5-ie),(.5-R)/(.5-ne)].filter(de=>de>0);let y=Math.min(...J)*this.dce.getZoomSettings().factor;await this.setZoom({factor:y}),this.dce.clearFrameBuffer(),this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(de=>{}))}}}else if(this.autoFocus&&(this.autoFocusFrameArray.push(!0),this.autoFocusFrameArray.splice(0,this.autoFocusFrameArray.length-this.autoFocusFrameLimit[0]),this.autoFocusFrameArray.filter(R=>R===!0).length>=this.autoFocusFrameLimit[1])){this.autoFocusFrameArray.length=0;try{F(D,s,l,A,I,d,_),await this.setFocus({mode:"manual",area:{centerPoint:{x:(D.x1+D.x3)/2+"px",y:(D.y1+D.y3)/2+"px"},width:D.x3-D.x1+"px",height:D.y3-D.y1+"px"}})}catch{}this.dce.clearFrameBuffer()}}else if(this.noIntermediateResultsCount++,this.suggestTipFrameArray.push(!1),this.autoZoom){if(this.autoZoomInFrameArray.push(!1),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.autoZoomOutFrameCount++,this.frameArrayInIdealZoom.push(!1),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.autoZoomOutFrameCount>=this.autoZoomOutFrameLimit){this.autoZoomOutFrameCount=0;const R=this.getZoomSettings().factor;if(R>this.autoZoomOutMinValue){const L=Math.max((R-1)*this.autoZoomOutStepRate,this.autoZoomOutMinStep),$=Math.max(R-L,this.autoZoomOutMinValue);await this.setZoom({factor:$}),this.dce.clearFrameBuffer()}}this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(R=>{}))}else this.autoFocus&&(this.autoFocusFrameArray.length=0,this.setFocus({mode:"continuous"}).catch(R=>{}))}return i})().then(i=>{if(j._onLog&&j._onLog(i),this.captureAndDecodeInParallel){let n=this.array_decodeFrameTimeCost,s=this.array_getFrameTimeCost,l=this._indexCurrentDecodingFrame;const d=()=>{let _=0;if(this.region instanceof Array){let S=0,w=0;S=l+1>=this.region.length?0:l+1,w=S+1>=this.region.length?0:S+1,_=n[S]&&n[S].length&&s[w]&&s[w].length?Math.min(...n[S])-Math.max(...s[w]):0}else if(s&&s.length){let S=Math.min(...n),w=Math.max(...s);S&&w&&(_=S-w)}else _=0;return _>0?_:0};(()=>{if(this.region instanceof Array){for(n[l]&&n[l]instanceof Array||(n[l]=[]);n[l].length>=5;)n[l].shift();n[l].push(this._lastInnerDecodeDuration)}else{for(;n.length>=5;)n.shift();n.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=d()+this.intervalTime,j._onLog&&j._onLog("Next fetching frame loop interval: "+this._intervalGetVideoFrame)}if(this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&i.length){let n=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?n=i.some(s=>s.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(n=i.some(s=>s.resultState==0)),n&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&i.length){let n=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?n=i.some(s=>s.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(n=i.some(s=>s.resultState==0)),n)try{navigator.vibrate(this.vibrateDuration)}catch(s){console.warn("Vibration not allowed. User interaction required: "+(s.message||s))}}if(this.onFrameRead){i=i.filter(s=>s.resultState>=0);const n=this._cloneDecodeResults(i);this.onFrameRead(n)}if(this.onUniqueRead){i=i.filter(s=>s.resultState==0);const n=this._cloneDecodeResults(i);for(let s of n)this.onUniqueRead(s.barcodeText,s)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){j._onLog&&j._onLog("Get frame in parallel.");let i=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,i||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;e=this.dce.getFrameFromBuffer(),(s=>{if(!s)return;let l=s.timeSpent,d=this.array_getFrameTimeCost;for(;d.length>=5;)d.shift();d.push(l)})(e)}else j._onLog&&j._onLog("Get frame in serial."),this.dce.stopFetchingLoop(),e=this.dce.getFrame();return e}async open(){this._bindUI();const e=await this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async openVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}close(){this.dce.close(),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}async show(){this._bindUI();const e=await this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async showVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}hide(){this.dce.close(!0),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}showTip(e,i,n,s,l=3e3,d=!0){this.dce&&this.dce.showTip(e,i,n,s,l,d)}hideTip(){this.dce&&this.dce.hideTip()}updateTipMessage(e){this.dce&&this.dce.updateTipMessage(e)}destroyContext(){this.close(),this.dce&&this.dce.dispose(!1),this.bDestroyed||super.destroyContext()}}var qc,eu,tu,iu,nu,ru,ou,su,au,lu,cu,uu,hu,du,fu,gu,pu,mu,_u,vu,yu,Su,wu,Cu,xu,Tu;(function(t){t[t.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",t[t.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",t[t.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",t[t.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",t[t.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",t[t.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",t[t.BICM_SKIP=0]="BICM_SKIP",t[t.BICM_REV=2147483648]="BICM_REV"})(qc||(qc={})),function(t){t[t.BCM_AUTO=1]="BCM_AUTO",t[t.BCM_GENERAL=2]="BCM_GENERAL",t[t.BCM_SKIP=0]="BCM_SKIP",t[t.BCM_REV=2147483648]="BCM_REV"}(eu||(eu={})),function(t){t[t.BF2_NULL=0]="BF2_NULL",t[t.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",t[t.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",t[t.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",t[t.BF2_POSTNET=2097152]="BF2_POSTNET",t[t.BF2_PLANET=4194304]="BF2_PLANET",t[t.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",t[t.BF2_RM4SCC=16777216]="BF2_RM4SCC",t[t.BF2_DOTCODE=2]="BF2_DOTCODE",t[t.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",t[t.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",t[t.BF2_PHARMACODE=12]="BF2_PHARMACODE",t[t.BF2_ALL=4294967295]="BF2_ALL"}(tu||(tu={})),function(t){t[t.BM_AUTO=1]="BM_AUTO",t[t.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",t[t.BM_SKIP=0]="BM_SKIP",t[t.BM_THRESHOLD=4]="BM_THRESHOLD",t[t.BM_REV=2147483648]="BM_REV"}(iu||(iu={})),function(t){t[t.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(nu||(nu={})),function(t){t[t.CFM_GENERAL=1]="CFM_GENERAL"}(ru||(ru={})),function(t){t[t.CCM_AUTO=1]="CCM_AUTO",t[t.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",t[t.CCM_SKIP=0]="CCM_SKIP",t[t.CCM_REV=2147483648]="CCM_REV"}(ou||(ou={})),function(t){t[t.CICM_GENERAL=1]="CICM_GENERAL",t[t.CICM_SKIP=0]="CICM_SKIP",t[t.CICM_REV=2147483648]="CICM_REV"}(su||(su={})),function(t){t[t.CM_IGNORE=1]="CM_IGNORE",t[t.CM_OVERWRITE=2]="CM_OVERWRITE"}(au||(au={})),function(t){t[t.DM_SKIP=0]="DM_SKIP",t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(lu||(lu={})),function(t){t[t.DRM_AUTO=1]="DRM_AUTO",t[t.DRM_GENERAL=2]="DRM_GENERAL",t[t.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",t[t.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",t[t.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",t[t.DRM_SKIP=0]="DRM_SKIP",t[t.DRM_REV=2147483648]="DRM_REV"}(cu||(cu={})),function(t){t[t.DPMCRM_AUTO=1]="DPMCRM_AUTO",t[t.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",t[t.DPMCRM_SKIP=0]="DPMCRM_SKIP",t[t.DPMCRM_REV=2147483648]="DPMCRM_REV"}(uu||(uu={})),function(t){t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_REV=2147483648]="GTM_REV"}(hu||(hu={})),function(t){t[t.IPM_AUTO=1]="IPM_AUTO",t[t.IPM_GENERAL=2]="IPM_GENERAL",t[t.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",t[t.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",t[t.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",t[t.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",t[t.IPM_SKIP=0]="IPM_SKIP",t[t.IPM_REV=2147483648]="IPM_REV"}(du||(du={})),function(t){t[t.IRSM_MEMORY=1]="IRSM_MEMORY",t[t.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",t[t.IRSM_BOTH=4]="IRSM_BOTH"}(fu||(fu={})),function(t){t[t.LM_SKIP=0]="LM_SKIP",t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=2147483648]="LM_REV"}(gu||(gu={})),function(t){t[t.PDFRM_RASTER=1]="PDFRM_RASTER",t[t.PDFRM_AUTO=2]="PDFRM_AUTO",t[t.PDFRM_VECTOR=4]="PDFRM_VECTOR",t[t.PDFRM_REV=2147483648]="PDFRM_REV"}(pu||(pu={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(mu||(mu={})),function(t){t[t.RPM_AUTO=1]="RPM_AUTO",t[t.RPM_GENERAL=2]="RPM_GENERAL",t[t.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",t[t.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",t[t.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",t[t.RPM_SKIP=0]="RPM_SKIP",t[t.RPM_REV=2147483648]="RPM_REV"}(_u||(_u={})),function(t){t[t.RCT_PIXEL=1]="RCT_PIXEL",t[t.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(vu||(vu={})),function(t){t[t.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",t[t.RT_RAW_TEXT=1]="RT_RAW_TEXT",t[t.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",t[t.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(yu||(yu={})),function(t){t[t.SUM_AUTO=1]="SUM_AUTO",t[t.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",t[t.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",t[t.SUM_SKIP=0]="SUM_SKIP",t[t.SUM_REV=2147483648]="SUM_REV"}(Su||(Su={})),function(t){t[t.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",t[t.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",t[t.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",t[t.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",t[t.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",t[t.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(wu||(wu={})),function(t){t[t.TFM_AUTO=1]="TFM_AUTO",t[t.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",t[t.TFM_SKIP=0]="TFM_SKIP",t[t.TFM_REV=2147483648]="TFM_REV"}(Cu||(Cu={})),function(t){t[t.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",t[t.TROM_POSITION=2]="TROM_POSITION",t[t.TROM_FORMAT=4]="TROM_FORMAT",t[t.TROM_SKIP=0]="TROM_SKIP",t[t.TROM_REV=2147483648]="TROM_REV"}(xu||(xu={})),function(t){t[t.TDM_AUTO=1]="TDM_AUTO",t[t.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",t[t.TDM_SKIP=0]="TDM_SKIP",t[t.TDM_REV=2147483648]="TDM_REV"}(Tu||(Tu={}));j.license="DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9";j.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.0/dist/";const rm=(t,e)=>e.some(i=>t instanceof i);let bu,Eu;function om(){return bu||(bu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sm(){return Eu||(Eu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Yd=new WeakMap,Oa=new WeakMap,Xd=new WeakMap,Es=new WeakMap,El=new WeakMap;function am(t){const e=new Promise((i,n)=>{const s=()=>{t.removeEventListener("success",l),t.removeEventListener("error",d)},l=()=>{i(vi(t.result)),s()},d=()=>{n(t.error),s()};t.addEventListener("success",l),t.addEventListener("error",d)});return e.then(i=>{i instanceof IDBCursor&&Yd.set(i,t)}).catch(()=>{}),El.set(e,t),e}function lm(t){if(Oa.has(t))return;const e=new Promise((i,n)=>{const s=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",d),t.removeEventListener("abort",d)},l=()=>{i(),s()},d=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",l),t.addEventListener("error",d),t.addEventListener("abort",d)});Oa.set(t,e)}let Ra={get(t,e,i){if(t instanceof IDBTransaction){if(e==="done")return Oa.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Xd.get(t);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return vi(t[e])},set(t,e,i){return t[e]=i,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function cm(t){Ra=t(Ra)}function um(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const n=t.call(Is(this),e,...i);return Xd.set(n,e.sort?e.sort():[e]),vi(n)}:sm().includes(t)?function(...e){return t.apply(Is(this),e),vi(Yd.get(this))}:function(...e){return vi(t.apply(Is(this),e))}}function hm(t){return typeof t=="function"?um(t):(t instanceof IDBTransaction&&lm(t),rm(t,om())?new Proxy(t,Ra):t)}function vi(t){if(t instanceof IDBRequest)return am(t);if(Es.has(t))return Es.get(t);const e=hm(t);return e!==t&&(Es.set(t,e),El.set(e,t)),e}const Is=t=>El.get(t);function dm(t,e,{blocked:i,upgrade:n,blocking:s,terminated:l}={}){const d=indexedDB.open(t,e),_=vi(d);return n&&d.addEventListener("upgradeneeded",S=>{n(vi(d.result),S.oldVersion,S.newVersion,vi(d.transaction),S)}),i&&d.addEventListener("blocked",S=>i(S.oldVersion,S.newVersion,S)),_.then(S=>{l&&S.addEventListener("close",()=>l()),s&&S.addEventListener("versionchange",w=>s(w.oldVersion,w.newVersion,w))}).catch(()=>{}),_}const fm=["get","getKey","getAll","getAllKeys","count"],gm=["put","add","delete","clear"],As=new Map;function Iu(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(As.get(e))return As.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,s=gm.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!(s||fm.includes(i)))return;const l=async function(d,..._){const S=this.transaction(d,s?"readwrite":"readonly");let w=S.store;return n&&(w=w.index(_.shift())),(await Promise.all([w[i](..._),s&&S.done]))[0]};return As.set(e,l),l}cm(t=>({...t,get:(e,i,n)=>Iu(e,i)||t.get(e,i,n),has:(e,i)=>!!Iu(e,i)||t.has(e,i)}));const pm=dm("BarcodeDB",1,{upgrade(t){t.createObjectStore("barcode")}}),Au=async(t,e)=>(await pm).put("barcode",e,t),Il=_e.exports.createContext(),Al=_e.exports.createContext();var $d={exports:{}};(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var n=[],s=0;s<arguments.length;s++){var l=arguments[s];if(l){var d=typeof l;if(d==="string"||d==="number")n.push(l);else if(Array.isArray(l)){if(l.length){var _=i.apply(null,l);_&&n.push(_)}}else if(d==="object"){if(l.toString!==Object.prototype.toString&&!l.toString.toString().includes("[native code]")){n.push(l.toString());continue}for(var S in l)e.call(l,S)&&l[S]&&n.push(S)}}}return n.join(" ")}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})($d);const Ue=$d.exports,mm=["as","disabled"];function _m(t,e){if(t==null)return{};var i={},n=Object.keys(t),s,l;for(l=0;l<n.length;l++)s=n[l],!(e.indexOf(s)>=0)&&(i[s]=t[s]);return i}function vm(t){return!t||t.trim()==="#"}function Kd({tagName:t,disabled:e,href:i,target:n,rel:s,role:l,onClick:d,tabIndex:_=0,type:S}){t||(i!=null||n!=null||s!=null?t="a":t="button");const w={tagName:t};if(t==="button")return[{type:S||"button",disabled:e},w];const T=I=>{if((e||t==="a"&&vm(i))&&I.preventDefault(),e){I.stopPropagation();return}d==null||d(I)},A=I=>{I.key===" "&&(I.preventDefault(),T(I))};return t==="a"&&(i||(i="#"),e&&(i=void 0)),[{role:l??"button",disabled:void 0,tabIndex:e?void 0:_,href:i,target:t==="a"?n:void 0,"aria-disabled":e||void 0,rel:t==="a"?s:void 0,onClick:T,onKeyDown:A},w]}const ym=_e.exports.forwardRef((t,e)=>{let{as:i,disabled:n}=t,s=_m(t,mm);const[l,{tagName:d}]=Kd(Object.assign({tagName:i,disabled:n},s));return ye(d,Object.assign({},s,l,{ref:e}))});ym.displayName="Button";const Sm=["xxl","xl","lg","md","sm","xs"],wm="xs",Ol=_e.exports.createContext({prefixes:{},breakpoints:Sm,minBreakpoint:wm});function Ze(t,e){const{prefixes:i}=_e.exports.useContext(Ol);return t||i[e]||e}function Cm(){const{breakpoints:t}=_e.exports.useContext(Ol);return t}function xm(){const{minBreakpoint:t}=_e.exports.useContext(Ol);return t}const Tm={variant:"primary",active:!1,disabled:!1},gr=_e.exports.forwardRef(({as:t,bsPrefix:e,variant:i,size:n,active:s,className:l,...d},_)=>{const S=Ze(e,"btn"),[w,{tagName:T}]=Kd({tagName:t,...d});return ye(T,{...w,...d,ref:_,className:Ue(l,S,s&&"active",i&&`${S}-${i}`,n&&`${S}-${n}`,d.href&&d.disabled&&"disabled")})});gr.displayName="Button";gr.defaultProps=Tm;var Fi={exports:{}},bm="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Em=bm,Im=Em;function Zd(){}function Jd(){}Jd.resetWarningCache=Zd;var Am=function(){function t(n,s,l,d,_,S){if(S!==Im){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}t.isRequired=t;function e(){return t}var i={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Jd,resetWarningCache:Zd};return i.PropTypes=i,i};Fi.exports=Am();const Om={type:Fi.exports.string,tooltip:Fi.exports.bool,as:Fi.exports.elementType},Jo=_e.exports.forwardRef(({as:t="div",className:e,type:i="valid",tooltip:n=!1,...s},l)=>ye(t,{...s,ref:l,className:Ue(e,`${i}-${n?"tooltip":"feedback"}`)}));Jo.displayName="Feedback";Jo.propTypes=Om;const ei=_e.exports.createContext({}),Rl=_e.exports.forwardRef(({id:t,bsPrefix:e,className:i,type:n="checkbox",isValid:s=!1,isInvalid:l=!1,as:d="input",..._},S)=>{const{controlId:w}=_e.exports.useContext(ei);return e=Ze(e,"form-check-input"),ye(d,{..._,ref:S,type:n,id:t||w,className:Ue(i,e,s&&"is-valid",l&&"is-invalid")})});Rl.displayName="FormCheckInput";const Do=_e.exports.forwardRef(({bsPrefix:t,className:e,htmlFor:i,...n},s)=>{const{controlId:l}=_e.exports.useContext(ei);return t=Ze(t,"form-check-label"),ye("label",{...n,ref:s,htmlFor:i||l,className:Ue(e,t)})});Do.displayName="FormCheckLabel";function Rm(t,e){return _e.exports.Children.toArray(t).some(i=>_e.exports.isValidElement(i)&&i.type===e)}const Qd=_e.exports.forwardRef(({id:t,bsPrefix:e,bsSwitchPrefix:i,inline:n=!1,reverse:s=!1,disabled:l=!1,isValid:d=!1,isInvalid:_=!1,feedbackTooltip:S=!1,feedback:w,feedbackType:T,className:A,style:I,title:k="",type:B="checkbox",label:F,children:z,as:D="input",...R},L)=>{e=Ze(e,"form-check"),i=Ze(i,"form-switch");const{controlId:$}=_e.exports.useContext(ei),ie=_e.exports.useMemo(()=>({controlId:t||$}),[$,t]),ne=!z&&F!=null&&F!==!1||Rm(z,Do),J=ye(Rl,{...R,type:B==="switch"?"checkbox":B,ref:L,isValid:d,isInvalid:_,disabled:l,as:D});return ye(ei.Provider,{value:ie,children:ye("div",{style:I,className:Ue(A,ne&&e,n&&`${e}-inline`,s&&`${e}-reverse`,B==="switch"&&i),children:z||ci(Pf,{children:[J,ne&&ye(Do,{title:k,children:F}),w&&ye(Jo,{type:T,tooltip:S,children:w})]})})})});Qd.displayName="FormCheck";const Mo=Object.assign(Qd,{Input:Rl,Label:Do}),qd=_e.exports.forwardRef(({bsPrefix:t,type:e,size:i,htmlSize:n,id:s,className:l,isValid:d=!1,isInvalid:_=!1,plaintext:S,readOnly:w,as:T="input",...A},I)=>{const{controlId:k}=_e.exports.useContext(ei);t=Ze(t,"form-control");let B;return S?B={[`${t}-plaintext`]:!0}:B={[t]:!0,[`${t}-${i}`]:i},ye(T,{...A,type:e,size:n,ref:I,readOnly:w,id:s||k,className:Ue(l,B,d&&"is-valid",_&&"is-invalid",e==="color"&&`${t}-color`)})});qd.displayName="FormControl";const Dm=Object.assign(qd,{Feedback:Jo});var Mm=/-(.)/g;function Lm(t){return t.replace(Mm,function(e,i){return i.toUpperCase()})}const km=t=>t[0].toUpperCase()+Lm(t).slice(1);function Ti(t,{displayName:e=km(t),Component:i,defaultProps:n}={}){const s=_e.exports.forwardRef(({className:l,bsPrefix:d,as:_=i||"div",...S},w)=>{const T=Ze(d,t);return ye(_,{ref:w,className:Ue(l,T),...S})});return s.defaultProps=n,s.displayName=e,s}const Fm=Ti("form-floating"),Dl=_e.exports.forwardRef(({controlId:t,as:e="div",...i},n)=>{const s=_e.exports.useMemo(()=>({controlId:t}),[t]);return ye(ei.Provider,{value:s,children:ye(e,{...i,ref:n})})});Dl.displayName="FormGroup";function Pm({as:t,bsPrefix:e,className:i,...n}){e=Ze(e,"col");const s=Cm(),l=xm(),d=[],_=[];return s.forEach(S=>{const w=n[S];delete n[S];let T,A,I;typeof w=="object"&&w!=null?{span:T,offset:A,order:I}=w:T=w;const k=S!==l?`-${S}`:"";T&&d.push(T===!0?`${e}${k}`:`${e}${k}-${T}`),I!=null&&_.push(`order${k}-${I}`),A!=null&&_.push(`offset${k}-${A}`)}),[{...n,className:Ue(i,...d,..._)},{as:t,bsPrefix:e,spans:d}]}const ef=_e.exports.forwardRef((t,e)=>{const[{className:i,...n},{as:s="div",bsPrefix:l,spans:d}]=Pm(t);return ye(s,{...n,ref:e,className:Ue(i,!d.length&&l)})});ef.displayName="Col";const Bm={column:!1,visuallyHidden:!1},Ml=_e.exports.forwardRef(({as:t="label",bsPrefix:e,column:i,visuallyHidden:n,className:s,htmlFor:l,...d},_)=>{const{controlId:S}=_e.exports.useContext(ei);e=Ze(e,"form-label");let w="col-form-label";typeof i=="string"&&(w=`${w} ${w}-${i}`);const T=Ue(s,e,n&&"visually-hidden",i&&w);return l=l||S,i?ye(ef,{ref:_,as:"label",className:T,htmlFor:l,...d}):ye(t,{ref:_,className:T,htmlFor:l,...d})});Ml.displayName="FormLabel";Ml.defaultProps=Bm;const tf=_e.exports.forwardRef(({bsPrefix:t,className:e,id:i,...n},s)=>{const{controlId:l}=_e.exports.useContext(ei);return t=Ze(t,"form-range"),ye("input",{...n,type:"range",ref:s,className:Ue(e,t),id:i||l})});tf.displayName="FormRange";const nf=_e.exports.forwardRef(({bsPrefix:t,size:e,htmlSize:i,className:n,isValid:s=!1,isInvalid:l=!1,id:d,..._},S)=>{const{controlId:w}=_e.exports.useContext(ei);return t=Ze(t,"form-select"),ye("select",{..._,size:i,ref:S,className:Ue(n,t,e&&`${t}-${e}`,s&&"is-valid",l&&"is-invalid"),id:d||w})});nf.displayName="FormSelect";const rf=_e.exports.forwardRef(({bsPrefix:t,className:e,as:i="small",muted:n,...s},l)=>(t=Ze(t,"form-text"),ye(i,{...s,ref:l,className:Ue(e,t,n&&"text-muted")})));rf.displayName="FormText";const of=_e.exports.forwardRef((t,e)=>ye(Mo,{...t,ref:e,type:"switch"}));of.displayName="Switch";const Nm=Object.assign(of,{Input:Mo.Input,Label:Mo.Label}),sf=_e.exports.forwardRef(({bsPrefix:t,className:e,children:i,controlId:n,label:s,...l},d)=>(t=Ze(t,"form-floating"),ci(Dl,{ref:d,className:Ue(e,t),controlId:n,...l,children:[i,ye("label",{htmlFor:n,children:s})]})));sf.displayName="FloatingLabel";const jm={_ref:Fi.exports.any,validated:Fi.exports.bool,as:Fi.exports.elementType},Ll=_e.exports.forwardRef(({className:t,validated:e,as:i="form",...n},s)=>ye(i,{...n,ref:s,className:Ue(t,e&&"was-validated")}));Ll.displayName="Form";Ll.propTypes=jm;const eo=Object.assign(Ll,{Group:Dl,Control:Dm,Floating:Fm,Check:Mo,Switch:Nm,Label:Ml,Text:rf,Range:tf,Select:nf,FloatingLabel:sf}),af=t=>_e.exports.forwardRef((e,i)=>ye("div",{...e,ref:i,className:Ue(e.className,t)})),lf=_e.exports.forwardRef(({bsPrefix:t,className:e,variant:i,as:n="img",...s},l)=>{const d=Ze(t,"card-img");return ye(n,{ref:l,className:Ue(i?`${d}-${i}`:d,e),...s})});lf.displayName="CardImg";const cf=_e.exports.createContext(null);cf.displayName="CardHeaderContext";const uf=_e.exports.forwardRef(({bsPrefix:t,className:e,as:i="div",...n},s)=>{const l=Ze(t,"card-header"),d=_e.exports.useMemo(()=>({cardHeaderBsPrefix:l}),[l]);return ye(cf.Provider,{value:d,children:ye(i,{ref:s,...n,className:Ue(e,l)})})});uf.displayName="CardHeader";const Vm=af("h5"),Um=af("h6"),hf=Ti("card-body"),Wm=Ti("card-title",{Component:Vm}),Gm=Ti("card-subtitle",{Component:Um}),zm=Ti("card-link",{Component:"a"}),Hm=Ti("card-text",{Component:"p"}),Ym=Ti("card-footer"),Xm=Ti("card-img-overlay"),$m={body:!1},kl=_e.exports.forwardRef(({bsPrefix:t,className:e,bg:i,text:n,border:s,body:l,children:d,as:_="div",...S},w)=>{const T=Ze(t,"card");return ye(_,{ref:w,...S,className:Ue(e,T,i&&`bg-${i}`,n&&`text-${n}`,s&&`border-${s}`),children:l?ye(hf,{children:d}):d})});kl.displayName="Card";kl.defaultProps=$m;const Os=Object.assign(kl,{Img:lf,Title:Wm,Subtitle:Gm,Body:hf,Link:zm,Text:Hm,Header:uf,Footer:Ym,ImgOverlay:Xm}),Km="/barcode-scanner-pwa/images/camera.png";function Rs({barcode:t,setBarcode:e,setShowScanner:i,ID:n,placeholder:s}){const l=S=>{e(S.target.value)},d=()=>{i(!0)},_=()=>{e(""),i(!1)};return ci(eo.Group,{children:[ye(eo.Label,{children:n}),ci("div",{className:"d-flex gap-2 justify-content-center align-items-center my-1",children:[ye(eo.Control,{className:"d-flex justify-content-center align-items-center p-2",type:"text",value:t,onChange:l,placeholder:s,required:!0}),t?ye(gr,{onClick:_,variant:"danger",className:"d-flex justify-content-center align-items-center px-3 py-2",children:ye("span",{children:"X"})}):ci(gr,{onClick:d,className:"d-flex justify-content-center align-items-center",children:[" ",ye("img",{alt:"logo",src:Km,width:"20",height:"20",className:"m-1"})]})]})]})}function Zm(){const[t,e]=_e.exports.useState(!0),i=_e.exports.useContext(Il),n=_e.exports.useContext(Al),s=l=>{l.preventDefault(),(i[2]||i[4])&&(i[2]&&i[2]&&i[4]?(Au(i[2],{roomID:i[0],assetID:i[2],tagID:i[4]}),n[1](!1),n[3](!1),n[5](!1),i[1](""),i[3](""),i[5]("")):(Au(i[2],{assetID:i[2],tagID:i[4]}),n[1](!1),n[3](!1),n[5](!1),i[1](""),i[3](""),i[5]("")))};return _e.exports.useEffect(()=>{i[2]&&i[4]?e(!1):e(!0)},[i[2],i[4]]),ci(Os,{children:[ye(Os.Title,{className:"text-capitalize pb-3 fw-bolder text-center mt-4",children:"Dynamsoft Scanner"}),ye(Os.Body,{className:"p-4",children:ci(eo,{action:"/",noValidate:!0,onSubmit:s,children:[ye(Rs,{barcode:i[0],setBarcode:i[1],setShowScanner:n[1],ID:"Room-ID",placeholder:"4302 (Option)"}),ye(Rs,{barcode:i[2],setBarcode:i[3],setShowScanner:n[3],ID:"Asset-ID",placeholder:"999 87456317AD"}),ye(Rs,{barcode:i[4],setBarcode:i[5],setShowScanner:n[5],ID:"Tag-ID",placeholder:"999 87456317AD"}),ye(gr,{type:"submit",disabled:t&&!0,className:"mt-3 p-2",style:{width:"100%"},children:"Tag Asset"})]})})]})}function Ds({setBarcode:t,showScanner:e}){const[i,n]=_e.exports.useState(""),s=_e.exports.useRef(),l=async()=>{await Nt.createInstance();const d=new Event("resize");window.dispatchEvent(d)};return _e.exports.useEffect(()=>{(async()=>e&&(n("full-screen"),await l()))()},[e]),_e.exports.useEffect(()=>{(async()=>{try{const d=await Nt.createInstance();await d.setUIElement(s.current),d.onFrameRead=_=>{for(let S of _)t(S.barcodeText),console.log(S.barcodeText)},await d.open()}catch(d){let _;d.message.includes("network connection error")?_="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":_=d.message||d,alert(_)}})()},[]),ye("div",{ref:s,className:"video-container",children:ci("div",{className:`div-ui-container ${i}`,children:[ye("svg",{className:"dce-bg-loading",viewBox:"0 0 1792 1792",children:ye("path",{d:"M1760 896q0 176-68.5 336t-184 275.5-275.5 184-336 68.5-336-68.5-275.5-184-184-275.5-68.5-336q0-213 97-398.5t265-305.5 374-151v228q-221 45-366.5 221t-145.5 406q0 130 51 248.5t136.5 204 204 136.5 248.5 51 248.5-51 204-136.5 136.5-204 51-248.5q0-230-145.5-406t-366.5-221v-228q206 31 374 151t265 305.5 97 398.5z"})}),ye("div",{className:"dce-video-container"}),ye("div",{className:"div-ui-container-center"})]})})}const Jm={fluid:!1},Fl=_e.exports.forwardRef(({bsPrefix:t,fluid:e,as:i="div",className:n,...s},l)=>{const d=Ze(t,"container"),_=typeof e=="string"?`-${e}`:"-fluid";return ye(i,{ref:l,...s,className:Ue(n,e?`${d}${_}`:d)})});Fl.displayName="Container";Fl.defaultProps=Jm;function Qm(){const t=_e.exports.useContext(Il),e=_e.exports.useContext(Al);return _e.exports.useEffect(()=>{(async()=>{try{await j.loadWasm()}catch(i){let n;i.message.includes("network connection error")?n="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":n=i.message||i,console.error(n),alert(n)}})()},[]),!t[0]&&e[0]?ye(Ds,{setBarcode:t[1],showScanner:e[0]}):!t[2]&&e[2]?ye(Ds,{setBarcode:t[3],showScanner:e[2]}):!t[4]&&e[4]?ye(Ds,{setBarcode:t[5],showScanner:e[4]}):ye(Fl,{style:{width:"390px",height:"844px"},className:"d-flex flex-column justify-content-center align-items-center",children:ye(Zm,{})})}function qm(){const[t,e]=_e.exports.useState(""),[i,n]=_e.exports.useState(""),[s,l]=_e.exports.useState(""),[d,_]=_e.exports.useState(!1),[S,w]=_e.exports.useState(!1),[T,A]=_e.exports.useState(!1),I=[t,e,i,n,s,l],k=[d,_,S,w,T,A];return ye(Al.Provider,{value:k,children:ye(Il.Provider,{value:I,children:ye(Qm,{})})})}Ms.createRoot(document.getElementById("root")).render(ye(Of.StrictMode,{children:ye(qm,{})}));
