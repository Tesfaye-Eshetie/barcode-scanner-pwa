(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();function _f(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ks={exports:{}},Ls={},_e={exports:{}},be={};var pr=Symbol.for("react.element"),vf=Symbol.for("react.portal"),yf=Symbol.for("react.fragment"),Sf=Symbol.for("react.strict_mode"),wf=Symbol.for("react.profiler"),Cf=Symbol.for("react.provider"),xf=Symbol.for("react.context"),Tf=Symbol.for("react.forward_ref"),bf=Symbol.for("react.suspense"),Ef=Symbol.for("react.memo"),If=Symbol.for("react.lazy"),Pl=Symbol.iterator;function Af(t){return t===null||typeof t!="object"?null:(t=Pl&&t[Pl]||t["@@iterator"],typeof t=="function"?t:null)}var Au={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ou=Object.assign,Ru={};function Cn(t,e,i){this.props=t,this.context=e,this.refs=Ru,this.updater=i||Au}Cn.prototype.isReactComponent={};Cn.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Cn.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Du(){}Du.prototype=Cn.prototype;function Da(t,e,i){this.props=t,this.context=e,this.refs=Ru,this.updater=i||Au}var Ma=Da.prototype=new Du;Ma.constructor=Da;Ou(Ma,Cn.prototype);Ma.isPureReactComponent=!0;var Bl=Array.isArray,Mu=Object.prototype.hasOwnProperty,ka={current:null},ku={key:!0,ref:!0,__self:!0,__source:!0};function Lu(t,e,i){var n,o={},l=null,d=null;if(e!=null)for(n in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(l=""+e.key),e)Mu.call(e,n)&&!ku.hasOwnProperty(n)&&(o[n]=e[n]);var _=arguments.length-2;if(_===1)o.children=i;else if(1<_){for(var S=Array(_),w=0;w<_;w++)S[w]=arguments[w+2];o.children=S}if(t&&t.defaultProps)for(n in _=t.defaultProps,_)o[n]===void 0&&(o[n]=_[n]);return{$$typeof:pr,type:t,key:l,ref:d,props:o,_owner:ka.current}}function Of(t,e){return{$$typeof:pr,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function La(t){return typeof t=="object"&&t!==null&&t.$$typeof===pr}function Rf(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var Nl=/\/+/g;function qs(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Rf(""+t.key):e.toString(36)}function Ur(t,e,i,n,o){var l=typeof t;(l==="undefined"||l==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(l){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case pr:case vf:d=!0}}if(d)return d=t,o=o(d),t=n===""?"."+qs(d,0):n,Bl(o)?(i="",t!=null&&(i=t.replace(Nl,"$&/")+"/"),Ur(o,e,i,"",function(w){return w})):o!=null&&(La(o)&&(o=Of(o,i+(!o.key||d&&d.key===o.key?"":(""+o.key).replace(Nl,"$&/")+"/")+t)),e.push(o)),1;if(d=0,n=n===""?".":n+":",Bl(t))for(var _=0;_<t.length;_++){l=t[_];var S=n+qs(l,_);d+=Ur(l,e,i,S,o)}else if(S=Af(t),typeof S=="function")for(t=S.call(t),_=0;!(l=t.next()).done;)l=l.value,S=n+qs(l,_++),d+=Ur(l,e,i,S,o);else if(l==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function wr(t,e,i){if(t==null)return t;var n=[],o=0;return Ur(t,n,"","",function(l){return e.call(i,l,o++)}),n}function Df(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var st={current:null},Wr={transition:null},Mf={ReactCurrentDispatcher:st,ReactCurrentBatchConfig:Wr,ReactCurrentOwner:ka};be.Children={map:wr,forEach:function(t,e,i){wr(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return wr(t,function(){e++}),e},toArray:function(t){return wr(t,function(e){return e})||[]},only:function(t){if(!La(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};be.Component=Cn;be.Fragment=yf;be.Profiler=wf;be.PureComponent=Da;be.StrictMode=Sf;be.Suspense=bf;be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Mf;be.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=Ou({},t.props),o=t.key,l=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,d=ka.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var _=t.type.defaultProps;for(S in e)Mu.call(e,S)&&!ku.hasOwnProperty(S)&&(n[S]=e[S]===void 0&&_!==void 0?_[S]:e[S])}var S=arguments.length-2;if(S===1)n.children=i;else if(1<S){_=Array(S);for(var w=0;w<S;w++)_[w]=arguments[w+2];n.children=_}return{$$typeof:pr,type:t.type,key:o,ref:l,props:n,_owner:d}};be.createContext=function(t){return t={$$typeof:xf,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Cf,_context:t},t.Consumer=t};be.createElement=Lu;be.createFactory=function(t){var e=Lu.bind(null,t);return e.type=t,e};be.createRef=function(){return{current:null}};be.forwardRef=function(t){return{$$typeof:Tf,render:t}};be.isValidElement=La;be.lazy=function(t){return{$$typeof:If,_payload:{_status:-1,_result:t},_init:Df}};be.memo=function(t,e){return{$$typeof:Ef,type:t,compare:e===void 0?null:e}};be.startTransition=function(t){var e=Wr.transition;Wr.transition={};try{t()}finally{Wr.transition=e}};be.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};be.useCallback=function(t,e){return st.current.useCallback(t,e)};be.useContext=function(t){return st.current.useContext(t)};be.useDebugValue=function(){};be.useDeferredValue=function(t){return st.current.useDeferredValue(t)};be.useEffect=function(t,e){return st.current.useEffect(t,e)};be.useId=function(){return st.current.useId()};be.useImperativeHandle=function(t,e,i){return st.current.useImperativeHandle(t,e,i)};be.useInsertionEffect=function(t,e){return st.current.useInsertionEffect(t,e)};be.useLayoutEffect=function(t,e){return st.current.useLayoutEffect(t,e)};be.useMemo=function(t,e){return st.current.useMemo(t,e)};be.useReducer=function(t,e,i){return st.current.useReducer(t,e,i)};be.useRef=function(t){return st.current.useRef(t)};be.useState=function(t){return st.current.useState(t)};be.useSyncExternalStore=function(t,e,i){return st.current.useSyncExternalStore(t,e,i)};be.useTransition=function(){return st.current.useTransition()};be.version="18.2.0";(function(t){t.exports=be})(_e);const kf=_f(_e.exports);var Lf=_e.exports,Ff=Symbol.for("react.element"),Pf=Symbol.for("react.fragment"),Bf=Object.prototype.hasOwnProperty,Nf=Lf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jf={key:!0,ref:!0,__self:!0,__source:!0};function Fu(t,e,i){var n,o={},l=null,d=null;i!==void 0&&(l=""+i),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(d=e.ref);for(n in e)Bf.call(e,n)&&!jf.hasOwnProperty(n)&&(o[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)o[n]===void 0&&(o[n]=e[n]);return{$$typeof:Ff,type:t,key:l,ref:d,props:o,_owner:Nf.current}}Ls.Fragment=Pf;Ls.jsx=Fu;Ls.jsxs=Fu;(function(t){t.exports=Ls})(ks);const Pu=ks.exports.Fragment,de=ks.exports.jsx,Ye=ks.exports.jsxs;var Mo={},Bu={exports:{}},St={},Nu={exports:{}},ju={};(function(t){function e(h,m){var g=h.length;h.push(m);e:for(;0<g;){var p=g-1>>>1,v=h[p];if(0<o(v,m))h[p]=m,h[g]=v,g=p;else break e}}function i(h){return h.length===0?null:h[0]}function n(h){if(h.length===0)return null;var m=h[0],g=h.pop();if(g!==m){h[0]=g;e:for(var p=0,v=h.length,C=v>>>1;p<C;){var x=2*(p+1)-1,b=h[x],E=x+1,O=h[E];if(0>o(b,g))E<v&&0>o(O,b)?(h[p]=O,h[E]=g,p=E):(h[p]=b,h[x]=g,p=x);else if(E<v&&0>o(O,g))h[p]=O,h[E]=g,p=E;else break e}}return m}function o(h,m){var g=h.sortIndex-m.sortIndex;return g!==0?g:h.id-m.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var d=Date,_=d.now();t.unstable_now=function(){return d.now()-_}}var S=[],w=[],T=1,A=null,I=3,k=!1,P=!1,F=!1,z=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(h){for(var m=i(w);m!==null;){if(m.callback===null)n(w);else if(m.startTime<=h)n(w),m.sortIndex=m.expirationTime,e(S,m);else break;m=i(w)}}function $(h){if(F=!1,M(h),!P)if(i(S)!==null)P=!0,r(ie);else{var m=i(w);m!==null&&s($,m.startTime-h)}}function ie(h,m){P=!1,F&&(F=!1,D(y),y=-1),k=!0;var g=I;try{for(M(m),A=i(S);A!==null&&(!(A.expirationTime>m)||h&&!Ce());){var p=A.callback;if(typeof p=="function"){A.callback=null,I=A.priorityLevel;var v=p(A.expirationTime<=m);m=t.unstable_now(),typeof v=="function"?A.callback=v:A===i(S)&&n(S),M(m)}else n(S);A=i(S)}if(A!==null)var C=!0;else{var x=i(w);x!==null&&s($,x.startTime-m),C=!1}return C}finally{A=null,I=g,k=!1}}var ne=!1,q=null,y=-1,pe=5,fe=-1;function Ce(){return!(t.unstable_now()-fe<pe)}function u(){if(q!==null){var h=t.unstable_now();fe=h;var m=!0;try{m=q(!0,h)}finally{m?a():(ne=!1,q=null)}}else ne=!1}var a;if(typeof R=="function")a=function(){R(u)};else if(typeof MessageChannel<"u"){var c=new MessageChannel,f=c.port2;c.port1.onmessage=u,a=function(){f.postMessage(null)}}else a=function(){z(u,0)};function r(h){q=h,ne||(ne=!0,a())}function s(h,m){y=z(function(){h(t.unstable_now())},m)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(h){h.callback=null},t.unstable_continueExecution=function(){P||k||(P=!0,r(ie))},t.unstable_forceFrameRate=function(h){0>h||125<h?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pe=0<h?Math.floor(1e3/h):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_getFirstCallbackNode=function(){return i(S)},t.unstable_next=function(h){switch(I){case 1:case 2:case 3:var m=3;break;default:m=I}var g=I;I=m;try{return h()}finally{I=g}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(h,m){switch(h){case 1:case 2:case 3:case 4:case 5:break;default:h=3}var g=I;I=h;try{return m()}finally{I=g}},t.unstable_scheduleCallback=function(h,m,g){var p=t.unstable_now();switch(typeof g=="object"&&g!==null?(g=g.delay,g=typeof g=="number"&&0<g?p+g:p):g=p,h){case 1:var v=-1;break;case 2:v=250;break;case 5:v=1073741823;break;case 4:v=1e4;break;default:v=5e3}return v=g+v,h={id:T++,callback:m,priorityLevel:h,startTime:g,expirationTime:v,sortIndex:-1},g>p?(h.sortIndex=g,e(w,h),i(S)===null&&h===i(w)&&(F?(D(y),y=-1):F=!0,s($,g-p))):(h.sortIndex=v,e(S,h),P||k||(P=!0,r(ie))),h},t.unstable_shouldYield=Ce,t.unstable_wrapCallback=function(h){var m=I;return function(){var g=I;I=m;try{return h.apply(this,arguments)}finally{I=g}}}})(ju);(function(t){t.exports=ju})(Nu);var Vu=_e.exports,yt=Nu.exports;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Uu=new Set,Qn={};function Wi(t,e){gn(t,e),gn(t+"Capture",e)}function gn(t,e){for(Qn[t]=e,t=0;t<e.length;t++)Uu.add(e[t])}var Jt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ko=Object.prototype.hasOwnProperty,Vf=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jl={},Vl={};function Uf(t){return ko.call(Vl,t)?!0:ko.call(jl,t)?!1:Vf.test(t)?Vl[t]=!0:(jl[t]=!0,!1)}function Wf(t,e,i,n){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Gf(t,e,i,n){if(e===null||typeof e>"u"||Wf(t,e,i,n))return!0;if(n)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ot(t,e,i,n,o,l,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=l,this.removeEmptyString=d}var Je={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Je[t]=new ot(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Je[e]=new ot(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Je[t]=new ot(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Je[t]=new ot(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Je[t]=new ot(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Je[t]=new ot(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Je[t]=new ot(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Je[t]=new ot(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Je[t]=new ot(t,5,!1,t.toLowerCase(),null,!1,!1)});var Fa=/[\-:]([a-z])/g;function Pa(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Fa,Pa);Je[e]=new ot(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Fa,Pa);Je[e]=new ot(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Fa,Pa);Je[e]=new ot(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Je[t]=new ot(t,1,!1,t.toLowerCase(),null,!1,!1)});Je.xlinkHref=new ot("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Je[t]=new ot(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ba(t,e,i,n){var o=Je.hasOwnProperty(e)?Je[e]:null;(o!==null?o.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Gf(e,i,o,n)&&(i=null),n||o===null?Uf(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):o.mustUseProperty?t[o.propertyName]=i===null?o.type===3?!1:"":i:(e=o.attributeName,n=o.attributeNamespace,i===null?t.removeAttribute(e):(o=o.type,i=o===3||o===4&&i===!0?"":""+i,n?t.setAttributeNS(n,e,i):t.setAttribute(e,i))))}var ii=Vu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Cr=Symbol.for("react.element"),Ki=Symbol.for("react.portal"),Zi=Symbol.for("react.fragment"),Na=Symbol.for("react.strict_mode"),Lo=Symbol.for("react.profiler"),Wu=Symbol.for("react.provider"),Gu=Symbol.for("react.context"),ja=Symbol.for("react.forward_ref"),Fo=Symbol.for("react.suspense"),Po=Symbol.for("react.suspense_list"),Va=Symbol.for("react.memo"),ri=Symbol.for("react.lazy"),zu=Symbol.for("react.offscreen"),Ul=Symbol.iterator;function An(t){return t===null||typeof t!="object"?null:(t=Ul&&t[Ul]||t["@@iterator"],typeof t=="function"?t:null)}var Be=Object.assign,eo;function jn(t){if(eo===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);eo=e&&e[1]||""}return`
`+eo+t}var to=!1;function io(t,e){if(!t||to)return"";to=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var n=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){n=w}t.call(e.prototype)}else{try{throw Error()}catch(w){n=w}t()}}catch(w){if(w&&n&&typeof w.stack=="string"){for(var o=w.stack.split(`
`),l=n.stack.split(`
`),d=o.length-1,_=l.length-1;1<=d&&0<=_&&o[d]!==l[_];)_--;for(;1<=d&&0<=_;d--,_--)if(o[d]!==l[_]){if(d!==1||_!==1)do if(d--,_--,0>_||o[d]!==l[_]){var S=`
`+o[d].replace(" at new "," at ");return t.displayName&&S.includes("<anonymous>")&&(S=S.replace("<anonymous>",t.displayName)),S}while(1<=d&&0<=_);break}}}finally{to=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?jn(t):""}function zf(t){switch(t.tag){case 5:return jn(t.type);case 16:return jn("Lazy");case 13:return jn("Suspense");case 19:return jn("SuspenseList");case 0:case 2:case 15:return t=io(t.type,!1),t;case 11:return t=io(t.type.render,!1),t;case 1:return t=io(t.type,!0),t;default:return""}}function Bo(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Zi:return"Fragment";case Ki:return"Portal";case Lo:return"Profiler";case Na:return"StrictMode";case Fo:return"Suspense";case Po:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Gu:return(t.displayName||"Context")+".Consumer";case Wu:return(t._context.displayName||"Context")+".Provider";case ja:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Va:return e=t.displayName||null,e!==null?e:Bo(t.type)||"Memo";case ri:e=t._payload,t=t._init;try{return Bo(t(e))}catch{}}return null}function Hf(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bo(e);case 8:return e===Na?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function yi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Hu(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Yf(t){var e=Hu(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var o=i.get,l=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(d){n=""+d,l.call(this,d)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(d){n=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function xr(t){t._valueTracker||(t._valueTracker=Yf(t))}function Yu(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),n="";return t&&(n=Hu(t)?t.checked?"true":"false":t.value),t=n,t!==i?(e.setValue(t),!0):!1}function ts(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function No(t,e){var i=e.checked;return Be({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function Wl(t,e){var i=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;i=yi(e.value!=null?e.value:i),t._wrapperState={initialChecked:n,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Xu(t,e){e=e.checked,e!=null&&Ba(t,"checked",e,!1)}function jo(t,e){Xu(t,e);var i=yi(e.value),n=e.type;if(i!=null)n==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Vo(t,e.type,i):e.hasOwnProperty("defaultValue")&&Vo(t,e.type,yi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Gl(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function Vo(t,e,i){(e!=="number"||ts(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var Vn=Array.isArray;function ln(t,e,i,n){if(t=t.options,e){e={};for(var o=0;o<i.length;o++)e["$"+i[o]]=!0;for(i=0;i<t.length;i++)o=e.hasOwnProperty("$"+t[i].value),t[i].selected!==o&&(t[i].selected=o),o&&n&&(t[i].defaultSelected=!0)}else{for(i=""+yi(i),e=null,o=0;o<t.length;o++){if(t[o].value===i){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function Uo(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return Be({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function zl(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(ae(92));if(Vn(i)){if(1<i.length)throw Error(ae(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:yi(i)}}function $u(t,e){var i=yi(e.value),n=yi(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),n!=null&&(t.defaultValue=""+n)}function Hl(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Ku(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wo(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Ku(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Tr,Zu=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,n,o){MSApp.execUnsafeLocalFunction(function(){return t(e,i,n,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Tr=Tr||document.createElement("div"),Tr.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Tr.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qn(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var Gn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xf=["Webkit","ms","Moz","O"];Object.keys(Gn).forEach(function(t){Xf.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Gn[e]=Gn[t]})});function Ju(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||Gn.hasOwnProperty(t)&&Gn[t]?(""+e).trim():e+"px"}function Qu(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var n=i.indexOf("--")===0,o=Ju(i,e[i],n);i==="float"&&(i="cssFloat"),n?t.setProperty(i,o):t[i]=o}}var $f=Be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Go(t,e){if(e){if($f[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function zo(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ho=null;function Ua(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Yo=null,cn=null,un=null;function Yl(t){if(t=vr(t)){if(typeof Yo!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=js(e),Yo(t.stateNode,t.type,e))}}function qu(t){cn?un?un.push(t):un=[t]:cn=t}function eh(){if(cn){var t=cn,e=un;if(un=cn=null,Yl(t),e)for(t=0;t<e.length;t++)Yl(e[t])}}function th(t,e){return t(e)}function ih(){}var no=!1;function nh(t,e,i){if(no)return t(e,i);no=!0;try{return th(t,e,i)}finally{no=!1,(cn!==null||un!==null)&&(ih(),eh())}}function er(t,e){var i=t.stateNode;if(i===null)return null;var n=js(i);if(n===null)return null;i=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(ae(231,e,typeof i));return i}var Xo=!1;if(Jt)try{var On={};Object.defineProperty(On,"passive",{get:function(){Xo=!0}}),window.addEventListener("test",On,On),window.removeEventListener("test",On,On)}catch{Xo=!1}function Kf(t,e,i,n,o,l,d,_,S){var w=Array.prototype.slice.call(arguments,3);try{e.apply(i,w)}catch(T){this.onError(T)}}var zn=!1,is=null,ns=!1,$o=null,Zf={onError:function(t){zn=!0,is=t}};function Jf(t,e,i,n,o,l,d,_,S){zn=!1,is=null,Kf.apply(Zf,arguments)}function Qf(t,e,i,n,o,l,d,_,S){if(Jf.apply(this,arguments),zn){if(zn){var w=is;zn=!1,is=null}else throw Error(ae(198));ns||(ns=!0,$o=w)}}function Gi(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function rh(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Xl(t){if(Gi(t)!==t)throw Error(ae(188))}function qf(t){var e=t.alternate;if(!e){if(e=Gi(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var i=t,n=e;;){var o=i.return;if(o===null)break;var l=o.alternate;if(l===null){if(n=o.return,n!==null){i=n;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===i)return Xl(o),t;if(l===n)return Xl(o),e;l=l.sibling}throw Error(ae(188))}if(i.return!==n.return)i=o,n=l;else{for(var d=!1,_=o.child;_;){if(_===i){d=!0,i=o,n=l;break}if(_===n){d=!0,n=o,i=l;break}_=_.sibling}if(!d){for(_=l.child;_;){if(_===i){d=!0,i=l,n=o;break}if(_===n){d=!0,n=l,i=o;break}_=_.sibling}if(!d)throw Error(ae(189))}}if(i.alternate!==n)throw Error(ae(190))}if(i.tag!==3)throw Error(ae(188));return i.stateNode.current===i?t:e}function sh(t){return t=qf(t),t!==null?oh(t):null}function oh(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=oh(t);if(e!==null)return e;t=t.sibling}return null}var ah=yt.unstable_scheduleCallback,$l=yt.unstable_cancelCallback,eg=yt.unstable_shouldYield,tg=yt.unstable_requestPaint,je=yt.unstable_now,ig=yt.unstable_getCurrentPriorityLevel,Wa=yt.unstable_ImmediatePriority,lh=yt.unstable_UserBlockingPriority,rs=yt.unstable_NormalPriority,ng=yt.unstable_LowPriority,ch=yt.unstable_IdlePriority,Fs=null,Vt=null;function rg(t){if(Vt&&typeof Vt.onCommitFiberRoot=="function")try{Vt.onCommitFiberRoot(Fs,t,void 0,(t.current.flags&128)===128)}catch{}}var Lt=Math.clz32?Math.clz32:ag,sg=Math.log,og=Math.LN2;function ag(t){return t>>>=0,t===0?32:31-(sg(t)/og|0)|0}var br=64,Er=4194304;function Un(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ss(t,e){var i=t.pendingLanes;if(i===0)return 0;var n=0,o=t.suspendedLanes,l=t.pingedLanes,d=i&268435455;if(d!==0){var _=d&~o;_!==0?n=Un(_):(l&=d,l!==0&&(n=Un(l)))}else d=i&~o,d!==0?n=Un(d):l!==0&&(n=Un(l));if(n===0)return 0;if(e!==0&&e!==n&&!(e&o)&&(o=n&-n,l=e&-e,o>=l||o===16&&(l&4194240)!==0))return e;if(n&4&&(n|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)i=31-Lt(e),o=1<<i,n|=t[i],e&=~o;return n}function lg(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cg(t,e){for(var i=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,l=t.pendingLanes;0<l;){var d=31-Lt(l),_=1<<d,S=o[d];S===-1?(!(_&i)||_&n)&&(o[d]=lg(_,e)):S<=e&&(t.expiredLanes|=_),l&=~_}}function Ko(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function uh(){var t=br;return br<<=1,!(br&4194240)&&(br=64),t}function ro(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function mr(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lt(e),t[e]=i}function ug(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<i;){var o=31-Lt(i),l=1<<o;e[o]=0,n[o]=-1,t[o]=-1,i&=~l}}function Ga(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var n=31-Lt(i),o=1<<n;o&e|t[n]&e&&(t[n]|=e),i&=~o}}var Ae=0;function hh(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var dh,za,fh,gh,ph,Zo=!1,Ir=[],ui=null,hi=null,di=null,tr=new Map,ir=new Map,oi=[],hg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Kl(t,e){switch(t){case"focusin":case"focusout":ui=null;break;case"dragenter":case"dragleave":hi=null;break;case"mouseover":case"mouseout":di=null;break;case"pointerover":case"pointerout":tr.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ir.delete(e.pointerId)}}function Rn(t,e,i,n,o,l){return t===null||t.nativeEvent!==l?(t={blockedOn:e,domEventName:i,eventSystemFlags:n,nativeEvent:l,targetContainers:[o]},e!==null&&(e=vr(e),e!==null&&za(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function dg(t,e,i,n,o){switch(e){case"focusin":return ui=Rn(ui,t,e,i,n,o),!0;case"dragenter":return hi=Rn(hi,t,e,i,n,o),!0;case"mouseover":return di=Rn(di,t,e,i,n,o),!0;case"pointerover":var l=o.pointerId;return tr.set(l,Rn(tr.get(l)||null,t,e,i,n,o)),!0;case"gotpointercapture":return l=o.pointerId,ir.set(l,Rn(ir.get(l)||null,t,e,i,n,o)),!0}return!1}function mh(t){var e=Ai(t.target);if(e!==null){var i=Gi(e);if(i!==null){if(e=i.tag,e===13){if(e=rh(i),e!==null){t.blockedOn=e,ph(t.priority,function(){fh(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Gr(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=Jo(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var n=new i.constructor(i.type,i);Ho=n,i.target.dispatchEvent(n),Ho=null}else return e=vr(i),e!==null&&za(e),t.blockedOn=i,!1;e.shift()}return!0}function Zl(t,e,i){Gr(t)&&i.delete(e)}function fg(){Zo=!1,ui!==null&&Gr(ui)&&(ui=null),hi!==null&&Gr(hi)&&(hi=null),di!==null&&Gr(di)&&(di=null),tr.forEach(Zl),ir.forEach(Zl)}function Dn(t,e){t.blockedOn===e&&(t.blockedOn=null,Zo||(Zo=!0,yt.unstable_scheduleCallback(yt.unstable_NormalPriority,fg)))}function nr(t){function e(o){return Dn(o,t)}if(0<Ir.length){Dn(Ir[0],t);for(var i=1;i<Ir.length;i++){var n=Ir[i];n.blockedOn===t&&(n.blockedOn=null)}}for(ui!==null&&Dn(ui,t),hi!==null&&Dn(hi,t),di!==null&&Dn(di,t),tr.forEach(e),ir.forEach(e),i=0;i<oi.length;i++)n=oi[i],n.blockedOn===t&&(n.blockedOn=null);for(;0<oi.length&&(i=oi[0],i.blockedOn===null);)mh(i),i.blockedOn===null&&oi.shift()}var hn=ii.ReactCurrentBatchConfig,os=!0;function gg(t,e,i,n){var o=Ae,l=hn.transition;hn.transition=null;try{Ae=1,Ha(t,e,i,n)}finally{Ae=o,hn.transition=l}}function pg(t,e,i,n){var o=Ae,l=hn.transition;hn.transition=null;try{Ae=4,Ha(t,e,i,n)}finally{Ae=o,hn.transition=l}}function Ha(t,e,i,n){if(os){var o=Jo(t,e,i,n);if(o===null)po(t,e,n,as,i),Kl(t,n);else if(dg(o,t,e,i,n))n.stopPropagation();else if(Kl(t,n),e&4&&-1<hg.indexOf(t)){for(;o!==null;){var l=vr(o);if(l!==null&&dh(l),l=Jo(t,e,i,n),l===null&&po(t,e,n,as,i),l===o)break;o=l}o!==null&&n.stopPropagation()}else po(t,e,n,null,i)}}var as=null;function Jo(t,e,i,n){if(as=null,t=Ua(n),t=Ai(t),t!==null)if(e=Gi(t),e===null)t=null;else if(i=e.tag,i===13){if(t=rh(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return as=t,null}function _h(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ig()){case Wa:return 1;case lh:return 4;case rs:case ng:return 16;case ch:return 536870912;default:return 16}default:return 16}}var li=null,Ya=null,zr=null;function vh(){if(zr)return zr;var t,e=Ya,i=e.length,n,o="value"in li?li.value:li.textContent,l=o.length;for(t=0;t<i&&e[t]===o[t];t++);var d=i-t;for(n=1;n<=d&&e[i-n]===o[l-n];n++);return zr=o.slice(t,1<n?1-n:void 0)}function Hr(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ar(){return!0}function Jl(){return!1}function wt(t){function e(i,n,o,l,d){this._reactName=i,this._targetInst=o,this.type=n,this.nativeEvent=l,this.target=d,this.currentTarget=null;for(var _ in t)t.hasOwnProperty(_)&&(i=t[_],this[_]=i?i(l):l[_]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?Ar:Jl,this.isPropagationStopped=Jl,this}return Be(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Ar)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Ar)},persist:function(){},isPersistent:Ar}),e}var xn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xa=wt(xn),_r=Be({},xn,{view:0,detail:0}),mg=wt(_r),so,oo,Mn,Ps=Be({},_r,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$a,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Mn&&(Mn&&t.type==="mousemove"?(so=t.screenX-Mn.screenX,oo=t.screenY-Mn.screenY):oo=so=0,Mn=t),so)},movementY:function(t){return"movementY"in t?t.movementY:oo}}),Ql=wt(Ps),_g=Be({},Ps,{dataTransfer:0}),vg=wt(_g),yg=Be({},_r,{relatedTarget:0}),ao=wt(yg),Sg=Be({},xn,{animationName:0,elapsedTime:0,pseudoElement:0}),wg=wt(Sg),Cg=Be({},xn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xg=wt(Cg),Tg=Be({},xn,{data:0}),ql=wt(Tg),bg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Eg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ig={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ag(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Ig[t])?!!e[t]:!1}function $a(){return Ag}var Og=Be({},_r,{key:function(t){if(t.key){var e=bg[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Hr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Eg[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$a,charCode:function(t){return t.type==="keypress"?Hr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Hr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Rg=wt(Og),Dg=Be({},Ps,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ec=wt(Dg),Mg=Be({},_r,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$a}),kg=wt(Mg),Lg=Be({},xn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fg=wt(Lg),Pg=Be({},Ps,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Bg=wt(Pg),Ng=[9,13,27,32],Ka=Jt&&"CompositionEvent"in window,Hn=null;Jt&&"documentMode"in document&&(Hn=document.documentMode);var jg=Jt&&"TextEvent"in window&&!Hn,yh=Jt&&(!Ka||Hn&&8<Hn&&11>=Hn),tc=String.fromCharCode(32),ic=!1;function Sh(t,e){switch(t){case"keyup":return Ng.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wh(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ji=!1;function Vg(t,e){switch(t){case"compositionend":return wh(e);case"keypress":return e.which!==32?null:(ic=!0,tc);case"textInput":return t=e.data,t===tc&&ic?null:t;default:return null}}function Ug(t,e){if(Ji)return t==="compositionend"||!Ka&&Sh(t,e)?(t=vh(),zr=Ya=li=null,Ji=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yh&&e.locale!=="ko"?null:e.data;default:return null}}var Wg={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Wg[t.type]:e==="textarea"}function Ch(t,e,i,n){qu(n),e=ls(e,"onChange"),0<e.length&&(i=new Xa("onChange","change",null,i,n),t.push({event:i,listeners:e}))}var Yn=null,rr=null;function Gg(t){kh(t,0)}function Bs(t){var e=en(t);if(Yu(e))return t}function zg(t,e){if(t==="change")return e}var xh=!1;if(Jt){var lo;if(Jt){var co="oninput"in document;if(!co){var rc=document.createElement("div");rc.setAttribute("oninput","return;"),co=typeof rc.oninput=="function"}lo=co}else lo=!1;xh=lo&&(!document.documentMode||9<document.documentMode)}function sc(){Yn&&(Yn.detachEvent("onpropertychange",Th),rr=Yn=null)}function Th(t){if(t.propertyName==="value"&&Bs(rr)){var e=[];Ch(e,rr,t,Ua(t)),nh(Gg,e)}}function Hg(t,e,i){t==="focusin"?(sc(),Yn=e,rr=i,Yn.attachEvent("onpropertychange",Th)):t==="focusout"&&sc()}function Yg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bs(rr)}function Xg(t,e){if(t==="click")return Bs(e)}function $g(t,e){if(t==="input"||t==="change")return Bs(e)}function Kg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Pt=typeof Object.is=="function"?Object.is:Kg;function sr(t,e){if(Pt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var o=i[n];if(!ko.call(e,o)||!Pt(t[o],e[o]))return!1}return!0}function oc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ac(t,e){var i=oc(t);t=0;for(var n;i;){if(i.nodeType===3){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=oc(i)}}function bh(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?bh(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Eh(){for(var t=window,e=ts();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=ts(t.document)}return e}function Za(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Zg(t){var e=Eh(),i=t.focusedElem,n=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&bh(i.ownerDocument.documentElement,i)){if(n!==null&&Za(i)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=i.textContent.length,l=Math.min(n.start,o);n=n.end===void 0?l:Math.min(n.end,o),!t.extend&&l>n&&(o=n,n=l,l=o),o=ac(i,l);var d=ac(i,n);o&&d&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),l>n?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Jg=Jt&&"documentMode"in document&&11>=document.documentMode,Qi=null,Qo=null,Xn=null,qo=!1;function lc(t,e,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;qo||Qi==null||Qi!==ts(n)||(n=Qi,"selectionStart"in n&&Za(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Xn&&sr(Xn,n)||(Xn=n,n=ls(Qo,"onSelect"),0<n.length&&(e=new Xa("onSelect","select",null,e,i),t.push({event:e,listeners:n}),e.target=Qi)))}function Or(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var qi={animationend:Or("Animation","AnimationEnd"),animationiteration:Or("Animation","AnimationIteration"),animationstart:Or("Animation","AnimationStart"),transitionend:Or("Transition","TransitionEnd")},uo={},Ih={};Jt&&(Ih=document.createElement("div").style,"AnimationEvent"in window||(delete qi.animationend.animation,delete qi.animationiteration.animation,delete qi.animationstart.animation),"TransitionEvent"in window||delete qi.transitionend.transition);function Ns(t){if(uo[t])return uo[t];if(!qi[t])return t;var e=qi[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in Ih)return uo[t]=e[i];return t}var Ah=Ns("animationend"),Oh=Ns("animationiteration"),Rh=Ns("animationstart"),Dh=Ns("transitionend"),Mh=new Map,cc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(t,e){Mh.set(t,e),Wi(e,[t])}for(var ho=0;ho<cc.length;ho++){var fo=cc[ho],Qg=fo.toLowerCase(),qg=fo[0].toUpperCase()+fo.slice(1);wi(Qg,"on"+qg)}wi(Ah,"onAnimationEnd");wi(Oh,"onAnimationIteration");wi(Rh,"onAnimationStart");wi("dblclick","onDoubleClick");wi("focusin","onFocus");wi("focusout","onBlur");wi(Dh,"onTransitionEnd");gn("onMouseEnter",["mouseout","mouseover"]);gn("onMouseLeave",["mouseout","mouseover"]);gn("onPointerEnter",["pointerout","pointerover"]);gn("onPointerLeave",["pointerout","pointerover"]);Wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ep=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wn));function uc(t,e,i){var n=t.type||"unknown-event";t.currentTarget=i,Qf(n,e,void 0,t),t.currentTarget=null}function kh(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var n=t[i],o=n.event;n=n.listeners;e:{var l=void 0;if(e)for(var d=n.length-1;0<=d;d--){var _=n[d],S=_.instance,w=_.currentTarget;if(_=_.listener,S!==l&&o.isPropagationStopped())break e;uc(o,_,w),l=S}else for(d=0;d<n.length;d++){if(_=n[d],S=_.instance,w=_.currentTarget,_=_.listener,S!==l&&o.isPropagationStopped())break e;uc(o,_,w),l=S}}}if(ns)throw t=$o,ns=!1,$o=null,t}function Re(t,e){var i=e[ra];i===void 0&&(i=e[ra]=new Set);var n=t+"__bubble";i.has(n)||(Lh(e,t,2,!1),i.add(n))}function go(t,e,i){var n=0;e&&(n|=4),Lh(i,t,n,e)}var Rr="_reactListening"+Math.random().toString(36).slice(2);function or(t){if(!t[Rr]){t[Rr]=!0,Uu.forEach(function(i){i!=="selectionchange"&&(ep.has(i)||go(i,!1,t),go(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Rr]||(e[Rr]=!0,go("selectionchange",!1,e))}}function Lh(t,e,i,n){switch(_h(e)){case 1:var o=gg;break;case 4:o=pg;break;default:o=Ha}i=o.bind(null,e,i,t),o=void 0,!Xo||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(e,i,{capture:!0,passive:o}):t.addEventListener(e,i,!0):o!==void 0?t.addEventListener(e,i,{passive:o}):t.addEventListener(e,i,!1)}function po(t,e,i,n,o){var l=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var _=n.stateNode.containerInfo;if(_===o||_.nodeType===8&&_.parentNode===o)break;if(d===4)for(d=n.return;d!==null;){var S=d.tag;if((S===3||S===4)&&(S=d.stateNode.containerInfo,S===o||S.nodeType===8&&S.parentNode===o))return;d=d.return}for(;_!==null;){if(d=Ai(_),d===null)return;if(S=d.tag,S===5||S===6){n=l=d;continue e}_=_.parentNode}}n=n.return}nh(function(){var w=l,T=Ua(i),A=[];e:{var I=Mh.get(t);if(I!==void 0){var k=Xa,P=t;switch(t){case"keypress":if(Hr(i)===0)break e;case"keydown":case"keyup":k=Rg;break;case"focusin":P="focus",k=ao;break;case"focusout":P="blur",k=ao;break;case"beforeblur":case"afterblur":k=ao;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=Ql;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=vg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=kg;break;case Ah:case Oh:case Rh:k=wg;break;case Dh:k=Fg;break;case"scroll":k=mg;break;case"wheel":k=Bg;break;case"copy":case"cut":case"paste":k=xg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=ec}var F=(e&4)!==0,z=!F&&t==="scroll",D=F?I!==null?I+"Capture":null:I;F=[];for(var R=w,M;R!==null;){M=R;var $=M.stateNode;if(M.tag===5&&$!==null&&(M=$,D!==null&&($=er(R,D),$!=null&&F.push(ar(R,$,M)))),z)break;R=R.return}0<F.length&&(I=new k(I,P,null,i,T),A.push({event:I,listeners:F}))}}if(!(e&7)){e:{if(I=t==="mouseover"||t==="pointerover",k=t==="mouseout"||t==="pointerout",I&&i!==Ho&&(P=i.relatedTarget||i.fromElement)&&(Ai(P)||P[Qt]))break e;if((k||I)&&(I=T.window===T?T:(I=T.ownerDocument)?I.defaultView||I.parentWindow:window,k?(P=i.relatedTarget||i.toElement,k=w,P=P?Ai(P):null,P!==null&&(z=Gi(P),P!==z||P.tag!==5&&P.tag!==6)&&(P=null)):(k=null,P=w),k!==P)){if(F=Ql,$="onMouseLeave",D="onMouseEnter",R="mouse",(t==="pointerout"||t==="pointerover")&&(F=ec,$="onPointerLeave",D="onPointerEnter",R="pointer"),z=k==null?I:en(k),M=P==null?I:en(P),I=new F($,R+"leave",k,i,T),I.target=z,I.relatedTarget=M,$=null,Ai(T)===w&&(F=new F(D,R+"enter",P,i,T),F.target=M,F.relatedTarget=z,$=F),z=$,k&&P)t:{for(F=k,D=P,R=0,M=F;M;M=$i(M))R++;for(M=0,$=D;$;$=$i($))M++;for(;0<R-M;)F=$i(F),R--;for(;0<M-R;)D=$i(D),M--;for(;R--;){if(F===D||D!==null&&F===D.alternate)break t;F=$i(F),D=$i(D)}F=null}else F=null;k!==null&&hc(A,I,k,F,!1),P!==null&&z!==null&&hc(A,z,P,F,!0)}}e:{if(I=w?en(w):window,k=I.nodeName&&I.nodeName.toLowerCase(),k==="select"||k==="input"&&I.type==="file")var ie=zg;else if(nc(I))if(xh)ie=$g;else{ie=Yg;var ne=Hg}else(k=I.nodeName)&&k.toLowerCase()==="input"&&(I.type==="checkbox"||I.type==="radio")&&(ie=Xg);if(ie&&(ie=ie(t,w))){Ch(A,ie,i,T);break e}ne&&ne(t,I,w),t==="focusout"&&(ne=I._wrapperState)&&ne.controlled&&I.type==="number"&&Vo(I,"number",I.value)}switch(ne=w?en(w):window,t){case"focusin":(nc(ne)||ne.contentEditable==="true")&&(Qi=ne,Qo=w,Xn=null);break;case"focusout":Xn=Qo=Qi=null;break;case"mousedown":qo=!0;break;case"contextmenu":case"mouseup":case"dragend":qo=!1,lc(A,i,T);break;case"selectionchange":if(Jg)break;case"keydown":case"keyup":lc(A,i,T)}var q;if(Ka)e:{switch(t){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Ji?Sh(t,i)&&(y="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(y="onCompositionStart");y&&(yh&&i.locale!=="ko"&&(Ji||y!=="onCompositionStart"?y==="onCompositionEnd"&&Ji&&(q=vh()):(li=T,Ya="value"in li?li.value:li.textContent,Ji=!0)),ne=ls(w,y),0<ne.length&&(y=new ql(y,t,null,i,T),A.push({event:y,listeners:ne}),q?y.data=q:(q=wh(i),q!==null&&(y.data=q)))),(q=jg?Vg(t,i):Ug(t,i))&&(w=ls(w,"onBeforeInput"),0<w.length&&(T=new ql("onBeforeInput","beforeinput",null,i,T),A.push({event:T,listeners:w}),T.data=q))}kh(A,e)})}function ar(t,e,i){return{instance:t,listener:e,currentTarget:i}}function ls(t,e){for(var i=e+"Capture",n=[];t!==null;){var o=t,l=o.stateNode;o.tag===5&&l!==null&&(o=l,l=er(t,i),l!=null&&n.unshift(ar(t,l,o)),l=er(t,e),l!=null&&n.push(ar(t,l,o))),t=t.return}return n}function $i(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function hc(t,e,i,n,o){for(var l=e._reactName,d=[];i!==null&&i!==n;){var _=i,S=_.alternate,w=_.stateNode;if(S!==null&&S===n)break;_.tag===5&&w!==null&&(_=w,o?(S=er(i,l),S!=null&&d.unshift(ar(i,S,_))):o||(S=er(i,l),S!=null&&d.push(ar(i,S,_)))),i=i.return}d.length!==0&&t.push({event:e,listeners:d})}var tp=/\r\n?/g,ip=/\u0000|\uFFFD/g;function dc(t){return(typeof t=="string"?t:""+t).replace(tp,`
`).replace(ip,"")}function Dr(t,e,i){if(e=dc(e),dc(t)!==e&&i)throw Error(ae(425))}function cs(){}var ea=null,ta=null;function ia(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var na=typeof setTimeout=="function"?setTimeout:void 0,np=typeof clearTimeout=="function"?clearTimeout:void 0,fc=typeof Promise=="function"?Promise:void 0,rp=typeof queueMicrotask=="function"?queueMicrotask:typeof fc<"u"?function(t){return fc.resolve(null).then(t).catch(sp)}:na;function sp(t){setTimeout(function(){throw t})}function mo(t,e){var i=e,n=0;do{var o=i.nextSibling;if(t.removeChild(i),o&&o.nodeType===8)if(i=o.data,i==="/$"){if(n===0){t.removeChild(o),nr(e);return}n--}else i!=="$"&&i!=="$?"&&i!=="$!"||n++;i=o}while(i);nr(e)}function fi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function gc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var Tn=Math.random().toString(36).slice(2),jt="__reactFiber$"+Tn,lr="__reactProps$"+Tn,Qt="__reactContainer$"+Tn,ra="__reactEvents$"+Tn,op="__reactListeners$"+Tn,ap="__reactHandles$"+Tn;function Ai(t){var e=t[jt];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Qt]||i[jt]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=gc(t);t!==null;){if(i=t[jt])return i;t=gc(t)}return e}t=i,i=t.parentNode}return null}function vr(t){return t=t[jt]||t[Qt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function en(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function js(t){return t[lr]||null}var sa=[],tn=-1;function Ci(t){return{current:t}}function Me(t){0>tn||(t.current=sa[tn],sa[tn]=null,tn--)}function Oe(t,e){tn++,sa[tn]=t.current,t.current=e}var Si={},it=Ci(Si),ct=Ci(!1),Pi=Si;function pn(t,e){var i=t.type.contextTypes;if(!i)return Si;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var o={},l;for(l in i)o[l]=e[l];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function ut(t){return t=t.childContextTypes,t!=null}function us(){Me(ct),Me(it)}function pc(t,e,i){if(it.current!==Si)throw Error(ae(168));Oe(it,e),Oe(ct,i)}function Fh(t,e,i){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return i;n=n.getChildContext();for(var o in n)if(!(o in e))throw Error(ae(108,Hf(t)||"Unknown",o));return Be({},i,n)}function hs(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Si,Pi=it.current,Oe(it,t),Oe(ct,ct.current),!0}function mc(t,e,i){var n=t.stateNode;if(!n)throw Error(ae(169));i?(t=Fh(t,e,Pi),n.__reactInternalMemoizedMergedChildContext=t,Me(ct),Me(it),Oe(it,t)):Me(ct),Oe(ct,i)}var Ht=null,Vs=!1,_o=!1;function Ph(t){Ht===null?Ht=[t]:Ht.push(t)}function lp(t){Vs=!0,Ph(t)}function xi(){if(!_o&&Ht!==null){_o=!0;var t=0,e=Ae;try{var i=Ht;for(Ae=1;t<i.length;t++){var n=i[t];do n=n(!0);while(n!==null)}Ht=null,Vs=!1}catch(o){throw Ht!==null&&(Ht=Ht.slice(t+1)),ah(Wa,xi),o}finally{Ae=e,_o=!1}}return null}var nn=[],rn=0,ds=null,fs=0,Tt=[],bt=0,Bi=null,$t=1,Kt="";function Ei(t,e){nn[rn++]=fs,nn[rn++]=ds,ds=t,fs=e}function Bh(t,e,i){Tt[bt++]=$t,Tt[bt++]=Kt,Tt[bt++]=Bi,Bi=t;var n=$t;t=Kt;var o=32-Lt(n)-1;n&=~(1<<o),i+=1;var l=32-Lt(e)+o;if(30<l){var d=o-o%5;l=(n&(1<<d)-1).toString(32),n>>=d,o-=d,$t=1<<32-Lt(e)+o|i<<o|n,Kt=l+t}else $t=1<<l|i<<o|n,Kt=t}function Ja(t){t.return!==null&&(Ei(t,1),Bh(t,1,0))}function Qa(t){for(;t===ds;)ds=nn[--rn],nn[rn]=null,fs=nn[--rn],nn[rn]=null;for(;t===Bi;)Bi=Tt[--bt],Tt[bt]=null,Kt=Tt[--bt],Tt[bt]=null,$t=Tt[--bt],Tt[bt]=null}var vt=null,_t=null,Le=!1,kt=null;function Nh(t,e){var i=Et(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function _c(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,vt=t,_t=fi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,vt=t,_t=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=Bi!==null?{id:$t,overflow:Kt}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=Et(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,vt=t,_t=null,!0):!1;default:return!1}}function oa(t){return(t.mode&1)!==0&&(t.flags&128)===0}function aa(t){if(Le){var e=_t;if(e){var i=e;if(!_c(t,e)){if(oa(t))throw Error(ae(418));e=fi(i.nextSibling);var n=vt;e&&_c(t,e)?Nh(n,i):(t.flags=t.flags&-4097|2,Le=!1,vt=t)}}else{if(oa(t))throw Error(ae(418));t.flags=t.flags&-4097|2,Le=!1,vt=t}}}function vc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;vt=t}function Mr(t){if(t!==vt)return!1;if(!Le)return vc(t),Le=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ia(t.type,t.memoizedProps)),e&&(e=_t)){if(oa(t))throw jh(),Error(ae(418));for(;e;)Nh(t,e),e=fi(e.nextSibling)}if(vc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){_t=fi(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}_t=null}}else _t=vt?fi(t.stateNode.nextSibling):null;return!0}function jh(){for(var t=_t;t;)t=fi(t.nextSibling)}function mn(){_t=vt=null,Le=!1}function qa(t){kt===null?kt=[t]:kt.push(t)}var cp=ii.ReactCurrentBatchConfig;function Dt(t,e){if(t&&t.defaultProps){e=Be({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}var gs=Ci(null),ps=null,sn=null,el=null;function tl(){el=sn=ps=null}function il(t){var e=gs.current;Me(gs),t._currentValue=e}function la(t,e,i){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===i)break;t=t.return}}function dn(t,e){ps=t,el=sn=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(lt=!0),t.firstContext=null)}function At(t){var e=t._currentValue;if(el!==t)if(t={context:t,memoizedValue:e,next:null},sn===null){if(ps===null)throw Error(ae(308));sn=t,ps.dependencies={lanes:0,firstContext:t}}else sn=sn.next=t;return e}var Oi=null;function nl(t){Oi===null?Oi=[t]:Oi.push(t)}function Vh(t,e,i,n){var o=e.interleaved;return o===null?(i.next=i,nl(e)):(i.next=o.next,o.next=i),e.interleaved=i,qt(t,n)}function qt(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var si=!1;function rl(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uh(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Zt(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function gi(t,e,i){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Ee&2){var o=n.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),n.pending=e,qt(t,i)}return o=n.interleaved,o===null?(e.next=e,nl(n)):(e.next=o.next,o.next=e),n.interleaved=e,qt(t,i)}function Yr(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,Ga(t,i)}}function yc(t,e){var i=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var o=null,l=null;if(i=i.firstBaseUpdate,i!==null){do{var d={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};l===null?o=l=d:l=l.next=d,i=i.next}while(i!==null);l===null?o=l=e:l=l.next=e}else o=l=e;i={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:l,shared:n.shared,effects:n.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function ms(t,e,i,n){var o=t.updateQueue;si=!1;var l=o.firstBaseUpdate,d=o.lastBaseUpdate,_=o.shared.pending;if(_!==null){o.shared.pending=null;var S=_,w=S.next;S.next=null,d===null?l=w:d.next=w,d=S;var T=t.alternate;T!==null&&(T=T.updateQueue,_=T.lastBaseUpdate,_!==d&&(_===null?T.firstBaseUpdate=w:_.next=w,T.lastBaseUpdate=S))}if(l!==null){var A=o.baseState;d=0,T=w=S=null,_=l;do{var I=_.lane,k=_.eventTime;if((n&I)===I){T!==null&&(T=T.next={eventTime:k,lane:0,tag:_.tag,payload:_.payload,callback:_.callback,next:null});e:{var P=t,F=_;switch(I=e,k=i,F.tag){case 1:if(P=F.payload,typeof P=="function"){A=P.call(k,A,I);break e}A=P;break e;case 3:P.flags=P.flags&-65537|128;case 0:if(P=F.payload,I=typeof P=="function"?P.call(k,A,I):P,I==null)break e;A=Be({},A,I);break e;case 2:si=!0}}_.callback!==null&&_.lane!==0&&(t.flags|=64,I=o.effects,I===null?o.effects=[_]:I.push(_))}else k={eventTime:k,lane:I,tag:_.tag,payload:_.payload,callback:_.callback,next:null},T===null?(w=T=k,S=A):T=T.next=k,d|=I;if(_=_.next,_===null){if(_=o.shared.pending,_===null)break;I=_,_=I.next,I.next=null,o.lastBaseUpdate=I,o.shared.pending=null}}while(1);if(T===null&&(S=A),o.baseState=S,o.firstBaseUpdate=w,o.lastBaseUpdate=T,e=o.shared.interleaved,e!==null){o=e;do d|=o.lane,o=o.next;while(o!==e)}else l===null&&(o.shared.lanes=0);ji|=d,t.lanes=d,t.memoizedState=A}}function Sc(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],o=n.callback;if(o!==null){if(n.callback=null,n=i,typeof o!="function")throw Error(ae(191,o));o.call(n)}}}var Wh=new Vu.Component().refs;function ca(t,e,i,n){e=t.memoizedState,i=i(n,e),i=i==null?e:Be({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var Us={isMounted:function(t){return(t=t._reactInternals)?Gi(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var n=rt(),o=mi(t),l=Zt(n,o);l.payload=e,i!=null&&(l.callback=i),e=gi(t,l,o),e!==null&&(Ft(e,t,o,n),Yr(e,t,o))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var n=rt(),o=mi(t),l=Zt(n,o);l.tag=1,l.payload=e,i!=null&&(l.callback=i),e=gi(t,l,o),e!==null&&(Ft(e,t,o,n),Yr(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=rt(),n=mi(t),o=Zt(i,n);o.tag=2,e!=null&&(o.callback=e),e=gi(t,o,n),e!==null&&(Ft(e,t,n,i),Yr(e,t,n))}};function wc(t,e,i,n,o,l,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,l,d):e.prototype&&e.prototype.isPureReactComponent?!sr(i,n)||!sr(o,l):!0}function Gh(t,e,i){var n=!1,o=Si,l=e.contextType;return typeof l=="object"&&l!==null?l=At(l):(o=ut(e)?Pi:it.current,n=e.contextTypes,l=(n=n!=null)?pn(t,o):Si),e=new e(i,l),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Us,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=l),e}function Cc(t,e,i,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,n),e.state!==t&&Us.enqueueReplaceState(e,e.state,null)}function ua(t,e,i,n){var o=t.stateNode;o.props=i,o.state=t.memoizedState,o.refs=Wh,rl(t);var l=e.contextType;typeof l=="object"&&l!==null?o.context=At(l):(l=ut(e)?Pi:it.current,o.context=pn(t,l)),o.state=t.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(ca(t,e,l,i),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&Us.enqueueReplaceState(o,o.state,null),ms(t,i,o,n),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function kn(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ae(309));var n=i.stateNode}if(!n)throw Error(ae(147,t));var o=n,l=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===l?e.ref:(e=function(d){var _=o.refs;_===Wh&&(_=o.refs={}),d===null?delete _[l]:_[l]=d},e._stringRef=l,e)}if(typeof t!="string")throw Error(ae(284));if(!i._owner)throw Error(ae(290,t))}return t}function kr(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function xc(t){var e=t._init;return e(t._payload)}function zh(t){function e(D,R){if(t){var M=D.deletions;M===null?(D.deletions=[R],D.flags|=16):M.push(R)}}function i(D,R){if(!t)return null;for(;R!==null;)e(D,R),R=R.sibling;return null}function n(D,R){for(D=new Map;R!==null;)R.key!==null?D.set(R.key,R):D.set(R.index,R),R=R.sibling;return D}function o(D,R){return D=_i(D,R),D.index=0,D.sibling=null,D}function l(D,R,M){return D.index=M,t?(M=D.alternate,M!==null?(M=M.index,M<R?(D.flags|=2,R):M):(D.flags|=2,R)):(D.flags|=1048576,R)}function d(D){return t&&D.alternate===null&&(D.flags|=2),D}function _(D,R,M,$){return R===null||R.tag!==6?(R=To(M,D.mode,$),R.return=D,R):(R=o(R,M),R.return=D,R)}function S(D,R,M,$){var ie=M.type;return ie===Zi?T(D,R,M.props.children,$,M.key):R!==null&&(R.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===ri&&xc(ie)===R.type)?($=o(R,M.props),$.ref=kn(D,R,M),$.return=D,$):($=Qr(M.type,M.key,M.props,null,D.mode,$),$.ref=kn(D,R,M),$.return=D,$)}function w(D,R,M,$){return R===null||R.tag!==4||R.stateNode.containerInfo!==M.containerInfo||R.stateNode.implementation!==M.implementation?(R=bo(M,D.mode,$),R.return=D,R):(R=o(R,M.children||[]),R.return=D,R)}function T(D,R,M,$,ie){return R===null||R.tag!==7?(R=ki(M,D.mode,$,ie),R.return=D,R):(R=o(R,M),R.return=D,R)}function A(D,R,M){if(typeof R=="string"&&R!==""||typeof R=="number")return R=To(""+R,D.mode,M),R.return=D,R;if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Cr:return M=Qr(R.type,R.key,R.props,null,D.mode,M),M.ref=kn(D,null,R),M.return=D,M;case Ki:return R=bo(R,D.mode,M),R.return=D,R;case ri:var $=R._init;return A(D,$(R._payload),M)}if(Vn(R)||An(R))return R=ki(R,D.mode,M,null),R.return=D,R;kr(D,R)}return null}function I(D,R,M,$){var ie=R!==null?R.key:null;if(typeof M=="string"&&M!==""||typeof M=="number")return ie!==null?null:_(D,R,""+M,$);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Cr:return M.key===ie?S(D,R,M,$):null;case Ki:return M.key===ie?w(D,R,M,$):null;case ri:return ie=M._init,I(D,R,ie(M._payload),$)}if(Vn(M)||An(M))return ie!==null?null:T(D,R,M,$,null);kr(D,M)}return null}function k(D,R,M,$,ie){if(typeof $=="string"&&$!==""||typeof $=="number")return D=D.get(M)||null,_(R,D,""+$,ie);if(typeof $=="object"&&$!==null){switch($.$$typeof){case Cr:return D=D.get($.key===null?M:$.key)||null,S(R,D,$,ie);case Ki:return D=D.get($.key===null?M:$.key)||null,w(R,D,$,ie);case ri:var ne=$._init;return k(D,R,M,ne($._payload),ie)}if(Vn($)||An($))return D=D.get(M)||null,T(R,D,$,ie,null);kr(R,$)}return null}function P(D,R,M,$){for(var ie=null,ne=null,q=R,y=R=0,pe=null;q!==null&&y<M.length;y++){q.index>y?(pe=q,q=null):pe=q.sibling;var fe=I(D,q,M[y],$);if(fe===null){q===null&&(q=pe);break}t&&q&&fe.alternate===null&&e(D,q),R=l(fe,R,y),ne===null?ie=fe:ne.sibling=fe,ne=fe,q=pe}if(y===M.length)return i(D,q),Le&&Ei(D,y),ie;if(q===null){for(;y<M.length;y++)q=A(D,M[y],$),q!==null&&(R=l(q,R,y),ne===null?ie=q:ne.sibling=q,ne=q);return Le&&Ei(D,y),ie}for(q=n(D,q);y<M.length;y++)pe=k(q,D,y,M[y],$),pe!==null&&(t&&pe.alternate!==null&&q.delete(pe.key===null?y:pe.key),R=l(pe,R,y),ne===null?ie=pe:ne.sibling=pe,ne=pe);return t&&q.forEach(function(Ce){return e(D,Ce)}),Le&&Ei(D,y),ie}function F(D,R,M,$){var ie=An(M);if(typeof ie!="function")throw Error(ae(150));if(M=ie.call(M),M==null)throw Error(ae(151));for(var ne=ie=null,q=R,y=R=0,pe=null,fe=M.next();q!==null&&!fe.done;y++,fe=M.next()){q.index>y?(pe=q,q=null):pe=q.sibling;var Ce=I(D,q,fe.value,$);if(Ce===null){q===null&&(q=pe);break}t&&q&&Ce.alternate===null&&e(D,q),R=l(Ce,R,y),ne===null?ie=Ce:ne.sibling=Ce,ne=Ce,q=pe}if(fe.done)return i(D,q),Le&&Ei(D,y),ie;if(q===null){for(;!fe.done;y++,fe=M.next())fe=A(D,fe.value,$),fe!==null&&(R=l(fe,R,y),ne===null?ie=fe:ne.sibling=fe,ne=fe);return Le&&Ei(D,y),ie}for(q=n(D,q);!fe.done;y++,fe=M.next())fe=k(q,D,y,fe.value,$),fe!==null&&(t&&fe.alternate!==null&&q.delete(fe.key===null?y:fe.key),R=l(fe,R,y),ne===null?ie=fe:ne.sibling=fe,ne=fe);return t&&q.forEach(function(u){return e(D,u)}),Le&&Ei(D,y),ie}function z(D,R,M,$){if(typeof M=="object"&&M!==null&&M.type===Zi&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case Cr:e:{for(var ie=M.key,ne=R;ne!==null;){if(ne.key===ie){if(ie=M.type,ie===Zi){if(ne.tag===7){i(D,ne.sibling),R=o(ne,M.props.children),R.return=D,D=R;break e}}else if(ne.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===ri&&xc(ie)===ne.type){i(D,ne.sibling),R=o(ne,M.props),R.ref=kn(D,ne,M),R.return=D,D=R;break e}i(D,ne);break}else e(D,ne);ne=ne.sibling}M.type===Zi?(R=ki(M.props.children,D.mode,$,M.key),R.return=D,D=R):($=Qr(M.type,M.key,M.props,null,D.mode,$),$.ref=kn(D,R,M),$.return=D,D=$)}return d(D);case Ki:e:{for(ne=M.key;R!==null;){if(R.key===ne)if(R.tag===4&&R.stateNode.containerInfo===M.containerInfo&&R.stateNode.implementation===M.implementation){i(D,R.sibling),R=o(R,M.children||[]),R.return=D,D=R;break e}else{i(D,R);break}else e(D,R);R=R.sibling}R=bo(M,D.mode,$),R.return=D,D=R}return d(D);case ri:return ne=M._init,z(D,R,ne(M._payload),$)}if(Vn(M))return P(D,R,M,$);if(An(M))return F(D,R,M,$);kr(D,M)}return typeof M=="string"&&M!==""||typeof M=="number"?(M=""+M,R!==null&&R.tag===6?(i(D,R.sibling),R=o(R,M),R.return=D,D=R):(i(D,R),R=To(M,D.mode,$),R.return=D,D=R),d(D)):i(D,R)}return z}var _n=zh(!0),Hh=zh(!1),yr={},Ut=Ci(yr),cr=Ci(yr),ur=Ci(yr);function Ri(t){if(t===yr)throw Error(ae(174));return t}function sl(t,e){switch(Oe(ur,e),Oe(cr,t),Oe(Ut,yr),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Wo(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Wo(e,t)}Me(Ut),Oe(Ut,e)}function vn(){Me(Ut),Me(cr),Me(ur)}function Yh(t){Ri(ur.current);var e=Ri(Ut.current),i=Wo(e,t.type);e!==i&&(Oe(cr,t),Oe(Ut,i))}function ol(t){cr.current===t&&(Me(Ut),Me(cr))}var Fe=Ci(0);function _s(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var vo=[];function al(){for(var t=0;t<vo.length;t++)vo[t]._workInProgressVersionPrimary=null;vo.length=0}var Xr=ii.ReactCurrentDispatcher,yo=ii.ReactCurrentBatchConfig,Ni=0,Pe=null,We=null,ze=null,vs=!1,$n=!1,hr=0,up=0;function Qe(){throw Error(ae(321))}function ll(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!Pt(t[i],e[i]))return!1;return!0}function cl(t,e,i,n,o,l){if(Ni=l,Pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Xr.current=t===null||t.memoizedState===null?gp:pp,t=i(n,o),$n){l=0;do{if($n=!1,hr=0,25<=l)throw Error(ae(301));l+=1,ze=We=null,e.updateQueue=null,Xr.current=mp,t=i(n,o)}while($n)}if(Xr.current=ys,e=We!==null&&We.next!==null,Ni=0,ze=We=Pe=null,vs=!1,e)throw Error(ae(300));return t}function ul(){var t=hr!==0;return hr=0,t}function Nt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ze===null?Pe.memoizedState=ze=t:ze=ze.next=t,ze}function Ot(){if(We===null){var t=Pe.alternate;t=t!==null?t.memoizedState:null}else t=We.next;var e=ze===null?Pe.memoizedState:ze.next;if(e!==null)ze=e,We=t;else{if(t===null)throw Error(ae(310));We=t,t={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},ze===null?Pe.memoizedState=ze=t:ze=ze.next=t}return ze}function dr(t,e){return typeof e=="function"?e(t):e}function So(t){var e=Ot(),i=e.queue;if(i===null)throw Error(ae(311));i.lastRenderedReducer=t;var n=We,o=n.baseQueue,l=i.pending;if(l!==null){if(o!==null){var d=o.next;o.next=l.next,l.next=d}n.baseQueue=o=l,i.pending=null}if(o!==null){l=o.next,n=n.baseState;var _=d=null,S=null,w=l;do{var T=w.lane;if((Ni&T)===T)S!==null&&(S=S.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),n=w.hasEagerState?w.eagerState:t(n,w.action);else{var A={lane:T,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};S===null?(_=S=A,d=n):S=S.next=A,Pe.lanes|=T,ji|=T}w=w.next}while(w!==null&&w!==l);S===null?d=n:S.next=_,Pt(n,e.memoizedState)||(lt=!0),e.memoizedState=n,e.baseState=d,e.baseQueue=S,i.lastRenderedState=n}if(t=i.interleaved,t!==null){o=t;do l=o.lane,Pe.lanes|=l,ji|=l,o=o.next;while(o!==t)}else o===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function wo(t){var e=Ot(),i=e.queue;if(i===null)throw Error(ae(311));i.lastRenderedReducer=t;var n=i.dispatch,o=i.pending,l=e.memoizedState;if(o!==null){i.pending=null;var d=o=o.next;do l=t(l,d.action),d=d.next;while(d!==o);Pt(l,e.memoizedState)||(lt=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),i.lastRenderedState=l}return[l,n]}function Xh(){}function $h(t,e){var i=Pe,n=Ot(),o=e(),l=!Pt(n.memoizedState,o);if(l&&(n.memoizedState=o,lt=!0),n=n.queue,hl(Jh.bind(null,i,n,t),[t]),n.getSnapshot!==e||l||ze!==null&&ze.memoizedState.tag&1){if(i.flags|=2048,fr(9,Zh.bind(null,i,n,o,e),void 0,null),Xe===null)throw Error(ae(349));Ni&30||Kh(i,e,o)}return o}function Kh(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=Pe.updateQueue,e===null?(e={lastEffect:null,stores:null},Pe.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function Zh(t,e,i,n){e.value=i,e.getSnapshot=n,Qh(e)&&qh(t)}function Jh(t,e,i){return i(function(){Qh(e)&&qh(t)})}function Qh(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!Pt(t,i)}catch{return!0}}function qh(t){var e=qt(t,1);e!==null&&Ft(e,t,1,-1)}function Tc(t){var e=Nt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dr,lastRenderedState:t},e.queue=t,t=t.dispatch=fp.bind(null,Pe,t),[e.memoizedState,t]}function fr(t,e,i,n){return t={tag:t,create:e,destroy:i,deps:n,next:null},e=Pe.updateQueue,e===null?(e={lastEffect:null,stores:null},Pe.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(n=i.next,i.next=t,t.next=n,e.lastEffect=t)),t}function ed(){return Ot().memoizedState}function $r(t,e,i,n){var o=Nt();Pe.flags|=t,o.memoizedState=fr(1|e,i,void 0,n===void 0?null:n)}function Ws(t,e,i,n){var o=Ot();n=n===void 0?null:n;var l=void 0;if(We!==null){var d=We.memoizedState;if(l=d.destroy,n!==null&&ll(n,d.deps)){o.memoizedState=fr(e,i,l,n);return}}Pe.flags|=t,o.memoizedState=fr(1|e,i,l,n)}function bc(t,e){return $r(8390656,8,t,e)}function hl(t,e){return Ws(2048,8,t,e)}function td(t,e){return Ws(4,2,t,e)}function id(t,e){return Ws(4,4,t,e)}function nd(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function rd(t,e,i){return i=i!=null?i.concat([t]):null,Ws(4,4,nd.bind(null,e,t),i)}function dl(){}function sd(t,e){var i=Ot();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&ll(e,n[1])?n[0]:(i.memoizedState=[t,e],t)}function od(t,e){var i=Ot();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&ll(e,n[1])?n[0]:(t=t(),i.memoizedState=[t,e],t)}function ad(t,e,i){return Ni&21?(Pt(i,e)||(i=uh(),Pe.lanes|=i,ji|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,lt=!0),t.memoizedState=i)}function hp(t,e){var i=Ae;Ae=i!==0&&4>i?i:4,t(!0);var n=yo.transition;yo.transition={};try{t(!1),e()}finally{Ae=i,yo.transition=n}}function ld(){return Ot().memoizedState}function dp(t,e,i){var n=mi(t);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},cd(t))ud(e,i);else if(i=Vh(t,e,i,n),i!==null){var o=rt();Ft(i,t,n,o),hd(i,e,n)}}function fp(t,e,i){var n=mi(t),o={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(cd(t))ud(e,o);else{var l=t.alternate;if(t.lanes===0&&(l===null||l.lanes===0)&&(l=e.lastRenderedReducer,l!==null))try{var d=e.lastRenderedState,_=l(d,i);if(o.hasEagerState=!0,o.eagerState=_,Pt(_,d)){var S=e.interleaved;S===null?(o.next=o,nl(e)):(o.next=S.next,S.next=o),e.interleaved=o;return}}catch{}finally{}i=Vh(t,e,o,n),i!==null&&(o=rt(),Ft(i,t,n,o),hd(i,e,n))}}function cd(t){var e=t.alternate;return t===Pe||e!==null&&e===Pe}function ud(t,e){$n=vs=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function hd(t,e,i){if(i&4194240){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,Ga(t,i)}}var ys={readContext:At,useCallback:Qe,useContext:Qe,useEffect:Qe,useImperativeHandle:Qe,useInsertionEffect:Qe,useLayoutEffect:Qe,useMemo:Qe,useReducer:Qe,useRef:Qe,useState:Qe,useDebugValue:Qe,useDeferredValue:Qe,useTransition:Qe,useMutableSource:Qe,useSyncExternalStore:Qe,useId:Qe,unstable_isNewReconciler:!1},gp={readContext:At,useCallback:function(t,e){return Nt().memoizedState=[t,e===void 0?null:e],t},useContext:At,useEffect:bc,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,$r(4194308,4,nd.bind(null,e,t),i)},useLayoutEffect:function(t,e){return $r(4194308,4,t,e)},useInsertionEffect:function(t,e){return $r(4,2,t,e)},useMemo:function(t,e){var i=Nt();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var n=Nt();return e=i!==void 0?i(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=dp.bind(null,Pe,t),[n.memoizedState,t]},useRef:function(t){var e=Nt();return t={current:t},e.memoizedState=t},useState:Tc,useDebugValue:dl,useDeferredValue:function(t){return Nt().memoizedState=t},useTransition:function(){var t=Tc(!1),e=t[0];return t=hp.bind(null,t[1]),Nt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var n=Pe,o=Nt();if(Le){if(i===void 0)throw Error(ae(407));i=i()}else{if(i=e(),Xe===null)throw Error(ae(349));Ni&30||Kh(n,e,i)}o.memoizedState=i;var l={value:i,getSnapshot:e};return o.queue=l,bc(Jh.bind(null,n,l,t),[t]),n.flags|=2048,fr(9,Zh.bind(null,n,l,i,e),void 0,null),i},useId:function(){var t=Nt(),e=Xe.identifierPrefix;if(Le){var i=Kt,n=$t;i=(n&~(1<<32-Lt(n)-1)).toString(32)+i,e=":"+e+"R"+i,i=hr++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=up++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},pp={readContext:At,useCallback:sd,useContext:At,useEffect:hl,useImperativeHandle:rd,useInsertionEffect:td,useLayoutEffect:id,useMemo:od,useReducer:So,useRef:ed,useState:function(){return So(dr)},useDebugValue:dl,useDeferredValue:function(t){var e=Ot();return ad(e,We.memoizedState,t)},useTransition:function(){var t=So(dr)[0],e=Ot().memoizedState;return[t,e]},useMutableSource:Xh,useSyncExternalStore:$h,useId:ld,unstable_isNewReconciler:!1},mp={readContext:At,useCallback:sd,useContext:At,useEffect:hl,useImperativeHandle:rd,useInsertionEffect:td,useLayoutEffect:id,useMemo:od,useReducer:wo,useRef:ed,useState:function(){return wo(dr)},useDebugValue:dl,useDeferredValue:function(t){var e=Ot();return We===null?e.memoizedState=t:ad(e,We.memoizedState,t)},useTransition:function(){var t=wo(dr)[0],e=Ot().memoizedState;return[t,e]},useMutableSource:Xh,useSyncExternalStore:$h,useId:ld,unstable_isNewReconciler:!1};function yn(t,e){try{var i="",n=e;do i+=zf(n),n=n.return;while(n);var o=i}catch(l){o=`
Error generating stack: `+l.message+`
`+l.stack}return{value:t,source:e,stack:o,digest:null}}function Co(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function ha(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var _p=typeof WeakMap=="function"?WeakMap:Map;function dd(t,e,i){i=Zt(-1,i),i.tag=3,i.payload={element:null};var n=e.value;return i.callback=function(){ws||(ws=!0,wa=n),ha(t,e)},i}function fd(t,e,i){i=Zt(-1,i),i.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var o=e.value;i.payload=function(){return n(o)},i.callback=function(){ha(t,e)}}var l=t.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(i.callback=function(){ha(t,e),typeof n!="function"&&(pi===null?pi=new Set([this]):pi.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),i}function Ec(t,e,i){var n=t.pingCache;if(n===null){n=t.pingCache=new _p;var o=new Set;n.set(e,o)}else o=n.get(e),o===void 0&&(o=new Set,n.set(e,o));o.has(i)||(o.add(i),t=Dp.bind(null,t,e,i),e.then(t,t))}function Ic(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ac(t,e,i,n,o){return t.mode&1?(t.flags|=65536,t.lanes=o,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=Zt(-1,1),e.tag=2,gi(i,e,1))),i.lanes|=1),t)}var vp=ii.ReactCurrentOwner,lt=!1;function nt(t,e,i,n){e.child=t===null?Hh(e,null,i,n):_n(e,t.child,i,n)}function Oc(t,e,i,n,o){i=i.render;var l=e.ref;return dn(e,o),n=cl(t,e,i,n,l,o),i=ul(),t!==null&&!lt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,ei(t,e,o)):(Le&&i&&Ja(e),e.flags|=1,nt(t,e,n,o),e.child)}function Rc(t,e,i,n,o){if(t===null){var l=i.type;return typeof l=="function"&&!Sl(l)&&l.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=l,gd(t,e,l,n,o)):(t=Qr(i.type,null,n,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(l=t.child,!(t.lanes&o)){var d=l.memoizedProps;if(i=i.compare,i=i!==null?i:sr,i(d,n)&&t.ref===e.ref)return ei(t,e,o)}return e.flags|=1,t=_i(l,n),t.ref=e.ref,t.return=e,e.child=t}function gd(t,e,i,n,o){if(t!==null){var l=t.memoizedProps;if(sr(l,n)&&t.ref===e.ref)if(lt=!1,e.pendingProps=n=l,(t.lanes&o)!==0)t.flags&131072&&(lt=!0);else return e.lanes=t.lanes,ei(t,e,o)}return da(t,e,i,n,o)}function pd(t,e,i){var n=e.pendingProps,o=n.children,l=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Oe(an,gt),gt|=i;else{if(!(i&1073741824))return t=l!==null?l.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Oe(an,gt),gt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=l!==null?l.baseLanes:i,Oe(an,gt),gt|=n}else l!==null?(n=l.baseLanes|i,e.memoizedState=null):n=i,Oe(an,gt),gt|=n;return nt(t,e,o,i),e.child}function md(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function da(t,e,i,n,o){var l=ut(i)?Pi:it.current;return l=pn(e,l),dn(e,o),i=cl(t,e,i,n,l,o),n=ul(),t!==null&&!lt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,ei(t,e,o)):(Le&&n&&Ja(e),e.flags|=1,nt(t,e,i,o),e.child)}function Dc(t,e,i,n,o){if(ut(i)){var l=!0;hs(e)}else l=!1;if(dn(e,o),e.stateNode===null)Kr(t,e),Gh(e,i,n),ua(e,i,n,o),n=!0;else if(t===null){var d=e.stateNode,_=e.memoizedProps;d.props=_;var S=d.context,w=i.contextType;typeof w=="object"&&w!==null?w=At(w):(w=ut(i)?Pi:it.current,w=pn(e,w));var T=i.getDerivedStateFromProps,A=typeof T=="function"||typeof d.getSnapshotBeforeUpdate=="function";A||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(_!==n||S!==w)&&Cc(e,d,n,w),si=!1;var I=e.memoizedState;d.state=I,ms(e,n,d,o),S=e.memoizedState,_!==n||I!==S||ct.current||si?(typeof T=="function"&&(ca(e,i,T,n),S=e.memoizedState),(_=si||wc(e,i,_,n,I,S,w))?(A||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=S),d.props=n,d.state=S,d.context=w,n=_):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{d=e.stateNode,Uh(t,e),_=e.memoizedProps,w=e.type===e.elementType?_:Dt(e.type,_),d.props=w,A=e.pendingProps,I=d.context,S=i.contextType,typeof S=="object"&&S!==null?S=At(S):(S=ut(i)?Pi:it.current,S=pn(e,S));var k=i.getDerivedStateFromProps;(T=typeof k=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(_!==A||I!==S)&&Cc(e,d,n,S),si=!1,I=e.memoizedState,d.state=I,ms(e,n,d,o);var P=e.memoizedState;_!==A||I!==P||ct.current||si?(typeof k=="function"&&(ca(e,i,k,n),P=e.memoizedState),(w=si||wc(e,i,w,n,I,P,S)||!1)?(T||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,P,S),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,P,S)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=P),d.props=n,d.state=P,d.context=S,n=w):(typeof d.componentDidUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||_===t.memoizedProps&&I===t.memoizedState||(e.flags|=1024),n=!1)}return fa(t,e,i,n,l,o)}function fa(t,e,i,n,o,l){md(t,e);var d=(e.flags&128)!==0;if(!n&&!d)return o&&mc(e,i,!1),ei(t,e,l);n=e.stateNode,vp.current=e;var _=d&&typeof i.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&d?(e.child=_n(e,t.child,null,l),e.child=_n(e,null,_,l)):nt(t,e,_,l),e.memoizedState=n.state,o&&mc(e,i,!0),e.child}function _d(t){var e=t.stateNode;e.pendingContext?pc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&pc(t,e.context,!1),sl(t,e.containerInfo)}function Mc(t,e,i,n,o){return mn(),qa(o),e.flags|=256,nt(t,e,i,n),e.child}var ga={dehydrated:null,treeContext:null,retryLane:0};function pa(t){return{baseLanes:t,cachePool:null,transitions:null}}function vd(t,e,i){var n=e.pendingProps,o=Fe.current,l=!1,d=(e.flags&128)!==0,_;if((_=d)||(_=t!==null&&t.memoizedState===null?!1:(o&2)!==0),_?(l=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),Oe(Fe,o&1),t===null)return aa(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=n.children,t=n.fallback,l?(n=e.mode,l=e.child,d={mode:"hidden",children:d},!(n&1)&&l!==null?(l.childLanes=0,l.pendingProps=d):l=Hs(d,n,0,null),t=ki(t,n,i,null),l.return=e,t.return=e,l.sibling=t,e.child=l,e.child.memoizedState=pa(i),e.memoizedState=ga,t):fl(e,d));if(o=t.memoizedState,o!==null&&(_=o.dehydrated,_!==null))return yp(t,e,d,n,_,o,i);if(l){l=n.fallback,d=e.mode,o=t.child,_=o.sibling;var S={mode:"hidden",children:n.children};return!(d&1)&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=S,e.deletions=null):(n=_i(o,S),n.subtreeFlags=o.subtreeFlags&14680064),_!==null?l=_i(_,l):(l=ki(l,d,i,null),l.flags|=2),l.return=e,n.return=e,n.sibling=l,e.child=n,n=l,l=e.child,d=t.child.memoizedState,d=d===null?pa(i):{baseLanes:d.baseLanes|i,cachePool:null,transitions:d.transitions},l.memoizedState=d,l.childLanes=t.childLanes&~i,e.memoizedState=ga,n}return l=t.child,t=l.sibling,n=_i(l,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=i),n.return=e,n.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n,e.memoizedState=null,n}function fl(t,e){return e=Hs({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Lr(t,e,i,n){return n!==null&&qa(n),_n(e,t.child,null,i),t=fl(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function yp(t,e,i,n,o,l,d){if(i)return e.flags&256?(e.flags&=-257,n=Co(Error(ae(422))),Lr(t,e,d,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(l=n.fallback,o=e.mode,n=Hs({mode:"visible",children:n.children},o,0,null),l=ki(l,o,d,null),l.flags|=2,n.return=e,l.return=e,n.sibling=l,e.child=n,e.mode&1&&_n(e,t.child,null,d),e.child.memoizedState=pa(d),e.memoizedState=ga,l);if(!(e.mode&1))return Lr(t,e,d,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var _=n.dgst;return n=_,l=Error(ae(419)),n=Co(l,n,void 0),Lr(t,e,d,n)}if(_=(d&t.childLanes)!==0,lt||_){if(n=Xe,n!==null){switch(d&-d){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(n.suspendedLanes|d)?0:o,o!==0&&o!==l.retryLane&&(l.retryLane=o,qt(t,o),Ft(n,t,o,-1))}return yl(),n=Co(Error(ae(421))),Lr(t,e,d,n)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=Mp.bind(null,t),o._reactRetry=e,null):(t=l.treeContext,_t=fi(o.nextSibling),vt=e,Le=!0,kt=null,t!==null&&(Tt[bt++]=$t,Tt[bt++]=Kt,Tt[bt++]=Bi,$t=t.id,Kt=t.overflow,Bi=e),e=fl(e,n.children),e.flags|=4096,e)}function kc(t,e,i){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),la(t.return,e,i)}function xo(t,e,i,n,o){var l=t.memoizedState;l===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:o}:(l.isBackwards=e,l.rendering=null,l.renderingStartTime=0,l.last=n,l.tail=i,l.tailMode=o)}function yd(t,e,i){var n=e.pendingProps,o=n.revealOrder,l=n.tail;if(nt(t,e,n.children,i),n=Fe.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&kc(t,i,e);else if(t.tag===19)kc(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Oe(Fe,n),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(i=e.child,o=null;i!==null;)t=i.alternate,t!==null&&_s(t)===null&&(o=i),i=i.sibling;i=o,i===null?(o=e.child,e.child=null):(o=i.sibling,i.sibling=null),xo(e,!1,o,i,l);break;case"backwards":for(i=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&_s(t)===null){e.child=o;break}t=o.sibling,o.sibling=i,i=o,o=t}xo(e,!0,i,null,l);break;case"together":xo(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Kr(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ei(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),ji|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,i=_i(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=_i(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function Sp(t,e,i){switch(e.tag){case 3:_d(e),mn();break;case 5:Yh(e);break;case 1:ut(e.type)&&hs(e);break;case 4:sl(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,o=e.memoizedProps.value;Oe(gs,n._currentValue),n._currentValue=o;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Oe(Fe,Fe.current&1),e.flags|=128,null):i&e.child.childLanes?vd(t,e,i):(Oe(Fe,Fe.current&1),t=ei(t,e,i),t!==null?t.sibling:null);Oe(Fe,Fe.current&1);break;case 19:if(n=(i&e.childLanes)!==0,t.flags&128){if(n)return yd(t,e,i);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Oe(Fe,Fe.current),n)break;return null;case 22:case 23:return e.lanes=0,pd(t,e,i)}return ei(t,e,i)}var Sd,ma,wd,Cd;Sd=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};ma=function(){};wd=function(t,e,i,n){var o=t.memoizedProps;if(o!==n){t=e.stateNode,Ri(Ut.current);var l=null;switch(i){case"input":o=No(t,o),n=No(t,n),l=[];break;case"select":o=Be({},o,{value:void 0}),n=Be({},n,{value:void 0}),l=[];break;case"textarea":o=Uo(t,o),n=Uo(t,n),l=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=cs)}Go(i,n);var d;i=null;for(w in o)if(!n.hasOwnProperty(w)&&o.hasOwnProperty(w)&&o[w]!=null)if(w==="style"){var _=o[w];for(d in _)_.hasOwnProperty(d)&&(i||(i={}),i[d]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Qn.hasOwnProperty(w)?l||(l=[]):(l=l||[]).push(w,null));for(w in n){var S=n[w];if(_=o!=null?o[w]:void 0,n.hasOwnProperty(w)&&S!==_&&(S!=null||_!=null))if(w==="style")if(_){for(d in _)!_.hasOwnProperty(d)||S&&S.hasOwnProperty(d)||(i||(i={}),i[d]="");for(d in S)S.hasOwnProperty(d)&&_[d]!==S[d]&&(i||(i={}),i[d]=S[d])}else i||(l||(l=[]),l.push(w,i)),i=S;else w==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,_=_?_.__html:void 0,S!=null&&_!==S&&(l=l||[]).push(w,S)):w==="children"?typeof S!="string"&&typeof S!="number"||(l=l||[]).push(w,""+S):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Qn.hasOwnProperty(w)?(S!=null&&w==="onScroll"&&Re("scroll",t),l||_===S||(l=[])):(l=l||[]).push(w,S))}i&&(l=l||[]).push("style",i);var w=l;(e.updateQueue=w)&&(e.flags|=4)}};Cd=function(t,e,i,n){i!==n&&(e.flags|=4)};function Ln(t,e){if(!Le)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,n=0;if(e)for(var o=t.child;o!==null;)i|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)i|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=i,e}function wp(t,e,i){var n=e.pendingProps;switch(Qa(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(e),null;case 1:return ut(e.type)&&us(),qe(e),null;case 3:return n=e.stateNode,vn(),Me(ct),Me(it),al(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Mr(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,kt!==null&&(Ta(kt),kt=null))),ma(t,e),qe(e),null;case 5:ol(e);var o=Ri(ur.current);if(i=e.type,t!==null&&e.stateNode!=null)wd(t,e,i,n,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ae(166));return qe(e),null}if(t=Ri(Ut.current),Mr(e)){n=e.stateNode,i=e.type;var l=e.memoizedProps;switch(n[jt]=e,n[lr]=l,t=(e.mode&1)!==0,i){case"dialog":Re("cancel",n),Re("close",n);break;case"iframe":case"object":case"embed":Re("load",n);break;case"video":case"audio":for(o=0;o<Wn.length;o++)Re(Wn[o],n);break;case"source":Re("error",n);break;case"img":case"image":case"link":Re("error",n),Re("load",n);break;case"details":Re("toggle",n);break;case"input":Wl(n,l),Re("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!l.multiple},Re("invalid",n);break;case"textarea":zl(n,l),Re("invalid",n)}Go(i,l),o=null;for(var d in l)if(l.hasOwnProperty(d)){var _=l[d];d==="children"?typeof _=="string"?n.textContent!==_&&(l.suppressHydrationWarning!==!0&&Dr(n.textContent,_,t),o=["children",_]):typeof _=="number"&&n.textContent!==""+_&&(l.suppressHydrationWarning!==!0&&Dr(n.textContent,_,t),o=["children",""+_]):Qn.hasOwnProperty(d)&&_!=null&&d==="onScroll"&&Re("scroll",n)}switch(i){case"input":xr(n),Gl(n,l,!0);break;case"textarea":xr(n),Hl(n);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(n.onclick=cs)}n=o,e.updateQueue=n,n!==null&&(e.flags|=4)}else{d=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ku(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=d.createElement("div"),t.innerHTML="<script></script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=d.createElement(i,{is:n.is}):(t=d.createElement(i),i==="select"&&(d=t,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):t=d.createElementNS(t,i),t[jt]=e,t[lr]=n,Sd(t,e,!1,!1),e.stateNode=t;e:{switch(d=zo(i,n),i){case"dialog":Re("cancel",t),Re("close",t),o=n;break;case"iframe":case"object":case"embed":Re("load",t),o=n;break;case"video":case"audio":for(o=0;o<Wn.length;o++)Re(Wn[o],t);o=n;break;case"source":Re("error",t),o=n;break;case"img":case"image":case"link":Re("error",t),Re("load",t),o=n;break;case"details":Re("toggle",t),o=n;break;case"input":Wl(t,n),o=No(t,n),Re("invalid",t);break;case"option":o=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},o=Be({},n,{value:void 0}),Re("invalid",t);break;case"textarea":zl(t,n),o=Uo(t,n),Re("invalid",t);break;default:o=n}Go(i,o),_=o;for(l in _)if(_.hasOwnProperty(l)){var S=_[l];l==="style"?Qu(t,S):l==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,S!=null&&Zu(t,S)):l==="children"?typeof S=="string"?(i!=="textarea"||S!=="")&&qn(t,S):typeof S=="number"&&qn(t,""+S):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Qn.hasOwnProperty(l)?S!=null&&l==="onScroll"&&Re("scroll",t):S!=null&&Ba(t,l,S,d))}switch(i){case"input":xr(t),Gl(t,n,!1);break;case"textarea":xr(t),Hl(t);break;case"option":n.value!=null&&t.setAttribute("value",""+yi(n.value));break;case"select":t.multiple=!!n.multiple,l=n.value,l!=null?ln(t,!!n.multiple,l,!1):n.defaultValue!=null&&ln(t,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=cs)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qe(e),null;case 6:if(t&&e.stateNode!=null)Cd(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ae(166));if(i=Ri(ur.current),Ri(Ut.current),Mr(e)){if(n=e.stateNode,i=e.memoizedProps,n[jt]=e,(l=n.nodeValue!==i)&&(t=vt,t!==null))switch(t.tag){case 3:Dr(n.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Dr(n.nodeValue,i,(t.mode&1)!==0)}l&&(e.flags|=4)}else n=(i.nodeType===9?i:i.ownerDocument).createTextNode(n),n[jt]=e,e.stateNode=n}return qe(e),null;case 13:if(Me(Fe),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Le&&_t!==null&&e.mode&1&&!(e.flags&128))jh(),mn(),e.flags|=98560,l=!1;else if(l=Mr(e),n!==null&&n.dehydrated!==null){if(t===null){if(!l)throw Error(ae(318));if(l=e.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(ae(317));l[jt]=e}else mn(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),l=!1}else kt!==null&&(Ta(kt),kt=null),l=!0;if(!l)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||Fe.current&1?Ge===0&&(Ge=3):yl())),e.updateQueue!==null&&(e.flags|=4),qe(e),null);case 4:return vn(),ma(t,e),t===null&&or(e.stateNode.containerInfo),qe(e),null;case 10:return il(e.type._context),qe(e),null;case 17:return ut(e.type)&&us(),qe(e),null;case 19:if(Me(Fe),l=e.memoizedState,l===null)return qe(e),null;if(n=(e.flags&128)!==0,d=l.rendering,d===null)if(n)Ln(l,!1);else{if(Ge!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=_s(t),d!==null){for(e.flags|=128,Ln(l,!1),n=d.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=i,i=e.child;i!==null;)l=i,t=n,l.flags&=14680066,d=l.alternate,d===null?(l.childLanes=0,l.lanes=t,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=d.childLanes,l.lanes=d.lanes,l.child=d.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=d.memoizedProps,l.memoizedState=d.memoizedState,l.updateQueue=d.updateQueue,l.type=d.type,t=d.dependencies,l.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return Oe(Fe,Fe.current&1|2),e.child}t=t.sibling}l.tail!==null&&je()>Sn&&(e.flags|=128,n=!0,Ln(l,!1),e.lanes=4194304)}else{if(!n)if(t=_s(d),t!==null){if(e.flags|=128,n=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),Ln(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!Le)return qe(e),null}else 2*je()-l.renderingStartTime>Sn&&i!==1073741824&&(e.flags|=128,n=!0,Ln(l,!1),e.lanes=4194304);l.isBackwards?(d.sibling=e.child,e.child=d):(i=l.last,i!==null?i.sibling=d:e.child=d,l.last=d)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=je(),e.sibling=null,i=Fe.current,Oe(Fe,n?i&1|2:i&1),e):(qe(e),null);case 22:case 23:return vl(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?gt&1073741824&&(qe(e),e.subtreeFlags&6&&(e.flags|=8192)):qe(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function Cp(t,e){switch(Qa(e),e.tag){case 1:return ut(e.type)&&us(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return vn(),Me(ct),Me(it),al(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ol(e),null;case 13:if(Me(Fe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));mn()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Me(Fe),null;case 4:return vn(),null;case 10:return il(e.type._context),null;case 22:case 23:return vl(),null;case 24:return null;default:return null}}var Fr=!1,tt=!1,xp=typeof WeakSet=="function"?WeakSet:Set,ve=null;function on(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(n){Ne(t,e,n)}else i.current=null}function _a(t,e,i){try{i()}catch(n){Ne(t,e,n)}}var Lc=!1;function Tp(t,e){if(ea=os,t=Eh(),Za(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var o=n.anchorOffset,l=n.focusNode;n=n.focusOffset;try{i.nodeType,l.nodeType}catch{i=null;break e}var d=0,_=-1,S=-1,w=0,T=0,A=t,I=null;t:for(;;){for(var k;A!==i||o!==0&&A.nodeType!==3||(_=d+o),A!==l||n!==0&&A.nodeType!==3||(S=d+n),A.nodeType===3&&(d+=A.nodeValue.length),(k=A.firstChild)!==null;)I=A,A=k;for(;;){if(A===t)break t;if(I===i&&++w===o&&(_=d),I===l&&++T===n&&(S=d),(k=A.nextSibling)!==null)break;A=I,I=A.parentNode}A=k}i=_===-1||S===-1?null:{start:_,end:S}}else i=null}i=i||{start:0,end:0}}else i=null;for(ta={focusedElem:t,selectionRange:i},os=!1,ve=e;ve!==null;)if(e=ve,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ve=t;else for(;ve!==null;){e=ve;try{var P=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var F=P.memoizedProps,z=P.memoizedState,D=e.stateNode,R=D.getSnapshotBeforeUpdate(e.elementType===e.type?F:Dt(e.type,F),z);D.__reactInternalSnapshotBeforeUpdate=R}break;case 3:var M=e.stateNode.containerInfo;M.nodeType===1?M.textContent="":M.nodeType===9&&M.documentElement&&M.removeChild(M.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch($){Ne(e,e.return,$)}if(t=e.sibling,t!==null){t.return=e.return,ve=t;break}ve=e.return}return P=Lc,Lc=!1,P}function Kn(t,e,i){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&t)===t){var l=o.destroy;o.destroy=void 0,l!==void 0&&_a(e,i,l)}o=o.next}while(o!==n)}}function Gs(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var n=i.create;i.destroy=n()}i=i.next}while(i!==e)}}function va(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function xd(t){var e=t.alternate;e!==null&&(t.alternate=null,xd(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[jt],delete e[lr],delete e[ra],delete e[op],delete e[ap])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Td(t){return t.tag===5||t.tag===3||t.tag===4}function Fc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Td(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ya(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=cs));else if(n!==4&&(t=t.child,t!==null))for(ya(t,e,i),t=t.sibling;t!==null;)ya(t,e,i),t=t.sibling}function Sa(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Sa(t,e,i),t=t.sibling;t!==null;)Sa(t,e,i),t=t.sibling}var Ke=null,Mt=!1;function ni(t,e,i){for(i=i.child;i!==null;)bd(t,e,i),i=i.sibling}function bd(t,e,i){if(Vt&&typeof Vt.onCommitFiberUnmount=="function")try{Vt.onCommitFiberUnmount(Fs,i)}catch{}switch(i.tag){case 5:tt||on(i,e);case 6:var n=Ke,o=Mt;Ke=null,ni(t,e,i),Ke=n,Mt=o,Ke!==null&&(Mt?(t=Ke,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):Ke.removeChild(i.stateNode));break;case 18:Ke!==null&&(Mt?(t=Ke,i=i.stateNode,t.nodeType===8?mo(t.parentNode,i):t.nodeType===1&&mo(t,i),nr(t)):mo(Ke,i.stateNode));break;case 4:n=Ke,o=Mt,Ke=i.stateNode.containerInfo,Mt=!0,ni(t,e,i),Ke=n,Mt=o;break;case 0:case 11:case 14:case 15:if(!tt&&(n=i.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var l=o,d=l.destroy;l=l.tag,d!==void 0&&(l&2||l&4)&&_a(i,e,d),o=o.next}while(o!==n)}ni(t,e,i);break;case 1:if(!tt&&(on(i,e),n=i.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(_){Ne(i,e,_)}ni(t,e,i);break;case 21:ni(t,e,i);break;case 22:i.mode&1?(tt=(n=tt)||i.memoizedState!==null,ni(t,e,i),tt=n):ni(t,e,i);break;default:ni(t,e,i)}}function Pc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new xp),e.forEach(function(n){var o=kp.bind(null,t,n);i.has(n)||(i.add(n),n.then(o,o))})}}function Rt(t,e){var i=e.deletions;if(i!==null)for(var n=0;n<i.length;n++){var o=i[n];try{var l=t,d=e,_=d;e:for(;_!==null;){switch(_.tag){case 5:Ke=_.stateNode,Mt=!1;break e;case 3:Ke=_.stateNode.containerInfo,Mt=!0;break e;case 4:Ke=_.stateNode.containerInfo,Mt=!0;break e}_=_.return}if(Ke===null)throw Error(ae(160));bd(l,d,o),Ke=null,Mt=!1;var S=o.alternate;S!==null&&(S.return=null),o.return=null}catch(w){Ne(o,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ed(e,t),e=e.sibling}function Ed(t,e){var i=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Rt(e,t),Bt(t),n&4){try{Kn(3,t,t.return),Gs(3,t)}catch(F){Ne(t,t.return,F)}try{Kn(5,t,t.return)}catch(F){Ne(t,t.return,F)}}break;case 1:Rt(e,t),Bt(t),n&512&&i!==null&&on(i,i.return);break;case 5:if(Rt(e,t),Bt(t),n&512&&i!==null&&on(i,i.return),t.flags&32){var o=t.stateNode;try{qn(o,"")}catch(F){Ne(t,t.return,F)}}if(n&4&&(o=t.stateNode,o!=null)){var l=t.memoizedProps,d=i!==null?i.memoizedProps:l,_=t.type,S=t.updateQueue;if(t.updateQueue=null,S!==null)try{_==="input"&&l.type==="radio"&&l.name!=null&&Xu(o,l),zo(_,d);var w=zo(_,l);for(d=0;d<S.length;d+=2){var T=S[d],A=S[d+1];T==="style"?Qu(o,A):T==="dangerouslySetInnerHTML"?Zu(o,A):T==="children"?qn(o,A):Ba(o,T,A,w)}switch(_){case"input":jo(o,l);break;case"textarea":$u(o,l);break;case"select":var I=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!l.multiple;var k=l.value;k!=null?ln(o,!!l.multiple,k,!1):I!==!!l.multiple&&(l.defaultValue!=null?ln(o,!!l.multiple,l.defaultValue,!0):ln(o,!!l.multiple,l.multiple?[]:"",!1))}o[lr]=l}catch(F){Ne(t,t.return,F)}}break;case 6:if(Rt(e,t),Bt(t),n&4){if(t.stateNode===null)throw Error(ae(162));o=t.stateNode,l=t.memoizedProps;try{o.nodeValue=l}catch(F){Ne(t,t.return,F)}}break;case 3:if(Rt(e,t),Bt(t),n&4&&i!==null&&i.memoizedState.isDehydrated)try{nr(e.containerInfo)}catch(F){Ne(t,t.return,F)}break;case 4:Rt(e,t),Bt(t);break;case 13:Rt(e,t),Bt(t),o=t.child,o.flags&8192&&(l=o.memoizedState!==null,o.stateNode.isHidden=l,!l||o.alternate!==null&&o.alternate.memoizedState!==null||(ml=je())),n&4&&Pc(t);break;case 22:if(T=i!==null&&i.memoizedState!==null,t.mode&1?(tt=(w=tt)||T,Rt(e,t),tt=w):Rt(e,t),Bt(t),n&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!T&&t.mode&1)for(ve=t,T=t.child;T!==null;){for(A=ve=T;ve!==null;){switch(I=ve,k=I.child,I.tag){case 0:case 11:case 14:case 15:Kn(4,I,I.return);break;case 1:on(I,I.return);var P=I.stateNode;if(typeof P.componentWillUnmount=="function"){n=I,i=I.return;try{e=n,P.props=e.memoizedProps,P.state=e.memoizedState,P.componentWillUnmount()}catch(F){Ne(n,i,F)}}break;case 5:on(I,I.return);break;case 22:if(I.memoizedState!==null){Nc(A);continue}}k!==null?(k.return=I,ve=k):Nc(A)}T=T.sibling}e:for(T=null,A=t;;){if(A.tag===5){if(T===null){T=A;try{o=A.stateNode,w?(l=o.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(_=A.stateNode,S=A.memoizedProps.style,d=S!=null&&S.hasOwnProperty("display")?S.display:null,_.style.display=Ju("display",d))}catch(F){Ne(t,t.return,F)}}}else if(A.tag===6){if(T===null)try{A.stateNode.nodeValue=w?"":A.memoizedProps}catch(F){Ne(t,t.return,F)}}else if((A.tag!==22&&A.tag!==23||A.memoizedState===null||A===t)&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===t)break e;for(;A.sibling===null;){if(A.return===null||A.return===t)break e;T===A&&(T=null),A=A.return}T===A&&(T=null),A.sibling.return=A.return,A=A.sibling}}break;case 19:Rt(e,t),Bt(t),n&4&&Pc(t);break;case 21:break;default:Rt(e,t),Bt(t)}}function Bt(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(Td(i)){var n=i;break e}i=i.return}throw Error(ae(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(qn(o,""),n.flags&=-33);var l=Fc(t);Sa(t,l,o);break;case 3:case 4:var d=n.stateNode.containerInfo,_=Fc(t);ya(t,_,d);break;default:throw Error(ae(161))}}catch(S){Ne(t,t.return,S)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function bp(t,e,i){ve=t,Id(t)}function Id(t,e,i){for(var n=(t.mode&1)!==0;ve!==null;){var o=ve,l=o.child;if(o.tag===22&&n){var d=o.memoizedState!==null||Fr;if(!d){var _=o.alternate,S=_!==null&&_.memoizedState!==null||tt;_=Fr;var w=tt;if(Fr=d,(tt=S)&&!w)for(ve=o;ve!==null;)d=ve,S=d.child,d.tag===22&&d.memoizedState!==null?jc(o):S!==null?(S.return=d,ve=S):jc(o);for(;l!==null;)ve=l,Id(l),l=l.sibling;ve=o,Fr=_,tt=w}Bc(t)}else o.subtreeFlags&8772&&l!==null?(l.return=o,ve=l):Bc(t)}}function Bc(t){for(;ve!==null;){var e=ve;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:tt||Gs(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!tt)if(i===null)n.componentDidMount();else{var o=e.elementType===e.type?i.memoizedProps:Dt(e.type,i.memoizedProps);n.componentDidUpdate(o,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var l=e.updateQueue;l!==null&&Sc(e,l,n);break;case 3:var d=e.updateQueue;if(d!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}Sc(e,d,i)}break;case 5:var _=e.stateNode;if(i===null&&e.flags&4){i=_;var S=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":S.autoFocus&&i.focus();break;case"img":S.src&&(i.src=S.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var T=w.memoizedState;if(T!==null){var A=T.dehydrated;A!==null&&nr(A)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}tt||e.flags&512&&va(e)}catch(I){Ne(e,e.return,I)}}if(e===t){ve=null;break}if(i=e.sibling,i!==null){i.return=e.return,ve=i;break}ve=e.return}}function Nc(t){for(;ve!==null;){var e=ve;if(e===t){ve=null;break}var i=e.sibling;if(i!==null){i.return=e.return,ve=i;break}ve=e.return}}function jc(t){for(;ve!==null;){var e=ve;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{Gs(4,e)}catch(S){Ne(e,i,S)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var o=e.return;try{n.componentDidMount()}catch(S){Ne(e,o,S)}}var l=e.return;try{va(e)}catch(S){Ne(e,l,S)}break;case 5:var d=e.return;try{va(e)}catch(S){Ne(e,d,S)}}}catch(S){Ne(e,e.return,S)}if(e===t){ve=null;break}var _=e.sibling;if(_!==null){_.return=e.return,ve=_;break}ve=e.return}}var Ep=Math.ceil,Ss=ii.ReactCurrentDispatcher,gl=ii.ReactCurrentOwner,It=ii.ReactCurrentBatchConfig,Ee=0,Xe=null,Ue=null,Ze=0,gt=0,an=Ci(0),Ge=0,gr=null,ji=0,zs=0,pl=0,Zn=null,at=null,ml=0,Sn=1/0,Gt=null,ws=!1,wa=null,pi=null,Pr=!1,ci=null,Cs=0,Jn=0,Ca=null,Zr=-1,Jr=0;function rt(){return Ee&6?je():Zr!==-1?Zr:Zr=je()}function mi(t){return t.mode&1?Ee&2&&Ze!==0?Ze&-Ze:cp.transition!==null?(Jr===0&&(Jr=uh()),Jr):(t=Ae,t!==0||(t=window.event,t=t===void 0?16:_h(t.type)),t):1}function Ft(t,e,i,n){if(50<Jn)throw Jn=0,Ca=null,Error(ae(185));mr(t,i,n),(!(Ee&2)||t!==Xe)&&(t===Xe&&(!(Ee&2)&&(zs|=i),Ge===4&&ai(t,Ze)),ht(t,n),i===1&&Ee===0&&!(e.mode&1)&&(Sn=je()+500,Vs&&xi()))}function ht(t,e){var i=t.callbackNode;cg(t,e);var n=ss(t,t===Xe?Ze:0);if(n===0)i!==null&&$l(i),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(i!=null&&$l(i),e===1)t.tag===0?lp(Vc.bind(null,t)):Ph(Vc.bind(null,t)),rp(function(){!(Ee&6)&&xi()}),i=null;else{switch(hh(n)){case 1:i=Wa;break;case 4:i=lh;break;case 16:i=rs;break;case 536870912:i=ch;break;default:i=rs}i=Fd(i,Ad.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function Ad(t,e){if(Zr=-1,Jr=0,Ee&6)throw Error(ae(327));var i=t.callbackNode;if(fn()&&t.callbackNode!==i)return null;var n=ss(t,t===Xe?Ze:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=xs(t,n);else{e=n;var o=Ee;Ee|=2;var l=Rd();(Xe!==t||Ze!==e)&&(Gt=null,Sn=je()+500,Mi(t,e));do try{Op();break}catch(_){Od(t,_)}while(1);tl(),Ss.current=l,Ee=o,Ue!==null?e=0:(Xe=null,Ze=0,e=Ge)}if(e!==0){if(e===2&&(o=Ko(t),o!==0&&(n=o,e=xa(t,o))),e===1)throw i=gr,Mi(t,0),ai(t,n),ht(t,je()),i;if(e===6)ai(t,n);else{if(o=t.current.alternate,!(n&30)&&!Ip(o)&&(e=xs(t,n),e===2&&(l=Ko(t),l!==0&&(n=l,e=xa(t,l))),e===1))throw i=gr,Mi(t,0),ai(t,n),ht(t,je()),i;switch(t.finishedWork=o,t.finishedLanes=n,e){case 0:case 1:throw Error(ae(345));case 2:Ii(t,at,Gt);break;case 3:if(ai(t,n),(n&130023424)===n&&(e=ml+500-je(),10<e)){if(ss(t,0)!==0)break;if(o=t.suspendedLanes,(o&n)!==n){rt(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=na(Ii.bind(null,t,at,Gt),e);break}Ii(t,at,Gt);break;case 4:if(ai(t,n),(n&4194240)===n)break;for(e=t.eventTimes,o=-1;0<n;){var d=31-Lt(n);l=1<<d,d=e[d],d>o&&(o=d),n&=~l}if(n=o,n=je()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ep(n/1960))-n,10<n){t.timeoutHandle=na(Ii.bind(null,t,at,Gt),n);break}Ii(t,at,Gt);break;case 5:Ii(t,at,Gt);break;default:throw Error(ae(329))}}}return ht(t,je()),t.callbackNode===i?Ad.bind(null,t):null}function xa(t,e){var i=Zn;return t.current.memoizedState.isDehydrated&&(Mi(t,e).flags|=256),t=xs(t,e),t!==2&&(e=at,at=i,e!==null&&Ta(e)),t}function Ta(t){at===null?at=t:at.push.apply(at,t)}function Ip(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var n=0;n<i.length;n++){var o=i[n],l=o.getSnapshot;o=o.value;try{if(!Pt(l(),o))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ai(t,e){for(e&=~pl,e&=~zs,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-Lt(e),n=1<<i;t[i]=-1,e&=~n}}function Vc(t){if(Ee&6)throw Error(ae(327));fn();var e=ss(t,0);if(!(e&1))return ht(t,je()),null;var i=xs(t,e);if(t.tag!==0&&i===2){var n=Ko(t);n!==0&&(e=n,i=xa(t,n))}if(i===1)throw i=gr,Mi(t,0),ai(t,e),ht(t,je()),i;if(i===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ii(t,at,Gt),ht(t,je()),null}function _l(t,e){var i=Ee;Ee|=1;try{return t(e)}finally{Ee=i,Ee===0&&(Sn=je()+500,Vs&&xi())}}function Vi(t){ci!==null&&ci.tag===0&&!(Ee&6)&&fn();var e=Ee;Ee|=1;var i=It.transition,n=Ae;try{if(It.transition=null,Ae=1,t)return t()}finally{Ae=n,It.transition=i,Ee=e,!(Ee&6)&&xi()}}function vl(){gt=an.current,Me(an)}function Mi(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,np(i)),Ue!==null)for(i=Ue.return;i!==null;){var n=i;switch(Qa(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&us();break;case 3:vn(),Me(ct),Me(it),al();break;case 5:ol(n);break;case 4:vn();break;case 13:Me(Fe);break;case 19:Me(Fe);break;case 10:il(n.type._context);break;case 22:case 23:vl()}i=i.return}if(Xe=t,Ue=t=_i(t.current,null),Ze=gt=e,Ge=0,gr=null,pl=zs=ji=0,at=Zn=null,Oi!==null){for(e=0;e<Oi.length;e++)if(i=Oi[e],n=i.interleaved,n!==null){i.interleaved=null;var o=n.next,l=i.pending;if(l!==null){var d=l.next;l.next=o,n.next=d}i.pending=n}Oi=null}return t}function Od(t,e){do{var i=Ue;try{if(tl(),Xr.current=ys,vs){for(var n=Pe.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}vs=!1}if(Ni=0,ze=We=Pe=null,$n=!1,hr=0,gl.current=null,i===null||i.return===null){Ge=1,gr=e,Ue=null;break}e:{var l=t,d=i.return,_=i,S=e;if(e=Ze,_.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){var w=S,T=_,A=T.tag;if(!(T.mode&1)&&(A===0||A===11||A===15)){var I=T.alternate;I?(T.updateQueue=I.updateQueue,T.memoizedState=I.memoizedState,T.lanes=I.lanes):(T.updateQueue=null,T.memoizedState=null)}var k=Ic(d);if(k!==null){k.flags&=-257,Ac(k,d,_,l,e),k.mode&1&&Ec(l,w,e),e=k,S=w;var P=e.updateQueue;if(P===null){var F=new Set;F.add(S),e.updateQueue=F}else P.add(S);break e}else{if(!(e&1)){Ec(l,w,e),yl();break e}S=Error(ae(426))}}else if(Le&&_.mode&1){var z=Ic(d);if(z!==null){!(z.flags&65536)&&(z.flags|=256),Ac(z,d,_,l,e),qa(yn(S,_));break e}}l=S=yn(S,_),Ge!==4&&(Ge=2),Zn===null?Zn=[l]:Zn.push(l),l=d;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e;var D=dd(l,S,e);yc(l,D);break e;case 1:_=S;var R=l.type,M=l.stateNode;if(!(l.flags&128)&&(typeof R.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(pi===null||!pi.has(M)))){l.flags|=65536,e&=-e,l.lanes|=e;var $=fd(l,_,e);yc(l,$);break e}}l=l.return}while(l!==null)}Md(i)}catch(ie){e=ie,Ue===i&&i!==null&&(Ue=i=i.return);continue}break}while(1)}function Rd(){var t=Ss.current;return Ss.current=ys,t===null?ys:t}function yl(){(Ge===0||Ge===3||Ge===2)&&(Ge=4),Xe===null||!(ji&268435455)&&!(zs&268435455)||ai(Xe,Ze)}function xs(t,e){var i=Ee;Ee|=2;var n=Rd();(Xe!==t||Ze!==e)&&(Gt=null,Mi(t,e));do try{Ap();break}catch(o){Od(t,o)}while(1);if(tl(),Ee=i,Ss.current=n,Ue!==null)throw Error(ae(261));return Xe=null,Ze=0,Ge}function Ap(){for(;Ue!==null;)Dd(Ue)}function Op(){for(;Ue!==null&&!eg();)Dd(Ue)}function Dd(t){var e=Ld(t.alternate,t,gt);t.memoizedProps=t.pendingProps,e===null?Md(t):Ue=e,gl.current=null}function Md(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=Cp(i,e),i!==null){i.flags&=32767,Ue=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ge=6,Ue=null;return}}else if(i=wp(i,e,gt),i!==null){Ue=i;return}if(e=e.sibling,e!==null){Ue=e;return}Ue=e=t}while(e!==null);Ge===0&&(Ge=5)}function Ii(t,e,i){var n=Ae,o=It.transition;try{It.transition=null,Ae=1,Rp(t,e,i,n)}finally{It.transition=o,Ae=n}return null}function Rp(t,e,i,n){do fn();while(ci!==null);if(Ee&6)throw Error(ae(327));i=t.finishedWork;var o=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var l=i.lanes|i.childLanes;if(ug(t,l),t===Xe&&(Ue=Xe=null,Ze=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||Pr||(Pr=!0,Fd(rs,function(){return fn(),null})),l=(i.flags&15990)!==0,i.subtreeFlags&15990||l){l=It.transition,It.transition=null;var d=Ae;Ae=1;var _=Ee;Ee|=4,gl.current=null,Tp(t,i),Ed(i,t),Zg(ta),os=!!ea,ta=ea=null,t.current=i,bp(i),tg(),Ee=_,Ae=d,It.transition=l}else t.current=i;if(Pr&&(Pr=!1,ci=t,Cs=o),l=t.pendingLanes,l===0&&(pi=null),rg(i.stateNode),ht(t,je()),e!==null)for(n=t.onRecoverableError,i=0;i<e.length;i++)o=e[i],n(o.value,{componentStack:o.stack,digest:o.digest});if(ws)throw ws=!1,t=wa,wa=null,t;return Cs&1&&t.tag!==0&&fn(),l=t.pendingLanes,l&1?t===Ca?Jn++:(Jn=0,Ca=t):Jn=0,xi(),null}function fn(){if(ci!==null){var t=hh(Cs),e=It.transition,i=Ae;try{if(It.transition=null,Ae=16>t?16:t,ci===null)var n=!1;else{if(t=ci,ci=null,Cs=0,Ee&6)throw Error(ae(331));var o=Ee;for(Ee|=4,ve=t.current;ve!==null;){var l=ve,d=l.child;if(ve.flags&16){var _=l.deletions;if(_!==null){for(var S=0;S<_.length;S++){var w=_[S];for(ve=w;ve!==null;){var T=ve;switch(T.tag){case 0:case 11:case 15:Kn(8,T,l)}var A=T.child;if(A!==null)A.return=T,ve=A;else for(;ve!==null;){T=ve;var I=T.sibling,k=T.return;if(xd(T),T===w){ve=null;break}if(I!==null){I.return=k,ve=I;break}ve=k}}}var P=l.alternate;if(P!==null){var F=P.child;if(F!==null){P.child=null;do{var z=F.sibling;F.sibling=null,F=z}while(F!==null)}}ve=l}}if(l.subtreeFlags&2064&&d!==null)d.return=l,ve=d;else e:for(;ve!==null;){if(l=ve,l.flags&2048)switch(l.tag){case 0:case 11:case 15:Kn(9,l,l.return)}var D=l.sibling;if(D!==null){D.return=l.return,ve=D;break e}ve=l.return}}var R=t.current;for(ve=R;ve!==null;){d=ve;var M=d.child;if(d.subtreeFlags&2064&&M!==null)M.return=d,ve=M;else e:for(d=R;ve!==null;){if(_=ve,_.flags&2048)try{switch(_.tag){case 0:case 11:case 15:Gs(9,_)}}catch(ie){Ne(_,_.return,ie)}if(_===d){ve=null;break e}var $=_.sibling;if($!==null){$.return=_.return,ve=$;break e}ve=_.return}}if(Ee=o,xi(),Vt&&typeof Vt.onPostCommitFiberRoot=="function")try{Vt.onPostCommitFiberRoot(Fs,t)}catch{}n=!0}return n}finally{Ae=i,It.transition=e}}return!1}function Uc(t,e,i){e=yn(i,e),e=dd(t,e,1),t=gi(t,e,1),e=rt(),t!==null&&(mr(t,1,e),ht(t,e))}function Ne(t,e,i){if(t.tag===3)Uc(t,t,i);else for(;e!==null;){if(e.tag===3){Uc(e,t,i);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(pi===null||!pi.has(n))){t=yn(i,t),t=fd(e,t,1),e=gi(e,t,1),t=rt(),e!==null&&(mr(e,1,t),ht(e,t));break}}e=e.return}}function Dp(t,e,i){var n=t.pingCache;n!==null&&n.delete(e),e=rt(),t.pingedLanes|=t.suspendedLanes&i,Xe===t&&(Ze&i)===i&&(Ge===4||Ge===3&&(Ze&130023424)===Ze&&500>je()-ml?Mi(t,0):pl|=i),ht(t,e)}function kd(t,e){e===0&&(t.mode&1?(e=Er,Er<<=1,!(Er&130023424)&&(Er=4194304)):e=1);var i=rt();t=qt(t,e),t!==null&&(mr(t,e,i),ht(t,i))}function Mp(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),kd(t,i)}function kp(t,e){var i=0;switch(t.tag){case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(i=o.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(ae(314))}n!==null&&n.delete(e),kd(t,i)}var Ld;Ld=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||ct.current)lt=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return lt=!1,Sp(t,e,i);lt=!!(t.flags&131072)}else lt=!1,Le&&e.flags&1048576&&Bh(e,fs,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Kr(t,e),t=e.pendingProps;var o=pn(e,it.current);dn(e,i),o=cl(null,e,n,t,o,i);var l=ul();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ut(n)?(l=!0,hs(e)):l=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,rl(e),o.updater=Us,e.stateNode=o,o._reactInternals=e,ua(e,n,t,i),e=fa(null,e,n,!0,l,i)):(e.tag=0,Le&&l&&Ja(e),nt(null,e,o,i),e=e.child),e;case 16:n=e.elementType;e:{switch(Kr(t,e),t=e.pendingProps,o=n._init,n=o(n._payload),e.type=n,o=e.tag=Fp(n),t=Dt(n,t),o){case 0:e=da(null,e,n,t,i);break e;case 1:e=Dc(null,e,n,t,i);break e;case 11:e=Oc(null,e,n,t,i);break e;case 14:e=Rc(null,e,n,Dt(n.type,t),i);break e}throw Error(ae(306,n,""))}return e;case 0:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:Dt(n,o),da(t,e,n,o,i);case 1:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:Dt(n,o),Dc(t,e,n,o,i);case 3:e:{if(_d(e),t===null)throw Error(ae(387));n=e.pendingProps,l=e.memoizedState,o=l.element,Uh(t,e),ms(e,n,null,i);var d=e.memoizedState;if(n=d.element,l.isDehydrated)if(l={element:n,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=l,e.memoizedState=l,e.flags&256){o=yn(Error(ae(423)),e),e=Mc(t,e,n,i,o);break e}else if(n!==o){o=yn(Error(ae(424)),e),e=Mc(t,e,n,i,o);break e}else for(_t=fi(e.stateNode.containerInfo.firstChild),vt=e,Le=!0,kt=null,i=Hh(e,null,n,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(mn(),n===o){e=ei(t,e,i);break e}nt(t,e,n,i)}e=e.child}return e;case 5:return Yh(e),t===null&&aa(e),n=e.type,o=e.pendingProps,l=t!==null?t.memoizedProps:null,d=o.children,ia(n,o)?d=null:l!==null&&ia(n,l)&&(e.flags|=32),md(t,e),nt(t,e,d,i),e.child;case 6:return t===null&&aa(e),null;case 13:return vd(t,e,i);case 4:return sl(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=_n(e,null,n,i):nt(t,e,n,i),e.child;case 11:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:Dt(n,o),Oc(t,e,n,o,i);case 7:return nt(t,e,e.pendingProps,i),e.child;case 8:return nt(t,e,e.pendingProps.children,i),e.child;case 12:return nt(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(n=e.type._context,o=e.pendingProps,l=e.memoizedProps,d=o.value,Oe(gs,n._currentValue),n._currentValue=d,l!==null)if(Pt(l.value,d)){if(l.children===o.children&&!ct.current){e=ei(t,e,i);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var _=l.dependencies;if(_!==null){d=l.child;for(var S=_.firstContext;S!==null;){if(S.context===n){if(l.tag===1){S=Zt(-1,i&-i),S.tag=2;var w=l.updateQueue;if(w!==null){w=w.shared;var T=w.pending;T===null?S.next=S:(S.next=T.next,T.next=S),w.pending=S}}l.lanes|=i,S=l.alternate,S!==null&&(S.lanes|=i),la(l.return,i,e),_.lanes|=i;break}S=S.next}}else if(l.tag===10)d=l.type===e.type?null:l.child;else if(l.tag===18){if(d=l.return,d===null)throw Error(ae(341));d.lanes|=i,_=d.alternate,_!==null&&(_.lanes|=i),la(d,i,e),d=l.sibling}else d=l.child;if(d!==null)d.return=l;else for(d=l;d!==null;){if(d===e){d=null;break}if(l=d.sibling,l!==null){l.return=d.return,d=l;break}d=d.return}l=d}nt(t,e,o.children,i),e=e.child}return e;case 9:return o=e.type,n=e.pendingProps.children,dn(e,i),o=At(o),n=n(o),e.flags|=1,nt(t,e,n,i),e.child;case 14:return n=e.type,o=Dt(n,e.pendingProps),o=Dt(n.type,o),Rc(t,e,n,o,i);case 15:return gd(t,e,e.type,e.pendingProps,i);case 17:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:Dt(n,o),Kr(t,e),e.tag=1,ut(n)?(t=!0,hs(e)):t=!1,dn(e,i),Gh(e,n,o),ua(e,n,o,i),fa(null,e,n,!0,t,i);case 19:return yd(t,e,i);case 22:return pd(t,e,i)}throw Error(ae(156,e.tag))};function Fd(t,e){return ah(t,e)}function Lp(t,e,i,n){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Et(t,e,i,n){return new Lp(t,e,i,n)}function Sl(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Fp(t){if(typeof t=="function")return Sl(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ja)return 11;if(t===Va)return 14}return 2}function _i(t,e){var i=t.alternate;return i===null?(i=Et(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Qr(t,e,i,n,o,l){var d=2;if(n=t,typeof t=="function")Sl(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case Zi:return ki(i.children,o,l,e);case Na:d=8,o|=8;break;case Lo:return t=Et(12,i,e,o|2),t.elementType=Lo,t.lanes=l,t;case Fo:return t=Et(13,i,e,o),t.elementType=Fo,t.lanes=l,t;case Po:return t=Et(19,i,e,o),t.elementType=Po,t.lanes=l,t;case zu:return Hs(i,o,l,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Wu:d=10;break e;case Gu:d=9;break e;case ja:d=11;break e;case Va:d=14;break e;case ri:d=16,n=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=Et(d,i,e,o),e.elementType=t,e.type=n,e.lanes=l,e}function ki(t,e,i,n){return t=Et(7,t,n,e),t.lanes=i,t}function Hs(t,e,i,n){return t=Et(22,t,n,e),t.elementType=zu,t.lanes=i,t.stateNode={isHidden:!1},t}function To(t,e,i){return t=Et(6,t,null,e),t.lanes=i,t}function bo(t,e,i){return e=Et(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Pp(t,e,i,n,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ro(0),this.expirationTimes=ro(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ro(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function wl(t,e,i,n,o,l,d,_,S){return t=new Pp(t,e,i,_,S),e===1?(e=1,l===!0&&(e|=8)):e=0,l=Et(3,null,null,e),t.current=l,l.stateNode=t,l.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},rl(l),t}function Bp(t,e,i){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ki,key:n==null?null:""+n,children:t,containerInfo:e,implementation:i}}function Pd(t){if(!t)return Si;t=t._reactInternals;e:{if(Gi(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ut(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var i=t.type;if(ut(i))return Fh(t,i,e)}return e}function Bd(t,e,i,n,o,l,d,_,S){return t=wl(i,n,!0,t,o,l,d,_,S),t.context=Pd(null),i=t.current,n=rt(),o=mi(i),l=Zt(n,o),l.callback=e??null,gi(i,l,o),t.current.lanes=o,mr(t,o,n),ht(t,n),t}function Ys(t,e,i,n){var o=e.current,l=rt(),d=mi(o);return i=Pd(i),e.context===null?e.context=i:e.pendingContext=i,e=Zt(l,d),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=gi(o,e,d),t!==null&&(Ft(t,o,d,l),Yr(t,o,d)),d}function Ts(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Wc(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function Cl(t,e){Wc(t,e),(t=t.alternate)&&Wc(t,e)}function Np(){return null}var Nd=typeof reportError=="function"?reportError:function(t){console.error(t)};function xl(t){this._internalRoot=t}Xs.prototype.render=xl.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));Ys(t,e,null,null)};Xs.prototype.unmount=xl.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Vi(function(){Ys(null,t,null,null)}),e[Qt]=null}};function Xs(t){this._internalRoot=t}Xs.prototype.unstable_scheduleHydration=function(t){if(t){var e=gh();t={blockedOn:null,target:t,priority:e};for(var i=0;i<oi.length&&e!==0&&e<oi[i].priority;i++);oi.splice(i,0,t),i===0&&mh(t)}};function Tl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function $s(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Gc(){}function jp(t,e,i,n,o){if(o){if(typeof n=="function"){var l=n;n=function(){var w=Ts(d);l.call(w)}}var d=Bd(e,n,t,0,null,!1,!1,"",Gc);return t._reactRootContainer=d,t[Qt]=d.current,or(t.nodeType===8?t.parentNode:t),Vi(),d}for(;o=t.lastChild;)t.removeChild(o);if(typeof n=="function"){var _=n;n=function(){var w=Ts(S);_.call(w)}}var S=wl(t,0,!1,null,null,!1,!1,"",Gc);return t._reactRootContainer=S,t[Qt]=S.current,or(t.nodeType===8?t.parentNode:t),Vi(function(){Ys(e,S,i,n)}),S}function Ks(t,e,i,n,o){var l=i._reactRootContainer;if(l){var d=l;if(typeof o=="function"){var _=o;o=function(){var S=Ts(d);_.call(S)}}Ys(e,d,t,o)}else d=jp(i,e,t,o,n);return Ts(d)}dh=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=Un(e.pendingLanes);i!==0&&(Ga(e,i|1),ht(e,je()),!(Ee&6)&&(Sn=je()+500,xi()))}break;case 13:Vi(function(){var n=qt(t,1);if(n!==null){var o=rt();Ft(n,t,1,o)}}),Cl(t,1)}};za=function(t){if(t.tag===13){var e=qt(t,134217728);if(e!==null){var i=rt();Ft(e,t,134217728,i)}Cl(t,134217728)}};fh=function(t){if(t.tag===13){var e=mi(t),i=qt(t,e);if(i!==null){var n=rt();Ft(i,t,e,n)}Cl(t,e)}};gh=function(){return Ae};ph=function(t,e){var i=Ae;try{return Ae=t,e()}finally{Ae=i}};Yo=function(t,e,i){switch(e){case"input":if(jo(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var n=i[e];if(n!==t&&n.form===t.form){var o=js(n);if(!o)throw Error(ae(90));Yu(n),jo(n,o)}}}break;case"textarea":$u(t,i);break;case"select":e=i.value,e!=null&&ln(t,!!i.multiple,e,!1)}};th=_l;ih=Vi;var Vp={usingClientEntryPoint:!1,Events:[vr,en,js,qu,eh,_l]},Fn={findFiberByHostInstance:Ai,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Up={bundleType:Fn.bundleType,version:Fn.version,rendererPackageName:Fn.rendererPackageName,rendererConfig:Fn.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ii.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=sh(t),t===null?null:t.stateNode},findFiberByHostInstance:Fn.findFiberByHostInstance||Np,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Br=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Br.isDisabled&&Br.supportsFiber)try{Fs=Br.inject(Up),Vt=Br}catch{}}St.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vp;St.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tl(e))throw Error(ae(200));return Bp(t,e,null,i)};St.createRoot=function(t,e){if(!Tl(t))throw Error(ae(299));var i=!1,n="",o=Nd;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=wl(t,1,!1,null,null,i,!1,n,o),t[Qt]=e.current,or(t.nodeType===8?t.parentNode:t),new xl(e)};St.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=sh(e),t=t===null?null:t.stateNode,t};St.flushSync=function(t){return Vi(t)};St.hydrate=function(t,e,i){if(!$s(e))throw Error(ae(200));return Ks(null,t,e,!0,i)};St.hydrateRoot=function(t,e,i){if(!Tl(t))throw Error(ae(405));var n=i!=null&&i.hydratedSources||null,o=!1,l="",d=Nd;if(i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onRecoverableError!==void 0&&(d=i.onRecoverableError)),e=Bd(e,null,t,1,i??null,o,!1,l,d),t[Qt]=e.current,or(t),n)for(t=0;t<n.length;t++)i=n[t],o=i._getVersion,o=o(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,o]:e.mutableSourceEagerHydrationData.push(i,o);return new Xs(e)};St.render=function(t,e,i){if(!$s(e))throw Error(ae(200));return Ks(null,t,e,!1,i)};St.unmountComponentAtNode=function(t){if(!$s(t))throw Error(ae(40));return t._reactRootContainer?(Vi(function(){Ks(null,null,t,!1,function(){t._reactRootContainer=null,t[Qt]=null})}),!0):!1};St.unstable_batchedUpdates=_l;St.unstable_renderSubtreeIntoContainer=function(t,e,i,n){if(!$s(i))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return Ks(t,e,i,!1,n)};St.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}e(),t.exports=St})(Bu);var zc=Bu.exports;Mo.createRoot=zc.createRoot,Mo.hydrateRoot=zc.hydrateRoot;const Wp=(t,e)=>e.some(i=>t instanceof i);let Hc,Yc;function Gp(){return Hc||(Hc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zp(){return Yc||(Yc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jd=new WeakMap,ba=new WeakMap,Vd=new WeakMap,Eo=new WeakMap,bl=new WeakMap;function Hp(t){const e=new Promise((i,n)=>{const o=()=>{t.removeEventListener("success",l),t.removeEventListener("error",d)},l=()=>{i(vi(t.result)),o()},d=()=>{n(t.error),o()};t.addEventListener("success",l),t.addEventListener("error",d)});return e.then(i=>{i instanceof IDBCursor&&jd.set(i,t)}).catch(()=>{}),bl.set(e,t),e}function Yp(t){if(ba.has(t))return;const e=new Promise((i,n)=>{const o=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",d),t.removeEventListener("abort",d)},l=()=>{i(),o()},d=()=>{n(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",l),t.addEventListener("error",d),t.addEventListener("abort",d)});ba.set(t,e)}let Ea={get(t,e,i){if(t instanceof IDBTransaction){if(e==="done")return ba.get(t);if(e==="objectStoreNames")return t.objectStoreNames||Vd.get(t);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return vi(t[e])},set(t,e,i){return t[e]=i,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Xp(t){Ea=t(Ea)}function $p(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const n=t.call(Io(this),e,...i);return Vd.set(n,e.sort?e.sort():[e]),vi(n)}:zp().includes(t)?function(...e){return t.apply(Io(this),e),vi(jd.get(this))}:function(...e){return vi(t.apply(Io(this),e))}}function Kp(t){return typeof t=="function"?$p(t):(t instanceof IDBTransaction&&Yp(t),Wp(t,Gp())?new Proxy(t,Ea):t)}function vi(t){if(t instanceof IDBRequest)return Hp(t);if(Eo.has(t))return Eo.get(t);const e=Kp(t);return e!==t&&(Eo.set(t,e),bl.set(e,t)),e}const Io=t=>bl.get(t);function Zp(t,e,{blocked:i,upgrade:n,blocking:o,terminated:l}={}){const d=indexedDB.open(t,e),_=vi(d);return n&&d.addEventListener("upgradeneeded",S=>{n(vi(d.result),S.oldVersion,S.newVersion,vi(d.transaction),S)}),i&&d.addEventListener("blocked",S=>i(S.oldVersion,S.newVersion,S)),_.then(S=>{l&&S.addEventListener("close",()=>l()),o&&S.addEventListener("versionchange",w=>o(w.oldVersion,w.newVersion,w))}).catch(()=>{}),_}const Jp=["get","getKey","getAll","getAllKeys","count"],Qp=["put","add","delete","clear"],Ao=new Map;function Xc(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ao.get(e))return Ao.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,o=Qp.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!(o||Jp.includes(i)))return;const l=async function(d,..._){const S=this.transaction(d,o?"readwrite":"readonly");let w=S.store;return n&&(w=w.index(_.shift())),(await Promise.all([w[i](..._),o&&S.done]))[0]};return Ao.set(e,l),l}Xp(t=>({...t,get:(e,i,n)=>Xc(e,i)||t.get(e,i,n),has:(e,i)=>!!Xc(e,i)||t.has(e,i)}));const El=Zp("BarcodeDB-v2",1,{upgrade(t){t.createObjectStore("taggedList")}}),$c=async(t,e)=>(await El).put("taggedList",e,t),qp=async t=>(await El).delete("taggedList",t),Ud=_e.exports.createContext(),em=({children:t})=>{const[e,i]=_e.exports.useState(""),[n,o]=_e.exports.useState(""),[l,d]=_e.exports.useState(""),_={roomID:e,assetID:n,tagID:l,setRoomID:i,setAssetID:o,setTagID:d};return de(Ud.Provider,{value:_,children:t})},Wd=_e.exports.createContext(),tm=({children:t})=>{const[e,i]=_e.exports.useState(!1),[n,o]=_e.exports.useState(!1),[l,d]=_e.exports.useState(!1),_={showRoomID:e,showAssetID:n,showTagID:l,setShowRoomID:i,setShowAssetID:o,setShowTagID:d};return de(Wd.Provider,{value:_,children:t})};function im(t,e,i,n){t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(l){var d=this;if(!d.ctx||!d.ctx.listener)return d;for(var _=d._howls.length-1;_>=0;_--)d._howls[_].stereo(l);return d},t.prototype.pos=function(l,d,_){var S=this;if(!S.ctx||!S.ctx.listener)return S;if(d=typeof d!="number"?S._pos[1]:d,_=typeof _!="number"?S._pos[2]:_,typeof l=="number")S._pos=[l,d,_],typeof S.ctx.listener.positionX<"u"?(S.ctx.listener.positionX.setTargetAtTime(S._pos[0],e.ctx.currentTime,.1),S.ctx.listener.positionY.setTargetAtTime(S._pos[1],e.ctx.currentTime,.1),S.ctx.listener.positionZ.setTargetAtTime(S._pos[2],e.ctx.currentTime,.1)):S.ctx.listener.setPosition(S._pos[0],S._pos[1],S._pos[2]);else return S._pos;return S},t.prototype.orientation=function(l,d,_,S,w,T){var A=this;if(!A.ctx||!A.ctx.listener)return A;var I=A._orientation;if(d=typeof d!="number"?I[1]:d,_=typeof _!="number"?I[2]:_,S=typeof S!="number"?I[3]:S,w=typeof w!="number"?I[4]:w,T=typeof T!="number"?I[5]:T,typeof l=="number")A._orientation=[l,d,_,S,w,T],typeof A.ctx.listener.forwardX<"u"?(A.ctx.listener.forwardX.setTargetAtTime(l,e.ctx.currentTime,.1),A.ctx.listener.forwardY.setTargetAtTime(d,e.ctx.currentTime,.1),A.ctx.listener.forwardZ.setTargetAtTime(_,e.ctx.currentTime,.1),A.ctx.listener.upX.setTargetAtTime(S,e.ctx.currentTime,.1),A.ctx.listener.upY.setTargetAtTime(w,e.ctx.currentTime,.1),A.ctx.listener.upZ.setTargetAtTime(T,e.ctx.currentTime,.1)):A.ctx.listener.setOrientation(l,d,_,S,w,T);else return I;return A},i.prototype.init=function(l){return function(d){var _=this;return _._orientation=d.orientation||[1,0,0],_._stereo=d.stereo||null,_._pos=d.pos||null,_._pannerAttr={coneInnerAngle:typeof d.coneInnerAngle<"u"?d.coneInnerAngle:360,coneOuterAngle:typeof d.coneOuterAngle<"u"?d.coneOuterAngle:360,coneOuterGain:typeof d.coneOuterGain<"u"?d.coneOuterGain:0,distanceModel:typeof d.distanceModel<"u"?d.distanceModel:"inverse",maxDistance:typeof d.maxDistance<"u"?d.maxDistance:1e4,panningModel:typeof d.panningModel<"u"?d.panningModel:"HRTF",refDistance:typeof d.refDistance<"u"?d.refDistance:1,rolloffFactor:typeof d.rolloffFactor<"u"?d.rolloffFactor:1},_._onstereo=d.onstereo?[{fn:d.onstereo}]:[],_._onpos=d.onpos?[{fn:d.onpos}]:[],_._onorientation=d.onorientation?[{fn:d.onorientation}]:[],l.call(this,d)}}(i.prototype.init),i.prototype.stereo=function(l,d){var _=this;if(!_._webAudio)return _;if(_._state!=="loaded")return _._queue.push({event:"stereo",action:function(){_.stereo(l,d)}}),_;var S=typeof e.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof d>"u")if(typeof l=="number")_._stereo=l,_._pos=[l,0,0];else return _._stereo;for(var w=_._getSoundIds(d),T=0;T<w.length;T++){var A=_._soundById(w[T]);if(A)if(typeof l=="number")A._stereo=l,A._pos=[l,0,0],A._node&&(A._pannerAttr.panningModel="equalpower",(!A._panner||!A._panner.pan)&&o(A,S),S==="spatial"?typeof A._panner.positionX<"u"?(A._panner.positionX.setValueAtTime(l,e.ctx.currentTime),A._panner.positionY.setValueAtTime(0,e.ctx.currentTime),A._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):A._panner.setPosition(l,0,0):A._panner.pan.setValueAtTime(l,e.ctx.currentTime)),_._emit("stereo",A._id);else return A._stereo}return _},i.prototype.pos=function(l,d,_,S){var w=this;if(!w._webAudio)return w;if(w._state!=="loaded")return w._queue.push({event:"pos",action:function(){w.pos(l,d,_,S)}}),w;if(d=typeof d!="number"?0:d,_=typeof _!="number"?-.5:_,typeof S>"u")if(typeof l=="number")w._pos=[l,d,_];else return w._pos;for(var T=w._getSoundIds(S),A=0;A<T.length;A++){var I=w._soundById(T[A]);if(I)if(typeof l=="number")I._pos=[l,d,_],I._node&&((!I._panner||I._panner.pan)&&o(I,"spatial"),typeof I._panner.positionX<"u"?(I._panner.positionX.setValueAtTime(l,e.ctx.currentTime),I._panner.positionY.setValueAtTime(d,e.ctx.currentTime),I._panner.positionZ.setValueAtTime(_,e.ctx.currentTime)):I._panner.setPosition(l,d,_)),w._emit("pos",I._id);else return I._pos}return w},i.prototype.orientation=function(l,d,_,S){var w=this;if(!w._webAudio)return w;if(w._state!=="loaded")return w._queue.push({event:"orientation",action:function(){w.orientation(l,d,_,S)}}),w;if(d=typeof d!="number"?w._orientation[1]:d,_=typeof _!="number"?w._orientation[2]:_,typeof S>"u")if(typeof l=="number")w._orientation=[l,d,_];else return w._orientation;for(var T=w._getSoundIds(S),A=0;A<T.length;A++){var I=w._soundById(T[A]);if(I)if(typeof l=="number")I._orientation=[l,d,_],I._node&&(I._panner||(I._pos||(I._pos=w._pos||[0,0,-.5]),o(I,"spatial")),typeof I._panner.orientationX<"u"?(I._panner.orientationX.setValueAtTime(l,e.ctx.currentTime),I._panner.orientationY.setValueAtTime(d,e.ctx.currentTime),I._panner.orientationZ.setValueAtTime(_,e.ctx.currentTime)):I._panner.setOrientation(l,d,_)),w._emit("orientation",I._id);else return I._orientation}return w},i.prototype.pannerAttr=function(){var l=this,d=arguments,_,S,w;if(!l._webAudio)return l;if(d.length===0)return l._pannerAttr;if(d.length===1)if(typeof d[0]=="object")_=d[0],typeof S>"u"&&(_.pannerAttr||(_.pannerAttr={coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor,panningModel:_.panningModel}),l._pannerAttr={coneInnerAngle:typeof _.pannerAttr.coneInnerAngle<"u"?_.pannerAttr.coneInnerAngle:l._coneInnerAngle,coneOuterAngle:typeof _.pannerAttr.coneOuterAngle<"u"?_.pannerAttr.coneOuterAngle:l._coneOuterAngle,coneOuterGain:typeof _.pannerAttr.coneOuterGain<"u"?_.pannerAttr.coneOuterGain:l._coneOuterGain,distanceModel:typeof _.pannerAttr.distanceModel<"u"?_.pannerAttr.distanceModel:l._distanceModel,maxDistance:typeof _.pannerAttr.maxDistance<"u"?_.pannerAttr.maxDistance:l._maxDistance,refDistance:typeof _.pannerAttr.refDistance<"u"?_.pannerAttr.refDistance:l._refDistance,rolloffFactor:typeof _.pannerAttr.rolloffFactor<"u"?_.pannerAttr.rolloffFactor:l._rolloffFactor,panningModel:typeof _.pannerAttr.panningModel<"u"?_.pannerAttr.panningModel:l._panningModel});else return w=l._soundById(parseInt(d[0],10)),w?w._pannerAttr:l._pannerAttr;else d.length===2&&(_=d[0],S=parseInt(d[1],10));for(var T=l._getSoundIds(S),A=0;A<T.length;A++)if(w=l._soundById(T[A]),w){var I=w._pannerAttr;I={coneInnerAngle:typeof _.coneInnerAngle<"u"?_.coneInnerAngle:I.coneInnerAngle,coneOuterAngle:typeof _.coneOuterAngle<"u"?_.coneOuterAngle:I.coneOuterAngle,coneOuterGain:typeof _.coneOuterGain<"u"?_.coneOuterGain:I.coneOuterGain,distanceModel:typeof _.distanceModel<"u"?_.distanceModel:I.distanceModel,maxDistance:typeof _.maxDistance<"u"?_.maxDistance:I.maxDistance,refDistance:typeof _.refDistance<"u"?_.refDistance:I.refDistance,rolloffFactor:typeof _.rolloffFactor<"u"?_.rolloffFactor:I.rolloffFactor,panningModel:typeof _.panningModel<"u"?_.panningModel:I.panningModel};var k=w._panner;k||(w._pos||(w._pos=l._pos||[0,0,-.5]),o(w,"spatial"),k=w._panner),k.coneInnerAngle=I.coneInnerAngle,k.coneOuterAngle=I.coneOuterAngle,k.coneOuterGain=I.coneOuterGain,k.distanceModel=I.distanceModel,k.maxDistance=I.maxDistance,k.refDistance=I.refDistance,k.rolloffFactor=I.rolloffFactor,k.panningModel=I.panningModel}return l},n.prototype.init=function(l){return function(){var d=this,_=d._parent;d._orientation=_._orientation,d._stereo=_._stereo,d._pos=_._pos,d._pannerAttr=_._pannerAttr,l.call(this),d._stereo?_.stereo(d._stereo):d._pos&&_.pos(d._pos[0],d._pos[1],d._pos[2],d._id)}}(n.prototype.init),n.prototype.reset=function(l){return function(){var d=this,_=d._parent;return d._orientation=_._orientation,d._stereo=_._stereo,d._pos=_._pos,d._pannerAttr=_._pannerAttr,d._stereo?_.stereo(d._stereo):d._pos?_.pos(d._pos[0],d._pos[1],d._pos[2],d._id):d._panner&&(d._panner.disconnect(0),d._panner=void 0,_._refreshBuffer(d)),l.call(this)}}(n.prototype.reset);var o=function(l,d){d=d||"spatial",d==="spatial"?(l._panner=e.ctx.createPanner(),l._panner.coneInnerAngle=l._pannerAttr.coneInnerAngle,l._panner.coneOuterAngle=l._pannerAttr.coneOuterAngle,l._panner.coneOuterGain=l._pannerAttr.coneOuterGain,l._panner.distanceModel=l._pannerAttr.distanceModel,l._panner.maxDistance=l._pannerAttr.maxDistance,l._panner.refDistance=l._pannerAttr.refDistance,l._panner.rolloffFactor=l._pannerAttr.rolloffFactor,l._panner.panningModel=l._pannerAttr.panningModel,typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(l._pos[0],e.ctx.currentTime),l._panner.positionY.setValueAtTime(l._pos[1],e.ctx.currentTime),l._panner.positionZ.setValueAtTime(l._pos[2],e.ctx.currentTime)):l._panner.setPosition(l._pos[0],l._pos[1],l._pos[2]),typeof l._panner.orientationX<"u"?(l._panner.orientationX.setValueAtTime(l._orientation[0],e.ctx.currentTime),l._panner.orientationY.setValueAtTime(l._orientation[1],e.ctx.currentTime),l._panner.orientationZ.setValueAtTime(l._orientation[2],e.ctx.currentTime)):l._panner.setOrientation(l._orientation[0],l._orientation[1],l._orientation[2])):(l._panner=e.ctx.createStereoPanner(),l._panner.pan.setValueAtTime(l._stereo,e.ctx.currentTime)),l._panner.connect(l._node),l._paused||l._parent.pause(l._id,!0).play(l._id,!0)}}var Il=function(){this.init()};Il.prototype={init:function(){var t=this||se;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||se;if(t=parseFloat(t),e.ctx||qr(),typeof t<"u"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,se.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),o=0;o<n.length;o++){var l=e._howls[i]._soundById(n[o]);l&&l._node&&(l._node.volume=l._volume*t)}return e}return e._volume},mute:function(t){var e=this||se;e.ctx||qr(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,se.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),o=0;o<n.length;o++){var l=e._howls[i]._soundById(n[o]);l&&l._node&&(l._node.muted=t?!0:l._muted)}return e},stop:function(){for(var t=this||se,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||se,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,qr()),t},codecs:function(t){return(this||se)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||se;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{var e=new Audio;typeof e.oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||se,e=null;try{e=typeof Audio<"u"?new Audio:null}catch{return t}if(!e||typeof e.canPlayType!="function")return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",o=n.match(/OPR\/([0-6].)/g),l=o&&parseInt(o[0].split("/")[1],10)<33,d=n.indexOf("Safari")!==-1&&n.indexOf("Chrome")===-1,_=n.match(/Version\/(.*?) /),S=d&&_&&parseInt(_[1],10)<15;return t._codecs={mp3:!!(!l&&(i||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!S&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!S&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||se;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch{t.noAudio=!0;break}for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var l=t._howls[o]._getSoundIds(),d=0;d<l.length;d++){var _=t._howls[o]._soundById(l[d]);_&&_._node&&!_._node._unlocked&&(_._node._unlocked=!0,_._node.load())}t._autoResume();var S=t.ctx.createBufferSource();S.buffer=t._scratchBuffer,S.connect(t.ctx.destination),typeof S.start>"u"?S.noteOn(0):S.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),S.onended=function(){S.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var w=0;w<t._howls.length;w++)t._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||se;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=new Audio().play();return e&&typeof Promise<"u"&&(e instanceof Promise||typeof e.then=="function")&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||se;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend>"u"||!se.usingWebAudio)){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio){for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var n=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(n,n)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume>"u"||!se.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var se=new Il,bs=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};bs.prototype={init:function(t){var e=this;return se.ctx||qr(),e._autoplay=t.autoplay||!1,e._format=typeof t.format!="string"?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src=typeof t.src!="string"?t.src:[t.src],e._volume=t.volume!==void 0?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=se.usingWebAudio&&!e._html5,typeof se.ctx<"u"&&se.ctx&&se.autoUnlock&&se._unlockAudio(),se._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e._preload!=="none"&&e.load(),e},load:function(){var t=this,e=null;if(se.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var n,o;if(t._format&&t._format[i])n=t._format[i];else{if(o=t._src[i],typeof o!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}n=/^data:audio\/([^;,]+);/i.exec(o),n||(n=/\.([^.]+)$/.exec(o.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&se.codecs(n)){e=t._src[i];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=e,t._state="loading",window.location.protocol==="https:"&&e.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new Es(t),t._webAudio&&nm(t),t},play:function(t,e){var i=this,n=null;if(typeof t=="number")n=t,t=null;else{if(typeof t=="string"&&i._state==="loaded"&&!i._sprite[t])return null;if(typeof t>"u"&&(t="__default",!i._playLock)){for(var o=0,l=0;l<i._sounds.length;l++)i._sounds[l]._paused&&!i._sounds[l]._ended&&(o++,n=i._sounds[l]._id);o===1?t=null:n=null}}var d=n?i._soundById(n):i._inactiveSound();if(!d)return null;if(n&&!t&&(t=d._sprite||"__default"),i._state!=="loaded"){d._sprite=t,d._ended=!1;var _=d._id;return i._queue.push({event:"play",action:function(){i.play(_)}}),_}if(n&&!d._paused)return e||i._loadQueue("play"),d._id;i._webAudio&&se._autoResume();var S=Math.max(0,d._seek>0?d._seek:i._sprite[t][0]/1e3),w=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-S),T=w*1e3/Math.abs(d._rate),A=i._sprite[t][0]/1e3,I=(i._sprite[t][0]+i._sprite[t][1])/1e3;d._sprite=t,d._ended=!1;var k=function(){d._paused=!1,d._seek=S,d._start=A,d._stop=I,d._loop=!!(d._loop||i._sprite[t][2])};if(S>=I){i._ended(d);return}var P=d._node;if(i._webAudio){var F=function(){i._playLock=!1,k(),i._refreshBuffer(d);var M=d._muted||i._muted?0:d._volume;P.gain.setValueAtTime(M,se.ctx.currentTime),d._playStart=se.ctx.currentTime,typeof P.bufferSource.start>"u"?d._loop?P.bufferSource.noteGrainOn(0,S,86400):P.bufferSource.noteGrainOn(0,S,w):d._loop?P.bufferSource.start(0,S,86400):P.bufferSource.start(0,S,w),T!==1/0&&(i._endTimers[d._id]=setTimeout(i._ended.bind(i,d),T)),e||setTimeout(function(){i._emit("play",d._id),i._loadQueue()},0)};se.state==="running"&&se.ctx.state!=="interrupted"?F():(i._playLock=!0,i.once("resume",F),i._clearTimer(d._id))}else{var z=function(){P.currentTime=S,P.muted=d._muted||i._muted||se._muted||P.muted,P.volume=d._volume*se.volume(),P.playbackRate=d._rate;try{var M=P.play();if(M&&typeof Promise<"u"&&(M instanceof Promise||typeof M.then=="function")?(i._playLock=!0,k(),M.then(function(){i._playLock=!1,P._unlocked=!0,e?i._loadQueue():i._emit("play",d._id)}).catch(function(){i._playLock=!1,i._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),d._ended=!0,d._paused=!0})):e||(i._playLock=!1,k(),i._emit("play",d._id)),P.playbackRate=d._rate,P.paused){i._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||d._loop?i._endTimers[d._id]=setTimeout(i._ended.bind(i,d),T):(i._endTimers[d._id]=function(){i._ended(d),P.removeEventListener("ended",i._endTimers[d._id],!1)},P.addEventListener("ended",i._endTimers[d._id],!1))}catch($){i._emit("playerror",d._id,$)}};P.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(P.src=i._src,P.load());var D=window&&window.ejecta||!P.readyState&&se._navigator.isCocoonJS;if(P.readyState>=3||D)z();else{i._playLock=!0,i._state="loading";var R=function(){i._state="loaded",z(),P.removeEventListener(se._canPlayEvent,R,!1)};P.addEventListener(se._canPlayEvent,R,!1),i._clearTimer(d._id)}}return d._id},pause:function(t){var e=this;if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),n=0;n<i.length;n++){e._clearTimer(i[n]);var o=e._soundById(i[n]);if(o&&!o._paused&&(o._seek=e.seek(i[n]),o._rateSeek=0,o._paused=!0,e._stopFade(i[n]),o._node))if(e._webAudio){if(!o._node.bufferSource)continue;typeof o._node.bufferSource.stop>"u"?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),e._cleanBuffer(o._node)}else(!isNaN(o._node.duration)||o._node.duration===1/0)&&o._node.pause();arguments[1]||e._emit("pause",o?o._id:null)}return e},stop:function(t,e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var n=i._getSoundIds(t),o=0;o<n.length;o++){i._clearTimer(n[o]);var l=i._soundById(n[o]);l&&(l._seek=l._start||0,l._rateSeek=0,l._paused=!0,l._ended=!0,i._stopFade(n[o]),l._node&&(i._webAudio?l._node.bufferSource&&(typeof l._node.bufferSource.stop>"u"?l._node.bufferSource.noteOff(0):l._node.bufferSource.stop(0),i._cleanBuffer(l._node)):(!isNaN(l._node.duration)||l._node.duration===1/0)&&(l._node.currentTime=l._start||0,l._node.pause(),l._node.duration===1/0&&i._clearSound(l._node))),e||i._emit("stop",l._id))}return i},mute:function(t,e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(typeof e>"u")if(typeof t=="boolean")i._muted=t;else return i._muted;for(var n=i._getSoundIds(e),o=0;o<n.length;o++){var l=i._soundById(n[o]);l&&(l._muted=t,l._interval&&i._stopFade(l._id),i._webAudio&&l._node?l._node.gain.setValueAtTime(t?0:l._volume,se.ctx.currentTime):l._node&&(l._node.muted=se._muted?!0:t),i._emit("mute",l._id))}return i},volume:function(){var t=this,e=arguments,i,n;if(e.length===0)return t._volume;if(e.length===1||e.length===2&&typeof e[1]>"u"){var o=t._getSoundIds(),l=o.indexOf(e[0]);l>=0?n=parseInt(e[0],10):i=parseFloat(e[0])}else e.length>=2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));var d;if(typeof i<"u"&&i>=0&&i<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof n>"u"&&(t._volume=i),n=t._getSoundIds(n);for(var _=0;_<n.length;_++)d=t._soundById(n[_]),d&&(d._volume=i,e[2]||t._stopFade(n[_]),t._webAudio&&d._node&&!d._muted?d._node.gain.setValueAtTime(i,se.ctx.currentTime):d._node&&!d._muted&&(d._node.volume=i*se.volume()),t._emit("volume",d._id))}else return d=n?t._soundById(n):t._sounds[0],d?d._volume:0;return t},fade:function(t,e,i,n){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(t,e,i,n)}}),o;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),o.volume(t,n);for(var l=o._getSoundIds(n),d=0;d<l.length;d++){var _=o._soundById(l[d]);if(_){if(n||o._stopFade(l[d]),o._webAudio&&!_._muted){var S=se.ctx.currentTime,w=S+i/1e3;_._volume=t,_._node.gain.setValueAtTime(t,S),_._node.gain.linearRampToValueAtTime(e,w)}o._startFadeInterval(_,t,e,i,l[d],typeof n>"u")}}return o},_startFadeInterval:function(t,e,i,n,o,l){var d=this,_=e,S=i-e,w=Math.abs(S/.01),T=Math.max(4,w>0?n/w:n),A=Date.now();t._fadeTo=i,t._interval=setInterval(function(){var I=(Date.now()-A)/n;A=Date.now(),_+=S*I,_=Math.round(_*100)/100,S<0?_=Math.max(i,_):_=Math.min(i,_),d._webAudio?t._volume=_:d.volume(_,t._id,!0),l&&(d._volume=_),(i<e&&_<=i||i>e&&_>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,d.volume(i,t._id),d._emit("fade",t._id))},T)},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(se.ctx.currentTime),clearInterval(i._interval),i._interval=null,e.volume(i._fadeTo,t),i._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t=this,e=arguments,i,n,o;if(e.length===0)return t._loop;if(e.length===1)if(typeof e[0]=="boolean")i=e[0],t._loop=i;else return o=t._soundById(parseInt(e[0],10)),o?o._loop:!1;else e.length===2&&(i=e[0],n=parseInt(e[1],10));for(var l=t._getSoundIds(n),d=0;d<l.length;d++)o=t._soundById(l[d]),o&&(o._loop=i,t._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=i,i&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,t.playing(l[d])&&(t.pause(l[d],!0),t.play(l[d],!0)))));return t},rate:function(){var t=this,e=arguments,i,n;if(e.length===0)n=t._sounds[0]._id;else if(e.length===1){var o=t._getSoundIds(),l=o.indexOf(e[0]);l>=0?n=parseInt(e[0],10):i=parseFloat(e[0])}else e.length===2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));var d;if(typeof i=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof n>"u"&&(t._rate=i),n=t._getSoundIds(n);for(var _=0;_<n.length;_++)if(d=t._soundById(n[_]),d){t.playing(n[_])&&(d._rateSeek=t.seek(n[_]),d._playStart=t._webAudio?se.ctx.currentTime:d._playStart),d._rate=i,t._webAudio&&d._node&&d._node.bufferSource?d._node.bufferSource.playbackRate.setValueAtTime(i,se.ctx.currentTime):d._node&&(d._node.playbackRate=i);var S=t.seek(n[_]),w=(t._sprite[d._sprite][0]+t._sprite[d._sprite][1])/1e3-S,T=w*1e3/Math.abs(d._rate);(t._endTimers[n[_]]||!d._paused)&&(t._clearTimer(n[_]),t._endTimers[n[_]]=setTimeout(t._ended.bind(t,d),T)),t._emit("rate",d._id)}}else return d=t._soundById(n),d?d._rate:t._rate;return t},seek:function(){var t=this,e=arguments,i,n;if(e.length===0)t._sounds.length&&(n=t._sounds[0]._id);else if(e.length===1){var o=t._getSoundIds(),l=o.indexOf(e[0]);l>=0?n=parseInt(e[0],10):t._sounds.length&&(n=t._sounds[0]._id,i=parseFloat(e[0]))}else e.length===2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));if(typeof n>"u")return 0;if(typeof i=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var d=t._soundById(n);if(d)if(typeof i=="number"&&i>=0){var _=t.playing(n);_&&t.pause(n,!0),d._seek=i,d._ended=!1,t._clearTimer(n),!t._webAudio&&d._node&&!isNaN(d._node.duration)&&(d._node.currentTime=i);var S=function(){_&&t.play(n,!0),t._emit("seek",n)};if(_&&!t._webAudio){var w=function(){t._playLock?setTimeout(w,0):S()};setTimeout(w,0)}else S()}else if(t._webAudio){var T=t.playing(n)?se.ctx.currentTime-d._playStart:0,A=d._rateSeek?d._rateSeek-d._seek:0;return d._seek+(A+T*Math.abs(d._rate))}else return d._node.currentTime;return t},playing:function(t){var e=this;if(typeof t=="number"){var i=e._soundById(t);return i?!i._paused:!1}for(var n=0;n<e._sounds.length;n++)if(!e._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,n=e._soundById(t);return n&&(i=e._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(se._canPlayEvent,e[i]._loadFn,!1),e[i]._node.removeEventListener("ended",e[i]._endFn,!1),se._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var n=se._howls.indexOf(t);n>=0&&se._howls.splice(n,1);var o=!0;for(i=0;i<se._howls.length;i++)if(se._howls[i]._src===t._src||t._src.indexOf(se._howls[i]._src)>=0){o=!1;break}return Li&&o&&delete Li[t._src],se.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,n){var o=this,l=o["_on"+t];return typeof e=="function"&&l.push(n?{id:i,fn:e,once:n}:{id:i,fn:e}),o},off:function(t,e,i){var n=this,o=n["_on"+t],l=0;if(typeof e=="number"&&(i=e,e=null),e||i)for(l=0;l<o.length;l++){var d=i===o[l].id;if(e===o[l].fn&&d||!e&&d){o.splice(l,1);break}}else if(t)n["_on"+t]=[];else{var _=Object.keys(n);for(l=0;l<_.length;l++)_[l].indexOf("_on")===0&&Array.isArray(n[_[l]])&&(n[_[l]]=[])}return n},once:function(t,e,i){var n=this;return n.on(t,e,i,1),n},_emit:function(t,e,i){for(var n=this,o=n["_on"+t],l=o.length-1;l>=0;l--)(!o[l].id||o[l].id===e||t==="load")&&(setTimeout(function(d){d.call(this,e,i)}.bind(n,o[l].fn),0),o[l].once&&n.off(t,o[l].fn,o[l].id));return n._loadQueue(t),n},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,i=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!!(t._loop||e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=se.ctx.currentTime;var o=(t._stop-t._start)*1e3/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),o)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),se._autoSuspend()),!e._webAudio&&!n&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if(typeof e._endTimers[t]!="function")clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new Es(t)},_drain:function(){var t=this,e=t._pool,i=0,n=0;if(!(t._sounds.length<e)){for(n=0;n<t._sounds.length;n++)t._sounds[n]._ended&&i++;for(n=t._sounds.length-1;n>=0;n--){if(i<=e)return;t._sounds[n]._ended&&(t._webAudio&&t._sounds[n]._node&&t._sounds[n]._node.disconnect(0),t._sounds.splice(n,1),i--)}}},_getSoundIds:function(t){var e=this;if(typeof t>"u"){for(var i=[],n=0;n<e._sounds.length;n++)i.push(e._sounds[n]._id);return i}else return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=se.ctx.createBufferSource(),t._node.bufferSource.buffer=Li[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,se.ctx.currentTime),e},_cleanBuffer:function(t){var e=this,i=se._navigator&&se._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return e;if(se._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),i))try{t.bufferSource.buffer=se._scratchBuffer}catch{}return t.bufferSource=null,e},_clearSound:function(t){var e=/MSIE |Trident\//.test(se._navigator&&se._navigator.userAgent);e||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Es=function(t){this._parent=t,this.init()};Es.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++se._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=se._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof se.ctx.createGain>"u"?se.ctx.createGainNode():se.ctx.createGain(),t._node.gain.setValueAtTime(i,se.ctx.currentTime),t._node.paused=!0,t._node.connect(se.masterGain)):se.noAudio||(t._node=se._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(se._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=e._preload===!0?"auto":e._preload,t._node.volume=i*se.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++se._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10,Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(se._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(t._node.duration*10)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=e._duration*1e3),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var Li={},nm=function(t){var e=t._src;if(Li[e]){t._duration=Li[e].duration,Gd(t);return}if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),n=new Uint8Array(i.length),o=0;o<i.length;++o)n[o]=i.charCodeAt(o);Kc(n.buffer,t)}else{var l=new XMLHttpRequest;l.open(t._xhr.method,e,!0),l.withCredentials=t._xhr.withCredentials,l.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(d){l.setRequestHeader(d,t._xhr.headers[d])}),l.onload=function(){var d=(l.status+"")[0];if(d!=="0"&&d!=="2"&&d!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+l.status+".");return}Kc(l.response,t)},l.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete Li[e],t.load())},rm(l)}},rm=function(t){try{t.send()}catch{t.onerror()}},Kc=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(o){o&&e._sounds.length>0?(Li[e._src]=o,Gd(e,o)):i()};typeof Promise<"u"&&se.ctx.decodeAudioData.length===1?se.ctx.decodeAudioData(t).then(n).catch(i):se.ctx.decodeAudioData(t,n,i)},Gd=function(t,e){e&&!t._duration&&(t._duration=e.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},qr=function(){if(se.usingWebAudio){try{typeof AudioContext<"u"?se.ctx=new AudioContext:typeof webkitAudioContext<"u"?se.ctx=new webkitAudioContext:se.usingWebAudio=!1}catch{se.usingWebAudio=!1}se.ctx||(se.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(se._navigator&&se._navigator.platform),e=se._navigator&&se._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var n=/safari/.test(se._navigator&&se._navigator.userAgent.toLowerCase());se._navigator&&!n&&(se.usingWebAudio=!1)}se.usingWebAudio&&(se.masterGain=typeof se.ctx.createGain>"u"?se.ctx.createGainNode():se.ctx.createGain(),se.masterGain.gain.setValueAtTime(se._muted?0:se._volume,se.ctx.currentTime),se.masterGain.connect(se.ctx.destination)),se._setup()}};im(Il,se,bs,Es);const zi=typeof self>"u";let Pn,Yt,Nr,Is,et;if(typeof navigator<"u"&&(Pn=navigator,Yt=Pn.userAgent,Nr=Pn.platform,Is=Pn.mediaDevices),!zi){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Pn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Nr,search:"Win"},Mac:{str:Nr},Linux:{str:Nr}};let i="unknownBrowser",n=0,o="unknownOS";for(let l in t){const d=t[l]||{};let _=d.str||Yt,S=d.search||l,w=d.verStr||Yt,T=d.verSearch||l;if(T instanceof Array||(T=[T]),_.indexOf(S)!=-1){i=l;for(let A of T){let I=w.indexOf(A);if(I!=-1){n=parseFloat(w.substring(I+A.length+1));break}}break}}for(let l in e){const d=e[l]||{};let _=d.str||Yt,S=d.search||l;if(_.indexOf(S)!=-1){o=l;break}}o=="Linux"&&Yt.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),et={browser:i,version:n,OS:o}}zi&&(et={browser:"ssr",version:0,OS:"ssr"});const sm=typeof WebAssembly<"u"&&Yt&&!(/Safari/.test(Yt)&&!/Chrome/.test(Yt)&&/\(.+\s11_2_([2-6]).*\)/.test(Yt)),om=!(typeof Worker>"u"),zd=!(!Is||!Is.getUserMedia),am=async()=>{let t=!1;if(zd)try{(await Is.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};et.browser==="Chrome"&&et.version>66||et.browser==="Safari"&&et.version>13||et.browser==="OPR"&&et.version>43||et.browser==="Edge"&&et.version;const lm=(()=>{if(!zi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let i=t.indexOf("#");i!=-1&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Bn=" is not allowed to change after `createInstance` or `loadWasm` is called.",cm=!zi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",um=!zi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",Zc=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!zi){let i=document.createElement("a");i.href=t[e],t[e]=i.href}t[e].endsWith("/")||(t[e]+="/")}}return t};var De,As,Ia,pt,wn;(function(t){t[t.IPF_Binary=0]="IPF_Binary",t[t.IPF_BinaryInverted=1]="IPF_BinaryInverted",t[t.IPF_GrayScaled=2]="IPF_GrayScaled",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888"})(De||(De={})),function(t){t[t.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",t[t.DBR_SUCCESS=0]="DBR_SUCCESS",t[t.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",t[t.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",t[t.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",t[t.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",t[t.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",t[t.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",t[t.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",t[t.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",t[t.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",t[t.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",t[t.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",t[t.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",t[t.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",t[t.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",t[t.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",t[t.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",t[t.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",t[t.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",t[t.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",t[t.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",t[t.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",t[t.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",t[t.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",t[t.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",t[t.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",t[t.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",t[t.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",t[t.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",t[t.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",t[t.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",t[t.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",t[t.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",t[t.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",t[t.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",t[t.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",t[t.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",t[t.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",t[t.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",t[t.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",t[t.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",t[t.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",t[t.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",t[t.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",t[t.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",t[t.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",t[t.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",t[t.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",t[t.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",t[t.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",t[t.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",t[t.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",t[t.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",t[t.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",t[t.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",t[t.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",t[t.DBR_PANORAMA_LICENSE_INVALID=-10060]="DBR_PANORAMA_LICENSE_INVALID",t[t.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",t[t.DBR_PHARMACODE_LICENSE_INVALID=-10062]="DBR_PHARMACODE_LICENSE_INVALID",t[t.DBR_IMAGE_ORIENTATION_INVALID=-10063]="DBR_IMAGE_ORIENTATION_INVALID",t[t.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",t[t.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",t[t.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",t[t.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(As||(As={})),function(t){t[t.IMRDT_IMAGE=1]="IMRDT_IMAGE",t[t.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",t[t.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",t[t.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",t[t.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",t[t.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(Ia||(Ia={})),function(t){t[t.BF_ALL=4265607167]="BF_ALL",t[t.BF_ONED=3147775]="BF_ONED",t[t.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",t[t.BF_CODE_39=1]="BF_CODE_39",t[t.BF_CODE_128=2]="BF_CODE_128",t[t.BF_CODE_93=4]="BF_CODE_93",t[t.BF_CODABAR=8]="BF_CODABAR",t[t.BF_ITF=16]="BF_ITF",t[t.BF_EAN_13=32]="BF_EAN_13",t[t.BF_EAN_8=64]="BF_EAN_8",t[t.BF_UPC_A=128]="BF_UPC_A",t[t.BF_UPC_E=256]="BF_UPC_E",t[t.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",t[t.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",t[t.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",t[t.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",t[t.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",t[t.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",t[t.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",t[t.BF_PATCHCODE=262144]="BF_PATCHCODE",t[t.BF_PDF417=33554432]="BF_PDF417",t[t.BF_QR_CODE=67108864]="BF_QR_CODE",t[t.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",t[t.BF_AZTEC=268435456]="BF_AZTEC",t[t.BF_MAXICODE=536870912]="BF_MAXICODE",t[t.BF_MICRO_QR=1073741824]="BF_MICRO_QR",t[t.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",t[t.BF_GS1_COMPOSITE=2147483648]="BF_GS1_COMPOSITE",t[t.BF_MSI_CODE=1048576]="BF_MSI_CODE",t[t.BF_CODE_11=2097152]="BF_CODE_11",t[t.BF_NULL=0]="BF_NULL"}(pt||(pt={})),function(t){t[t.IRT_NO_RESULT=0]="IRT_NO_RESULT",t[t.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",t[t.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",t[t.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",t[t.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",t[t.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",t[t.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",t[t.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",t[t.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",t[t.IRT_CONTOUR=256]="IRT_CONTOUR",t[t.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",t[t.IRT_FORM=1024]="IRT_FORM",t[t.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",t[t.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",t[t.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(wn||(wn={}));const Jc=t=>t&&typeof t=="object"&&typeof t.then=="function";class Hd extends Promise{constructor(e){let i,n;super((o,l)=>{i=o,n=l}),this._s="pending",this.resolve=o=>{this.isPending&&(Jc(o)?this.task=o:(this._s="fulfilled",i(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",n(o))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let i;this._task=e,Jc(e)?i=e:typeof e=="function"&&(i=new Promise(e)),i&&(async()=>{try{const n=await i;e===this._task&&this.resolve(n)}catch(n){e===this._task&&this.reject(n)}})()}get isEmpty(){return this._task==null}}const Oo=["iPhone","iPad","Android","HarmonyOS"].includes(et.OS)?2048:4096;class j{constructor(){this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.beepSound=new bs({src:["data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"],onplayerror:(e,i)=>{console.warn(`Sound '${e}' playback failure: ${i}`)}}),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.captureAndDecodeInParallel=!0,this.autoSuggestTip=!1,this.suggestTipFrameArray=[],this.suggestTipFrameLimit=[5,3],this.noIntermediateResultsCount=0,this.noIntermediateResultsTipLimit=100,this.tinyBarcodeTipModuleSizeLimit=3,this.hugeBarcodeTipLimit=.9,this.autoZoomInFrameArray=[],this.autoZoomInFrameLimit=[5,3],this.autoZoomInStepRate=1/3,this.autoZoomInMaxStep=1.5,this.autoZoomInMaxTimes=5,this.autoZoomInMinStep=Math.pow(10,1/this.autoZoomInMaxTimes),this.autoZoomInIdealModuleSize=6,this.autoZoomOutFrameCount=0,this.autoZoomOutFrameLimit=3,this.autoZoomOutStepRate=1/3,this.autoZoomOutMinValue=1,this.autoZoomOutMinStep=2,this.autoZoomOutStepRate_2=.05,this.autoZoomOutMinValue_2=2,this.frameArrayInIdealZoom=[],this.frameLimitInIdealZoom=[5,3],this.enableZoomOutInIdealZoom=!1,this.nextActionInIdealZoom="focus",this.autoFocusFrameArray=[],this.autoFocusFrameLimit=[5,3],this.autoZoomIdealArea=[0,.05],this.autoZoomTargetBorder=.9,this.autoZoomDetectionArea=.5,this.autoZoom=!1,this.autoFocus=!1,this._resultHighlightingDuration=-1,this._dce=null,this._imgSource=null,this._maxCvsSideLength=Oo,this._promiseStartScan=null}static get version(){return this._version}static get license(){return this._license}static set license(e){((i,n)=>{const o=i;if(!o._pLoad.isEmpty)throw new Error("`license`"+Bn);o._license=n})(j,e)}static get productKeys(){return this._license}static set productKeys(e){j.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){j.license=e}static get organizationID(){return this._license}static set organizationID(e){j.license=e}static set sessionPassword(e){((i,n)=>{const o=i;if(!o._pLoad.isEmpty)throw new Error("`sessionPassword`"+Bn);o._sessionPassword=n})(j,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:sm,worker:om,getUserMedia:zd,camera:await am(),browser:et.browser,version:et.version,OS:et.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");j._engineResourcePath=(i=>{if(i==null&&(i="./"),!zi){let n=document.createElement("a");n.href=i,i=n.href}return i.endsWith("/")||(i+="/"),i})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((i,n)=>{const o=i;if(!o._pLoad.isEmpty)throw new Error("`licenseServer`"+Bn);o._licenseServer=Zc(n)})(j,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((i,n)=>{const o=i;if(!o._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Bn);o._deviceFriendlyName=n||""})(j,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");j.__bUseFullFeature=e}static isImageSource(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"width"in e&&"height"in e&&"pixelFormat"in e}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return(e=j._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",j.engineResourcePath)}static set defaultUIElementURL(e){j._defaultUIElementURL=e}static _fireHTTPSWarnning(){j.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{j.onWarning&&j.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new bs({src:[this._soundSource],onplayerror:(i,n)=>{console.warn(`Sound '${i}' playback failure: ${n}`)}})}get whenToPlaySoundforSuccessfulRead(){return this.bPlaySoundOnSuccessfulRead===!0?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead=e!=="never"&&e}get whenToVibrateforSuccessfulRead(){return this.bVibrateOnSuccessfulRead===!0?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead=e!=="never"&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed||this._dce.disposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;j._onLog&&j._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const i=this._dceControler;i.register(this),i.setDisiredValue(this,"refreshInterval",200),i.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"});try{}catch(l){l.name==="ReferenceError"&&window&&(window.ResizeObserver=void 0)}const n=e.getUIElement(),o=this.dce.constructor;if(o._defaultUIElementURL==="@engineResourcePath/dce.ui.html")try{n?n===i._innerSetUI&&(await e.setUIElement(`${o.engineResourcePath}dce.ui.html`),i._innerSetUI=e.getUIElement()):(await e.setUIElement(`${o.engineResourcePath}dbr.ui.html`),i._innerSetUI=e.getUIElement())}catch{await e.setUIElement(o.defaultUIElementURL)}else n||await e.setUIElement(o.defaultUIElementURL);this.callbackCameraChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async l=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null);let d=await this._decode_DCEFrame(l,{bCopyData:!1}),_=null;if(d&&d.length){const{sx:S,sy:w,width:T,height:A,_sWidth:I,_sHeight:k}=l;_=d.map(P=>({localizationResult:JSON.parse(JSON.stringify(P.localizationResult))})),j.recalculateResultLocation(_,S,w,I,k,T,A)}if(this._drawResults(_,d),await this.clearMapDecodeRecord(),this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let S=this._cloneDecodeResults(d);this.onImageRead(S)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let S of d)this.onUniqueRead(S.barcodeText,this._cloneDecodeResults(S))},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(j._onLog&&j._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}async setImageSource(e,i){if(e==null)return this._imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this._imgSource=null;else{if(!j.isImageSource(e))throw new Error("Invalid value.");this._logoutDCEControler(),this._imgSource=e}i&&i.resultsHighlightBaseShapes&&(this._drawingItemNamespace=i.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:i,ls:n,sp:o,rmk:l}=(d=>{const _=d;if(_._pLoad.isEmpty){let S,w,T=_._license||"",A=JSON.parse(JSON.stringify(_._licenseServer)),I=_._sessionPassword,k=0;if(T.startsWith("t")||T.startsWith("f"))k=0;else if(T.length===0||T.startsWith("P")||T.startsWith("L")||T.startsWith("Y")||T.startsWith("A"))k=1;else{k=2;const P=T.indexOf(":");if(P!=-1&&(T=T.substring(P+1)),T.startsWith("DLS2")){let F;try{let z=T.substring(4);z=atob(z),F=JSON.parse(z)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(T=F.handshakeCode?F.handshakeCode:F.organizationID?F.organizationID:"",typeof T=="number"&&(T=JSON.stringify(T)),A.length===0){let z=[];F.mainServerURL&&(z[0]=F.mainServerURL),F.standbyServerURL&&(z[1]=F.standbyServerURL),A=Zc(z)}!I&&F.sessionPassword&&(I=F.sessionPassword),S=F.remark}(T==="200001"||T.startsWith("200001-"))&&(A&&A.length||(T="")),T||(k=1)}if(k&&(globalThis.crypto||(w="Please upgrade your browser to support online key."),globalThis.crypto.subtle||(w="Require https to use online key in this browser.")),w){if(k!==1)throw new Error(w);k=0,console.warn(w),_._lastErrorCode=-1,_._lastErrorString=w}return k===1&&(T="",console.warn("Applying for a public trial license ...")),{lt:k,l:T,ls:A,sp:I,rmk:S}}throw new Error("Can't preprocess license again"+Bn)})(j);this._pLoad.task=async(d,_)=>{let S=j.engineResourcePath+j._workerName;j.engineResourcePath.startsWith(location.origin)||(S=await fetch(S).then(w=>w.blob()).then(w=>URL.createObjectURL(w))),j._dbrWorker=new Worker(S),j._dbrWorker.onerror=w=>{let T=new Error(w.message);_(T)},j._dbrWorker.onmessage=async w=>{let T=w.data?w.data:w;switch(T.type){case"log":j._onLog&&j._onLog(T.message);break;case"load":{T.message&&(T.message=T.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let A,I=!1;e===1&&(I=!0,T.message||(T.message="Using a temporary license. [Register for a 30-day trial license >>>](https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&deploymenttype=browser)")),T.success?(j._dbrWorker.onerror=null,j._version=T.version+"(JS "+j._jsVersion+"."+j._jsEditVersion+")",j._onLog&&j._onLog("load dbr worker success"),T.message&&console.warn(T.message)):(A=new Error(T.message),A.stack=T.stack+`
`+A.stack,A.ltsErrorCode=T.ltsErrorCode,I||T.ltsErrorCode==111&&T.message.toLowerCase().indexOf("trial license")!=-1&&(I=!0)),I&&j.showDialog(T.success?"warn":"error",T.message),T.success?d():_(A);break}case"task":{let A=T.id,I=T.body;try{j._taskCallbackMap.get(A)(I),j._taskCallbackMap.delete(A)}catch(k){throw j._taskCallbackMap.delete(A),k}break}default:j._onLog&&j._onLog(w)}},j._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:j.engineResourcePath,bUseFullFeature:j._bUseFullFeature,bd:j._bWasmDebug,v:j._jsVersion,brtk:!!e,bptk:e===1,l:i,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:et,fn:j.deviceFriendlyName,ls:n,sp:o,rmk:l})}}await this._pLoad}static async showDialog(e,i){await(async(n,o,l)=>{if(!n._bNeverShowDialog)try{let d=await fetch(n.engineResourcePath+"dls.license.dialog.html");if(!d.ok)throw Error("Get license dialog fail. Network Error: "+d.statusText);let _=await d.text();if(!_.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let S=document.createElement("div");S.innerHTML=_;let w=[];for(let R=0;R<S.childElementCount;++R){let M=S.children[R];M instanceof HTMLStyleElement&&(w.push(M),document.head.append(M))}let T=S.childElementCount==1?S.children[0]:S;T.remove();let A,I,k,P,F,z=[T],D=T.children;for(let R of D)z.push(R);for(let R=0;R<z.length;++R)for(let M of z[R].children)z.push(M);for(let R of z)if(!A&&R.classList.contains("dls-license-mask"))A=R,R.addEventListener("click",M=>{if(R==M.target){T.remove();for(let $ of w)$.remove()}});else if(!I&&R.classList.contains("dls-license-icon-close"))I=R,R.addEventListener("click",()=>{T.remove();for(let M of w)M.remove()});else if(!k&&R.classList.contains("dls-license-icon-error"))k=R,o!="error"&&R.remove();else if(!P&&R.classList.contains("dls-license-icon-warn"))P=R,o!="warn"&&R.remove();else if(!F&&R.classList.contains("dls-license-msg-content")){F=R;let M=l;for(;M;){let $=M.indexOf("["),ie=M.indexOf("]",$),ne=M.indexOf("(",ie),q=M.indexOf(")",ne);if($==-1||ie==-1||ne==-1||q==-1){R.appendChild(new Text(M));break}$>0&&R.appendChild(new Text(M.substring(0,$)));let y=document.createElement("a"),pe=M.substring($+1,ie);y.innerText=pe;let fe=M.substring(ne+1,q);y.setAttribute("href",fe),y.setAttribute("target","_blank"),R.appendChild(y),M=M.substring(q+1)}}document.body.appendChild(T)}catch(d){n._onLog&&n._onLog(d.message||d)}})(this,e,i)}static async createInstanceInWorker(e=!1){return await j.loadWasm(),await new Promise((i,n)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,l=>{if(l.success)return i(l.instanceID);{let d=new Error(l.message);return d.stack=l.stack+`
`+d.stack,n(d)}}),j._dbrWorker.postMessage({type:"createInstance",id:o,bScanner:e})})}static async createInstance(){let e=new j;return e._instanceID=await j.createInstanceInWorker(),j._fireHTTPSWarnning(),e}async clearMapDecodeRecord(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success)return e();{let l=new Error(o.message);return l.stack=o.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:n,instanceID:this._instanceID})})}async decode(e){j._onLog&&j._onLog("decode(source: any)"),j._onLog&&(this._timeStartDecode=Date.now());{let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?await this._decode_Blob(e,i):e instanceof ArrayBuffer?await this._decode_ArrayBuffer(e,i):e instanceof Uint8Array||e instanceof Uint8ClampedArray?await this._decode_Uint8Array(e,i):e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?await this._decode_Image(e,i):e instanceof HTMLCanvasElement?await this._decode_Canvas(e,i):e instanceof HTMLVideoElement?await this._decode_Video(e,i):typeof e=="string"?e.substring(0,11)=="data:image/"?await this._decode_Base64(e,i):await this._decode_Url(e,i):j.isDCEFrame(e)?(i.bCopyData=!0,await this._decode_DCEFrame(e,i)):j.isDSImage(e)?(i.bCopyData=!0,await this._decode_DSImage(e,i)):await Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}async decodeBase64String(e){let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,i)}async decodeUrl(e){let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,i)}async _decodeBuffer_Uint8Array(e,i,n,o,l,d,_){return await new Promise((S,w)=>{let T=j._nextTaskID++;j._taskCallbackMap.set(T,A=>{if(A.success){let I,k=j._onLog?Date.now():0;j._onLog&&j._onLog("worker return result: "+k),this._lastInnerDecodeDuration=A.duration;try{I=this._handleRetJsonString(A.decodeReturn)}catch(P){return w(P)}if(j._onLog){let P=Date.now();j._onLog("DBR getting message from worker timestamp: "+k),j._onLog("From DBR staring decoding to entering worker costs: "+(this._timeEnterInnerDBR-this._timeStartDecode)),j._onLog("From DBR entering worker to returning message from worker costs: "+(k-this._timeEnterInnerDBR)),j._onLog("Handling results from DBR worker costs: "+(P-k)),j._onLog("Total decoding image costs: "+(P-this._timeStartDecode))}return S(I)}{let I=new Error(A.message);return I.stack=A.stack+`
`+I.stack,w(I)}}),this._timeEnterInnerDBR=Date.now(),j._onLog&&j._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDBR),j._dbrWorker.postMessage({type:"decodeBuffer",id:T,instanceID:this._instanceID,body:{buffer:e,width:i,height:n,stride:o,format:l,orientation:d,config:_}},[e.buffer]),j._onLog&&_&&_.timeStamp&&j._onLog("Delay of decoding image: "+(this._timeEnterInnerDBR-_.timeStamp))})}async _decodeBuffer_Blob(e,i,n,o,l,d,_){j._onLog&&j._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const S=e.arrayBuffer?await e.arrayBuffer():await new Promise((w,T)=>{let A=new FileReader;A.readAsArrayBuffer(e),A.onload=()=>{w(A.result)},A.onerror=()=>{T(A.error)}});return await this._decodeBuffer_Uint8Array(new Uint8Array(S),i,n,o,l,d,_)}async decodeBuffer(e,i,n,o,l,d,_){let S;return j._onLog&&j._onLog("decodeBuffer(buffer,width,height,stride,format)"),j._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?S=await this._decodeBuffer_Uint8Array(e,i,n,o,l,d,_):e instanceof ArrayBuffer?S=await this._decodeBuffer_Uint8Array(new Uint8Array(e),i,n,o,l,d,_):e instanceof Blob&&(S=await this._decodeBuffer_Blob(e,i,n,o,l,d,_)),S}async _decodeFileInMemory_Uint8Array(e){return await new Promise((i,n)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,l=>{if(l.success){let d;this._lastInnerDecodeDuration=l.duration;try{d=this._handleRetJsonString(l.decodeReturn)}catch(_){return n(_)}return i(d)}{let d=new Error(l.message);return d.stack=l.stack+`
`+d.stack,n(d)}}),j._dbrWorker.postMessage({type:"decodeFileInMemory",id:o,instanceID:this._instanceID,body:{bytes:e}})})}async getRuntimeSettings(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success){let l=JSON.parse(o.results);return this.userDefinedRegion!=null&&(l.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(l)}{let l=new Error(o.message);return l.stack=o.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"getRuntimeSettings",id:n,instanceID:this._instanceID})})}async updateRuntimeSettings(e){let i;if(typeof e=="string")if(e=="speed"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0]}else if(e=="balance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0]}else if(e=="coverage"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region}else if(e=="dense"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=9,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else if(e=="distance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else i=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let n=i.region;[n.regionLeft,n.regionTop,n.regionLeft,n.regionBottom,n.regionMeasuredByPercentage].some(o=>o!==void 0)&&(i.region={regionLeft:n.regionLeft||0,regionTop:n.regionTop||0,regionRight:n.regionRight||0,regionBottom:n.regionBottom||0,regionMeasuredByPercentage:n.regionMeasuredByPercentage||0})}}if(!j._bUseFullFeature){if(i.barcodeFormatIds&~(pt.BF_ONED|pt.BF_QR_CODE|pt.BF_PDF417|pt.BF_DATAMATRIX)||i.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(i.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let n=i.region;if(n instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(n)),(n.regionLeft||n.regionTop||n.regionRight||n.regionBottom||n.regionMeasuredByPercentage)&&(n.regionLeft||n.regionTop||n.regionRight!=100||n.regionBottom!=100||!n.regionMeasuredByPercentage)?this.region=n:this.region=null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return(this.autoZoom||this.autoFocus)&&(i.intermediateResultTypes|=wn.IRT_TYPED_BARCODE_ZONE),await new Promise((n,o)=>{let l=j._nextTaskID++;j._taskCallbackMap.set(l,d=>{if(d.success){try{this._handleRetJsonString(d.updateReturn)}catch(_){o(_)}return n()}{let _=new Error(d.message);return _.stack=d.stack+`
`+_.stack,o(_)}}),j._dbrWorker.postMessage({type:"updateRuntimeSettings",id:l,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})})}async resetRuntimeSettings(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=Oo,await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success)return e();{let l=new Error(o.message);return l.stack=o.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"resetRuntimeSettings",id:n,instanceID:this._instanceID})})}async _resetRuntimeSettingsToCppDefault(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=Oo,await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success)return e();{let l=new Error(o.message);return l.stack=o.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"resetRuntimeSettingsToCppDefault",id:n,instanceID:this._instanceID})})}async outputRuntimeSettingsToString(){if(!j._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success)return e(o.results);{let l=new Error(o.message);return l.stack=o.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:n,instanceID:this._instanceID})})}async initRuntimeSettingsWithString(e){if(!j._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if(typeof e=="string")e=e;else{if(typeof e!="object")throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise((i,n)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,l=>{if(l.success){try{this._handleRetJsonString(l.initReturn)}catch(d){n(d)}return i()}{let d=new Error(l.message);return d.stack=l.stack+`
`+d.stack,n(d)}}),j._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:o,instanceID:this._instanceID,body:{settings:e}})})}async _decode_Blob(e,i){j._onLog&&j._onLog("_decode_Blob(blob: Blob)");let n=null,o=null;if(typeof createImageBitmap<"u")try{n=await createImageBitmap(e)}catch{}n||(o=await function(d){return new Promise((_,S)=>{let w=URL.createObjectURL(d),T=new Image;T.dbrObjUrl=w,T.src=w,T.onload=()=>{_(T)},T.onerror=A=>{S(new Error("Can't convert blob to image : "+(A instanceof Event?A.type:A)))}})}(e));let l=await this._decode_Image(n||o,i);return n&&n.close(),l}async _decode_ArrayBuffer(e,i){return await this._decode_Blob(new Blob([e]),i)}async _decode_Uint8Array(e,i){return await this._decode_Blob(new Blob([e]),i)}async _decode_Image(e,i){j._onLog&&j._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),i=i||{};let n,o,l=e instanceof HTMLImageElement?e.naturalWidth:e.width,d=e instanceof HTMLImageElement?e.naturalHeight:e.height,_=Math.max(l,d);if(_>this._maxCvsSideLength){let w=this._maxCvsSideLength/_;n=Math.round(l*w),o=Math.round(d*w)}else n=l,o=d;this.canvas||(this.canvas=document.createElement("canvas"));const S=this.canvas;return S.width===n&&S.height===o||(S.width=n,S.height=o),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(e,0,0,l,d,0,0,n,o),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._decode_Canvas(S,i)}async _decode_Canvas(e,i){if(j._onLog&&j._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if(e.width===0||e.height===0)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let n=(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data;return await this._decodeBuffer_Uint8Array(n,e.width,e.height,4*e.width,De.IPF_ABGR_8888,0,i)}async _decode_Video(e,i){if(j._onLog&&j._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";i=i||{};let n,o,l=e.videoWidth,d=e.videoHeight,_=Math.max(l,d);if(_>this._maxCvsSideLength){let w=this._maxCvsSideLength/_;n=Math.round(l*w),o=Math.round(d*w)}else n=l,o=d;this.canvas||(this.canvas=document.createElement("canvas"));const S=this.canvas;return S.width===n&&S.height===o||(S.width=n,S.height=o),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(e,0,0,l,d,0,0,n,o),await this._decode_Canvas(S,i)}async _decode_DCEFrame(e,i){if(j._onLog&&j._onLog("_decode_DCEFrame(dceFrame)"),!j.isDCEFrame(e))return[];let n=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:o,height:l,colorMode:d,pixelFormat:_,stride:S,timeStamp:w}=e;let T;T=i&&i.bCopyData?new Uint8Array(e.data):e.data;let A=null;if(i?(A=JSON.parse(JSON.stringify(i)),A.timeStamp=w):A={timeStamp:w},_&&S)if(_==="grey")n=await this._decodeBuffer_Uint8Array(T,o,l,S,De.IPF_GrayScaled,0,A);else if(_==="rgba")n=await this._decodeBuffer_Uint8Array(T,o,l,S,De.IPF_ABGR_8888,0,A);else{if(_!=="bgra")throw new Error(`Pixel format '${_}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(T,o,l,S,De.IPF_ARGB_8888,0,A)}else if(d==="grey")n=await this._decodeBuffer_Uint8Array(T,o,l,o,De.IPF_GrayScaled,0,A);else if(d==="rgba")n=await this._decodeBuffer_Uint8Array(T,o,l,4*o,De.IPF_ABGR_8888,0,A);else{if(d!=="bgra")throw new Error(`Color mode '${d}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(T,o,l,4*o,De.IPF_ARGB_8888,0,A)}return n}async _decode_DSImage(e,i){if(j._onLog&&j._onLog("_decode_DSImage(dsImage)"),!j.isDSImage(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const w=document.createElement("canvas");let T;switch(w.width=this.width,w.height=this.height,this.pixelFormat){case"grey":T=new Uint8ClampedArray(this.width*this.height*4);for(let I=0;I<T.length;I+=4)T[I]=this.data[I/4],T[I+1]=this.data[I/4],T[I+2]=this.data[I/4],T[I+3]=255;break;case"rgb":T=new Uint8ClampedArray(this.width*this.height*4);for(let I=0;I<T.length;I+=4)T[I]=this.data[I],T[I+1]=this.data[I+1],T[I+2]=this.data[I+2],T[I+3]=255;break;case"bgr":T=new Uint8ClampedArray(this.width*this.height*4);for(let I=0;I<T.length;I+=4)T[I]=this.data[I],T[I+1]=this.data[I+1],T[I+2]=this.data[I+2],T[I+3]=255;break;case"rgba":case"bgra":T=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const A=new ImageData(T,this.width,this.height);return w.getContext("2d").putImageData(A,0,0),w}});const{width:n,height:o}=e;let l,d,_,S=e.pixelFormat.toLowerCase();switch(l=i&&i.bCopyData?new Uint8Array(e.data):e.data,S){case"grey":_=De.IPF_GrayScaled,d=n;break;case"rgb":_=De.IPF_BGR_888,d=3*n;break;case"bgr":_=De.IPF_RGB_888,d=3*n;break;case"rgba":_=De.IPF_ABGR_8888,d=4*n;break;case"bgra":_=De.IPF_ARGB_8888,d=4*n;break;default:throw new Error("The pixel format is not supported to decode.")}return await this._decodeBuffer_Uint8Array(l,n,o,d,_,0,i)}async _decode_Base64(e,i){if(j._onLog&&j._onLog("_decode_Base64(base64Str)"),typeof e!="string")return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");e.substring(0,11)=="data:image/"&&(e=e.substring(e.indexOf(",")+1));{let n=atob(e),o=n.length,l=new Uint8Array(o);for(;o--;)l[o]=n.charCodeAt(o);return await this._decode_Blob(new Blob([l]),i)}}async _decode_Url(e,i){if(j._onLog&&j._onLog("_decode_Url(url)"),typeof e!="string")throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");e=e;{let n=await new Promise((o,l)=>{let d=new XMLHttpRequest;d.open("GET",e,!0),d.responseType="blob",d.send(),d.onloadend=async()=>{o(d.response)},d.onerror=()=>{l(new Error("Network Error: "+d.statusText))}});return await this._decode_Blob(n,i)}}async _decode_FilePath(e,i){throw j._onLog&&j._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")}static recalculateResultLocation(e,i,n,o,l,d,_){if(e.length>0)for(let S of e){let w=S.localizationResult;w.resultCoordinateType==2&&(w.x1*=.01*d,w.x2*=.01*d,w.x3*=.01*d,w.x4*=.01*d,w.y1*=.01*_,w.y2*=.01*_,w.y3*=.01*_,w.y4*=.01*_);let T=d/o,A=_/l;w.x1=w.x1/T+i,w.x2=w.x2/T+i,w.x3=w.x3/T+i,w.x4=w.x4/T+i,w.y1=w.y1/A+n,w.y2=w.y2/A+n,w.y3=w.y3/A+n,w.y4=w.y4/A+n,w.resultCoordinateType==2&&(w.x1*=100/o,w.x2*=100/o,w.x3*=100/o,w.x4*=100/o,w.y1*=100/l,w.y2*=100/l,w.y3*=100/l,w.y4*=100/l)}}static BarcodeReaderException(e,i){let n,o=As.DBR_UNKNOWN;return typeof e=="number"?(o=e,n=new Error(i)):n=new Error(e),n.code=o,n}_handleRetJsonString(e){let i=As;if(e.textResults){for(let n=0;n<e.textResults.length;n++){let o=e.textResults[n];try{let l=o.barcodeText,d="";for(let _=0;_<l.length;_++)d+=String.fromCharCode(l[_]);try{o.barcodeText=decodeURIComponent(escape(d))}catch{o.barcodeText=d}}catch{o.barcodeText=""}if(o.exception!=null){j._setWarnnedEx.has(o.exception)||(j._setWarnnedEx.add(o.exception),console.warn(o.exception));let l={};o.exception.split(";").forEach(d=>{let _=d.indexOf(":");l[d.substring(0,_)]=d.substring(_+1)}),o.exception=l}}return e.decodeRecords?this.decodeRecords=e.decodeRecords:this.decodeRecords={},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!j._setWarnnedEx.has(e.description)&&(j._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==i.DBR_SUCCESS)return e.data;throw j.BarcodeReaderException(e.exception,e.description)}async setModeArgument(e,i,n,o){return await new Promise((l,d)=>{let _=j._nextTaskID++;j._taskCallbackMap.set(_,S=>{if(S.success){try{this._handleRetJsonString(S.setReturn)}catch(w){return d(w)}return l()}{let w=new Error(S.message);return w.stack=S.stack+`
`+w.stack,d(w)}}),j._dbrWorker.postMessage({type:"setModeArgument",id:_,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:n,argumentValue:o}})})}async getModeArgument(e,i,n){return await new Promise((o,l)=>{let d=j._nextTaskID++;j._taskCallbackMap.set(d,_=>{if(_.success){let S;try{S=this._handleRetJsonString(_.getReturn)}catch(w){return l(w)}return o(S)}{let S=new Error(_.message);return S.stack=_.stack+`
`+S.stack,l(S)}}),j._dbrWorker.postMessage({type:"getModeArgument",id:d,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:n}})})}async getIntermediateResults(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success)return e(o.results);{let l=new Error(o.message);return l.stack=o.stack+`
`+l.stack,i(l)}}),j._dbrWorker.postMessage({type:"getIntermediateResults",id:n,instanceID:this._instanceID})})}async getIntermediateCanvas(){let e=await this.getIntermediateResults(),i=[];for(let n of e)if(n.dataType==Ia.IMRDT_IMAGE)for(let o of n.results){const l=o.bytes;let d;switch(j._onLog&&j._onLog(" "+l.length+" "+l.byteLength+" "+o.width+" "+o.height+" "+o.stride+" "+o.format),o.format){case De.IPF_ABGR_8888:d=new Uint8ClampedArray(l);break;case De.IPF_RGB_888:{const w=l.length/3;d=new Uint8ClampedArray(4*w);for(let T=0;T<w;++T)d[4*T]=l[3*T+2],d[4*T+1]=l[3*T+1],d[4*T+2]=l[3*T],d[4*T+3]=255;break}case De.IPF_GrayScaled:{const w=l.length;d=new Uint8ClampedArray(4*w);for(let T=0;T<w;T++)d[4*T]=d[4*T+1]=d[4*T+2]=l[T],d[4*T+3]=255;break}case De.IPF_Binary:case De.IPF_BinaryInverted:{const w=l.length,T=o.width,A=o.height,I=o.stride;d=new Uint8ClampedArray(T*A*4);for(let k=0;k<w;k++){let P=l[k],F=k%I*8,z=Math.floor(k/I);for(let D=0;D<8;D++){let R=F+D,M=4*(z*T+R);if(R>=T)break;d[M]=d[M+1]=d[M+2]=(128&P)/128*255,d[M+3]=255,P<<=1}}break}default:console.warn("unknow intermediate image",o)}if(!d)continue;let _=new ImageData(d,o.width,o.height),S=document.createElement("canvas");S.width=o.width,S.height=o.height,S.getContext("2d").putImageData(_,0,0),i.push(S)}return i}async getScanSettings(){return await new Promise((e,i)=>{let n=j._nextTaskID++;j._taskCallbackMap.set(n,o=>{if(o.success){let l=o.results;return l.intervalTime=this.intervalTime,l.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,l.soundOnSuccessfullRead=this.soundSource,l.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,l.vibrateDuration=this.vibrateDuration,l.captureAndDecodeInParallel=this.captureAndDecodeInParallel,l.autoZoom=this.autoZoom,l.autoFocus=this.autoFocus,l.autoSuggestTip=this.autoSuggestTip,e(l)}{let l=new Error(o.message);return l.stack+=`
`+o.stack,i(l)}}),j._dbrWorker.postMessage({type:"getScanSettings",id:n,instanceID:this._instanceID})})}async updateScanSettings(e){if(!e)return;const i=JSON.parse(JSON.stringify(e));if(i.autoZoom||i.autoFocus||i.autoSuggestTip){if(!j._bUseFullFeature)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported in the compact version. Please try the full-featured version.");const n=await this.getRuntimeSettings();n.intermediateResultTypes|=wn.IRT_TYPED_BARCODE_ZONE,await this.updateRuntimeSettings(n)}return i.hasOwnProperty("intervalTime")&&(this.intervalTime=Math.max(i.intervalTime,0),delete i.intervalTime),i.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=i.whenToPlaySoundforSuccessfulRead,delete i.whenToPlaySoundforSuccessfulRead),i.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=i.soundOnSuccessfullRead,delete i.soundOnSuccessfullRead),i.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=i.whenToVibrateforSuccessfulRead,delete i.whenToVibrateforSuccessfulRead),i.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=i.vibrateDuration,delete i.vibrateDuration),i.hasOwnProperty("captureAndDecodeInParallel")&&(this.captureAndDecodeInParallel=i.captureAndDecodeInParallel,delete i.captureAndDecodeInParallel),i.hasOwnProperty("autoZoom")&&(this.autoZoom&&this.autoZoom!=i.autoZoom&&this.dce&&this.dce.setZoom({factor:1}).catch(()=>{}),this.autoZoom=i.autoZoom,delete i.autoZoom),i.hasOwnProperty("autoFocus")&&(this.autoFocus=i.autoFocus,this.dce&&this.dce.setFocus({mode:"continuous"}).catch(()=>{}),delete i.autoFocus),i.hasOwnProperty("autoSuggestTip")&&(this.autoSuggestTip=i.autoSuggestTip,delete i.autoFocus),await new Promise((n,o)=>{let l=j._nextTaskID++;j._taskCallbackMap.set(l,d=>{if(d.success)return n();{let _=new Error(d.message);return _.stack+=`
`+d.stack,o(_)}}),j._dbrWorker.postMessage({type:"updateScanSettings",id:l,instanceID:this._instanceID,body:{settings:i}})})}_cloneDecodeResults(e){if(e instanceof Array){let i=[];for(let n of e)i.push(this._cloneDecodeResults(n));return i}{let i=e;return JSON.parse(JSON.stringify(i,(o,l)=>o=="oriVideoCanvas"||o=="searchRegionCanvas"?void 0:l))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this._imgSource||this._bPauseScan)return j._onLog&&j._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));j._onLog&&j._onLog("======= once read ======="),j._onLog&&(this._timeStartDecode=Date.now());let e=null,i=null;if(this.dce)e=this._getVideoFrame();else if(this._imgSource&&(i=await this._imgSource.getImage(),!j.isDSImage(i)))throw new Error("Invalid DSImage.");if(!e&&!i)return j._onLog&&j._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{let n=[];if(e){n=await this._decode_DCEFrame(e,{bScanner:!0,bCopyData:!1});let o=null;if(n&&n.length){const{sx:l,sy:d,width:_,height:S,_sWidth:w,_sHeight:T}=e;o=n.map(A=>({resultState:A.resultState,localizationResult:JSON.parse(JSON.stringify(A.localizationResult))})),j.recalculateResultLocation(o,l,d,w,T,_,S)}this._resultHighlightingDuration==0?this._drawResults(null):this._drawResults(o,n),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout(()=>{this.bDestroyed||this._drawResults(null)},this._resultHighlightingDuration))}else i&&(n=await this._decode_DSImage(i,{bScanner:!0,bCopyData:!1}));return n})().then(n=>{if(j._onLog&&j._onLog(n),this.dce&&this.captureAndDecodeInParallel){let o=this.array_decodeFrameTimeCost,l=this.array_getFrameTimeCost;const d=()=>{let _=0;if(l&&l.length){let S=Math.min(...o),w=Math.max(...l);S&&w&&(_=S-w)}else _=0;return _>0?_:0};(()=>{for(;o.length>=5;)o.shift();o.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=d()+this.intervalTime}if((this.dce&&this.dce.isOpen()||this._imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&n.length){let o=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?o=n.some(l=>l.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(o=n.some(l=>l.resultState==0)),o&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&n.length){let o=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?o=n.some(l=>l.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(o=n.some(l=>l.resultState==0)),o)try{navigator.vibrate(this.vibrateDuration)}catch(l){console.warn("Vibration not allowed. User interaction required: "+(l.message||l))}}if(this.onImageRead){n=n.filter(l=>l.resultState>=0);const o=this._cloneDecodeResults(n);this.onImageRead(o)}if(this.onUniqueRead){n=n.filter(l=>l.resultState==0);const o=this._cloneDecodeResults(n);for(let l of o)this.onUniqueRead(l.barcodeText,l)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()}).catch(n=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),j._onLog&&j._onLog(n.message||n),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},Math.max(this.intervalTime,1e3)),n.message=="platform error"||console.warn(n.message)})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){if(j._onLog&&j._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer(),(n=>{if(!n)return;let o=n.timeSpent,l=this.array_getFrameTimeCost;for(;l.length>=5;)l.shift();l.push(o)})(e)}else j._onLog&&j._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e,i){if(!this.dce||this.dce.disposed||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dbrDrawingLayer){if(!this.dce.isOpen()||!(this.dce.singleFrameMode||this.dce.video&&this.dce._videoTrack))return;this._dbrDrawingLayer=this.dce.getDrawingLayer(3)}const n=this._dbrDrawingLayer;e||(e=[]);let o=this._arrPolygons;for(let l=0;l<e.length;l++){let d,_=e[l].localizationResult;o[l]?(d=o[l],n.hasDrawingItem(d)||n.addDrawingItem(d),d.set("vertices",[{x:_.x1,y:_.y1},{x:_.x2,y:_.y2},{x:_.x3,y:_.y3},{x:_.x4,y:_.y4}]),(d.set||d.setAttribute).call(d,"vertices",[{x:_.x1,y:_.y1},{x:_.x2,y:_.y2},{x:_.x3,y:_.y3},{x:_.x4,y:_.y4}])):(d=new this._drawingItemNamespace.DT_Polygon([{x:_.x1,y:_.y1},{x:_.x2,y:_.y2},{x:_.x3,y:_.y3},{x:_.x4,y:_.y4}]),n.addDrawingItem(d),o[l]=d),e[l].resultState===-1?(d.styleId=this._styleIdBeforeVerification,d._mapStyle.set("default",this.dce.getDrawingStyle(this._styleIdBeforeVerification)),d._mapStyle.set("selected",this.dce.getDrawingStyle(this._styleIdBeforeVerification))):(d.styleId=null,d._mapStyle.set("default",this.dce.getDrawingStyle(3)),d._mapStyle.set("selected",this.dce.getDrawingStyle(7))),i&&i[l]?d.addNote({name:"Barcode_Result",content:i[l]},!0):d.addNote({name:"Barcode_Result",content:e[l]},!0)}for(let l=e.length;l<o.length;l++)o[l].deleteNote("Barcode_Result"),n.removeDrawingItem(o[l]);n.renderAll()}async startScanning(e){if(!this.dce&&!this._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new Hd;let i=null;if(this.dce){if(this.dce.isOpen())if(e&&this.dce.appendAndShowUI(),this.dce.playCallbackInfo)i=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else{const n=this.dce.getSelectedCamera();i={width:this.dce.video.videoWidth,height:this.dce.video.videoHeight,deviceId:n&&n.deviceId}}else if(i=await this.dce.open(e),!this._promiseStartScan)return null;this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},0)),this._promiseStartScan.resolve(i),i}stopScanning(e){this.dce&&(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.clearUserDisiredValue({property:"ifShowScanRegionLaser"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(j._onLog&&j._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,!this.dce&&this._promiseStartScan||this.stopScanning(),this.setImageSource(null);let e=j._nextTaskID++;j._taskCallbackMap.set(e,i=>{if(!i.success){let n=new Error(i.message);throw n.stack=i.stack+`
`+n.stack,n}}),j._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}j._jsVersion="9.6.10",j._jsEditVersion="20230213",j._version=`loading...(JS ${j._jsVersion}.${j._jsEditVersion})`,j._license=cm,j._sessionPassword=um,j.browserInfo=et,j._workerName=`dbr-${j._jsVersion}.browser.worker.js`,j._engineResourcePath=lm,j._licenseServer=[],j._deviceFriendlyName="",j._isShowRelDecodeTimeInResults=!1,j._bWasmDebug=!1,j._bNeverShowDialog=!1,j.__bUseFullFeature=!0,j._nextTaskID=0,j._taskCallbackMap=new Map,j._pLoad=new Hd,j._lastErrorCode=0,j._lastErrorString="",j._setWarnnedEx=new Set,j._defaultUIElementURL="@engineResourcePath/dbr.ui.html";var hm={653:(t,e,i)=>{var n,o,l,d,_,S,w,T,A,I,k,P,F,z,D,R,M,$,ie,ne,q,y=y||{version:"5.2.1"};if(e.fabric=y,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?y.document=document:y.document=document.implementation.createHTMLDocument(""),y.window=window;else{var pe=new(i(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;y.document=pe.document,y.jsdomImplForWrapper=i(898).implForWrapper,y.nodeCanvas=i(245).Canvas,y.window=pe,DOMParser=y.window.DOMParser}function fe(u,a){var c=u.canvas,f=a.targetCanvas,r=f.getContext("2d");r.translate(0,f.height),r.scale(1,-1);var s=c.height-f.height;r.drawImage(c,0,s,f.width,f.height,0,0,f.width,f.height)}function Ce(u,a){var c=a.targetCanvas.getContext("2d"),f=a.destinationWidth,r=a.destinationHeight,s=f*r*4,h=new Uint8Array(this.imageBuffer,0,s),m=new Uint8ClampedArray(this.imageBuffer,0,s);u.readPixels(0,0,f,r,u.RGBA,u.UNSIGNED_BYTE,h);var g=new ImageData(m,f,r);c.putImageData(g,0,0)}y.isTouchSupported="ontouchstart"in y.window||"ontouchstart"in y.document||y.window&&y.window.navigator&&y.window.navigator.maxTouchPoints>0,y.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",y.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],y.DPI=96,y.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",y.commaWsp="(?:\\s+,?\\s*|,\\s*)",y.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,y.reNonWord=/[ \n\.,;!\?\-]/,y.fontPaths={},y.iMatrix=[1,0,0,1,0,0],y.svgNS="http://www.w3.org/2000/svg",y.perfLimitSizeTotal=2097152,y.maxCacheSideLimit=4096,y.minCacheSideLimit=256,y.charWidthsCache={},y.textureSize=2048,y.disableStyleCopyPaste=!1,y.enableGLFiltering=!0,y.devicePixelRatio=y.window.devicePixelRatio||y.window.webkitDevicePixelRatio||y.window.mozDevicePixelRatio||1,y.browserShadowBlurConstant=1,y.arcToSegmentsCache={},y.boundsOfCurveCache={},y.cachesBoundsOfCurve=!0,y.forceGLPutImageData=!1,y.initFilterBackend=function(){return y.enableGLFiltering&&y.isWebglSupported&&y.isWebglSupported(y.textureSize)?(console.log("max texture size: "+y.maxTextureSize),new y.WebglFilterBackend({tileSize:y.textureSize})):y.Canvas2dFilterBackend?new y.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=y),function(){function u(c,f){if(this.__eventListeners[c]){var r=this.__eventListeners[c];f?r[r.indexOf(f)]=!1:y.util.array.fill(r,!1)}}function a(c,f){var r=function(){f.apply(this,arguments),this.off(c,r)}.bind(this);this.on(c,r)}y.Observable={fire:function(c,f){if(!this.__eventListeners)return this;var r=this.__eventListeners[c];if(!r)return this;for(var s=0,h=r.length;s<h;s++)r[s]&&r[s].call(this,f||{});return this.__eventListeners[c]=r.filter(function(m){return m!==!1}),this},on:function(c,f){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var r in c)this.on(r,c[r]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(f);return this},once:function(c,f){if(arguments.length===1)for(var r in c)a.call(this,r,c[r]);else a.call(this,c,f);return this},off:function(c,f){if(!this.__eventListeners)return this;if(arguments.length===0)for(c in this.__eventListeners)u.call(this,c);else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in c)u.call(this,r,c[r]);else u.call(this,c,f);return this}}}(),y.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var u=0,a=arguments.length;u<a;u++)this._onObjectAdded(arguments[u]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(u,a,c){var f=this._objects;return c?f[a]=u:f.splice(a,0,u),this._onObjectAdded&&this._onObjectAdded(u),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var u,a=this._objects,c=!1,f=0,r=arguments.length;f<r;f++)(u=a.indexOf(arguments[f]))!==-1&&(c=!0,a.splice(u,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[f]));return this.renderOnAddRemove&&c&&this.requestRenderAll(),this},forEachObject:function(u,a){for(var c=this.getObjects(),f=0,r=c.length;f<r;f++)u.call(a,c[f],f,c);return this},getObjects:function(u){return u===void 0?this._objects.concat():this._objects.filter(function(a){return a.type===u})},item:function(u){return this._objects[u]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(u,a){return this._objects.indexOf(u)>-1||!!a&&this._objects.some(function(c){return typeof c.contains=="function"&&c.contains(u,!0)})},complexity:function(){return this._objects.reduce(function(u,a){return u+(a.complexity?a.complexity():0)},0)}},y.CommonMethods={_setOptions:function(u){for(var a in u)this.set(a,u[a])},_initGradient:function(u,a){!u||!u.colorStops||u instanceof y.Gradient||this.set(a,new y.Gradient(u))},_initPattern:function(u,a,c){!u||!u.source||u instanceof y.Pattern?c&&c():this.set(a,new y.Pattern(u,c))},_setObject:function(u){for(var a in u)this._set(a,u[a])},set:function(u,a){return typeof u=="object"?this._setObject(u):this._set(u,a),this},_set:function(u,a){this[u]=a},toggle:function(u){var a=this.get(u);return typeof a=="boolean"&&this.set(u,!a),this},get:function(u){return this[u]}},n=e,o=Math.sqrt,l=Math.atan2,d=Math.pow,_=Math.PI/180,S=Math.PI/2,y.util={cos:function(u){if(u===0)return 1;switch(u<0&&(u=-u),u/S){case 1:case 3:return 0;case 2:return-1}return Math.cos(u)},sin:function(u){if(u===0)return 0;var a=1;switch(u<0&&(a=-1),u/S){case 1:return a;case 2:return 0;case 3:return-a}return Math.sin(u)},removeFromArray:function(u,a){var c=u.indexOf(a);return c!==-1&&u.splice(c,1),u},getRandomInt:function(u,a){return Math.floor(Math.random()*(a-u+1))+u},degreesToRadians:function(u){return u*_},radiansToDegrees:function(u){return u/_},rotatePoint:function(u,a,c){var f=new y.Point(u.x-a.x,u.y-a.y),r=y.util.rotateVector(f,c);return new y.Point(r.x,r.y).addEquals(a)},rotateVector:function(u,a){var c=y.util.sin(a),f=y.util.cos(a);return{x:u.x*f-u.y*c,y:u.x*c+u.y*f}},createVector:function(u,a){return new y.Point(a.x-u.x,a.y-u.y)},calcAngleBetweenVectors:function(u,a){return Math.acos((u.x*a.x+u.y*a.y)/(Math.hypot(u.x,u.y)*Math.hypot(a.x,a.y)))},getHatVector:function(u){return new y.Point(u.x,u.y).multiply(1/Math.hypot(u.x,u.y))},getBisector:function(u,a,c){var f=y.util.createVector(u,a),r=y.util.createVector(u,c),s=y.util.calcAngleBetweenVectors(f,r),h=s*(y.util.calcAngleBetweenVectors(y.util.rotateVector(f,s),r)===0?1:-1)/2;return{vector:y.util.getHatVector(y.util.rotateVector(f,h)),angle:s}},projectStrokeOnPoints:function(u,a,c){var f=[],r=a.strokeWidth/2,s=a.strokeUniform?new y.Point(1/a.scaleX,1/a.scaleY):new y.Point(1,1),h=function(m){var g=r/Math.hypot(m.x,m.y);return new y.Point(m.x*g*s.x,m.y*g*s.y)};return u.length<=1||u.forEach(function(m,g){var p,v,C=new y.Point(m.x,m.y);g===0?(v=u[g+1],p=c?h(y.util.createVector(v,C)).addEquals(C):u[u.length-1]):g===u.length-1?(p=u[g-1],v=c?h(y.util.createVector(p,C)).addEquals(C):u[0]):(p=u[g-1],v=u[g+1]);var x,b,E=y.util.getBisector(C,p,v),O=E.vector,L=E.angle;if(a.strokeLineJoin==="miter"&&(x=-r/Math.sin(L/2),b=new y.Point(O.x*x*s.x,O.y*x*s.y),Math.hypot(b.x,b.y)/r<=a.strokeMiterLimit))return f.push(C.add(b)),void f.push(C.subtract(b));x=-r*Math.SQRT2,b=new y.Point(O.x*x*s.x,O.y*x*s.y),f.push(C.add(b)),f.push(C.subtract(b))}),f},transformPoint:function(u,a,c){return c?new y.Point(a[0]*u.x+a[2]*u.y,a[1]*u.x+a[3]*u.y):new y.Point(a[0]*u.x+a[2]*u.y+a[4],a[1]*u.x+a[3]*u.y+a[5])},makeBoundingBoxFromPoints:function(u,a){if(a)for(var c=0;c<u.length;c++)u[c]=y.util.transformPoint(u[c],a);var f=[u[0].x,u[1].x,u[2].x,u[3].x],r=y.util.array.min(f),s=y.util.array.max(f)-r,h=[u[0].y,u[1].y,u[2].y,u[3].y],m=y.util.array.min(h);return{left:r,top:m,width:s,height:y.util.array.max(h)-m}},invertTransform:function(u){var a=1/(u[0]*u[3]-u[1]*u[2]),c=[a*u[3],-a*u[1],-a*u[2],a*u[0]],f=y.util.transformPoint({x:u[4],y:u[5]},c,!0);return c[4]=-f.x,c[5]=-f.y,c},toFixed:function(u,a){return parseFloat(Number(u).toFixed(a))},parseUnit:function(u,a){var c=/\D{0,2}$/.exec(u),f=parseFloat(u);switch(a||(a=y.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return f*y.DPI/25.4;case"cm":return f*y.DPI/2.54;case"in":return f*y.DPI;case"pt":return f*y.DPI/72;case"pc":return f*y.DPI/72*12;case"em":return f*a;default:return f}},falseFunction:function(){return!1},getKlass:function(u,a){return u=y.util.string.camelize(u.charAt(0).toUpperCase()+u.slice(1)),y.util.resolveNamespace(a)[u]},getSvgAttributes:function(u){var a=["instantiated_by_use","style","id","class"];switch(u){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"])}return a},resolveNamespace:function(u){if(!u)return y;var a,c=u.split("."),f=c.length,r=n||y.window;for(a=0;a<f;++a)r=r[c[a]];return r},loadImage:function(u,a,c,f){if(u){var r=y.util.createImage(),s=function(){a&&a.call(c,r,!1),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){y.log("Error loading "+r.src),a&&a.call(c,null,!0),r=r.onload=r.onerror=null},u.indexOf("data")!==0&&f!=null&&(r.crossOrigin=f),u.substring(0,14)==="data:image/svg"&&(r.onload=null,y.util.loadImageInDom(r,s)),r.src=u}else a&&a.call(c,u)},loadImageInDom:function(u,a){var c=y.document.createElement("div");c.style.width=c.style.height="1px",c.style.left=c.style.top="-100%",c.style.position="absolute",c.appendChild(u),y.document.querySelector("body").appendChild(c),u.onload=function(){a(),c.parentNode.removeChild(c),c=null}},enlivenObjects:function(u,a,c,f){var r=[],s=0,h=(u=u||[]).length;function m(){++s===h&&a&&a(r.filter(function(g){return g}))}h?u.forEach(function(g,p){g&&g.type?y.util.getKlass(g.type,c).fromObject(g,function(v,C){C||(r[p]=v),f&&f(g,v,C),m()}):m()}):a&&a(r)},enlivenObjectEnlivables:function(u,a,c){var f=y.Object.ENLIVEN_PROPS.filter(function(r){return!!u[r]});y.util.enlivenObjects(f.map(function(r){return u[r]}),function(r){var s={};f.forEach(function(h,m){s[h]=r[m],a&&(a[h]=r[m])}),c&&c(s)})},enlivenPatterns:function(u,a){function c(){++r===s&&a&&a(f)}var f=[],r=0,s=(u=u||[]).length;s?u.forEach(function(h,m){h&&h.source?new y.Pattern(h,function(g){f[m]=g,c()}):(f[m]=h,c())}):a&&a(f)},groupSVGElements:function(u,a,c){var f;return u&&u.length===1?u[0]:(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),f=new y.Group(u,a),c!==void 0&&(f.sourcePath=c),f)},populateWithProperties:function(u,a,c){if(c&&Array.isArray(c))for(var f=0,r=c.length;f<r;f++)c[f]in u&&(a[c[f]]=u[c[f]])},createCanvasElement:function(){return y.document.createElement("canvas")},copyCanvasElement:function(u){var a=y.util.createCanvasElement();return a.width=u.width,a.height=u.height,a.getContext("2d").drawImage(u,0,0),a},toDataURL:function(u,a,c){return u.toDataURL("image/"+a,c)},createImage:function(){return y.document.createElement("img")},multiplyTransformMatrices:function(u,a,c){return[u[0]*a[0]+u[2]*a[1],u[1]*a[0]+u[3]*a[1],u[0]*a[2]+u[2]*a[3],u[1]*a[2]+u[3]*a[3],c?0:u[0]*a[4]+u[2]*a[5]+u[4],c?0:u[1]*a[4]+u[3]*a[5]+u[5]]},qrDecompose:function(u){var a=l(u[1],u[0]),c=d(u[0],2)+d(u[1],2),f=o(c),r=(u[0]*u[3]-u[2]*u[1])/f,s=l(u[0]*u[2]+u[1]*u[3],c);return{angle:a/_,scaleX:f,scaleY:r,skewX:s/_,skewY:0,translateX:u[4],translateY:u[5]}},calcRotateMatrix:function(u){if(!u.angle)return y.iMatrix.concat();var a=y.util.degreesToRadians(u.angle),c=y.util.cos(a),f=y.util.sin(a);return[c,f,-f,c,0,0]},calcDimensionsMatrix:function(u){var a=u.scaleX===void 0?1:u.scaleX,c=u.scaleY===void 0?1:u.scaleY,f=[u.flipX?-a:a,0,0,u.flipY?-c:c,0,0],r=y.util.multiplyTransformMatrices,s=y.util.degreesToRadians;return u.skewX&&(f=r(f,[1,0,Math.tan(s(u.skewX)),1],!0)),u.skewY&&(f=r(f,[1,Math.tan(s(u.skewY)),0,1],!0)),f},composeMatrix:function(u){var a=[1,0,0,1,u.translateX||0,u.translateY||0],c=y.util.multiplyTransformMatrices;return u.angle&&(a=c(a,y.util.calcRotateMatrix(u))),(u.scaleX!==1||u.scaleY!==1||u.skewX||u.skewY||u.flipX||u.flipY)&&(a=c(a,y.util.calcDimensionsMatrix(u))),a},resetObjectTransform:function(u){u.scaleX=1,u.scaleY=1,u.skewX=0,u.skewY=0,u.flipX=!1,u.flipY=!1,u.rotate(0)},saveObjectTransform:function(u){return{scaleX:u.scaleX,scaleY:u.scaleY,skewX:u.skewX,skewY:u.skewY,angle:u.angle,left:u.left,flipX:u.flipX,flipY:u.flipY,top:u.top}},isTransparent:function(u,a,c,f){f>0&&(a>f?a-=f:a=0,c>f?c-=f:c=0);var r,s=!0,h=u.getImageData(a,c,2*f||1,2*f||1),m=h.data.length;for(r=3;r<m&&(s=h.data[r]<=0)!=0;r+=4);return h=null,s},parsePreserveAspectRatioAttribute:function(u){var a,c="meet",f=u.split(" ");return f&&f.length&&((c=f.pop())!=="meet"&&c!=="slice"?(a=c,c="meet"):f.length&&(a=f.pop())),{meetOrSlice:c,alignX:a!=="none"?a.slice(1,4):"none",alignY:a!=="none"?a.slice(5,8):"none"}},clearFabricFontCache:function(u){(u=(u||"").toLowerCase())?y.charWidthsCache[u]&&delete y.charWidthsCache[u]:y.charWidthsCache={}},limitDimsByArea:function(u,a){var c=Math.sqrt(a*u),f=Math.floor(a/c);return{x:Math.floor(c),y:f}},capValue:function(u,a,c){return Math.max(u,Math.min(a,c))},findScaleToFit:function(u,a){return Math.min(a.width/u.width,a.height/u.height)},findScaleToCover:function(u,a){return Math.max(a.width/u.width,a.height/u.height)},matrixToSVG:function(u){return"matrix("+u.map(function(a){return y.util.toFixed(a,y.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(u,a){var c=y.util.invertTransform(a),f=y.util.multiplyTransformMatrices(c,u.calcOwnMatrix());y.util.applyTransformToObject(u,f)},addTransformToObject:function(u,a){y.util.applyTransformToObject(u,y.util.multiplyTransformMatrices(a,u.calcOwnMatrix()))},applyTransformToObject:function(u,a){var c=y.util.qrDecompose(a),f=new y.Point(c.translateX,c.translateY);u.flipX=!1,u.flipY=!1,u.set("scaleX",c.scaleX),u.set("scaleY",c.scaleY),u.skewX=c.skewX,u.skewY=c.skewY,u.angle=c.angle,u.setPositionByOrigin(f,"center","center")},sizeAfterTransform:function(u,a,c){var f=u/2,r=a/2,s=[{x:-f,y:-r},{x:f,y:-r},{x:-f,y:r},{x:f,y:r}],h=y.util.calcDimensionsMatrix(c),m=y.util.makeBoundingBoxFromPoints(s,h);return{x:m.width,y:m.height}},mergeClipPaths:function(u,a){var c=u,f=a;c.inverted&&!f.inverted&&(c=a,f=u),y.util.applyTransformToObject(f,y.util.multiplyTransformMatrices(y.util.invertTransform(c.calcTransformMatrix()),f.calcTransformMatrix()));var r=c.inverted&&f.inverted;return r&&(c.inverted=f.inverted=!1),new y.Group([c],{clipPath:f,inverted:r})}},function(){var u=Array.prototype.join,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};function f(b,E,O,L,W,G,J,K,Y,N,B){var H=y.util.cos(b),Q=y.util.sin(b),ee=y.util.cos(E),U=y.util.sin(E),V=O*W*ee-L*G*U+J,X=L*W*ee+O*G*U+K;return["C",N+Y*(-O*W*Q-L*G*H),B+Y*(-L*W*Q+O*G*H),V+Y*(O*W*U+L*G*ee),X+Y*(L*W*U-O*G*ee),V,X]}function r(b,E,O,L){var W=Math.atan2(E,b),G=Math.atan2(L,O);return G>=W?G-W:2*Math.PI-(W-G)}function s(b,E,O){for(var L=O[1],W=O[2],G=O[3],J=O[4],K=O[5],Y=function(H,Q,ee,U,V,X,te){var Z=Math.PI,re=te*Z/180,he=y.util.sin(re),le=y.util.cos(re),oe=0,ue=0,ce=-le*H*.5-he*Q*.5,ge=-le*Q*.5+he*H*.5,ye=(ee=Math.abs(ee))*ee,me=(U=Math.abs(U))*U,we=ge*ge,Ie=ce*ce,Ct=ye*me-ye*we-me*Ie,Wt=0;if(Ct<0){var Hi=Math.sqrt(1-Ct/(ye*me));ee*=Hi,U*=Hi}else Wt=(V===X?-1:1)*Math.sqrt(Ct/(ye*we+me*Ie));var ke=Wt*ee*ge/U,xt=-Wt*U*ce/ee,bn=le*ke-he*xt+.5*H,Yi=he*ke+le*xt+.5*Q,bi=r(1,0,(ce-ke)/ee,(ge-xt)/U),Xi=r((ce-ke)/ee,(ge-xt)/U,(-ce-ke)/ee,(-ge-xt)/U);X===0&&Xi>0?Xi-=2*Z:X===1&&Xi<0&&(Xi+=2*Z);for(var Fl=Math.ceil(Math.abs(Xi/Z*2)),Sr=[],En=Xi/Fl,mf=8/3*Math.sin(En/4)*Math.sin(En/4)/Math.sin(En/2),Qs=bi+En,In=0;In<Fl;In++)Sr[In]=f(bi,Qs,le,he,ee,U,bn,Yi,mf,oe,ue),oe=Sr[In][5],ue=Sr[In][6],bi=Qs,Qs+=En;return Sr}(O[6]-b,O[7]-E,L,W,J,K,G),N=0,B=Y.length;N<B;N++)Y[N][1]+=b,Y[N][2]+=E,Y[N][3]+=b,Y[N][4]+=E,Y[N][5]+=b,Y[N][6]+=E;return Y}function h(b,E,O,L){return Math.sqrt((O-b)*(O-b)+(L-E)*(L-E))}function m(b,E,O,L,W,G,J,K){return function(Y){var N,B=(N=Y)*N*N,H=function(U){return 3*U*U*(1-U)}(Y),Q=function(U){return 3*U*(1-U)*(1-U)}(Y),ee=function(U){return(1-U)*(1-U)*(1-U)}(Y);return{x:J*B+W*H+O*Q+b*ee,y:K*B+G*H+L*Q+E*ee}}}function g(b,E,O,L,W,G,J,K){return function(Y){var N=1-Y,B=3*N*N*(O-b)+6*N*Y*(W-O)+3*Y*Y*(J-W),H=3*N*N*(L-E)+6*N*Y*(G-L)+3*Y*Y*(K-G);return Math.atan2(H,B)}}function p(b,E,O,L,W,G){return function(J){var K,Y=(K=J)*K,N=function(H){return 2*H*(1-H)}(J),B=function(H){return(1-H)*(1-H)}(J);return{x:W*Y+O*N+b*B,y:G*Y+L*N+E*B}}}function v(b,E,O,L,W,G){return function(J){var K=1-J,Y=2*K*(O-b)+2*J*(W-O),N=2*K*(L-E)+2*J*(G-L);return Math.atan2(N,Y)}}function C(b,E,O){var L,W,G={x:E,y:O},J=0;for(W=1;W<=100;W+=1)L=b(W/100),J+=h(G.x,G.y,L.x,L.y),G=L;return J}function x(b){for(var E,O,L,W,G=0,J=b.length,K=0,Y=0,N=0,B=0,H=[],Q=0;Q<J;Q++){switch(L={x:K,y:Y,command:(E=b[Q])[0]},E[0]){case"M":L.length=0,N=K=E[1],B=Y=E[2];break;case"L":L.length=h(K,Y,E[1],E[2]),K=E[1],Y=E[2];break;case"C":O=m(K,Y,E[1],E[2],E[3],E[4],E[5],E[6]),W=g(K,Y,E[1],E[2],E[3],E[4],E[5],E[6]),L.iterator=O,L.angleFinder=W,L.length=C(O,K,Y),K=E[5],Y=E[6];break;case"Q":O=p(K,Y,E[1],E[2],E[3],E[4]),W=v(K,Y,E[1],E[2],E[3],E[4]),L.iterator=O,L.angleFinder=W,L.length=C(O,K,Y),K=E[3],Y=E[4];break;case"Z":case"z":L.destX=N,L.destY=B,L.length=h(K,Y,N,B),K=N,Y=B}G+=L.length,H.push(L)}return H.push({length:G,x:K,y:Y}),H}y.util.joinPath=function(b){return b.map(function(E){return E.join(" ")}).join(" ")},y.util.parsePath=function(b){var E,O,L,W,G,J=[],K=[],Y=y.rePathCommand,N="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",B="("+N+")"+y.commaWsp,H="([01])"+y.commaWsp+"?",Q=new RegExp(B+"?"+B+"?"+B+H+H+B+"?("+N+")","g");if(!b||!b.match)return J;for(var ee,U=0,V=(G=b.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;U<V;U++){W=(E=G[U]).slice(1).trim(),K.length=0;var X=E.charAt(0);if(ee=[X],X.toLowerCase()==="a")for(var te;te=Q.exec(W);)for(var Z=1;Z<te.length;Z++)K.push(te[Z]);else for(;L=Y.exec(W);)K.push(L[0]);Z=0;for(var re=K.length;Z<re;Z++)O=parseFloat(K[Z]),isNaN(O)||ee.push(O);var he=a[X.toLowerCase()],le=c[X]||X;if(ee.length-1>he)for(var oe=1,ue=ee.length;oe<ue;oe+=he)J.push([X].concat(ee.slice(oe,oe+he))),X=le;else J.push(ee)}return J},y.util.makePathSimpler=function(b){var E,O,L,W,G,J,K=0,Y=0,N=b.length,B=0,H=0,Q=[];for(O=0;O<N;++O){switch(L=!1,(E=b[O].slice(0))[0]){case"l":E[0]="L",E[1]+=K,E[2]+=Y;case"L":K=E[1],Y=E[2];break;case"h":E[1]+=K;case"H":E[0]="L",E[2]=Y,K=E[1];break;case"v":E[1]+=Y;case"V":E[0]="L",Y=E[1],E[1]=K,E[2]=Y;break;case"m":E[0]="M",E[1]+=K,E[2]+=Y;case"M":K=E[1],Y=E[2],B=E[1],H=E[2];break;case"c":E[0]="C",E[1]+=K,E[2]+=Y,E[3]+=K,E[4]+=Y,E[5]+=K,E[6]+=Y;case"C":G=E[3],J=E[4],K=E[5],Y=E[6];break;case"s":E[0]="S",E[1]+=K,E[2]+=Y,E[3]+=K,E[4]+=Y;case"S":W==="C"?(G=2*K-G,J=2*Y-J):(G=K,J=Y),K=E[3],Y=E[4],E[0]="C",E[5]=E[3],E[6]=E[4],E[3]=E[1],E[4]=E[2],E[1]=G,E[2]=J,G=E[3],J=E[4];break;case"q":E[0]="Q",E[1]+=K,E[2]+=Y,E[3]+=K,E[4]+=Y;case"Q":G=E[1],J=E[2],K=E[3],Y=E[4];break;case"t":E[0]="T",E[1]+=K,E[2]+=Y;case"T":W==="Q"?(G=2*K-G,J=2*Y-J):(G=K,J=Y),E[0]="Q",K=E[1],Y=E[2],E[1]=G,E[2]=J,E[3]=K,E[4]=Y;break;case"a":E[0]="A",E[6]+=K,E[7]+=Y;case"A":L=!0,Q=Q.concat(s(K,Y,E)),K=E[6],Y=E[7];break;case"z":case"Z":K=B,Y=H}L||Q.push(E),W=E[0]}return Q},y.util.getSmoothPathFromPoints=function(b,E){var O,L=[],W=new y.Point(b[0].x,b[0].y),G=new y.Point(b[1].x,b[1].y),J=b.length,K=1,Y=0,N=J>2;for(E=E||0,N&&(K=b[2].x<G.x?-1:b[2].x===G.x?0:1,Y=b[2].y<G.y?-1:b[2].y===G.y?0:1),L.push(["M",W.x-K*E,W.y-Y*E]),O=1;O<J;O++){if(!W.eq(G)){var B=W.midPointFrom(G);L.push(["Q",W.x,W.y,B.x,B.y])}W=b[O],O+1<b.length&&(G=b[O+1])}return N&&(K=W.x>b[O-2].x?1:W.x===b[O-2].x?0:-1,Y=W.y>b[O-2].y?1:W.y===b[O-2].y?0:-1),L.push(["L",W.x+K*E,W.y+Y*E]),L},y.util.getPathSegmentsInfo=x,y.util.getBoundsOfCurve=function(b,E,O,L,W,G,J,K){var Y;if(y.cachesBoundsOfCurve&&(Y=u.call(arguments),y.boundsOfCurveCache[Y]))return y.boundsOfCurveCache[Y];var N,B,H,Q,ee,U,V,X,te=Math.sqrt,Z=Math.min,re=Math.max,he=Math.abs,le=[],oe=[[],[]];B=6*b-12*O+6*W,N=-3*b+9*O-9*W+3*J,H=3*O-3*b;for(var ue=0;ue<2;++ue)if(ue>0&&(B=6*E-12*L+6*G,N=-3*E+9*L-9*G+3*K,H=3*L-3*E),he(N)<1e-12){if(he(B)<1e-12)continue;0<(Q=-H/B)&&Q<1&&le.push(Q)}else(V=B*B-4*H*N)<0||(0<(ee=(-B+(X=te(V)))/(2*N))&&ee<1&&le.push(ee),0<(U=(-B-X)/(2*N))&&U<1&&le.push(U));for(var ce,ge,ye,me=le.length,we=me;me--;)ce=(ye=1-(Q=le[me]))*ye*ye*b+3*ye*ye*Q*O+3*ye*Q*Q*W+Q*Q*Q*J,oe[0][me]=ce,ge=ye*ye*ye*E+3*ye*ye*Q*L+3*ye*Q*Q*G+Q*Q*Q*K,oe[1][me]=ge;oe[0][we]=b,oe[1][we]=E,oe[0][we+1]=J,oe[1][we+1]=K;var Ie=[{x:Z.apply(null,oe[0]),y:Z.apply(null,oe[1])},{x:re.apply(null,oe[0]),y:re.apply(null,oe[1])}];return y.cachesBoundsOfCurve&&(y.boundsOfCurveCache[Y]=Ie),Ie},y.util.getPointOnPath=function(b,E,O){O||(O=x(b));for(var L=0;E-O[L].length>0&&L<O.length-2;)E-=O[L].length,L++;var W,G=O[L],J=E/G.length,K=G.command,Y=b[L];switch(K){case"M":return{x:G.x,y:G.y,angle:0};case"Z":case"z":return(W=new y.Point(G.x,G.y).lerp(new y.Point(G.destX,G.destY),J)).angle=Math.atan2(G.destY-G.y,G.destX-G.x),W;case"L":return(W=new y.Point(G.x,G.y).lerp(new y.Point(Y[1],Y[2]),J)).angle=Math.atan2(Y[2]-G.y,Y[1]-G.x),W;case"C":case"Q":return function(N,B){for(var H,Q,ee,U=0,V=0,X=N.iterator,te={x:N.x,y:N.y},Z=.01,re=N.angleFinder;V<B&&Z>1e-4;)H=X(U),ee=U,(Q=h(te.x,te.y,H.x,H.y))+V>B?(U-=Z,Z/=2):(te=H,U+=Z,V+=Q);return H.angle=re(ee),H}(G,E)}},y.util.transformPath=function(b,E,O){return O&&(E=y.util.multiplyTransformMatrices(E,[1,0,0,1,-O.x,-O.y])),b.map(function(L){for(var W=L.slice(0),G={},J=1;J<L.length-1;J+=2)G.x=L[J],G.y=L[J+1],G=y.util.transformPoint(G,E),W[J]=G.x,W[J+1]=G.y;return W})}}(),function(){var u=Array.prototype.slice;function a(c,f,r){if(c&&c.length!==0){var s=c.length-1,h=f?c[s][f]:c[s];if(f)for(;s--;)r(c[s][f],h)&&(h=c[s][f]);else for(;s--;)r(c[s],h)&&(h=c[s]);return h}}y.util.array={fill:function(c,f){for(var r=c.length;r--;)c[r]=f;return c},invoke:function(c,f){for(var r=u.call(arguments,2),s=[],h=0,m=c.length;h<m;h++)s[h]=r.length?c[h][f].apply(c[h],r):c[h][f].call(c[h]);return s},min:function(c,f){return a(c,f,function(r,s){return r<s})},max:function(c,f){return a(c,f,function(r,s){return r>=s})}}}(),function(){function u(a,c,f){if(f)if(!y.isLikelyNode&&c instanceof Element)a=c;else if(c instanceof Array){a=[];for(var r=0,s=c.length;r<s;r++)a[r]=u({},c[r],f)}else if(c&&typeof c=="object")for(var h in c)h==="canvas"||h==="group"?a[h]=null:c.hasOwnProperty(h)&&(a[h]=u({},c[h],f));else a=c;else for(var h in c)a[h]=c[h];return a}y.util.object={extend:u,clone:function(a,c){return u({},a,c)}},y.util.object.extend(y.util,y.Observable)}(),function(){function u(a,c){var f=a.charCodeAt(c);if(isNaN(f))return"";if(f<55296||f>57343)return a.charAt(c);if(55296<=f&&f<=56319){if(a.length<=c+1)throw"High surrogate without following low surrogate";var r=a.charCodeAt(c+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return a.charAt(c)+a.charAt(c+1)}if(c===0)throw"Low surrogate without preceding high surrogate";var s=a.charCodeAt(c-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}y.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(c,f){return f?f.toUpperCase():""})},capitalize:function(a,c){return a.charAt(0).toUpperCase()+(c?a.slice(1):a.slice(1).toLowerCase())},escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(a){var c,f=0,r=[];for(f=0;f<a.length;f++)(c=u(a,f))!==!1&&r.push(c);return r}}}(),function(){var u=Array.prototype.slice,a=function(){},c=function(){for(var h in{toString:1})if(h==="toString")return!1;return!0}(),f=function(h,m,g){for(var p in m)p in h.prototype&&typeof h.prototype[p]=="function"&&(m[p]+"").indexOf("callSuper")>-1?h.prototype[p]=function(v){return function(){var C=this.constructor.superclass;this.constructor.superclass=g;var x=m[v].apply(this,arguments);if(this.constructor.superclass=C,v!=="initialize")return x}}(p):h.prototype[p]=m[p],c&&(m.toString!==Object.prototype.toString&&(h.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(h.prototype.valueOf=m.valueOf))};function r(){}function s(h){for(var m=null,g=this;g.constructor.superclass;){var p=g.constructor.superclass.prototype[h];if(g[h]!==p){m=p;break}g=g.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,u.call(arguments,1)):m.call(this):console.log("tried to callSuper "+h+", method not found in prototype chain",this)}y.util.createClass=function(){var h=null,m=u.call(arguments,0);function g(){this.initialize.apply(this,arguments)}typeof m[0]=="function"&&(h=m.shift()),g.superclass=h,g.subclasses=[],h&&(r.prototype=h.prototype,g.prototype=new r,h.subclasses.push(g));for(var p=0,v=m.length;p<v;p++)f(g,m[p],h);return g.prototype.initialize||(g.prototype.initialize=a),g.prototype.constructor=g,g.prototype.callSuper=s,g}}(),w=!!y.document.createElement("div").attachEvent,T=["touchstart","touchmove","touchend"],y.util.addListener=function(u,a,c,f){u&&u.addEventListener(a,c,!w&&f)},y.util.removeListener=function(u,a,c,f){u&&u.removeEventListener(a,c,!w&&f)},y.util.getPointer=function(u){var a=u.target,c=y.util.getScrollLeftTop(a),f=function(r){var s=r.changedTouches;return s&&s[0]?s[0]:r}(u);return{x:f.clientX+c.left,y:f.clientY+c.top}},y.util.isTouchEvent=function(u){return T.indexOf(u.type)>-1||u.pointerType==="touch"},I=typeof(A=y.document.createElement("div")).style.opacity=="string",k=typeof A.style.filter=="string",P=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,F=function(u){return u},I?F=function(u,a){return u.style.opacity=a,u}:k&&(F=function(u,a){var c=u.style;return u.currentStyle&&!u.currentStyle.hasLayout&&(c.zoom=1),P.test(c.filter)?(a=a>=.9999?"":"alpha(opacity="+100*a+")",c.filter=c.filter.replace(P,a)):c.filter+=" alpha(opacity="+100*a+")",u}),y.util.setStyle=function(u,a){var c=u.style;if(!c)return u;if(typeof a=="string")return u.style.cssText+=";"+a,a.indexOf("opacity")>-1?F(u,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):u;for(var f in a)f==="opacity"?F(u,a[f]):c[f==="float"||f==="cssFloat"?c.styleFloat===void 0?"cssFloat":"styleFloat":f]=a[f];return u},function(){var u,a,c,f,r=Array.prototype.slice,s=function(g){return r.call(g,0)};try{u=s(y.document.childNodes)instanceof Array}catch{}function h(g,p){var v=y.document.createElement(g);for(var C in p)C==="class"?v.className=p[C]:C==="for"?v.htmlFor=p[C]:v.setAttribute(C,p[C]);return v}function m(g){for(var p=0,v=0,C=y.document.documentElement,x=y.document.body||{scrollLeft:0,scrollTop:0};g&&(g.parentNode||g.host)&&((g=g.parentNode||g.host)===y.document?(p=x.scrollLeft||C.scrollLeft||0,v=x.scrollTop||C.scrollTop||0):(p+=g.scrollLeft||0,v+=g.scrollTop||0),g.nodeType!==1||g.style.position!=="fixed"););return{left:p,top:v}}u||(s=function(g){for(var p=new Array(g.length),v=g.length;v--;)p[v]=g[v];return p}),a=y.document.defaultView&&y.document.defaultView.getComputedStyle?function(g,p){var v=y.document.defaultView.getComputedStyle(g,null);return v?v[p]:void 0}:function(g,p){var v=g.style[p];return!v&&g.currentStyle&&(v=g.currentStyle[p]),v},c=y.document.documentElement.style,f="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"",y.util.makeElementUnselectable=function(g){return g.onselectstart!==void 0&&(g.onselectstart=y.util.falseFunction),f?g.style[f]="none":typeof g.unselectable=="string"&&(g.unselectable="on"),g},y.util.makeElementSelectable=function(g){return g.onselectstart!==void 0&&(g.onselectstart=null),f?g.style[f]="":typeof g.unselectable=="string"&&(g.unselectable=""),g},y.util.setImageSmoothing=function(g,p){g.imageSmoothingEnabled=g.imageSmoothingEnabled||g.webkitImageSmoothingEnabled||g.mozImageSmoothingEnabled||g.msImageSmoothingEnabled||g.oImageSmoothingEnabled,g.imageSmoothingEnabled=p},y.util.getById=function(g){return typeof g=="string"?y.document.getElementById(g):g},y.util.toArray=s,y.util.addClass=function(g,p){g&&(" "+g.className+" ").indexOf(" "+p+" ")===-1&&(g.className+=(g.className?" ":"")+p)},y.util.makeElement=h,y.util.wrapElement=function(g,p,v){return typeof p=="string"&&(p=h(p,v)),g.parentNode&&g.parentNode.replaceChild(p,g),p.appendChild(g),p},y.util.getScrollLeftTop=m,y.util.getElementOffset=function(g){var p,v,C=g&&g.ownerDocument,x={left:0,top:0},b={left:0,top:0},E={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return b;for(var O in E)b[E[O]]+=parseInt(a(g,O),10)||0;return p=C.documentElement,g.getBoundingClientRect!==void 0&&(x=g.getBoundingClientRect()),v=m(g),{left:x.left+v.left-(p.clientLeft||0)+b.left,top:x.top+v.top-(p.clientTop||0)+b.top}},y.util.getNodeCanvas=function(g){var p=y.jsdomImplForWrapper(g);return p._canvas||p._image},y.util.cleanUpJsdomNode=function(g){if(y.isLikelyNode){var p=y.jsdomImplForWrapper(g);p&&(p._image=null,p._canvas=null,p._currentSrc=null,p._attributes=null,p._classList=null)}}}(),function(){function u(){}y.util.request=function(a,c){c||(c={});var f=c.method?c.method.toUpperCase():"GET",r=c.onComplete||function(){},s=new y.window.XMLHttpRequest,h=c.body||c.parameters;return s.onreadystatechange=function(){s.readyState===4&&(r(s),s.onreadystatechange=u)},f==="GET"&&(h=null,typeof c.parameters=="string"&&(a=function(m,g){return m+(/\?/.test(m)?"&":"?")+g}(a,c.parameters))),s.open(f,a,!0),f!=="POST"&&f!=="PUT"||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(h),s}}(),y.log=console.log,y.warn=console.warn,function(){var u=y.util.object.extend,a=y.util.object.clone,c=[];function f(){return!1}function r(g,p,v,C){return-v*Math.cos(g/C*(Math.PI/2))+v+p}y.util.object.extend(c,{cancelAll:function(){var g=this.splice(0);return g.forEach(function(p){p.cancel()}),g},cancelByCanvas:function(g){if(!g)return[];var p=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===g});return p.forEach(function(v){v.cancel()}),p},cancelByTarget:function(g){var p=this.findAnimationsByTarget(g);return p.forEach(function(v){v.cancel()}),p},findAnimationIndex:function(g){return this.indexOf(this.findAnimation(g))},findAnimation:function(g){return this.find(function(p){return p.cancel===g})},findAnimationsByTarget:function(g){return g?this.filter(function(p){return p.target===g}):[]}});var s=y.window.requestAnimationFrame||y.window.webkitRequestAnimationFrame||y.window.mozRequestAnimationFrame||y.window.oRequestAnimationFrame||y.window.msRequestAnimationFrame||function(g){return y.window.setTimeout(g,1e3/60)},h=y.window.cancelAnimationFrame||y.window.clearTimeout;function m(){return s.apply(y.window,arguments)}y.util.animate=function(g){g||(g={});var p,v=!1,C=function(){var x=y.runningAnimations.indexOf(p);return x>-1&&y.runningAnimations.splice(x,1)[0]};return p=u(a(g),{cancel:function(){return v=!0,C()},currentValue:"startValue"in g?g.startValue:0,completionRate:0,durationRate:0}),y.runningAnimations.push(p),m(function(x){var b,E=x||+new Date,O=g.duration||500,L=E+O,W=g.onChange||f,G=g.abort||f,J=g.onComplete||f,K=g.easing||r,Y="startValue"in g&&g.startValue.length>0,N="startValue"in g?g.startValue:0,B="endValue"in g?g.endValue:100,H=g.byValue||(Y?N.map(function(Q,ee){return B[ee]-N[ee]}):B-N);g.onStart&&g.onStart(),function Q(ee){var U=(b=ee||+new Date)>L?O:b-E,V=U/O,X=Y?N.map(function(Z,re){return K(U,N[re],H[re],O)}):K(U,N,H,O),te=Math.abs(Y?(X[0]-N[0])/H[0]:(X-N)/H);if(p.currentValue=Y?X.slice():X,p.completionRate=te,p.durationRate=V,!v){if(!G(X,te,V))return b>L?(p.currentValue=Y?B.slice():B,p.completionRate=1,p.durationRate=1,W(Y?B.slice():B,1,1),J(B,1,1),void C()):(W(X,te,V),void m(Q));C()}}(E)}),p.cancel},y.util.requestAnimFrame=m,y.util.cancelAnimFrame=function(){return h.apply(y.window,arguments)},y.runningAnimations=c}(),function(){function u(a,c,f){var r="rgba("+parseInt(a[0]+f*(c[0]-a[0]),10)+","+parseInt(a[1]+f*(c[1]-a[1]),10)+","+parseInt(a[2]+f*(c[2]-a[2]),10);return(r+=","+(a&&c?parseFloat(a[3]+f*(c[3]-a[3])):1))+")"}y.util.animateColor=function(a,c,f,r){var s=new y.Color(a).getSource(),h=new y.Color(c).getSource(),m=r.onComplete,g=r.onChange;return r=r||{},y.util.animate(y.util.object.extend(r,{duration:f||500,startValue:s,endValue:h,byValue:h,easing:function(p,v,C,x){return u(v,C,r.colorEasing?r.colorEasing(p,x):1-Math.cos(p/x*(Math.PI/2)))},onComplete:function(p,v,C){if(m)return m(u(h,h,0),v,C)},onChange:function(p,v,C){if(g){if(Array.isArray(p))return g(u(p,p,0),v,C);g(p,v,C)}}}))}}(),function(){function u(r,s,h,m){return r<Math.abs(s)?(r=s,m=h/4):m=s===0&&r===0?h/(2*Math.PI)*Math.asin(1):h/(2*Math.PI)*Math.asin(s/r),{a:r,c:s,p:h,s:m}}function a(r,s,h){return r.a*Math.pow(2,10*(s-=1))*Math.sin((s*h-r.s)*(2*Math.PI)/r.p)}function c(r,s,h,m){return h-f(m-r,0,h,m)+s}function f(r,s,h,m){return(r/=m)<1/2.75?h*(7.5625*r*r)+s:r<2/2.75?h*(7.5625*(r-=1.5/2.75)*r+.75)+s:r<2.5/2.75?h*(7.5625*(r-=2.25/2.75)*r+.9375)+s:h*(7.5625*(r-=2.625/2.75)*r+.984375)+s}y.util.ease={easeInQuad:function(r,s,h,m){return h*(r/=m)*r+s},easeOutQuad:function(r,s,h,m){return-h*(r/=m)*(r-2)+s},easeInOutQuad:function(r,s,h,m){return(r/=m/2)<1?h/2*r*r+s:-h/2*(--r*(r-2)-1)+s},easeInCubic:function(r,s,h,m){return h*(r/=m)*r*r+s},easeOutCubic:function(r,s,h,m){return h*((r=r/m-1)*r*r+1)+s},easeInOutCubic:function(r,s,h,m){return(r/=m/2)<1?h/2*r*r*r+s:h/2*((r-=2)*r*r+2)+s},easeInQuart:function(r,s,h,m){return h*(r/=m)*r*r*r+s},easeOutQuart:function(r,s,h,m){return-h*((r=r/m-1)*r*r*r-1)+s},easeInOutQuart:function(r,s,h,m){return(r/=m/2)<1?h/2*r*r*r*r+s:-h/2*((r-=2)*r*r*r-2)+s},easeInQuint:function(r,s,h,m){return h*(r/=m)*r*r*r*r+s},easeOutQuint:function(r,s,h,m){return h*((r=r/m-1)*r*r*r*r+1)+s},easeInOutQuint:function(r,s,h,m){return(r/=m/2)<1?h/2*r*r*r*r*r+s:h/2*((r-=2)*r*r*r*r+2)+s},easeInSine:function(r,s,h,m){return-h*Math.cos(r/m*(Math.PI/2))+h+s},easeOutSine:function(r,s,h,m){return h*Math.sin(r/m*(Math.PI/2))+s},easeInOutSine:function(r,s,h,m){return-h/2*(Math.cos(Math.PI*r/m)-1)+s},easeInExpo:function(r,s,h,m){return r===0?s:h*Math.pow(2,10*(r/m-1))+s},easeOutExpo:function(r,s,h,m){return r===m?s+h:h*(1-Math.pow(2,-10*r/m))+s},easeInOutExpo:function(r,s,h,m){return r===0?s:r===m?s+h:(r/=m/2)<1?h/2*Math.pow(2,10*(r-1))+s:h/2*(2-Math.pow(2,-10*--r))+s},easeInCirc:function(r,s,h,m){return-h*(Math.sqrt(1-(r/=m)*r)-1)+s},easeOutCirc:function(r,s,h,m){return h*Math.sqrt(1-(r=r/m-1)*r)+s},easeInOutCirc:function(r,s,h,m){return(r/=m/2)<1?-h/2*(Math.sqrt(1-r*r)-1)+s:h/2*(Math.sqrt(1-(r-=2)*r)+1)+s},easeInElastic:function(r,s,h,m){var g=0;return r===0?s:(r/=m)==1?s+h:(g||(g=.3*m),-a(u(h,h,g,1.70158),r,m)+s)},easeOutElastic:function(r,s,h,m){var g=0;if(r===0)return s;if((r/=m)==1)return s+h;g||(g=.3*m);var p=u(h,h,g,1.70158);return p.a*Math.pow(2,-10*r)*Math.sin((r*m-p.s)*(2*Math.PI)/p.p)+p.c+s},easeInOutElastic:function(r,s,h,m){var g=0;if(r===0)return s;if((r/=m/2)==2)return s+h;g||(g=m*(.3*1.5));var p=u(h,h,g,1.70158);return r<1?-.5*a(p,r,m)+s:p.a*Math.pow(2,-10*(r-=1))*Math.sin((r*m-p.s)*(2*Math.PI)/p.p)*.5+p.c+s},easeInBack:function(r,s,h,m,g){return g===void 0&&(g=1.70158),h*(r/=m)*r*((g+1)*r-g)+s},easeOutBack:function(r,s,h,m,g){return g===void 0&&(g=1.70158),h*((r=r/m-1)*r*((g+1)*r+g)+1)+s},easeInOutBack:function(r,s,h,m,g){return g===void 0&&(g=1.70158),(r/=m/2)<1?h/2*(r*r*((1+(g*=1.525))*r-g))+s:h/2*((r-=2)*r*((1+(g*=1.525))*r+g)+2)+s},easeInBounce:c,easeOutBounce:f,easeInOutBounce:function(r,s,h,m){return r<m/2?.5*c(2*r,0,h,m)+s:.5*f(2*r-m,0,h,m)+.5*h+s}}}(),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.object.clone,r=a.util.toFixed,s=a.util.parseUnit,h=a.util.multiplyTransformMatrices,m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},g={stroke:"strokeOpacity",fill:"fillOpacity"},p="font-size",v="clip-path";function C(N){return N in m?m[N]:N}function x(N,B,H,Q){var ee,U=Array.isArray(B);if(N!=="fill"&&N!=="stroke"||B!=="none"){if(N==="strokeUniform")return B==="non-scaling-stroke";if(N==="strokeDashArray")B=B==="none"?null:B.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(N==="transformMatrix")B=H&&H.transformMatrix?h(H.transformMatrix,a.parseTransformAttribute(B)):a.parseTransformAttribute(B);else if(N==="visible")B=B!=="none"&&B!=="hidden",H&&H.visible===!1&&(B=!1);else if(N==="opacity")B=parseFloat(B),H&&H.opacity!==void 0&&(B*=H.opacity);else if(N==="textAnchor")B=B==="start"?"left":B==="end"?"right":"center";else if(N==="charSpacing")ee=s(B,Q)/Q*1e3;else if(N==="paintFirst"){var V=B.indexOf("fill"),X=B.indexOf("stroke");B="fill",(V>-1&&X>-1&&X<V||V===-1&&X>-1)&&(B="stroke")}else{if(N==="href"||N==="xlink:href"||N==="font")return B;if(N==="imageSmoothing")return B==="optimizeQuality";ee=U?B.map(s):s(B,Q)}}else B="";return!U&&isNaN(ee)?B:ee}function b(N){return new RegExp("^("+N.join("|")+")\\b","i")}function E(N,B){var H,Q,ee,U,V=[];for(ee=0,U=B.length;ee<U;ee++)H=B[ee],Q=N.getElementsByTagName(H),V=V.concat(Array.prototype.slice.call(Q));return V}function O(N,B){var H,Q=!0;return(H=L(N,B.pop()))&&B.length&&(Q=function(ee,U){for(var V,X=!0;ee.parentNode&&ee.parentNode.nodeType===1&&U.length;)X&&(V=U.pop()),X=L(ee=ee.parentNode,V);return U.length===0}(N,B)),H&&Q&&B.length===0}function L(N,B){var H,Q,ee=N.nodeName,U=N.getAttribute("class"),V=N.getAttribute("id");if(H=new RegExp("^"+ee,"i"),B=B.replace(H,""),V&&B.length&&(H=new RegExp("#"+V+"(?![a-zA-Z\\-]+)","i"),B=B.replace(H,"")),U&&B.length)for(Q=(U=U.split(" ")).length;Q--;)H=new RegExp("\\."+U[Q]+"(?![a-zA-Z\\-]+)","i"),B=B.replace(H,"");return B.length===0}function W(N,B){var H;if(N.getElementById&&(H=N.getElementById(B)),H)return H;var Q,ee,U,V=N.getElementsByTagName("*");for(ee=0,U=V.length;ee<U;ee++)if(B===(Q=V[ee]).getAttribute("id"))return Q}a.svgValidTagNamesRegEx=b(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),a.svgViewBoxElementsRegEx=b(["symbol","image","marker","pattern","view","svg"]),a.svgInvalidAncestorsRegEx=b(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),a.svgValidParentsRegEx=b(["symbol","g","a","svg","clipPath","defs"]),a.cssRules={},a.gradientDefs={},a.clipPaths={},a.parseTransformAttribute=function(){function N(X,te,Z){X[Z]=Math.tan(a.util.degreesToRadians(te[0]))}var B=a.iMatrix,H=a.reNum,Q=a.commaWsp,ee="(?:(?:(matrix)\\s*\\(\\s*("+H+")"+Q+"("+H+")"+Q+"("+H+")"+Q+"("+H+")"+Q+"("+H+")"+Q+"("+H+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+H+")(?:"+Q+"("+H+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+H+")(?:"+Q+"("+H+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+H+")(?:"+Q+"("+H+")"+Q+"("+H+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+H+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+H+")\\s*\\)))",U=new RegExp("^\\s*(?:(?:"+ee+"(?:"+Q+"*"+ee+")*)?)\\s*$"),V=new RegExp(ee,"g");return function(X){var te=B.concat(),Z=[];if(!X||X&&!U.test(X))return te;X.replace(V,function(he){var le=new RegExp(ee).exec(he).filter(function(ce){return!!ce}),oe=le[1],ue=le.slice(2).map(parseFloat);switch(oe){case"translate":(function(ce,ge){ce[4]=ge[0],ge.length===2&&(ce[5]=ge[1])})(te,ue);break;case"rotate":ue[0]=a.util.degreesToRadians(ue[0]),function(ce,ge){var ye=a.util.cos(ge[0]),me=a.util.sin(ge[0]),we=0,Ie=0;ge.length===3&&(we=ge[1],Ie=ge[2]),ce[0]=ye,ce[1]=me,ce[2]=-me,ce[3]=ye,ce[4]=we-(ye*we-me*Ie),ce[5]=Ie-(me*we+ye*Ie)}(te,ue);break;case"scale":(function(ce,ge){var ye=ge[0],me=ge.length===2?ge[1]:ge[0];ce[0]=ye,ce[3]=me})(te,ue);break;case"skewX":N(te,ue,2);break;case"skewY":N(te,ue,1);break;case"matrix":te=ue}Z.push(te.concat()),te=B.concat()});for(var re=Z[0];Z.length>1;)Z.shift(),re=a.util.multiplyTransformMatrices(re,Z[0]);return re}}();var G=new RegExp("^\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*$");function J(N){if(!a.svgViewBoxElementsRegEx.test(N.nodeName))return{};var B,H,Q,ee,U,V,X=N.getAttribute("viewBox"),te=1,Z=1,re=N.getAttribute("width"),he=N.getAttribute("height"),le=N.getAttribute("x")||0,oe=N.getAttribute("y")||0,ue=N.getAttribute("preserveAspectRatio")||"",ce=!X||!(X=X.match(G)),ge=!re||!he||re==="100%"||he==="100%",ye=ce&&ge,me={},we="",Ie=0,Ct=0;if(me.width=0,me.height=0,me.toBeParsed=ye,ce&&(le||oe)&&N.parentNode&&N.parentNode.nodeName!=="#document"&&(we=" translate("+s(le)+" "+s(oe)+") ",U=(N.getAttribute("transform")||"")+we,N.setAttribute("transform",U),N.removeAttribute("x"),N.removeAttribute("y")),ye)return me;if(ce)return me.width=s(re),me.height=s(he),me;if(B=-parseFloat(X[1]),H=-parseFloat(X[2]),Q=parseFloat(X[3]),ee=parseFloat(X[4]),me.minX=B,me.minY=H,me.viewBoxWidth=Q,me.viewBoxHeight=ee,ge?(me.width=Q,me.height=ee):(me.width=s(re),me.height=s(he),te=me.width/Q,Z=me.height/ee),(ue=a.util.parsePreserveAspectRatioAttribute(ue)).alignX!=="none"&&(ue.meetOrSlice==="meet"&&(Z=te=te>Z?Z:te),ue.meetOrSlice==="slice"&&(Z=te=te>Z?te:Z),Ie=me.width-Q*te,Ct=me.height-ee*te,ue.alignX==="Mid"&&(Ie/=2),ue.alignY==="Mid"&&(Ct/=2),ue.alignX==="Min"&&(Ie=0),ue.alignY==="Min"&&(Ct=0)),te===1&&Z===1&&B===0&&H===0&&le===0&&oe===0)return me;if((le||oe)&&N.parentNode.nodeName!=="#document"&&(we=" translate("+s(le)+" "+s(oe)+") "),U=we+" matrix("+te+" 0 0 "+Z+" "+(B*te+Ie)+" "+(H*Z+Ct)+") ",N.nodeName==="svg"){for(V=N.ownerDocument.createElementNS(a.svgNS,"g");N.firstChild;)V.appendChild(N.firstChild);N.appendChild(V)}else(V=N).removeAttribute("x"),V.removeAttribute("y"),U=V.getAttribute("transform")+U;return V.setAttribute("transform",U),me}function K(N,B){var H="xlink:href",Q=W(N,B.getAttribute(H).slice(1));if(Q&&Q.getAttribute(H)&&K(N,Q),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(U){Q&&!B.hasAttribute(U)&&Q.hasAttribute(U)&&B.setAttribute(U,Q.getAttribute(U))}),!B.children.length)for(var ee=Q.cloneNode(!0);ee.firstChild;)B.appendChild(ee.firstChild);B.removeAttribute(H)}a.parseSVGDocument=function(N,B,H,Q){if(N){(function(le){for(var oe=E(le,["use","svg:use"]),ue=0;oe.length&&ue<oe.length;){var ce=oe[ue],ge=ce.getAttribute("xlink:href")||ce.getAttribute("href");if(ge===null)return;var ye,me,we,Ie,Ct=ge.slice(1),Wt=ce.getAttribute("x")||0,Hi=ce.getAttribute("y")||0,ke=W(le,Ct).cloneNode(!0),xt=(ke.getAttribute("transform")||"")+" translate("+Wt+", "+Hi+")",bn=oe.length,Yi=a.svgNS;if(J(ke),/^svg$/i.test(ke.nodeName)){var bi=ke.ownerDocument.createElementNS(Yi,"g");for(me=0,Ie=(we=ke.attributes).length;me<Ie;me++)ye=we.item(me),bi.setAttributeNS(Yi,ye.nodeName,ye.nodeValue);for(;ke.firstChild;)bi.appendChild(ke.firstChild);ke=bi}for(me=0,Ie=(we=ce.attributes).length;me<Ie;me++)(ye=we.item(me)).nodeName!=="x"&&ye.nodeName!=="y"&&ye.nodeName!=="xlink:href"&&ye.nodeName!=="href"&&(ye.nodeName==="transform"?xt=ye.nodeValue+" "+xt:ke.setAttribute(ye.nodeName,ye.nodeValue));ke.setAttribute("transform",xt),ke.setAttribute("instantiated_by_use","1"),ke.removeAttribute("id"),ce.parentNode.replaceChild(ke,ce),oe.length===bn&&ue++}})(N);var ee,U,V=a.Object.__uid++,X=J(N),te=a.util.toArray(N.getElementsByTagName("*"));if(X.crossOrigin=Q&&Q.crossOrigin,X.svgUid=V,te.length===0&&a.isLikelyNode){var Z=[];for(ee=0,U=(te=N.selectNodes('//*[name(.)!="svg"]')).length;ee<U;ee++)Z[ee]=te[ee];te=Z}var re=te.filter(function(le){return J(le),a.svgValidTagNamesRegEx.test(le.nodeName.replace("svg:",""))&&!function(oe,ue){for(;oe&&(oe=oe.parentNode);)if(oe.nodeName&&ue.test(oe.nodeName.replace("svg:",""))&&!oe.getAttribute("instantiated_by_use"))return!0;return!1}(le,a.svgInvalidAncestorsRegEx)});if(!re||re&&!re.length)B&&B([],{});else{var he={};te.filter(function(le){return le.nodeName.replace("svg:","")==="clipPath"}).forEach(function(le){var oe=le.getAttribute("id");he[oe]=a.util.toArray(le.getElementsByTagName("*")).filter(function(ue){return a.svgValidTagNamesRegEx.test(ue.nodeName.replace("svg:",""))})}),a.gradientDefs[V]=a.getGradientDefs(N),a.cssRules[V]=a.getCSSRules(N),a.clipPaths[V]=he,a.parseElements(re,function(le,oe){B&&(B(le,X,oe,te),delete a.gradientDefs[V],delete a.cssRules[V],delete a.clipPaths[V])},f(X),H,Q)}}};var Y=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+a.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+a.reNum+"))?\\s+(.*)");c(a,{parseFontDeclaration:function(N,B){var H=N.match(Y);if(H){var Q=H[1],ee=H[3],U=H[4],V=H[5],X=H[6];Q&&(B.fontStyle=Q),ee&&(B.fontWeight=isNaN(parseFloat(ee))?ee:parseFloat(ee)),U&&(B.fontSize=s(U)),X&&(B.fontFamily=X),V&&(B.lineHeight=V==="normal"?1:V)}},getGradientDefs:function(N){var B,H=E(N,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),Q=0,ee={};for(Q=H.length;Q--;)(B=H[Q]).getAttribute("xlink:href")&&K(N,B),ee[B.getAttribute("id")]=B;return ee},parseAttributes:function(N,B,H){if(N){var Q,ee,U,V={};H===void 0&&(H=N.getAttribute("svgUid")),N.parentNode&&a.svgValidParentsRegEx.test(N.parentNode.nodeName)&&(V=a.parseAttributes(N.parentNode,B,H));var X=B.reduce(function(ue,ce){return(Q=N.getAttribute(ce))&&(ue[ce]=Q),ue},{}),te=c(function(ue,ce){var ge={};for(var ye in a.cssRules[ce])if(O(ue,ye.split(" ")))for(var me in a.cssRules[ce][ye])ge[me]=a.cssRules[ce][ye][me];return ge}(N,H),a.parseStyleAttribute(N));X=c(X,te),te[v]&&N.setAttribute(v,te[v]),ee=U=V.fontSize||a.Text.DEFAULT_SVG_FONT_SIZE,X[p]&&(X[p]=ee=s(X[p],U));var Z,re,he={};for(var le in X)re=x(Z=C(le),X[le],V,ee),he[Z]=re;he&&he.font&&a.parseFontDeclaration(he.font,he);var oe=c(V,he);return a.svgValidParentsRegEx.test(N.nodeName)?oe:function(ue){for(var ce in g)if(ue[g[ce]]!==void 0&&ue[ce]!==""){if(ue[ce]===void 0){if(!a.Object.prototype[ce])continue;ue[ce]=a.Object.prototype[ce]}if(ue[ce].indexOf("url(")!==0){var ge=new a.Color(ue[ce]);ue[ce]=ge.setAlpha(r(ge.getAlpha()*ue[g[ce]],2)).toRgba()}}return ue}(oe)}},parseElements:function(N,B,H,Q,ee){new a.ElementsParser(N,B,H,Q,ee).parse()},parseStyleAttribute:function(N){var B={},H=N.getAttribute("style");return H&&(typeof H=="string"?function(Q,ee){var U,V;Q.replace(/;\s*$/,"").split(";").forEach(function(X){var te=X.split(":");U=te[0].trim().toLowerCase(),V=te[1].trim(),ee[U]=V})}(H,B):function(Q,ee){var U,V;for(var X in Q)Q[X]!==void 0&&(U=X.toLowerCase(),V=Q[X],ee[U]=V)}(H,B)),B},parsePointsAttribute:function(N){if(!N)return null;var B,H,Q=[];for(B=0,H=(N=(N=N.replace(/,/g," ").trim()).split(/\s+/)).length;B<H;B+=2)Q.push({x:parseFloat(N[B]),y:parseFloat(N[B+1])});return Q},getCSSRules:function(N){var B,H,Q=N.getElementsByTagName("style"),ee={};for(B=0,H=Q.length;B<H;B++){var U=Q[B].textContent;(U=U.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&U.split("}").filter(function(V){return V.trim()}).forEach(function(V){var X=V.split("{"),te={},Z=X[1].trim().split(";").filter(function(oe){return oe.trim()});for(B=0,H=Z.length;B<H;B++){var re=Z[B].split(":"),he=re[0].trim(),le=re[1].trim();te[he]=le}(V=X[0].trim()).split(",").forEach(function(oe){(oe=oe.replace(/^svg/i,"").trim())!==""&&(ee[oe]?a.util.object.extend(ee[oe],te):ee[oe]=a.util.object.clone(te))})})}return ee},loadSVGFromURL:function(N,B,H,Q){N=N.replace(/^\n\s*/,"").trim(),new a.util.request(N,{method:"get",onComplete:function(ee){var U=ee.responseXML;if(!U||!U.documentElement)return B&&B(null),!1;a.parseSVGDocument(U.documentElement,function(V,X,te,Z){B&&B(V,X,te,Z)},H,Q)}})},loadSVGFromString:function(N,B,H,Q){var ee=new a.window.DOMParser().parseFromString(N.trim(),"text/xml");a.parseSVGDocument(ee.documentElement,function(U,V,X,te){B(U,V,X,te)},H,Q)}})}(e),y.ElementsParser=function(u,a,c,f,r,s){this.elements=u,this.callback=a,this.options=c,this.reviver=f,this.svgUid=c&&c.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},(z=y.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},z.createObjects=function(){var u=this;this.elements.forEach(function(a,c){a.setAttribute("svgUid",u.svgUid),u.createObject(a,c)})},z.findTag=function(u){return y[y.util.string.capitalize(u.tagName.replace("svg:",""))]},z.createObject=function(u,a){var c=this.findTag(u);if(c&&c.fromElement)try{c.fromElement(u,this.createCallback(a,u),this.options)}catch(f){y.log(f)}else this.checkIfDone()},z.createCallback=function(u,a){var c=this;return function(f){var r;c.resolveGradient(f,a,"fill"),c.resolveGradient(f,a,"stroke"),f instanceof y.Image&&f._originalElement&&(r=f.parsePreserveAspectRatioAttribute(a)),f._removeTransformMatrix(r),c.resolveClipPath(f,a),c.reviver&&c.reviver(a,f),c.instances[u]=f,c.checkIfDone()}},z.extractPropertyDefinition=function(u,a,c){var f=u[a],r=this.regexUrl;if(r.test(f)){r.lastIndex=0;var s=r.exec(f)[1];return r.lastIndex=0,y[c][this.svgUid][s]}},z.resolveGradient=function(u,a,c){var f=this.extractPropertyDefinition(u,c,"gradientDefs");if(f){var r=a.getAttribute(c+"-opacity"),s=y.Gradient.fromElement(f,u,r,this.options);u.set(c,s)}},z.createClipPathCallback=function(u,a){return function(c){c._removeTransformMatrix(),c.fillRule=c.clipRule,a.push(c)}},z.resolveClipPath=function(u,a){var c,f,r,s,h=this.extractPropertyDefinition(u,"clipPath","clipPaths");if(h){r=[],f=y.util.invertTransform(u.calcTransformMatrix());for(var m=h[0].parentNode,g=a;g.parentNode&&g.getAttribute("clip-path")!==u.clipPath;)g=g.parentNode;g.parentNode.appendChild(m);for(var p=0;p<h.length;p++)c=h[p],this.findTag(c).fromElement(c,this.createClipPathCallback(u,r),this.options);h=r.length===1?r[0]:new y.Group(r),s=y.util.multiplyTransformMatrices(f,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,g);var v=y.util.qrDecompose(s);h.flipX=!1,h.flipY=!1,h.set("scaleX",v.scaleX),h.set("scaleY",v.scaleY),h.angle=v.angle,h.skewX=v.skewX,h.skewY=0,h.setPositionByOrigin({x:v.translateX,y:v.translateY},"center","center"),u.clipPath=h}else delete u.clipPath},z.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(u){return u!=null}),this.callback(this.instances,this.elements))},function(u){var a=u.fabric||(u.fabric={});function c(f,r){this.x=f,this.y=r}a.Point?a.warn("fabric.Point is already defined"):(a.Point=c,c.prototype={type:"point",constructor:c,add:function(f){return new c(this.x+f.x,this.y+f.y)},addEquals:function(f){return this.x+=f.x,this.y+=f.y,this},scalarAdd:function(f){return new c(this.x+f,this.y+f)},scalarAddEquals:function(f){return this.x+=f,this.y+=f,this},subtract:function(f){return new c(this.x-f.x,this.y-f.y)},subtractEquals:function(f){return this.x-=f.x,this.y-=f.y,this},scalarSubtract:function(f){return new c(this.x-f,this.y-f)},scalarSubtractEquals:function(f){return this.x-=f,this.y-=f,this},multiply:function(f){return new c(this.x*f,this.y*f)},multiplyEquals:function(f){return this.x*=f,this.y*=f,this},divide:function(f){return new c(this.x/f,this.y/f)},divideEquals:function(f){return this.x/=f,this.y/=f,this},eq:function(f){return this.x===f.x&&this.y===f.y},lt:function(f){return this.x<f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,r){return r===void 0&&(r=.5),r=Math.max(Math.min(1,r),0),new c(this.x+(f.x-this.x)*r,this.y+(f.y-this.y)*r)},distanceFrom:function(f){var r=this.x-f.x,s=this.y-f.y;return Math.sqrt(r*r+s*s)},midPointFrom:function(f){return this.lerp(f)},min:function(f){return new c(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new c(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},setXY:function(f,r){return this.x=f,this.y=r,this},setX:function(f){return this.x=f,this},setY:function(f){return this.y=f,this},setFromPoint:function(f){return this.x=f.x,this.y=f.y,this},swap:function(f){var r=this.x,s=this.y;this.x=f.x,this.y=f.y,f.x=r,f.y=s},clone:function(){return new c(this.x,this.y)}})}(e),function(u){var a=u.fabric||(u.fabric={});function c(f){this.status=f,this.points=[]}a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=c,a.Intersection.prototype={constructor:c,appendPoint:function(f){return this.points.push(f),this},appendPoints:function(f){return this.points=this.points.concat(f),this}},a.Intersection.intersectLineLine=function(f,r,s,h){var m,g=(h.x-s.x)*(f.y-s.y)-(h.y-s.y)*(f.x-s.x),p=(r.x-f.x)*(f.y-s.y)-(r.y-f.y)*(f.x-s.x),v=(h.y-s.y)*(r.x-f.x)-(h.x-s.x)*(r.y-f.y);if(v!==0){var C=g/v,x=p/v;0<=C&&C<=1&&0<=x&&x<=1?(m=new c("Intersection")).appendPoint(new a.Point(f.x+C*(r.x-f.x),f.y+C*(r.y-f.y))):m=new c}else m=new c(g===0||p===0?"Coincident":"Parallel");return m},a.Intersection.intersectLinePolygon=function(f,r,s){var h,m,g,p,v=new c,C=s.length;for(p=0;p<C;p++)h=s[p],m=s[(p+1)%C],g=c.intersectLineLine(f,r,h,m),v.appendPoints(g.points);return v.points.length>0&&(v.status="Intersection"),v},a.Intersection.intersectPolygonPolygon=function(f,r){var s,h=new c,m=f.length;for(s=0;s<m;s++){var g=f[s],p=f[(s+1)%m],v=c.intersectLinePolygon(g,p,r);h.appendPoints(v.points)}return h.points.length>0&&(h.status="Intersection"),h},a.Intersection.intersectPolygonRectangle=function(f,r,s){var h=r.min(s),m=r.max(s),g=new a.Point(m.x,h.y),p=new a.Point(h.x,m.y),v=c.intersectLinePolygon(h,g,f),C=c.intersectLinePolygon(g,m,f),x=c.intersectLinePolygon(m,p,f),b=c.intersectLinePolygon(p,h,f),E=new c;return E.appendPoints(v.points),E.appendPoints(C.points),E.appendPoints(x.points),E.appendPoints(b.points),E.points.length>0&&(E.status="Intersection"),E})}(e),function(u){var a=u.fabric||(u.fabric={});function c(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}function f(r,s,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?r+6*(s-r)*h:h<.5?s:h<2/3?r+(s-r)*(2/3-h)*6:r}a.Color?a.warn("fabric.Color is already defined."):(a.Color=c,a.Color.prototype={_tryParsingColor:function(r){var s;r in c.colorNameMap&&(r=c.colorNameMap[r]),r==="transparent"&&(s=[255,255,255,0]),s||(s=c.sourceFromHex(r)),s||(s=c.sourceFromRgb(r)),s||(s=c.sourceFromHsl(r)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(r,s,h){r/=255,s/=255,h/=255;var m,g,p,v=a.util.array.max([r,s,h]),C=a.util.array.min([r,s,h]);if(p=(v+C)/2,v===C)m=g=0;else{var x=v-C;switch(g=p>.5?x/(2-v-C):x/(v+C),v){case r:m=(s-h)/x+(s<h?6:0);break;case s:m=(h-r)/x+2;break;case h:m=(r-s)/x+4}m/=6}return[Math.round(360*m),Math.round(100*g),Math.round(100*p)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),s=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var r=this.getSource(),s=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+r[3]+")"},toHex:function(){var r,s,h,m=this.getSource();return r=(r=m[0].toString(16)).length===1?"0"+r:r,s=(s=m[1].toString(16)).length===1?"0"+s:s,h=(h=m[2].toString(16)).length===1?"0"+h:h,r.toUpperCase()+s.toUpperCase()+h.toUpperCase()},toHexa:function(){var r,s=this.getSource();return r=(r=(r=Math.round(255*s[3])).toString(16)).length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var s=this.getSource();return s[3]=r,this.setSource(s),this},toGrayscale:function(){var r=this.getSource(),s=parseInt((.3*r[0]+.59*r[1]+.11*r[2]).toFixed(0),10),h=r[3];return this.setSource([s,s,s,h]),this},toBlackWhite:function(r){var s=this.getSource(),h=(.3*s[0]+.59*s[1]+.11*s[2]).toFixed(0),m=s[3];return r=r||127,h=Number(h)<Number(r)?0:255,this.setSource([h,h,h,m]),this},overlayWith:function(r){r instanceof c||(r=new c(r));var s,h=[],m=this.getAlpha(),g=this.getSource(),p=r.getSource();for(s=0;s<3;s++)h.push(Math.round(.5*g[s]+.5*p[s]));return h[3]=m,this.setSource(h),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,a.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a.Color.fromRgb=function(r){return c.fromSource(c.sourceFromRgb(r))},a.Color.sourceFromRgb=function(r){var s=r.match(c.reRGBa);if(s){var h=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),m=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),g=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(h,10),parseInt(m,10),parseInt(g,10),s[4]?parseFloat(s[4]):1]}},a.Color.fromRgba=c.fromRgb,a.Color.fromHsl=function(r){return c.fromSource(c.sourceFromHsl(r))},a.Color.sourceFromHsl=function(r){var s=r.match(c.reHSLa);if(s){var h,m,g,p=(parseFloat(s[1])%360+360)%360/360,v=parseFloat(s[2])/(/%$/.test(s[2])?100:1),C=parseFloat(s[3])/(/%$/.test(s[3])?100:1);if(v===0)h=m=g=C;else{var x=C<=.5?C*(v+1):C+v-C*v,b=2*C-x;h=f(b,x,p+1/3),m=f(b,x,p),g=f(b,x,p-1/3)}return[Math.round(255*h),Math.round(255*m),Math.round(255*g),s[4]?parseFloat(s[4]):1]}},a.Color.fromHsla=c.fromHsl,a.Color.fromHex=function(r){return c.fromSource(c.sourceFromHex(r))},a.Color.sourceFromHex=function(r){if(r.match(c.reHex)){var s=r.slice(r.indexOf("#")+1),h=s.length===3||s.length===4,m=s.length===8||s.length===4,g=h?s.charAt(0)+s.charAt(0):s.substring(0,2),p=h?s.charAt(1)+s.charAt(1):s.substring(2,4),v=h?s.charAt(2)+s.charAt(2):s.substring(4,6),C=m?h?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(g,16),parseInt(p,16),parseInt(v,16),parseFloat((parseInt(C,16)/255).toFixed(2))]}},a.Color.fromSource=function(r){var s=new c;return s.setSource(r),s})}(e),function(u){var a=u.fabric||(u.fabric={}),c=["e","se","s","sw","w","nw","n","ne","e"],f=["ns","nesw","ew","nwse"],r={},s="left",h="top",m="right",g="bottom",p="center",v={top:g,bottom:h,left:m,right:s,center:p},C=a.util.radiansToDegrees,x=Math.sign||function(U){return(U>0)-(U<0)||+U};function b(U,V){var X=U.angle+C(Math.atan2(V.y,V.x))+360;return Math.round(X%360/45)}function E(U,V){var X=V.transform.target,te=X.canvas,Z=a.util.object.clone(V);Z.target=X,te&&te.fire("object:"+U,Z),X.fire(U,V)}function O(U,V){var X=V.canvas,te=U[X.uniScaleKey];return X.uniformScaling&&!te||!X.uniformScaling&&te}function L(U){return U.originX===p&&U.originY===p}function W(U,V,X){var te=U.lockScalingX,Z=U.lockScalingY;return!((!te||!Z)&&(V||!te&&!Z||!X)&&(!te||V!=="x")&&(!Z||V!=="y"))}function G(U,V,X,te){return{e:U,transform:V,pointer:{x:X,y:te}}}function J(U){return function(V,X,te,Z){var re=X.target,he=re.getCenterPoint(),le=re.translateToOriginPoint(he,X.originX,X.originY),oe=U(V,X,te,Z);return re.setPositionByOrigin(le,X.originX,X.originY),oe}}function K(U,V){return function(X,te,Z,re){var he=V(X,te,Z,re);return he&&E(U,G(X,te,Z,re)),he}}function Y(U,V,X,te,Z){var re=U.target,he=re.controls[U.corner],le=re.canvas.getZoom(),oe=re.padding/le,ue=re.toLocalPoint(new a.Point(te,Z),V,X);return ue.x>=oe&&(ue.x-=oe),ue.x<=-oe&&(ue.x+=oe),ue.y>=oe&&(ue.y-=oe),ue.y<=oe&&(ue.y+=oe),ue.x-=he.offsetX,ue.y-=he.offsetY,ue}function N(U){return U.flipX!==U.flipY}function B(U,V,X,te,Z){if(U[V]!==0){var re=Z/U._getTransformedDimensions()[te]*U[X];U.set(X,re)}}function H(U,V,X,te){var Z,re=V.target,he=re._getTransformedDimensions(0,re.skewY),le=Y(V,V.originX,V.originY,X,te),oe=Math.abs(2*le.x)-he.x,ue=re.skewX;oe<2?Z=0:(Z=C(Math.atan2(oe/re.scaleX,he.y/re.scaleY)),V.originX===s&&V.originY===g&&(Z=-Z),V.originX===m&&V.originY===h&&(Z=-Z),N(re)&&(Z=-Z));var ce=ue!==Z;if(ce){var ge=re._getTransformedDimensions().y;re.set("skewX",Z),B(re,"skewY","scaleY","y",ge)}return ce}function Q(U,V,X,te){var Z,re=V.target,he=re._getTransformedDimensions(re.skewX,0),le=Y(V,V.originX,V.originY,X,te),oe=Math.abs(2*le.y)-he.y,ue=re.skewY;oe<2?Z=0:(Z=C(Math.atan2(oe/re.scaleY,he.x/re.scaleX)),V.originX===s&&V.originY===g&&(Z=-Z),V.originX===m&&V.originY===h&&(Z=-Z),N(re)&&(Z=-Z));var ce=ue!==Z;if(ce){var ge=re._getTransformedDimensions().x;re.set("skewY",Z),B(re,"skewX","scaleX","x",ge)}return ce}function ee(U,V,X,te,Z){Z=Z||{};var re,he,le,oe,ue,ce,ge=V.target,ye=ge.lockScalingX,me=ge.lockScalingY,we=Z.by,Ie=O(U,ge),Ct=W(ge,we,Ie),Wt=V.gestureScale;if(Ct)return!1;if(Wt)he=V.scaleX*Wt,le=V.scaleY*Wt;else{if(re=Y(V,V.originX,V.originY,X,te),ue=we!=="y"?x(re.x):1,ce=we!=="x"?x(re.y):1,V.signX||(V.signX=ue),V.signY||(V.signY=ce),ge.lockScalingFlip&&(V.signX!==ue||V.signY!==ce))return!1;if(oe=ge._getTransformedDimensions(),Ie&&!we){var Hi=Math.abs(re.x)+Math.abs(re.y),ke=V.original,xt=Hi/(Math.abs(oe.x*ke.scaleX/ge.scaleX)+Math.abs(oe.y*ke.scaleY/ge.scaleY));he=ke.scaleX*xt,le=ke.scaleY*xt}else he=Math.abs(re.x*ge.scaleX/oe.x),le=Math.abs(re.y*ge.scaleY/oe.y);L(V)&&(he*=2,le*=2),V.signX!==ue&&we!=="y"&&(V.originX=v[V.originX],he*=-1,V.signX=ue),V.signY!==ce&&we!=="x"&&(V.originY=v[V.originY],le*=-1,V.signY=ce)}var bn=ge.scaleX,Yi=ge.scaleY;return we?(we==="x"&&ge.set("scaleX",he),we==="y"&&ge.set("scaleY",le)):(!ye&&ge.set("scaleX",he),!me&&ge.set("scaleY",le)),bn!==ge.scaleX||Yi!==ge.scaleY}r.scaleCursorStyleHandler=function(U,V,X){var te=O(U,X),Z="";if(V.x!==0&&V.y===0?Z="x":V.x===0&&V.y!==0&&(Z="y"),W(X,Z,te))return"not-allowed";var re=b(X,V);return c[re]+"-resize"},r.skewCursorStyleHandler=function(U,V,X){var te="not-allowed";if(V.x!==0&&X.lockSkewingY||V.y!==0&&X.lockSkewingX)return te;var Z=b(X,V)%4;return f[Z]+"-resize"},r.scaleSkewCursorStyleHandler=function(U,V,X){return U[X.canvas.altActionKey]?r.skewCursorStyleHandler(U,V,X):r.scaleCursorStyleHandler(U,V,X)},r.rotationWithSnapping=K("rotating",J(function(U,V,X,te){var Z=V,re=Z.target,he=re.translateToOriginPoint(re.getCenterPoint(),Z.originX,Z.originY);if(re.lockRotation)return!1;var le,oe=Math.atan2(Z.ey-he.y,Z.ex-he.x),ue=Math.atan2(te-he.y,X-he.x),ce=C(ue-oe+Z.theta);if(re.snapAngle>0){var ge=re.snapAngle,ye=re.snapThreshold||ge,me=Math.ceil(ce/ge)*ge,we=Math.floor(ce/ge)*ge;Math.abs(ce-we)<ye?ce=we:Math.abs(ce-me)<ye&&(ce=me)}return ce<0&&(ce=360+ce),ce%=360,le=re.angle!==ce,re.angle=ce,le})),r.scalingEqually=K("scaling",J(function(U,V,X,te){return ee(U,V,X,te)})),r.scalingX=K("scaling",J(function(U,V,X,te){return ee(U,V,X,te,{by:"x"})})),r.scalingY=K("scaling",J(function(U,V,X,te){return ee(U,V,X,te,{by:"y"})})),r.scalingYOrSkewingX=function(U,V,X,te){return U[V.target.canvas.altActionKey]?r.skewHandlerX(U,V,X,te):r.scalingY(U,V,X,te)},r.scalingXOrSkewingY=function(U,V,X,te){return U[V.target.canvas.altActionKey]?r.skewHandlerY(U,V,X,te):r.scalingX(U,V,X,te)},r.changeWidth=K("resizing",J(function(U,V,X,te){var Z=V.target,re=Y(V,V.originX,V.originY,X,te),he=Z.strokeWidth/(Z.strokeUniform?Z.scaleX:1),le=L(V)?2:1,oe=Z.width,ue=Math.abs(re.x*le/Z.scaleX)-he;return Z.set("width",Math.max(ue,0)),oe!==ue})),r.skewHandlerX=function(U,V,X,te){var Z,re=V.target,he=re.skewX,le=V.originY;return!re.lockSkewingX&&(he===0?Z=Y(V,p,p,X,te).x>0?s:m:(he>0&&(Z=le===h?s:m),he<0&&(Z=le===h?m:s),N(re)&&(Z=Z===s?m:s)),V.originX=Z,K("skewing",J(H))(U,V,X,te))},r.skewHandlerY=function(U,V,X,te){var Z,re=V.target,he=re.skewY,le=V.originX;return!re.lockSkewingY&&(he===0?Z=Y(V,p,p,X,te).y>0?h:g:(he>0&&(Z=le===s?h:g),he<0&&(Z=le===s?g:h),N(re)&&(Z=Z===h?g:h)),V.originY=Z,K("skewing",J(Q))(U,V,X,te))},r.dragHandler=function(U,V,X,te){var Z=V.target,re=X-V.offsetX,he=te-V.offsetY,le=!Z.get("lockMovementX")&&Z.left!==re,oe=!Z.get("lockMovementY")&&Z.top!==he;return le&&Z.set("left",re),oe&&Z.set("top",he),(le||oe)&&E("moving",G(U,V,X,te)),le||oe},r.scaleOrSkewActionName=function(U,V,X){var te=U[X.canvas.altActionKey];return V.x===0?te?"skewX":"scaleY":V.y===0?te?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(U,V,X){return X.lockRotation?"not-allowed":V.cursorStyle},r.fireEvent=E,r.wrapWithFixedAnchor=J,r.wrapWithFireEvent=K,r.getLocalPoint=Y,a.controlsUtils=r}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.degreesToRadians,f=a.controlsUtils;f.renderCircleControl=function(r,s,h,m,g){m=m||{};var p,v=this.sizeX||m.cornerSize||g.cornerSize,C=this.sizeY||m.cornerSize||g.cornerSize,x=m.transparentCorners!==void 0?m.transparentCorners:g.transparentCorners,b=x?"stroke":"fill",E=!x&&(m.cornerStrokeColor||g.cornerStrokeColor),O=s,L=h;r.save(),r.fillStyle=m.cornerColor||g.cornerColor,r.strokeStyle=m.cornerStrokeColor||g.cornerStrokeColor,v>C?(p=v,r.scale(1,C/v),L=h*v/C):C>v?(p=C,r.scale(v/C,1),O=s*C/v):p=v,r.lineWidth=1,r.beginPath(),r.arc(O,L,p/2,0,2*Math.PI,!1),r[b](),E&&r.stroke(),r.restore()},f.renderSquareControl=function(r,s,h,m,g){m=m||{};var p=this.sizeX||m.cornerSize||g.cornerSize,v=this.sizeY||m.cornerSize||g.cornerSize,C=m.transparentCorners!==void 0?m.transparentCorners:g.transparentCorners,x=C?"stroke":"fill",b=!C&&(m.cornerStrokeColor||g.cornerStrokeColor),E=p/2,O=v/2;r.save(),r.fillStyle=m.cornerColor||g.cornerColor,r.strokeStyle=m.cornerStrokeColor||g.cornerStrokeColor,r.lineWidth=1,r.translate(s,h),r.rotate(c(g.angle)),r[x+"Rect"](-E,-O,p,v),b&&r.strokeRect(-E,-O,p,v),r.restore()}}(e),function(u){var a=u.fabric||(u.fabric={});a.Control=function(c){for(var f in c)this[f]=c[f]},a.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(c,f){return f.cursorStyle},getActionName:function(c,f){return f.actionName},getVisibility:function(c,f){var r=c._controlsVisibility;return r&&r[f]!==void 0?r[f]:this.visible},setVisibility:function(c){this.visible=c},positionHandler:function(c,f){return a.util.transformPoint({x:this.x*c.x+this.offsetX,y:this.y*c.y+this.offsetY},f)},calcCornerCoords:function(c,f,r,s,h){var m,g,p,v,C=h?this.touchSizeX:this.sizeX,x=h?this.touchSizeY:this.sizeY;if(C&&x&&C!==x){var b=Math.atan2(x,C),E=Math.sqrt(C*C+x*x)/2,O=b-a.util.degreesToRadians(c),L=Math.PI/2-b-a.util.degreesToRadians(c);m=E*a.util.cos(O),g=E*a.util.sin(O),p=E*a.util.cos(L),v=E*a.util.sin(L)}else E=.7071067812*(C&&x?C:f),O=a.util.degreesToRadians(45-c),m=p=E*a.util.cos(O),g=v=E*a.util.sin(O);return{tl:{x:r-v,y:s-p},tr:{x:r+m,y:s-g},bl:{x:r-m,y:s+g},br:{x:r+v,y:s+p}}},render:function(c,f,r,s,h){((s=s||{}).cornerStyle||h.cornerStyle)==="circle"?a.controlsUtils.renderCircleControl.call(this,c,f,r,s,h):a.controlsUtils.renderSquareControl.call(this,c,f,r,s,h)}}}(e),function(){function u(c,f){var r,s,h,m,g=c.getAttribute("style"),p=c.getAttribute("offset")||0;if(p=(p=parseFloat(p)/(/%$/.test(p)?100:1))<0?0:p>1?1:p,g){var v=g.split(/\s*;\s*/);for(v[v.length-1]===""&&v.pop(),m=v.length;m--;){var C=v[m].split(/\s*:\s*/),x=C[0].trim(),b=C[1].trim();x==="stop-color"?r=b:x==="stop-opacity"&&(h=b)}}return r||(r=c.getAttribute("stop-color")||"rgb(0,0,0)"),h||(h=c.getAttribute("stop-opacity")),s=(r=new y.Color(r)).getAlpha(),h=isNaN(parseFloat(h))?1:parseFloat(h),h*=s*f,{offset:p,color:r.toRgb(),opacity:h}}var a=y.util.object.clone;y.Gradient=y.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(c){c||(c={}),c.coords||(c.coords={});var f,r=this;Object.keys(c).forEach(function(s){r[s]=c[s]}),this.id?this.id+="_"+y.Object.__uid++:this.id=y.Object.__uid++,f={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0},this.type==="radial"&&(f.r1=c.coords.r1||0,f.r2=c.coords.r2||0),this.coords=f,this.colorStops=c.colorStops.slice()},addColorStop:function(c){for(var f in c){var r=new y.Color(c[f]);this.colorStops.push({offset:parseFloat(f),color:r.toRgb(),opacity:r.getAlpha()})}return this},toObject:function(c){var f={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return y.util.populateWithProperties(this,f,c),f},toSVG:function(c,f){var r,s,h,m,g=a(this.coords,!0),p=(f=f||{},a(this.colorStops,!0)),v=g.r1>g.r2,C=this.gradientTransform?this.gradientTransform.concat():y.iMatrix.concat(),x=-this.offsetX,b=-this.offsetY,E=!!f.additionalTransform,O=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(p.sort(function(J,K){return J.offset-K.offset}),O==="objectBoundingBox"?(x/=c.width,b/=c.height):(x+=c.width/2,b+=c.height/2),c.type==="path"&&this.gradientUnits!=="percentage"&&(x-=c.pathOffset.x,b-=c.pathOffset.y),C[4]-=x,C[5]-=b,m='id="SVGID_'+this.id+'" gradientUnits="'+O+'"',m+=' gradientTransform="'+(E?f.additionalTransform+" ":"")+y.util.matrixToSVG(C)+'" ',this.type==="linear"?h=["<linearGradient ",m,' x1="',g.x1,'" y1="',g.y1,'" x2="',g.x2,'" y2="',g.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",m,' cx="',v?g.x1:g.x2,'" cy="',v?g.y1:g.y2,'" r="',v?g.r1:g.r2,'" fx="',v?g.x2:g.x1,'" fy="',v?g.y2:g.y1,`">
`]),this.type==="radial"){if(v)for((p=p.concat()).reverse(),r=0,s=p.length;r<s;r++)p[r].offset=1-p[r].offset;var L=Math.min(g.r1,g.r2);if(L>0){var W=L/Math.max(g.r1,g.r2);for(r=0,s=p.length;r<s;r++)p[r].offset+=W*(1-p[r].offset)}}for(r=0,s=p.length;r<s;r++){var G=p[r];h.push("<stop ",'offset="',100*G.offset+"%",'" style="stop-color:',G.color,G.opacity!==void 0?";stop-opacity: "+G.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(c){var f,r,s,h=y.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?f=c.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(f=c.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2)),r=0,s=this.colorStops.length;r<s;r++){var m=this.colorStops[r].color,g=this.colorStops[r].opacity,p=this.colorStops[r].offset;g!==void 0&&(m=new y.Color(m).setAlpha(g).toRgba()),f.addColorStop(p,m)}return f}}}),y.util.object.extend(y.Gradient,{fromElement:function(c,f,r,s){var h=parseFloat(r)/(/%$/.test(r)?100:1);h=h<0?0:h>1?1:h,isNaN(h)&&(h=1);var m,g,p,v,C=c.getElementsByTagName("stop"),x=c.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",b=c.getAttribute("gradientTransform")||"",E=[],O=0,L=0;for(c.nodeName==="linearGradient"||c.nodeName==="LINEARGRADIENT"?(m="linear",g=function(W){return{x1:W.getAttribute("x1")||0,y1:W.getAttribute("y1")||0,x2:W.getAttribute("x2")||"100%",y2:W.getAttribute("y2")||0}}(c)):(m="radial",g=function(W){return{x1:W.getAttribute("fx")||W.getAttribute("cx")||"50%",y1:W.getAttribute("fy")||W.getAttribute("cy")||"50%",r1:0,x2:W.getAttribute("cx")||"50%",y2:W.getAttribute("cy")||"50%",r2:W.getAttribute("r")||"50%"}}(c)),p=C.length;p--;)E.push(u(C[p],h));return v=y.parseTransformAttribute(b),function(W,G,J,K){var Y,N;Object.keys(G).forEach(function(B){(Y=G[B])==="Infinity"?N=1:Y==="-Infinity"?N=0:(N=parseFloat(G[B],10),typeof Y=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(Y)&&(N*=.01,K==="pixels"&&(B!=="x1"&&B!=="x2"&&B!=="r2"||(N*=J.viewBoxWidth||J.width),B!=="y1"&&B!=="y2"||(N*=J.viewBoxHeight||J.height)))),G[B]=N})}(0,g,s,x),x==="pixels"&&(O=-f.left,L=-f.top),new y.Gradient({id:c.getAttribute("id"),type:m,coords:g,colorStops:E,gradientUnits:x,gradientTransform:v,offsetX:O,offsetY:L})}})}(),D=y.util.toFixed,y.Pattern=y.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(u,a){if(u||(u={}),this.id=y.Object.__uid++,this.setOptions(u),!u.source||u.source&&typeof u.source!="string")a&&a(this);else{var c=this;this.source=y.util.createImage(),y.util.loadImage(u.source,function(f,r){c.source=f,a&&a(c,r)},null,this.crossOrigin)}},toObject:function(u){var a,c,f=y.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?a=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(a=this.source.toDataURL()),c={type:"pattern",source:a,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:D(this.offsetX,f),offsetY:D(this.offsetY,f),patternTransform:this.patternTransform?this.patternTransform.concat():null},y.util.populateWithProperties(this,c,u),c},toSVG:function(u){var a=typeof this.source=="function"?this.source():this.source,c=a.width/u.width,f=a.height/u.height,r=this.offsetX/u.width,s=this.offsetY/u.height,h="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(f=1,s&&(f+=Math.abs(s))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(c=1,r&&(c+=Math.abs(r))),a.src?h=a.src:a.toDataURL&&(h=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+s+'" width="'+c+'" height="'+f+`">
<image x="0" y="0" width="`+a.width+'" height="'+a.height+'" xlink:href="'+h+`"></image>
</pattern>
`},setOptions:function(u){for(var a in u)this[a]=u[a]},toLive:function(u){var a=this.source;return!a||a.src!==void 0&&(!a.complete||a.naturalWidth===0||a.naturalHeight===0)?"":u.createPattern(a,this.repeat)}}),function(u){var a=u.fabric||(u.fabric={}),c=a.util.toFixed;a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(f){for(var r in typeof f=="string"&&(f=this._parseShadow(f)),f)this[r]=f[r];this.id=a.Object.__uid++},_parseShadow:function(f){var r=f.trim(),s=a.Shadow.reOffsetsAndBlur.exec(r)||[];return{color:(r.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(s[1],10)||0,offsetY:parseFloat(s[2],10)||0,blur:parseFloat(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var r=40,s=40,h=a.Object.NUM_FRACTION_DIGITS,m=a.util.rotateVector({x:this.offsetX,y:this.offsetY},a.util.degreesToRadians(-f.angle)),g=new a.Color(this.color);return f.width&&f.height&&(r=100*c((Math.abs(m.x)+this.blur)/f.width,h)+20,s=100*c((Math.abs(m.y)+this.blur)/f.height,h)+20),f.flipX&&(m.x*=-1),f.flipY&&(m.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+c(this.blur?this.blur/2:0,h)+`"></feGaussianBlur>
	<feOffset dx="`+c(m.x,h)+'" dy="'+c(m.y,h)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+g.toRgb()+'" flood-opacity="'+g.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var f={},r=a.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==r[s]&&(f[s]=this[s])},this),f}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(y.StaticCanvas)y.warn("fabric.StaticCanvas is already defined.");else{var u=y.util.object.extend,a=y.util.getElementOffset,c=y.util.removeFromArray,f=y.util.toFixed,r=y.util.transformPoint,s=y.util.invertTransform,h=y.util.getNodeCanvas,m=y.util.createCanvasElement,g=new Error("Could not initialize `canvas` element");y.StaticCanvas=y.util.createClass(y.CommonMethods,{initialize:function(p,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(p,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:y.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(p,v){var C=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(p),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,C),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,C),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,C),v.overlayColor&&this.setOverlayColor(v.overlayColor,C),this.calcOffset()},_isRetinaScaling:function(){return y.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,y.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var p=y.devicePixelRatio;this.__initRetinaScaling(p,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(p,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(p,v,C){v.setAttribute("width",this.width*p),v.setAttribute("height",this.height*p),C.scale(p,p)},calcOffset:function(){return this._offset=a(this.lowerCanvasEl),this},setOverlayImage:function(p,v,C){return this.__setBgOverlayImage("overlayImage",p,v,C)},setBackgroundImage:function(p,v,C){return this.__setBgOverlayImage("backgroundImage",p,v,C)},setOverlayColor:function(p,v){return this.__setBgOverlayColor("overlayColor",p,v)},setBackgroundColor:function(p,v){return this.__setBgOverlayColor("backgroundColor",p,v)},__setBgOverlayImage:function(p,v,C,x){return typeof v=="string"?y.util.loadImage(v,function(b,E){if(b){var O=new y.Image(b,x);this[p]=O,O.canvas=this}C&&C(b,E)},this,x&&x.crossOrigin):(x&&v.setOptions(x),this[p]=v,v&&(v.canvas=this),C&&C(v,!1)),this},__setBgOverlayColor:function(p,v,C){return this[p]=v,this._initGradient(v,p),this._initPattern(v,p,C),this},_createCanvasElement:function(){var p=m();if(!p||(p.style||(p.style={}),p.getContext===void 0))throw g;return p},_initOptions:function(p){var v=this.lowerCanvasEl;this._setOptions(p),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(p){p&&p.getContext?this.lowerCanvasEl=p:this.lowerCanvasEl=y.util.getById(p)||this._createCanvasElement(),y.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(p,v){return this.setDimensions({width:p},v)},setHeight:function(p,v){return this.setDimensions({height:p},v)},setDimensions:function(p,v){var C;for(var x in v=v||{},p)C=p[x],v.cssOnly||(this._setBackstoreDimension(x,p[x]),C+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(x,C);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(p,v){return this.lowerCanvasEl[p]=v,this.upperCanvasEl&&(this.upperCanvasEl[p]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[p]=v),this[p]=v,this},_setCssDimension:function(p,v){return this.lowerCanvasEl.style[p]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[p]=v),this.wrapperEl&&(this.wrapperEl.style[p]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(p){var v,C,x,b=this._activeObject,E=this.backgroundImage,O=this.overlayImage;for(this.viewportTransform=p,C=0,x=this._objects.length;C<x;C++)(v=this._objects[C]).group||v.setCoords(!0);return b&&b.setCoords(),E&&E.setCoords(!0),O&&O.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(p,v){var C=p,x=this.viewportTransform.slice(0);p=r(p,s(this.viewportTransform)),x[0]=v,x[3]=v;var b=r(p,x);return x[4]+=C.x-b.x,x[5]+=C.y-b.y,this.setViewportTransform(x)},setZoom:function(p){return this.zoomToPoint(new y.Point(0,0),p),this},absolutePan:function(p){var v=this.viewportTransform.slice(0);return v[4]=-p.x,v[5]=-p.y,this.setViewportTransform(v)},relativePan:function(p){return this.absolutePan(new y.Point(-p.x-this.viewportTransform[4],-p.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(p){this.stateful&&p.setupState(),p._set("canvas",this),p.setCoords(),this.fire("object:added",{target:p}),p.fire("added")},_onObjectRemoved:function(p){this.fire("object:removed",{target:p}),p.fire("removed"),delete p.canvas},clearContext:function(p){return p.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var p=this.contextContainer;return this.renderCanvas(p,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=y.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var p={},v=this.width,C=this.height,x=s(this.viewportTransform);return p.tl=r({x:0,y:0},x),p.br=r({x:v,y:C},x),p.tr=new y.Point(p.br.x,p.tl.y),p.bl=new y.Point(p.tl.x,p.br.y),this.vptCoords=p,p},cancelRequestedRender:function(){this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(p,v){var C=this.viewportTransform,x=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(p),y.util.setImageSmoothing(p,this.imageSmoothingEnabled),this.fire("before:render",{ctx:p}),this._renderBackground(p),p.save(),p.transform(C[0],C[1],C[2],C[3],C[4],C[5]),this._renderObjects(p,v),p.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(p),x&&(x.canvas=this,x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(p)),this._renderOverlay(p),this.controlsAboveOverlay&&this.interactive&&this.drawControls(p),this.fire("after:render",{ctx:p})},drawClipPathOnCanvas:function(p){var v=this.viewportTransform,C=this.clipPath;p.save(),p.transform(v[0],v[1],v[2],v[3],v[4],v[5]),p.globalCompositeOperation="destination-in",C.transform(p),p.scale(1/C.zoomX,1/C.zoomY),p.drawImage(C._cacheCanvas,-C.cacheTranslationX,-C.cacheTranslationY),p.restore()},_renderObjects:function(p,v){var C,x;for(C=0,x=v.length;C<x;++C)v[C]&&v[C].render(p)},_renderBackgroundOrOverlay:function(p,v){var C=this[v+"Color"],x=this[v+"Image"],b=this.viewportTransform,E=this[v+"Vpt"];if(C||x){if(C){p.save(),p.beginPath(),p.moveTo(0,0),p.lineTo(this.width,0),p.lineTo(this.width,this.height),p.lineTo(0,this.height),p.closePath(),p.fillStyle=C.toLive?C.toLive(p,this):C,E&&p.transform(b[0],b[1],b[2],b[3],b[4],b[5]),p.transform(1,0,0,1,C.offsetX||0,C.offsetY||0);var O=C.gradientTransform||C.patternTransform;O&&p.transform(O[0],O[1],O[2],O[3],O[4],O[5]),p.fill(),p.restore()}x&&(p.save(),E&&p.transform(b[0],b[1],b[2],b[3],b[4],b[5]),x.render(p),p.restore())}},_renderBackground:function(p){this._renderBackgroundOrOverlay(p,"background")},_renderOverlay:function(p){this._renderBackgroundOrOverlay(p,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new y.Point(this.width/2,this.height/2)},centerObjectH:function(p){return this._centerObject(p,new y.Point(this.getCenterPoint().x,p.getCenterPoint().y))},centerObjectV:function(p){return this._centerObject(p,new y.Point(p.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(p){var v=this.getCenterPoint();return this._centerObject(p,v)},viewportCenterObject:function(p){var v=this.getVpCenter();return this._centerObject(p,v)},viewportCenterObjectH:function(p){var v=this.getVpCenter();return this._centerObject(p,new y.Point(v.x,p.getCenterPoint().y)),this},viewportCenterObjectV:function(p){var v=this.getVpCenter();return this._centerObject(p,new y.Point(p.getCenterPoint().x,v.y))},getVpCenter:function(){var p=this.getCenterPoint(),v=s(this.viewportTransform);return r(p,v)},_centerObject:function(p,v){return p.setPositionByOrigin(v,"center","center"),p.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(p){return this.toDatalessObject(p)},toObject:function(p){return this._toObjectMethod("toObject",p)},toDatalessObject:function(p){return this._toObjectMethod("toDatalessObject",p)},_toObjectMethod:function(p,v){var C=this.clipPath,x={version:y.version,objects:this._toObjects(p,v)};return C&&!C.excludeFromExport&&(x.clipPath=this._toObject(this.clipPath,p,v)),u(x,this.__serializeBgOverlay(p,v)),y.util.populateWithProperties(this,x,v),x},_toObjects:function(p,v){return this._objects.filter(function(C){return!C.excludeFromExport}).map(function(C){return this._toObject(C,p,v)},this)},_toObject:function(p,v,C){var x;this.includeDefaultValues||(x=p.includeDefaultValues,p.includeDefaultValues=!1);var b=p[v](C);return this.includeDefaultValues||(p.includeDefaultValues=x),b},__serializeBgOverlay:function(p,v){var C={},x=this.backgroundImage,b=this.overlayImage,E=this.backgroundColor,O=this.overlayColor;return E&&E.toObject?E.excludeFromExport||(C.background=E.toObject(v)):E&&(C.background=E),O&&O.toObject?O.excludeFromExport||(C.overlay=O.toObject(v)):O&&(C.overlay=O),x&&!x.excludeFromExport&&(C.backgroundImage=this._toObject(x,p,v)),b&&!b.excludeFromExport&&(C.overlayImage=this._toObject(b,p,v)),C},svgViewportTransformation:!0,toSVG:function(p,v){p||(p={}),p.reviver=v;var C=[];return this._setSVGPreamble(C,p),this._setSVGHeader(C,p),this.clipPath&&C.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(C,"background"),this._setSVGBgOverlayImage(C,"backgroundImage",v),this._setSVGObjects(C,v),this.clipPath&&C.push(`</g>
`),this._setSVGBgOverlayColor(C,"overlay"),this._setSVGBgOverlayImage(C,"overlayImage",v),C.push("</svg>"),C.join("")},_setSVGPreamble:function(p,v){v.suppressPreamble||p.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(p,v){var C,x=v.width||this.width,b=v.height||this.height,E='viewBox="0 0 '+this.width+" "+this.height+'" ',O=y.Object.NUM_FRACTION_DIGITS;v.viewBox?E='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(C=this.viewportTransform,E='viewBox="'+f(-C[4]/C[0],O)+" "+f(-C[5]/C[3],O)+" "+f(this.width/C[0],O)+" "+f(this.height/C[3],O)+'" '),p.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',x,'" ','height="',b,'" ',E,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",y.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(p){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+y.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(p.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var p=this;return["background","overlay"].map(function(v){var C=p[v+"Color"];if(C&&C.toLive){var x=p[v+"Vpt"],b=p.viewportTransform,E={width:p.width/(x?b[0]:1),height:p.height/(x?b[3]:1)};return C.toSVG(E,{additionalTransform:x?y.util.matrixToSVG(b):""})}}).join("")},createSVGFontFacesMarkup:function(){var p,v,C,x,b,E,O,L,W="",G={},J=y.fontPaths,K=[];for(this._objects.forEach(function N(B){K.push(B),B._objects&&B._objects.forEach(N)}),O=0,L=K.length;O<L;O++)if(v=(p=K[O]).fontFamily,p.type.indexOf("text")!==-1&&!G[v]&&J[v]&&(G[v]=!0,p.styles))for(b in C=p.styles)for(E in x=C[b])!G[v=x[E].fontFamily]&&J[v]&&(G[v]=!0);for(var Y in G)W+=[`		@font-face {
`,"			font-family: '",Y,`';
`,"			src: url('",J[Y],`');
`,`		}
`].join("");return W&&(W=['	<style type="text/css">',`<![CDATA[
`,W,"]]>",`</style>
`].join("")),W},_setSVGObjects:function(p,v){var C,x,b,E=this._objects;for(x=0,b=E.length;x<b;x++)(C=E[x]).excludeFromExport||this._setSVGObject(p,C,v)},_setSVGObject:function(p,v,C){p.push(v.toSVG(C))},_setSVGBgOverlayImage:function(p,v,C){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&p.push(this[v].toSVG(C))},_setSVGBgOverlayColor:function(p,v){var C=this[v+"Color"],x=this.viewportTransform,b=this.width,E=this.height;if(C)if(C.toLive){var O=C.repeat,L=y.util.invertTransform(x),W=this[v+"Vpt"]?y.util.matrixToSVG(L):"";p.push('<rect transform="'+W+" translate(",b/2,",",E/2,')"',' x="',C.offsetX-b/2,'" y="',C.offsetY-E/2,'" ','width="',O==="repeat-y"||O==="no-repeat"?C.source.width:b,'" height="',O==="repeat-x"||O==="no-repeat"?C.source.height:E,'" fill="url(#SVGID_'+C.id+')"',`></rect>
`)}else p.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',C,'"',`></rect>
`)},sendToBack:function(p){if(!p)return this;var v,C,x,b=this._activeObject;if(p===b&&p.type==="activeSelection")for(v=(x=b._objects).length;v--;)C=x[v],c(this._objects,C),this._objects.unshift(C);else c(this._objects,p),this._objects.unshift(p);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(p){if(!p)return this;var v,C,x,b=this._activeObject;if(p===b&&p.type==="activeSelection")for(x=b._objects,v=0;v<x.length;v++)C=x[v],c(this._objects,C),this._objects.push(C);else c(this._objects,p),this._objects.push(p);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(p,v){if(!p)return this;var C,x,b,E,O,L=this._activeObject,W=0;if(p===L&&p.type==="activeSelection")for(O=L._objects,C=0;C<O.length;C++)x=O[C],(b=this._objects.indexOf(x))>0+W&&(E=b-1,c(this._objects,x),this._objects.splice(E,0,x)),W++;else(b=this._objects.indexOf(p))!==0&&(E=this._findNewLowerIndex(p,b,v),c(this._objects,p),this._objects.splice(E,0,p));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(p,v,C){var x,b;if(C){for(x=v,b=v-1;b>=0;--b)if(p.intersectsWithObject(this._objects[b])||p.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(p)){x=b;break}}else x=v-1;return x},bringForward:function(p,v){if(!p)return this;var C,x,b,E,O,L=this._activeObject,W=0;if(p===L&&p.type==="activeSelection")for(C=(O=L._objects).length;C--;)x=O[C],(b=this._objects.indexOf(x))<this._objects.length-1-W&&(E=b+1,c(this._objects,x),this._objects.splice(E,0,x)),W++;else(b=this._objects.indexOf(p))!==this._objects.length-1&&(E=this._findNewUpperIndex(p,b,v),c(this._objects,p),this._objects.splice(E,0,p));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(p,v,C){var x,b,E;if(C){for(x=v,b=v+1,E=this._objects.length;b<E;++b)if(p.intersectsWithObject(this._objects[b])||p.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(p)){x=b;break}}else x=v+1;return x},moveTo:function(p,v){return c(this._objects,p),this._objects.splice(v,0,p),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),y.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),y.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),u(y.StaticCanvas.prototype,y.Observable),u(y.StaticCanvas.prototype,y.Collection),u(y.StaticCanvas.prototype,y.DataURLExporter),u(y.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(p){var v=m();if(!v||!v.getContext)return null;var C=v.getContext("2d");return C&&p==="setLineDash"?C.setLineDash!==void 0:null}}),y.StaticCanvas.prototype.toJSON=y.StaticCanvas.prototype.toObject,y.isLikelyNode&&(y.StaticCanvas.prototype.createPNGStream=function(){var p=h(this.lowerCanvasEl);return p&&p.createPNGStream()},y.StaticCanvas.prototype.createJPEGStream=function(p){var v=h(this.lowerCanvasEl);return v&&v.createJPEGStream(p)})}}(),y.BaseBrush=y.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(u){u.strokeStyle=this.color,u.lineWidth=this.width,u.lineCap=this.strokeLineCap,u.miterLimit=this.strokeMiterLimit,u.lineJoin=this.strokeLineJoin,u.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(u){var a=this.canvas.viewportTransform;u.save(),u.transform(a[0],a[1],a[2],a[3],a[4],a[5])},_setShadow:function(){if(this.shadow){var u=this.canvas,a=this.shadow,c=u.contextTop,f=u.getZoom();u&&u._isRetinaScaling()&&(f*=y.devicePixelRatio),c.shadowColor=a.color,c.shadowBlur=a.blur*f,c.shadowOffsetX=a.offsetX*f,c.shadowOffsetY=a.offsetY*f}},needsFullRender:function(){return new y.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var u=this.canvas.contextTop;u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0},_isOutSideCanvas:function(u){return u.x<0||u.x>this.canvas.getWidth()||u.y<0||u.y>this.canvas.getHeight()}}),y.PencilBrush=y.util.createClass(y.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(u){this.canvas=u,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(u,a,c){var f=a.midPointFrom(c);return u.quadraticCurveTo(a.x,a.y,f.x,f.y),f},onMouseDown:function(u,a){this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],this._prepareForDrawing(u),this._captureDrawingPath(u),this._render())},onMouseMove:function(u,a){if(this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(u))&&this._captureDrawingPath(u)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var c=this._points,f=c.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,c[f-2],c[f-1],!0),r.stroke(),r.restore()}},onMouseUp:function(u){return!this.canvas._isMainEvent(u.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(u){var a=new y.Point(u.x,u.y);this._reset(),this._addPoint(a),this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(u){return!(this._points.length>1&&u.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(u),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(u){var a=new y.Point(u.x,u.y);return this._addPoint(a)},_render:function(u){var a,c,f=this._points[0],r=this._points[1];if(u=u||this.canvas.contextTop,this._saveAndTransform(u),u.beginPath(),this._points.length===2&&f.x===r.x&&f.y===r.y){var s=this.width/1e3;f=new y.Point(f.x,f.y),r=new y.Point(r.x,r.y),f.x-=s,r.x+=s}for(u.moveTo(f.x,f.y),a=1,c=this._points.length;a<c;a++)this._drawSegment(u,f,r),f=this._points[a],r=this._points[a+1];u.lineTo(f.x,f.y),u.stroke(),u.restore()},convertPointsToSVGPath:function(u){var a=this.width/1e3;return y.util.getSmoothPathFromPoints(u,a)},_isEmptySVGPath:function(u){return y.util.joinPath(u)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(u){var a=new y.Path(u,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,a.shadow=new y.Shadow(this.shadow)),a},decimatePoints:function(u,a){if(u.length<=2)return u;var c,f=this.canvas.getZoom(),r=Math.pow(a/f,2),s=u.length-1,h=u[0],m=[h];for(c=1;c<s-1;c++)Math.pow(h.x-u[c].x,2)+Math.pow(h.y-u[c].y,2)>=r&&(h=u[c],m.push(h));return m.push(u[s]),m},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var u=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(u))this.canvas.requestRenderAll();else{var a=this.createPath(u);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.requestRenderAll(),a.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:a})}}}),y.CircleBrush=y.util.createClass(y.BaseBrush,{width:10,initialize:function(u){this.canvas=u,this.points=[]},drawDot:function(u){var a=this.addPoint(u),c=this.canvas.contextTop;this._saveAndTransform(c),this.dot(c,a),c.restore()},dot:function(u,a){u.fillStyle=a.fill,u.beginPath(),u.arc(a.x,a.y,a.radius,0,2*Math.PI,!1),u.closePath(),u.fill()},onMouseDown:function(u){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(u)},_render:function(){var u,a,c=this.canvas.contextTop,f=this.points;for(this._saveAndTransform(c),u=0,a=f.length;u<a;u++)this.dot(c,f[u]);c.restore()},onMouseMove:function(u){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(u),this._render()):this.drawDot(u))},onMouseUp:function(){var u,a,c=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var f=[];for(u=0,a=this.points.length;u<a;u++){var r=this.points[u],s=new y.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(s.shadow=new y.Shadow(this.shadow)),f.push(s)}var h=new y.Group(f);h.canvas=this.canvas,this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},addPoint:function(u){var a=new y.Point(u.x,u.y),c=y.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,f=new y.Color(this.color).setAlpha(y.util.getRandomInt(0,100)/100).toRgba();return a.radius=c,a.fill=f,this.points.push(a),a}}),y.SprayBrush=y.util.createClass(y.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(u){this.canvas=u,this.sprayChunks=[]},onMouseDown:function(u){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(u),this.render(this.sprayChunkPoints)},onMouseMove:function(u){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(u)||(this.addSprayChunk(u),this.render(this.sprayChunkPoints))},onMouseUp:function(){var u=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],c=0,f=this.sprayChunks.length;c<f;c++)for(var r=this.sprayChunks[c],s=0,h=r.length;s<h;s++){var m=new y.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});a.push(m)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));var g=new y.Group(a);this.shadow&&g.set("shadow",new y.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:g}),this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=u,this.canvas.requestRenderAll()},_getOptimizedRects:function(u){var a,c,f,r={};for(c=0,f=u.length;c<f;c++)r[a=u[c].left+""+u[c].top]||(r[a]=u[c]);var s=[];for(a in r)s.push(r[a]);return s},render:function(u){var a,c,f=this.canvas.contextTop;for(f.fillStyle=this.color,this._saveAndTransform(f),a=0,c=u.length;a<c;a++){var r=u[a];r.opacity!==void 0&&(f.globalAlpha=r.opacity),f.fillRect(r.x,r.y,r.width,r.width)}f.restore()},_render:function(){var u,a,c=this.canvas.contextTop;for(c.fillStyle=this.color,this._saveAndTransform(c),u=0,a=this.sprayChunks.length;u<a;u++)this.render(this.sprayChunks[u]);c.restore()},addSprayChunk:function(u){this.sprayChunkPoints=[];var a,c,f,r,s=this.width/2;for(r=0;r<this.density;r++){a=y.util.getRandomInt(u.x-s,u.x+s),c=y.util.getRandomInt(u.y-s,u.y+s),f=this.dotWidthVariance?y.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var h=new y.Point(a,c);h.width=f,this.randomOpacity&&(h.opacity=y.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),y.PatternBrush=y.util.createClass(y.PencilBrush,{getPatternSrc:function(){var u=y.util.createCanvasElement(),a=u.getContext("2d");return u.width=u.height=25,a.fillStyle=this.color,a.beginPath(),a.arc(10,10,10,0,2*Math.PI,!1),a.closePath(),a.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(u){return u.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(u){this.callSuper("_setBrushStyles",u),u.strokeStyle=this.getPattern(u)},createPath:function(u){var a=this.callSuper("createPath",u),c=a._getLeftTopCoords().scalarAdd(a.strokeWidth/2);return a.stroke=new y.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),a}}),function(){var u=y.util.getPointer,a=y.util.degreesToRadians,c=y.util.isTouchEvent;for(var f in y.Canvas=y.util.createClass(y.StaticCanvas,{initialize:function(r,s){s||(s={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,s),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=y.PencilBrush&&new y.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r,s,h,m=this.getActiveObjects();if(m.length>0&&!this.preserveObjectStacking){s=[],h=[];for(var g=0,p=this._objects.length;g<p;g++)r=this._objects[g],m.indexOf(r)===-1?s.push(r):h.push(r);m.length>1&&(this._activeObject._objects=h),s.push.apply(s,h)}else s=this._objects;return s},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,s){var h=r.calcTransformMatrix(),m=y.util.invertTransform(h),g=this.restorePointerVpt(s);return y.util.transformPoint(g,m)},isTargetTransparent:function(r,s,h){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var m=this._normalizePointer(r,{x:s,y:h}),g=Math.max(r.cacheTranslationX+m.x*r.zoomX,0),p=Math.max(r.cacheTranslationY+m.y*r.zoomY,0);return y.util.isTransparent(r._cacheContext,Math.round(g),Math.round(p),this.targetFindTolerance)}var v=this.contextCache,C=r.selectionBackgroundColor,x=this.viewportTransform;return r.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(x[0],x[1],x[2],x[3],x[4],x[5]),r.render(v),v.restore(),r.selectionBackgroundColor=C,y.util.isTransparent(v,s,h,this.targetFindTolerance)},_isSelectionKeyPressed:function(r){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(s){return r[s]===!0}):r[this.selectionKey]},_shouldClearSelection:function(r,s){var h=this.getActiveObjects(),m=this._activeObject;return!s||s&&m&&h.length>1&&h.indexOf(s)===-1&&m!==s&&!this._isSelectionKeyPressed(r)||s&&!s.evented||s&&!s.selectable&&m&&m!==s},_shouldCenterTransform:function(r,s,h){var m;if(r)return s==="scale"||s==="scaleX"||s==="scaleY"||s==="resizing"?m=this.centeredScaling||r.centeredScaling:s==="rotate"&&(m=this.centeredRotation||r.centeredRotation),m?!h:h},_getOriginFromCorner:function(r,s){var h={x:r.originX,y:r.originY};return s==="ml"||s==="tl"||s==="bl"?h.x="right":s!=="mr"&&s!=="tr"&&s!=="br"||(h.x="left"),s==="tl"||s==="mt"||s==="tr"?h.y="bottom":s!=="bl"&&s!=="mb"&&s!=="br"||(h.y="top"),h},_getActionFromCorner:function(r,s,h,m){if(!s||!r)return"drag";var g=m.controls[s];return g.getActionName(h,g,m)},_setupCurrentTransform:function(r,s,h){if(s){var m=this.getPointer(r),g=s.__corner,p=s.controls[g],v=h&&g?p.getActionHandler(r,s,p):y.controlsUtils.dragHandler,C=this._getActionFromCorner(h,g,r,s),x=this._getOriginFromCorner(s,g),b=r[this.centeredKey],E={target:s,action:C,actionHandler:v,corner:g,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,offsetX:m.x-s.left,offsetY:m.y-s.top,originX:x.x,originY:x.y,ex:m.x,ey:m.y,lastX:m.x,lastY:m.y,theta:a(s.angle),width:s.width*s.scaleX,shiftKey:r.shiftKey,altKey:b,original:y.util.saveObjectTransform(s)};this._shouldCenterTransform(s,C,b)&&(E.originX="center",E.originY="center"),E.original.originX=x.x,E.original.originY=x.y,this._currentTransform=E,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var s=this._groupSelector,h=new y.Point(s.ex,s.ey),m=y.util.transformPoint(h,this.viewportTransform),g=new y.Point(s.ex+s.left,s.ey+s.top),p=y.util.transformPoint(g,this.viewportTransform),v=Math.min(m.x,p.x),C=Math.min(m.y,p.y),x=Math.max(m.x,p.x),b=Math.max(m.y,p.y),E=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(v,C,x-v,b-C)),this.selectionLineWidth&&this.selectionBorderColor&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,v+=E,C+=E,x-=E,b-=E,y.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(v,C,x-v,b-C))},findTarget:function(r,s){if(!this.skipTargetFind){var h,m,g=this.getPointer(r,!0),p=this._activeObject,v=this.getActiveObjects(),C=c(r),x=v.length>1&&!s||v.length===1;if(this.targets=[],x&&p._findTargetCorner(g,C)||v.length>1&&!s&&p===this._searchPossibleTargets([p],g))return p;if(v.length===1&&p===this._searchPossibleTargets([p],g)){if(!this.preserveObjectStacking)return p;h=p,m=this.targets,this.targets=[]}var b=this._searchPossibleTargets(this._objects,g);return r[this.altSelectionKey]&&b&&h&&b!==h&&(b=h,this.targets=m),b}},_checkTarget:function(r,s,h){if(s&&s.visible&&s.evented&&s.containsPoint(r)&&(!this.perPixelTargetFind&&!s.perPixelTargetFind||s.isEditing||!this.isTargetTransparent(s,h.x,h.y)))return!0},_searchPossibleTargets:function(r,s){for(var h,m,g=r.length;g--;){var p=r[g],v=p.group?this._normalizePointer(p.group,s):s;if(this._checkTarget(v,p,s)){(h=r[g]).subTargetCheck&&h instanceof y.Group&&(m=this._searchPossibleTargets(h._objects,s))&&this.targets.push(m);break}}return h},restorePointerVpt:function(r){return y.util.transformPoint(r,y.util.invertTransform(this.viewportTransform))},getPointer:function(r,s){if(this._absolutePointer&&!s)return this._absolutePointer;if(this._pointer&&s)return this._pointer;var h,m=u(r),g=this.upperCanvasEl,p=g.getBoundingClientRect(),v=p.width||0,C=p.height||0;v&&C||("top"in p&&"bottom"in p&&(C=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(v=Math.abs(p.right-p.left))),this.calcOffset(),m.x=m.x-this._offset.left,m.y=m.y-this._offset.top,s||(m=this.restorePointerVpt(m));var x=this.getRetinaScaling();return x!==1&&(m.x/=x,m.y/=x),h=v===0||C===0?{width:1,height:1}:{width:g.width/v,height:g.height/C},{x:m.x*h.width,y:m.y*h.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),s=this.lowerCanvasEl,h=this.upperCanvasEl;h?h.className="":(h=this._createCanvasElement(),this.upperCanvasEl=h),y.util.addClass(h,"upper-canvas "+r),this.wrapperEl.appendChild(h),this._copyCanvasStyle(s,h),this._applyCanvasStyle(h),this.contextTop=h.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=y.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),y.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),y.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var s=this.width||r.width,h=this.height||r.height;y.util.setStyle(r,{position:"absolute",width:s+"px",height:h+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=s,r.height=h,y.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,s){s.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,s){var h=!1,m=this.getActiveObjects(),g=[],p=[];r.forEach(function(v){m.indexOf(v)===-1&&(h=!0,v.fire("deselected",{e:s,target:v}),p.push(v))}),m.forEach(function(v){r.indexOf(v)===-1&&(h=!0,v.fire("selected",{e:s,target:v}),g.push(v))}),r.length>0&&m.length>0?h&&this.fire("selection:updated",{e:s,selected:g,deselected:p}):m.length>0?this.fire("selection:created",{e:s,selected:g}):r.length>0&&this.fire("selection:cleared",{e:s,deselected:p})},setActiveObject:function(r,s){var h=this.getActiveObjects();return this._setActiveObject(r,s),this._fireSelectionEvents(h,s),this},_setActiveObject:function(r,s){return this._activeObject!==r&&!!this._discardActiveObject(s,r)&&!r.onSelect({e:s})&&(this._activeObject=r,!0)},_discardActiveObject:function(r,s){var h=this._activeObject;if(h){if(h.onDeselect({e:r,object:s}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var s=this.getActiveObjects(),h=this.getActiveObject();return s.length&&this.fire("before:selection:cleared",{target:h,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(s,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(s){y.util.cleanUpJsdomNode(this[s]),this[s]=void 0}.bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,y.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var s=this._activeObject;s&&s._renderControls(r)},_toObject:function(r,s,h){var m=this._realizeGroupTransformOnObject(r),g=this.callSuper("_toObject",r,s,h);return this._unwindGroupTransformOnObject(r,m),g},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var s={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(h){s[h]=r[h]}),y.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),s}return null},_unwindGroupTransformOnObject:function(r,s){s&&r.set(s)},_setSVGObject:function(r,s,h){var m=this._realizeGroupTransformOnObject(s);this.callSuper("_setSVGObject",r,s,h),this._unwindGroupTransformOnObject(s,m)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),y.StaticCanvas.prototype.setViewportTransform.call(this,r)}}),y.StaticCanvas)f!=="prototype"&&(y.Canvas[f]=y.StaticCanvas[f])}(),function(){var u=y.util.addListener,a=y.util.removeListener,c={passive:!1};function f(r,s){return r.button&&r.button===s-1}y.util.object.extend(y.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(u,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(r,s){var h=this.upperCanvasEl,m=this._getEventPrefix();r(y.window,"resize",this._onResize),r(h,m+"down",this._onMouseDown),r(h,m+"move",this._onMouseMove,c),r(h,m+"out",this._onMouseOut),r(h,m+"enter",this._onMouseEnter),r(h,"wheel",this._onMouseWheel),r(h,"contextmenu",this._onContextMenu),r(h,"dblclick",this._onDoubleClick),r(h,"dragover",this._onDragOver),r(h,"dragenter",this._onDragEnter),r(h,"dragleave",this._onDragLeave),r(h,"drop",this._onDrop),this.enablePointerEvents||r(h,"touchstart",this._onTouchStart,c),typeof eventjs<"u"&&s in eventjs&&(eventjs[s](h,"gesture",this._onGesture),eventjs[s](h,"drag",this._onDrag),eventjs[s](h,"orientation",this._onOrientationChange),eventjs[s](h,"shake",this._onShake),eventjs[s](h,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(a,"remove");var r=this._getEventPrefix();a(y.document,r+"up",this._onMouseUp),a(y.document,"touchend",this._onTouchEnd,c),a(y.document,r+"move",this._onMouseMove,c),a(y.document,"touchmove",this._onMouseMove,c)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(r,s){this.__onTransformGesture&&this.__onTransformGesture(r,s)},_onDrag:function(r,s){this.__onDrag&&this.__onDrag(r,s)},_onMouseWheel:function(r){this.__onMouseWheel(r)},_onMouseOut:function(r){var s=this._hoveredTarget;this.fire("mouse:out",{target:s,e:r}),this._hoveredTarget=null,s&&s.fire("mouseout",{e:r});var h=this;this._hoveredTargets.forEach(function(m){h.fire("mouse:out",{target:s,e:r}),m&&s.fire("mouseout",{e:r})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(m){m.isEditing&&m.hiddenTextarea.focus()})},_onMouseEnter:function(r){this._currentTransform||this.findTarget(r)||(this.fire("mouse:over",{target:null,e:r}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(r,s){this.__onOrientationChange&&this.__onOrientationChange(r,s)},_onShake:function(r,s){this.__onShake&&this.__onShake(r,s)},_onLongPress:function(r,s){this.__onLongPress&&this.__onLongPress(r,s)},_onDragOver:function(r){r.preventDefault();var s=this._simpleEventHandler("dragover",r);this._fireEnterLeaveEvents(s,r)},_onDrop:function(r){return this._simpleEventHandler("drop:before",r),this._simpleEventHandler("drop",r)},_onContextMenu:function(r){return this.stopContextMenu&&(r.stopPropagation(),r.preventDefault()),!1},_onDoubleClick:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"dblclick"),this._resetTransformEventData(r)},getPointerId:function(r){var s=r.changedTouches;return s?s[0]&&s[0].identifier:this.enablePointerEvents?r.pointerId:-1},_isMainEvent:function(r){return r.isPrimary===!0||r.isPrimary!==!1&&(r.type==="touchend"&&r.touches.length===0||!r.changedTouches||r.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(r){r.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(r)),this.__onMouseDown(r),this._resetTransformEventData();var s=this.upperCanvasEl,h=this._getEventPrefix();u(y.document,"touchend",this._onTouchEnd,c),u(y.document,"touchmove",this._onMouseMove,c),a(s,h+"down",this._onMouseDown)},_onMouseDown:function(r){this.__onMouseDown(r),this._resetTransformEventData();var s=this.upperCanvasEl,h=this._getEventPrefix();a(s,h+"move",this._onMouseMove,c),u(y.document,h+"up",this._onMouseUp),u(y.document,h+"move",this._onMouseMove,c)},_onTouchEnd:function(r){if(!(r.touches.length>0)){this.__onMouseUp(r),this._resetTransformEventData(),this.mainTouchId=null;var s=this._getEventPrefix();a(y.document,"touchend",this._onTouchEnd,c),a(y.document,"touchmove",this._onMouseMove,c);var h=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){u(h.upperCanvasEl,s+"down",h._onMouseDown),h._willAddMouseDown=0},400)}},_onMouseUp:function(r){this.__onMouseUp(r),this._resetTransformEventData();var s=this.upperCanvasEl,h=this._getEventPrefix();this._isMainEvent(r)&&(a(y.document,h+"up",this._onMouseUp),a(y.document,h+"move",this._onMouseMove,c),u(s,h+"move",this._onMouseMove,c))},_onMouseMove:function(r){!this.allowTouchScrolling&&r.preventDefault&&r.preventDefault(),this.__onMouseMove(r)},_onResize:function(){this.calcOffset()},_shouldRender:function(r){var s=this._activeObject;return!!(!!s!=!!r||s&&r&&s!==r)||(s&&s.isEditing,!1)},__onMouseUp:function(r){var s,h=this._currentTransform,m=this._groupSelector,g=!1,p=!m||m.left===0&&m.top===0;if(this._cacheTransformEventData(r),s=this._target,this._handleEvent(r,"up:before"),f(r,3))this.fireRightClick&&this._handleEvent(r,"up",3,p);else{if(f(r,2))return this.fireMiddleClick&&this._handleEvent(r,"up",2,p),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(r);else if(this._isMainEvent(r)){if(h&&(this._finalizeCurrentTransform(r),g=h.actionPerformed),!p){var v=s===this._activeObject;this._maybeGroupObjects(r),g||(g=this._shouldRender(s)||!v&&s===this._activeObject)}var C,x;if(s){if(C=s._findTargetCorner(this.getPointer(r,!0),y.util.isTouchEvent(r)),s.selectable&&s!==this._activeObject&&s.activeOn==="up")this.setActiveObject(s,r),g=!0;else{var b=s.controls[C],E=b&&b.getMouseUpHandler(r,s,b);E&&E(r,h,(x=this.getPointer(r)).x,x.y)}s.isMoving=!1}if(h&&(h.target!==s||h.corner!==C)){var O=h.target&&h.target.controls[h.corner],L=O&&O.getMouseUpHandler(r,s,b);x=x||this.getPointer(r),L&&L(r,h,x.x,x.y)}this._setCursorFromEvent(r,s),this._handleEvent(r,"up",1,p),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=0),g?this.requestRenderAll():p||this.renderTop()}}},_simpleEventHandler:function(r,s){var h=this.findTarget(s),m=this.targets,g={e:s,target:h,subTargets:m};if(this.fire(r,g),h&&h.fire(r,g),!m)return h;for(var p=0;p<m.length;p++)m[p].fire(r,g);return h},_handleEvent:function(r,s,h,m){var g=this._target,p=this.targets||[],v={e:r,target:g,subTargets:p,button:h||1,isClick:m||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};s==="up"&&(v.currentTarget=this.findTarget(r),v.currentSubTargets=this.targets),this.fire("mouse:"+s,v),g&&g.fire("mouse"+s,v);for(var C=0;C<p.length;C++)p[C].fire("mouse"+s,v)},_finalizeCurrentTransform:function(r){var s=this._currentTransform,h=s.target,m={e:r,target:h,transform:s,action:s.action};h._scaling&&(h._scaling=!1),h.setCoords(),(s.actionPerformed||this.stateful&&h.hasStateChanged())&&this._fire("modified",m)},_onMouseDownInDrawingMode:function(r){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(r).requestRenderAll();var s=this.getPointer(r);this.freeDrawingBrush.onMouseDown(s,{e:r,pointer:s}),this._handleEvent(r,"down")},_onMouseMoveInDrawingMode:function(r){if(this._isCurrentlyDrawing){var s=this.getPointer(r);this.freeDrawingBrush.onMouseMove(s,{e:r,pointer:s})}this.setCursor(this.freeDrawingCursor),this._handleEvent(r,"move")},_onMouseUpInDrawingMode:function(r){var s=this.getPointer(r);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:r,pointer:s}),this._handleEvent(r,"up")},__onMouseDown:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"down:before");var s=this._target;if(f(r,3))this.fireRightClick&&this._handleEvent(r,"down",3);else if(f(r,2))this.fireMiddleClick&&this._handleEvent(r,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(r);else if(this._isMainEvent(r)&&!this._currentTransform){var h=this._pointer;this._previousPointer=h;var m=this._shouldRender(s),g=this._shouldGroup(r,s);if(this._shouldClearSelection(r,s)?this.discardActiveObject(r):g&&(this._handleGrouping(r,s),s=this._activeObject),!this.selection||s&&(s.selectable||s.isEditing||s===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),s){var p=s===this._activeObject;s.selectable&&s.activeOn==="down"&&this.setActiveObject(s,r);var v=s._findTargetCorner(this.getPointer(r,!0),y.util.isTouchEvent(r));if(s.__corner=v,s===this._activeObject&&(v||!g)){this._setupCurrentTransform(r,s,p);var C=s.controls[v],x=(h=this.getPointer(r),C&&C.getMouseDownHandler(r,s,C));x&&x(r,this._currentTransform,h.x,h.y)}}this._handleEvent(r,"down"),(m||g)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(r){this._resetTransformEventData(),this._pointer=this.getPointer(r,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(r)||null},_beforeTransform:function(r){var s=this._currentTransform;this.stateful&&s.target.saveState(),this.fire("before:transform",{e:r,transform:s})},__onMouseMove:function(r){var s,h;if(this._handleEvent(r,"move:before"),this._cacheTransformEventData(r),this.isDrawingMode)this._onMouseMoveInDrawingMode(r);else if(this._isMainEvent(r)){var m=this._groupSelector;m?(h=this._absolutePointer,m.left=h.x-m.ex,m.top=h.y-m.ey,this.renderTop()):this._currentTransform?this._transformObject(r):(s=this.findTarget(r)||null,this._setCursorFromEvent(r,s),this._fireOverOutEvents(s,r)),this._handleEvent(r,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(r,s){var h=this._hoveredTarget,m=this._hoveredTargets,g=this.targets,p=Math.max(m.length,g.length);this.fireSyntheticInOutEvents(r,s,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<p;v++)this.fireSyntheticInOutEvents(g[v],s,{oldTarget:m[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(r,s){var h=this._draggedoverTarget,m=this._hoveredTargets,g=this.targets,p=Math.max(m.length,g.length);this.fireSyntheticInOutEvents(r,s,{oldTarget:h,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<p;v++)this.fireSyntheticInOutEvents(g[v],s,{oldTarget:m[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=r},fireSyntheticInOutEvents:function(r,s,h){var m,g,p,v=h.oldTarget,C=v!==r,x=h.canvasEvtIn,b=h.canvasEvtOut;C&&(m={e:s,target:r,previousTarget:v},g={e:s,target:v,nextTarget:r}),p=r&&C,v&&C&&(b&&this.fire(b,g),v.fire(h.evtOut,g)),p&&(x&&this.fire(x,m),r.fire(h.evtIn,m))},__onMouseWheel:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"wheel"),this._resetTransformEventData()},_transformObject:function(r){var s=this.getPointer(r),h=this._currentTransform;h.reset=!1,h.shiftKey=r.shiftKey,h.altKey=r[this.centeredKey],this._performTransformAction(r,h,s),h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(r,s,h){var m=h.x,g=h.y,p=s.action,v=!1,C=s.actionHandler;C&&(v=C(r,s,m,g)),p==="drag"&&v&&(s.target.isMoving=!0,this.setCursor(s.target.moveCursor||this.moveCursor)),s.actionPerformed=s.actionPerformed||v},_fire:y.controlsUtils.fireEvent,_setCursorFromEvent:function(r,s){if(!s)return this.setCursor(this.defaultCursor),!1;var h=s.hoverCursor||this.hoverCursor,m=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,g=(!m||!m.contains(s))&&s._findTargetCorner(this.getPointer(r,!0));g?this.setCursor(this.getCornerCursor(g,s,r)):(s.subTargetCheck&&this.targets.concat().reverse().map(function(p){h=p.hoverCursor||h}),this.setCursor(h))},getCornerCursor:function(r,s,h){var m=s.controls[r];return m.cursorStyleHandler(h,m,s)}})}(),R=Math.min,M=Math.max,y.util.object.extend(y.Canvas.prototype,{_shouldGroup:function(u,a){var c=this._activeObject;return c&&this._isSelectionKeyPressed(u)&&a&&a.selectable&&this.selection&&(c!==a||c.type==="activeSelection")&&!a.onSelect({e:u})},_handleGrouping:function(u,a){var c=this._activeObject;c.__corner||(a!==c||(a=this.findTarget(u,!0))&&a.selectable)&&(c&&c.type==="activeSelection"?this._updateActiveSelection(a,u):this._createActiveSelection(a,u))},_updateActiveSelection:function(u,a){var c=this._activeObject,f=c._objects.slice(0);c.contains(u)?(c.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),c.size()===1&&this._setActiveObject(c.item(0),a)):(c.addWithUpdate(u),this._hoveredTarget=c,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(f,a)},_createActiveSelection:function(u,a){var c=this.getActiveObjects(),f=this._createGroup(u);this._hoveredTarget=f,this._setActiveObject(f,a),this._fireSelectionEvents(c,a)},_createGroup:function(u){var a=this._objects,c=a.indexOf(this._activeObject)<a.indexOf(u)?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new y.ActiveSelection(c,{canvas:this})},_groupSelectedObjects:function(u){var a,c=this._collectObjects(u);c.length===1?this.setActiveObject(c[0],u):c.length>1&&(a=new y.ActiveSelection(c.reverse(),{canvas:this}),this.setActiveObject(a,u))},_collectObjects:function(u){for(var a,c=[],f=this._groupSelector.ex,r=this._groupSelector.ey,s=f+this._groupSelector.left,h=r+this._groupSelector.top,m=new y.Point(R(f,s),R(r,h)),g=new y.Point(M(f,s),M(r,h)),p=!this.selectionFullyContained,v=f===s&&r===h,C=this._objects.length;C--&&!((a=this._objects[C])&&a.selectable&&a.visible&&(p&&a.intersectsWithRect(m,g,!0)||a.isContainedWithinRect(m,g,!0)||p&&a.containsPoint(m,null,!0)||p&&a.containsPoint(g,null,!0))&&(c.push(a),v)););return c.length>1&&(c=c.filter(function(x){return!x.onSelect({e:u})})),c},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}}),y.util.object.extend(y.StaticCanvas.prototype,{toDataURL:function(u){u||(u={});var a=u.format||"png",c=u.quality||1,f=(u.multiplier||1)*(u.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(f,u);return y.util.toDataURL(r,a,c)},toCanvasElement:function(u,a){u=u||1;var c=((a=a||{}).width||this.width)*u,f=(a.height||this.height)*u,r=this.getZoom(),s=this.width,h=this.height,m=r*u,g=this.viewportTransform,p=(g[4]-(a.left||0))*u,v=(g[5]-(a.top||0))*u,C=this.interactive,x=[m,0,0,m,p,v],b=this.enableRetinaScaling,E=y.util.createCanvasElement(),O=this.contextTop;return E.width=c,E.height=f,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=x,this.width=c,this.height=f,this.calcViewportBoundaries(),this.renderCanvas(E.getContext("2d"),this._objects),this.viewportTransform=g,this.width=s,this.height=h,this.calcViewportBoundaries(),this.interactive=C,this.enableRetinaScaling=b,this.contextTop=O,E}}),y.util.object.extend(y.StaticCanvas.prototype,{loadFromJSON:function(u,a,c){if(u){var f=typeof u=="string"?JSON.parse(u):y.util.object.clone(u),r=this,s=f.clipPath,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete f.clipPath,this._enlivenObjects(f.objects,function(m){r.clear(),r._setBgOverlay(f,function(){s?r._enlivenObjects([s],function(g){r.clipPath=g[0],r.__setupCanvas.call(r,f,m,h,a)}):r.__setupCanvas.call(r,f,m,h,a)})},c),this}},__setupCanvas:function(u,a,c,f){var r=this;a.forEach(function(s,h){r.insertAt(s,h)}),this.renderOnAddRemove=c,delete u.objects,delete u.backgroundImage,delete u.overlayImage,delete u.background,delete u.overlay,this._setOptions(u),this.renderAll(),f&&f()},_setBgOverlay:function(u,a){var c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(u.backgroundImage||u.overlayImage||u.background||u.overlay){var f=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&a&&a()};this.__setBgOverlay("backgroundImage",u.backgroundImage,c,f),this.__setBgOverlay("overlayImage",u.overlayImage,c,f),this.__setBgOverlay("backgroundColor",u.background,c,f),this.__setBgOverlay("overlayColor",u.overlay,c,f)}else a&&a()},__setBgOverlay:function(u,a,c,f){var r=this;if(!a)return c[u]=!0,void(f&&f());u==="backgroundImage"||u==="overlayImage"?y.util.enlivenObjects([a],function(s){r[u]=s[0],c[u]=!0,f&&f()}):this["set"+y.util.string.capitalize(u,!0)](a,function(){c[u]=!0,f&&f()})},_enlivenObjects:function(u,a,c){u&&u.length!==0?y.util.enlivenObjects(u,function(f){a&&a(f)},null,c):a&&a([])},_toDataURL:function(u,a){this.clone(function(c){a(c.toDataURL(u))})},_toDataURLWithMultiplier:function(u,a,c){this.clone(function(f){c(f.toDataURLWithMultiplier(u,a))})},clone:function(u,a){var c=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(f){f.loadFromJSON(c,function(){u&&u(f)})})},cloneWithoutData:function(u){var a=y.util.createCanvasElement();a.width=this.width,a.height=this.height;var c=new y.Canvas(a);this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),u&&u(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):u&&u(c)}}),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.object.clone,r=a.util.toFixed,s=a.util.string.capitalize,h=a.util.degreesToRadians,m=!a.isLikelyNode;a.Object||(a.Object=a.util.createClass(a.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:m,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(g){g&&this.setOptions(g)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=a.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(g){var p=a.perfLimitSizeTotal,v=g.width,C=g.height,x=a.maxCacheSideLimit,b=a.minCacheSideLimit;if(v<=x&&C<=x&&v*C<=p)return v<b&&(g.width=b),C<b&&(g.height=b),g;var E=v/C,O=a.util.limitDimsByArea(E,p),L=a.util.capValue,W=L(b,O.x,x),G=L(b,O.y,x);return v>W&&(g.zoomX/=v/W,g.width=W,g.capped=!0),C>G&&(g.zoomY/=C/G,g.height=G,g.capped=!0),g},_getCacheCanvasDimensions:function(){var g=this.getTotalObjectScaling(),p=this._getTransformedDimensions(0,0),v=p.x*g.scaleX/this.scaleX,C=p.y*g.scaleY/this.scaleY;return{width:v+2,height:C+2,zoomX:g.scaleX,zoomY:g.scaleY,x:v,y:C}},_updateCacheCanvas:function(){var g=this.canvas;if(this.noScaleCache&&g&&g._currentTransform){var p=g._currentTransform.target,v=g._currentTransform.action;if(this===p&&v.slice&&v.slice(0,5)==="scale")return!1}var C,x,b=this._cacheCanvas,E=this._limitCacheSize(this._getCacheCanvasDimensions()),O=a.minCacheSideLimit,L=E.width,W=E.height,G=E.zoomX,J=E.zoomY,K=L!==this.cacheWidth||W!==this.cacheHeight,Y=this.zoomX!==G||this.zoomY!==J,N=K||Y,B=0,H=0,Q=!1;if(K){var ee=this._cacheCanvas.width,U=this._cacheCanvas.height,V=L>ee||W>U;Q=V||(L<.9*ee||W<.9*U)&&ee>O&&U>O,V&&!E.capped&&(L>O||W>O)&&(B=.1*L,H=.1*W)}return this instanceof a.Text&&this.path&&(N=!0,Q=!0,B+=this.getHeightOfLine(0)*this.zoomX,H+=this.getHeightOfLine(0)*this.zoomY),!!N&&(Q?(b.width=Math.ceil(L+B),b.height=Math.ceil(W+H)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,b.width,b.height)),C=E.x/2,x=E.y/2,this.cacheTranslationX=Math.round(b.width/2-C)+C,this.cacheTranslationY=Math.round(b.height/2-x)+x,this.cacheWidth=L,this.cacheHeight=W,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(G,J),this.zoomX=G,this.zoomY=J,!0)},setOptions:function(g){this._setOptions(g),this._initGradient(g.fill,"fill"),this._initGradient(g.stroke,"stroke"),this._initPattern(g.fill,"fill"),this._initPattern(g.stroke,"stroke")},transform:function(g){var p=this.group&&!this.group._transformDone||this.group&&this.canvas&&g===this.canvas.contextTop,v=this.calcTransformMatrix(!p);g.transform(v[0],v[1],v[2],v[3],v[4],v[5])},toObject:function(g){var p=a.Object.NUM_FRACTION_DIGITS,v={type:this.type,version:a.version,originX:this.originX,originY:this.originY,left:r(this.left,p),top:r(this.top,p),width:r(this.width,p),height:r(this.height,p),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,p),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,p),scaleX:r(this.scaleX,p),scaleY:r(this.scaleY,p),angle:r(this.angle,p),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,p),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,p),skewY:r(this.skewY,p)};return this.clipPath&&!this.clipPath.excludeFromExport&&(v.clipPath=this.clipPath.toObject(g),v.clipPath.inverted=this.clipPath.inverted,v.clipPath.absolutePositioned=this.clipPath.absolutePositioned),a.util.populateWithProperties(this,v,g),this.includeDefaultValues||(v=this._removeDefaultValues(v)),v},toDatalessObject:function(g){return this.toObject(g)},_removeDefaultValues:function(g){var p=a.util.getKlass(g.type).prototype;return p.stateProperties.forEach(function(v){v!=="left"&&v!=="top"&&(g[v]===p[v]&&delete g[v],Array.isArray(g[v])&&Array.isArray(p[v])&&g[v].length===0&&p[v].length===0&&delete g[v])}),g},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var g=a.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(g.scaleX),scaleY:Math.abs(g.scaleY)}},getTotalObjectScaling:function(){var g=this.getObjectScaling(),p=g.scaleX,v=g.scaleY;if(this.canvas){var C=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();p*=C*x,v*=C*x}return{scaleX:p,scaleY:v}},getObjectOpacity:function(){var g=this.opacity;return this.group&&(g*=this.group.getObjectOpacity()),g},_set:function(g,p){var v=g==="scaleX"||g==="scaleY",C=this[g]!==p,x=!1;return v&&(p=this._constrainScale(p)),g==="scaleX"&&p<0?(this.flipX=!this.flipX,p*=-1):g==="scaleY"&&p<0?(this.flipY=!this.flipY,p*=-1):g!=="shadow"||!p||p instanceof a.Shadow?g==="dirty"&&this.group&&this.group.set("dirty",p):p=new a.Shadow(p),this[g]=p,C&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(g)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(g)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:a.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(g){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(g.save(),this._setupCompositeOperation(g),this.drawSelectionBackground(g),this.transform(g),this._setOpacity(g),this._setShadow(g,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(g)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(g),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),g.restore())},renderCache:function(g){g=g||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,g.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(g,p){if(g.save(),p.inverted?g.globalCompositeOperation="destination-out":g.globalCompositeOperation="destination-in",p.absolutePositioned){var v=a.util.invertTransform(this.calcTransformMatrix());g.transform(v[0],v[1],v[2],v[3],v[4],v[5])}p.transform(g),g.scale(1/p.zoomX,1/p.zoomY),g.drawImage(p._cacheCanvas,-p.cacheTranslationX,-p.cacheTranslationY),g.restore()},drawObject:function(g,p){var v=this.fill,C=this.stroke;p?(this.fill="black",this.stroke="",this._setClippingProperties(g)):this._renderBackground(g),this._render(g),this._drawClipPath(g,this.clipPath),this.fill=v,this.stroke=C},_drawClipPath:function(g,p){p&&(p.canvas=this.canvas,p.shouldCache(),p._transformDone=!0,p.renderCache({forClipping:!0}),this.drawClipPathOnCache(g,p))},drawCacheOnCanvas:function(g){g.scale(1/this.zoomX,1/this.zoomY),g.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(g){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!g&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!g){var p=this.cacheWidth/this.zoomX,v=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-v/2,p,v)}return!0}return!1},_renderBackground:function(g){if(this.backgroundColor){var p=this._getNonTransformedDimensions();g.fillStyle=this.backgroundColor,g.fillRect(-p.x/2,-p.y/2,p.x,p.y),this._removeShadow(g)}},_setOpacity:function(g){this.group&&!this.group._transformDone?g.globalAlpha=this.getObjectOpacity():g.globalAlpha*=this.opacity},_setStrokeStyles:function(g,p){var v=p.stroke;v&&(g.lineWidth=p.strokeWidth,g.lineCap=p.strokeLineCap,g.lineDashOffset=p.strokeDashOffset,g.lineJoin=p.strokeLineJoin,g.miterLimit=p.strokeMiterLimit,v.toLive?v.gradientUnits==="percentage"||v.gradientTransform||v.patternTransform?this._applyPatternForTransformedGradient(g,v):(g.strokeStyle=v.toLive(g,this),this._applyPatternGradientTransform(g,v)):g.strokeStyle=p.stroke)},_setFillStyles:function(g,p){var v=p.fill;v&&(v.toLive?(g.fillStyle=v.toLive(g,this),this._applyPatternGradientTransform(g,p.fill)):g.fillStyle=v)},_setClippingProperties:function(g){g.globalAlpha=1,g.strokeStyle="transparent",g.fillStyle="#000000"},_setLineDash:function(g,p){p&&p.length!==0&&(1&p.length&&p.push.apply(p,p),g.setLineDash(p))},_renderControls:function(g,p){var v,C,x,b=this.getViewportTransform(),E=this.calcTransformMatrix();C=(p=p||{}).hasBorders!==void 0?p.hasBorders:this.hasBorders,x=p.hasControls!==void 0?p.hasControls:this.hasControls,E=a.util.multiplyTransformMatrices(b,E),v=a.util.qrDecompose(E),g.save(),g.translate(v.translateX,v.translateY),g.lineWidth=1*this.borderScaleFactor,this.group||(g.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(v.angle-=180),g.rotate(h(this.group?v.angle:this.angle)),p.forActiveSelection||this.group?C&&this.drawBordersInGroup(g,v,p):C&&this.drawBorders(g,p),x&&this.drawControls(g,p),g.restore()},_setShadow:function(g){if(this.shadow){var p,v=this.shadow,C=this.canvas,x=C&&C.viewportTransform[0]||1,b=C&&C.viewportTransform[3]||1;p=v.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),C&&C._isRetinaScaling()&&(x*=a.devicePixelRatio,b*=a.devicePixelRatio),g.shadowColor=v.color,g.shadowBlur=v.blur*a.browserShadowBlurConstant*(x+b)*(p.scaleX+p.scaleY)/4,g.shadowOffsetX=v.offsetX*x*p.scaleX,g.shadowOffsetY=v.offsetY*b*p.scaleY}},_removeShadow:function(g){this.shadow&&(g.shadowColor="",g.shadowBlur=g.shadowOffsetX=g.shadowOffsetY=0)},_applyPatternGradientTransform:function(g,p){if(!p||!p.toLive)return{offsetX:0,offsetY:0};var v=p.gradientTransform||p.patternTransform,C=-this.width/2+p.offsetX||0,x=-this.height/2+p.offsetY||0;return p.gradientUnits==="percentage"?g.transform(this.width,0,0,this.height,C,x):g.transform(1,0,0,1,C,x),v&&g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),{offsetX:C,offsetY:x}},_renderPaintInOrder:function(g){this.paintFirst==="stroke"?(this._renderStroke(g),this._renderFill(g)):(this._renderFill(g),this._renderStroke(g))},_render:function(){},_renderFill:function(g){this.fill&&(g.save(),this._setFillStyles(g,this),this.fillRule==="evenodd"?g.fill("evenodd"):g.fill(),g.restore())},_renderStroke:function(g){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(g),g.save(),this.strokeUniform&&this.group){var p=this.getObjectScaling();g.scale(1/p.scaleX,1/p.scaleY)}else this.strokeUniform&&g.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(g,this.strokeDashArray),this._setStrokeStyles(g,this),g.stroke(),g.restore()}},_applyPatternForTransformedGradient:function(g,p){var v,C=this._limitCacheSize(this._getCacheCanvasDimensions()),x=a.util.createCanvasElement(),b=this.canvas.getRetinaScaling(),E=C.x/this.scaleX/b,O=C.y/this.scaleY/b;x.width=E,x.height=O,(v=x.getContext("2d")).beginPath(),v.moveTo(0,0),v.lineTo(E,0),v.lineTo(E,O),v.lineTo(0,O),v.closePath(),v.translate(E/2,O/2),v.scale(C.zoomX/this.scaleX/b,C.zoomY/this.scaleY/b),this._applyPatternGradientTransform(v,p),v.fillStyle=p.toLive(g),v.fill(),g.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),g.scale(b*this.scaleX/C.zoomX,b*this.scaleY/C.zoomY),g.strokeStyle=v.createPattern(x,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var g=a.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",g.scaleX),this.set("scaleY",g.scaleY),this.angle=g.angle,this.skewX=g.skewX,this.skewY=0}},_removeTransformMatrix:function(g){var p=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),p=a.util.transformPoint(p,this.transformMatrix)),this.transformMatrix=null,g&&(this.scaleX*=g.scaleX,this.scaleY*=g.scaleY,this.cropX=g.cropX,this.cropY=g.cropY,p.x+=g.offsetLeft,p.y+=g.offsetTop,this.width=g.width,this.height=g.height),this.setPositionByOrigin(p,"center","center")},clone:function(g,p){var v=this.toObject(p);this.constructor.fromObject?this.constructor.fromObject(v,g):a.Object._fromObject("Object",v,g)},cloneAsImage:function(g,p){var v=this.toCanvasElement(p);return g&&g(new a.Image(v)),this},toCanvasElement:function(g){g||(g={});var p=a.util,v=p.saveObjectTransform(this),C=this.group,x=this.shadow,b=Math.abs,E=(g.multiplier||1)*(g.enableRetinaScaling?a.devicePixelRatio:1);delete this.group,g.withoutTransform&&p.resetObjectTransform(this),g.withoutShadow&&(this.shadow=null);var O,L,W,G,J=a.util.createCanvasElement(),K=this.getBoundingRect(!0,!0),Y=this.shadow,N={x:0,y:0};Y&&(L=Y.blur,O=Y.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),N.x=2*Math.round(b(Y.offsetX)+L)*b(O.scaleX),N.y=2*Math.round(b(Y.offsetY)+L)*b(O.scaleY)),W=K.width+N.x,G=K.height+N.y,J.width=Math.ceil(W),J.height=Math.ceil(G);var B=new a.StaticCanvas(J,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});g.format==="jpeg"&&(B.backgroundColor="#fff"),this.setPositionByOrigin(new a.Point(B.width/2,B.height/2),"center","center");var H=this.canvas;B.add(this);var Q=B.toCanvasElement(E||1,g);return this.shadow=x,this.set("canvas",H),C&&(this.group=C),this.set(v).setCoords(),B._objects=[],B.dispose(),B=null,Q},toDataURL:function(g){return g||(g={}),a.util.toDataURL(this.toCanvasElement(g),g.format||"png",g.quality||1)},isType:function(g){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===g},complexity:function(){return 1},toJSON:function(g){return this.toObject(g)},rotate:function(g){var p=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return p&&this._setOriginToCenter(),this.set("angle",g),p&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(g,p){p=p||this.canvas.getPointer(g);var v=new a.Point(p.x,p.y),C=this._getLeftTopCoords();return this.angle&&(v=a.util.rotatePoint(v,C,h(-this.angle))),{x:v.x-C.x,y:v.y-C.y}},_setupCompositeOperation:function(g){this.globalCompositeOperation&&(g.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){a.runningAnimations&&a.runningAnimations.cancelByTarget(this)}}),a.util.createAccessors&&a.util.createAccessors(a.Object),c(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.ENLIVEN_PROPS=["clipPath"],a.Object._fromObject=function(g,p,v,C){var x=a[g];p=f(p,!0),a.util.enlivenPatterns([p.fill,p.stroke],function(b){b[0]!==void 0&&(p.fill=b[0]),b[1]!==void 0&&(p.stroke=b[1]),a.util.enlivenObjectEnlivables(p,p,function(){var E=C?new x(p[C],p):new x(p);v&&v(E)})})},a.Object.__uid=0)}(e),$=y.util.degreesToRadians,ie={left:-.5,center:0,right:.5},ne={top:-.5,center:0,bottom:.5},y.util.object.extend(y.Object.prototype,{translateToGivenOrigin:function(u,a,c,f,r){var s,h,m,g=u.x,p=u.y;return typeof a=="string"?a=ie[a]:a-=.5,typeof f=="string"?f=ie[f]:f-=.5,typeof c=="string"?c=ne[c]:c-=.5,typeof r=="string"?r=ne[r]:r-=.5,h=r-c,((s=f-a)||h)&&(m=this._getTransformedDimensions(),g=u.x+s*m.x,p=u.y+h*m.y),new y.Point(g,p)},translateToCenterPoint:function(u,a,c){var f=this.translateToGivenOrigin(u,a,c,"center","center");return this.angle?y.util.rotatePoint(f,u,$(this.angle)):f},translateToOriginPoint:function(u,a,c){var f=this.translateToGivenOrigin(u,"center","center",a,c);return this.angle?y.util.rotatePoint(f,u,$(this.angle)):f},getCenterPoint:function(){var u=new y.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,a){var c=this.getCenterPoint();return this.translateToOriginPoint(c,u,a)},toLocalPoint:function(u,a,c){var f,r,s=this.getCenterPoint();return f=a!==void 0&&c!==void 0?this.translateToGivenOrigin(s,"center","center",a,c):new y.Point(this.left,this.top),r=new y.Point(u.x,u.y),this.angle&&(r=y.util.rotatePoint(r,s,-$(this.angle))),r.subtractEquals(f)},setPositionByOrigin:function(u,a,c){var f=this.translateToCenterPoint(u,a,c),r=this.translateToOriginPoint(f,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(u){var a,c,f=$(this.angle),r=this.getScaledWidth(),s=y.util.cos(f)*r,h=y.util.sin(f)*r;a=typeof this.originX=="string"?ie[this.originX]:this.originX-.5,c=typeof u=="string"?ie[u]:u-.5,this.left+=s*(c-a),this.top+=h*(c-a),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var u=y.util,a=u.degreesToRadians,c=u.multiplyTransformMatrices,f=u.transformPoint;u.object.extend(y.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,s){return s?r?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,s){return h=this._getCoords(r,s),[new y.Point(h.tl.x,h.tl.y),new y.Point(h.tr.x,h.tr.y),new y.Point(h.br.x,h.br.y),new y.Point(h.bl.x,h.bl.y)];var h},intersectsWithRect:function(r,s,h,m){var g=this.getCoords(h,m);return y.Intersection.intersectPolygonRectangle(g,r,s).status==="Intersection"},intersectsWithObject:function(r,s,h){return y.Intersection.intersectPolygonPolygon(this.getCoords(s,h),r.getCoords(s,h)).status==="Intersection"||r.isContainedWithinObject(this,s,h)||this.isContainedWithinObject(r,s,h)},isContainedWithinObject:function(r,s,h){for(var m=this.getCoords(s,h),g=s?r.aCoords:r.lineCoords,p=0,v=r._getImageLines(g);p<4;p++)if(!r.containsPoint(m[p],v))return!1;return!0},isContainedWithinRect:function(r,s,h,m){var g=this.getBoundingRect(h,m);return g.left>=r.x&&g.left+g.width<=s.x&&g.top>=r.y&&g.top+g.height<=s.y},containsPoint:function(r,s,h,m){var g=this._getCoords(h,m),p=(s=s||this._getImageLines(g),this._findCrossPoints(r,s));return p!==0&&p%2==1},isOnScreen:function(r){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.getCoords(!0,r).some(function(m){return m.x<=h.x&&m.x>=s.x&&m.y<=h.y&&m.y>=s.y})||!!this.intersectsWithRect(s,h,!0,r)||this._containsCenterOfCanvas(s,h,r)},_containsCenterOfCanvas:function(r,s,h){var m={x:(r.x+s.x)/2,y:(r.y+s.y)/2};return!!this.containsPoint(m,null,!0,h)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.intersectsWithRect(s,h,!0,r)||this.getCoords(!0,r).every(function(m){return(m.x>=h.x||m.x<=s.x)&&(m.y>=h.y||m.y<=s.y)})&&this._containsCenterOfCanvas(s,h,r)},_getImageLines:function(r){return{topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}}},_findCrossPoints:function(r,s){var h,m,g,p=0;for(var v in s)if(!((g=s[v]).o.y<r.y&&g.d.y<r.y||g.o.y>=r.y&&g.d.y>=r.y||(g.o.x===g.d.x&&g.o.x>=r.x?m=g.o.x:(h=(g.d.y-g.o.y)/(g.d.x-g.o.x),m=-(r.y-0*r.x-(g.o.y-h*g.o.x))/(0-h)),m>=r.x&&(p+=1),p!==2)))break;return p},getBoundingRect:function(r,s){var h=this.getCoords(r,s);return u.makeBoundingBoxFromPoints(h)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,s){var h=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(r/this.width/h)},scaleToHeight:function(r,s){var h=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(r/this.height/h)},calcLineCoords:function(){var r=this.getViewportTransform(),s=this.padding,h=a(this.angle),m=u.cos(h)*s,g=u.sin(h)*s,p=m+g,v=m-g,C=this.calcACoords(),x={tl:f(C.tl,r),tr:f(C.tr,r),bl:f(C.bl,r),br:f(C.br,r)};return s&&(x.tl.x-=v,x.tl.y-=p,x.tr.x+=p,x.tr.y-=v,x.bl.x-=p,x.bl.y+=v,x.br.x+=v,x.br.y+=p),x},calcOCoords:function(){var r=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),h=this.getViewportTransform(),m=c(h,s),g=c(m,r),p=(g=c(g,[1/h[0],0,0,1/h[3],0,0]),this._calculateCurrentDimensions()),v={};return this.forEachControl(function(C,x,b){v[x]=C.positionHandler(p,g,b)}),v},calcACoords:function(){var r=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),h=c(s,r),m=this._getTransformedDimensions(),g=m.x/2,p=m.y/2;return{tl:f({x:-g,y:-p},h),tr:f({x:g,y:-p},h),bl:f({x:-g,y:p},h),br:f({x:g,y:p},h)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return u.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var s="_",h="";return!r&&this.group&&(h=this.group.transformMatrixKey(r)+s),h+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var s=this.calcOwnMatrix();if(r||!this.group)return s;var h=this.transformMatrixKey(r),m=this.matrixCache||(this.matrixCache={});return m.key===h?m.value:(this.group&&(s=c(this.group.calcTransformMatrix(!1),s)),m.key=h,m.value=s,s)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===r)return s.value;var h=this._calcTranslateMatrix(),m={angle:this.angle,translateX:h[4],translateY:h[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return s.key=r,s.value=u.composeMatrix(m),s.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth;return{x:this.width+r,y:this.height+r}},_getTransformedDimensions:function(r,s){r===void 0&&(r=this.skewX),s===void 0&&(s=this.skewY);var h,m,g,p=r===0&&s===0;if(this.strokeUniform?(m=this.width,g=this.height):(m=(h=this._getNonTransformedDimensions()).x,g=h.y),p)return this._finalizeDimensions(m*this.scaleX,g*this.scaleY);var v=u.sizeAfterTransform(m,g,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:s});return this._finalizeDimensions(v.x,v.y)},_finalizeDimensions:function(r,s){return this.strokeUniform?{x:r+this.strokeWidth,y:s+this.strokeWidth}:{x:r,y:s}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),s=this._getTransformedDimensions();return f(s,r,!0).scalarAdd(2*this.padding)}})}(),y.util.object.extend(y.Object.prototype,{sendToBack:function(){return this.group?y.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?y.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(u){return this.group?y.StaticCanvas.prototype.sendBackwards.call(this.group,this,u):this.canvas&&this.canvas.sendBackwards(this,u),this},bringForward:function(u){return this.group?y.StaticCanvas.prototype.bringForward.call(this.group,this,u):this.canvas&&this.canvas.bringForward(this,u),this},moveTo:function(u){return this.group&&this.group.type!=="activeSelection"?y.StaticCanvas.prototype.moveTo.call(this.group,this,u):this.canvas&&this.canvas.moveTo(this,u),this}}),function(){function u(c,f){if(f){if(f.toLive)return c+": url(#SVGID_"+f.id+"); ";var r=new y.Color(f),s=c+": "+r.toRgb()+"; ",h=r.getAlpha();return h!==1&&(s+=c+"-opacity: "+h.toString()+"; "),s}return c+": none; "}var a=y.util.toFixed;y.util.object.extend(y.Object.prototype,{getSvgStyles:function(c){var f=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",h=this.strokeDashOffset?this.strokeDashOffset:"0",m=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",p=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=this.opacity!==void 0?this.opacity:"1",C=this.visible?"":" visibility: hidden;",x=c?"":this.getSvgFilter(),b=u("fill",this.fill);return[u("stroke",this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",m,"; ","stroke-dashoffset: ",h,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",p,"; ",b,"fill-rule: ",f,"; ","opacity: ",v,";",x,C].join("")},getSvgSpanStyles:function(c,f){var r="; ",s=c.fontFamily?"font-family: "+(c.fontFamily.indexOf("'")===-1&&c.fontFamily.indexOf('"')===-1?"'"+c.fontFamily+"'":c.fontFamily)+r:"",h=c.strokeWidth?"stroke-width: "+c.strokeWidth+r:"",m=c.fontSize?"font-size: "+c.fontSize+"px"+r:"",g=c.fontStyle?"font-style: "+c.fontStyle+r:"",p=c.fontWeight?"font-weight: "+c.fontWeight+r:"",v=c.fill?u("fill",c.fill):"",C=c.stroke?u("stroke",c.stroke):"",x=this.getSvgTextDecoration(c);return x&&(x="text-decoration: "+x+r),[C,h,s,m,g,p,x,v,c.deltaY?"baseline-shift: "+-c.deltaY+"; ":"",f?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(c){return["overline","underline","line-through"].filter(function(f){return c[f.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(c,f){var r=c?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+y.util.matrixToSVG(r)+(f||"")+'" '},_setSVGBg:function(c){if(this.backgroundColor){var f=y.Object.NUM_FRACTION_DIGITS;c.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,f),'" y="',a(-this.height/2,f),'" width="',a(this.width,f),'" height="',a(this.height,f),`"></rect>
`)}},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(c),{reviver:c})},toClipPathSVG:function(c){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(c),{reviver:c})},_createBaseClipPathSVGMarkup:function(c,f){var r=(f=f||{}).reviver,s=f.additionalTransform||"",h=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),m=c.indexOf("COMMON_PARTS");return c[m]=h,r?r(c.join("")):c.join("")},_createBaseSVGMarkup:function(c,f){var r,s,h=(f=f||{}).noStyle,m=f.reviver,g=h?"":'style="'+this.getSvgStyles()+'" ',p=f.withShadow?'style="'+this.getSvgFilter()+'" ':"",v=this.clipPath,C=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",x=v&&v.absolutePositioned,b=this.stroke,E=this.fill,O=this.shadow,L=[],W=c.indexOf("COMMON_PARTS"),G=f.additionalTransform;return v&&(v.clipPathId="CLIPPATH_"+y.Object.__uid++,s='<clipPath id="'+v.clipPathId+`" >
`+v.toClipPathSVG(m)+`</clipPath>
`),x&&L.push("<g ",p,this.getSvgCommons(),` >
`),L.push("<g ",this.getSvgTransform(!1),x?"":p+this.getSvgCommons(),` >
`),r=[g,C,h?"":this.addPaintOrder()," ",G?'transform="'+G+'" ':""].join(""),c[W]=r,E&&E.toLive&&L.push(E.toSVG(this)),b&&b.toLive&&L.push(b.toSVG(this)),O&&L.push(O.toSVG(this)),v&&L.push(s),L.push(c.join("")),L.push(`</g>
`),x&&L.push(`</g>
`),m?m(L.join("")):L.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var u=y.util.object.extend,a="stateProperties";function c(r,s,h){var m={};h.forEach(function(g){m[g]=r[g]}),u(r[s],m,!0)}function f(r,s,h){if(r===s)return!0;if(Array.isArray(r)){if(!Array.isArray(s)||r.length!==s.length)return!1;for(var m=0,g=r.length;m<g;m++)if(!f(r[m],s[m]))return!1;return!0}if(r&&typeof r=="object"){var p,v=Object.keys(r);if(!s||typeof s!="object"||!h&&v.length!==Object.keys(s).length)return!1;for(m=0,g=v.length;m<g;m++)if((p=v[m])!=="canvas"&&p!=="group"&&!f(r[p],s[p]))return!1;return!0}}y.util.object.extend(y.Object.prototype,{hasStateChanged:function(r){var s="_"+(r=r||a);return Object.keys(this[s]).length<this[r].length||!f(this[s],this,!0)},saveState:function(r){var s=r&&r.propertySet||a,h="_"+s;return this[h]?(c(this,h,this[s]),r&&r.stateProperties&&c(this,h,r.stateProperties),this):this.setupState(r)},setupState:function(r){var s=(r=r||{}).propertySet||a;return r.propertySet=s,this["_"+s]={},this.saveState(r),this}})}(),function(){var u=y.util.degreesToRadians;y.util.object.extend(y.Object.prototype,{_findTargetCorner:function(a,c){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var f,r,s,h=a.x,m=a.y,g=Object.keys(this.oCoords),p=g.length-1;for(this.__corner=0;p>=0;p--)if(s=g[p],this.isControlVisible(s)&&(r=this._getImageLines(c?this.oCoords[s].touchCorner:this.oCoords[s].corner),(f=this._findCrossPoints({x:h,y:m},r))!==0&&f%2==1))return this.__corner=s,s;return!1},forEachControl:function(a){for(var c in this.controls)a(this.controls[c],c,this)},_setCornerCoords:function(){var a=this.oCoords;for(var c in a){var f=this.controls[c];a[c].corner=f.calcCornerCoords(this.angle,this.cornerSize,a[c].x,a[c].y,!1),a[c].touchCorner=f.calcCornerCoords(this.angle,this.touchCornerSize,a[c].x,a[c].y,!0)}},drawSelectionBackground:function(a){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;a.save();var c=this.getCenterPoint(),f=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return a.translate(c.x,c.y),a.scale(1/r[0],1/r[3]),a.rotate(u(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-f.x/2,-f.y/2,f.x,f.y),a.restore(),this},drawBorders:function(a,c){c=c||{};var f=this._calculateCurrentDimensions(),r=this.borderScaleFactor,s=f.x+r,h=f.y+r,m=c.hasControls!==void 0?c.hasControls:this.hasControls,g=!1;return a.save(),a.strokeStyle=c.borderColor||this.borderColor,this._setLineDash(a,c.borderDashArray||this.borderDashArray),a.strokeRect(-s/2,-h/2,s,h),m&&(a.beginPath(),this.forEachControl(function(p,v,C){p.withConnection&&p.getVisibility(C,v)&&(g=!0,a.moveTo(p.x*s,p.y*h),a.lineTo(p.x*s+p.offsetX,p.y*h+p.offsetY))}),g&&a.stroke()),a.restore(),this},drawBordersInGroup:function(a,c,f){f=f||{};var r=y.util.sizeAfterTransform(this.width,this.height,c),s=this.strokeWidth,h=this.strokeUniform,m=this.borderScaleFactor,g=r.x+s*(h?this.canvas.getZoom():c.scaleX)+m,p=r.y+s*(h?this.canvas.getZoom():c.scaleY)+m;return a.save(),this._setLineDash(a,f.borderDashArray||this.borderDashArray),a.strokeStyle=f.borderColor||this.borderColor,a.strokeRect(-g/2,-p/2,g,p),a.restore(),this},drawControls:function(a,c){c=c||{},a.save();var f,r,s=this.canvas.getRetinaScaling();return a.setTransform(s,0,0,s,0,0),a.strokeStyle=a.fillStyle=c.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=c.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(a,c.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(f=this.group.calcTransformMatrix()),this.forEachControl(function(h,m,g){r=g.oCoords[m],h.getVisibility(g,m)&&(f&&(r=y.util.transformPoint(r,f)),h.render(a,r.x,r.y,c,g))}),a.restore(),this},isControlVisible:function(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)},setControlVisible:function(a,c){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=c,this},setControlsVisibility:function(a){for(var c in a||(a={}),a)this.setControlVisible(c,a[c]);return this},onDeselect:function(){},onSelect:function(){}})}(),y.util.object.extend(y.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(u,a){var c=function(){},f=(a=a||{}).onComplete||c,r=a.onChange||c,s=this;return y.util.animate({target:this,startValue:u.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(h){u.set("left",h),s.requestRenderAll(),r()},onComplete:function(){u.setCoords(),f()}})},fxCenterObjectV:function(u,a){var c=function(){},f=(a=a||{}).onComplete||c,r=a.onChange||c,s=this;return y.util.animate({target:this,startValue:u.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(h){u.set("top",h),s.requestRenderAll(),r()},onComplete:function(){u.setCoords(),f()}})},fxRemove:function(u,a){var c=function(){},f=(a=a||{}).onComplete||c,r=a.onChange||c,s=this;return y.util.animate({target:this,startValue:u.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(h){u.set("opacity",h),s.requestRenderAll(),r()},onComplete:function(){s.remove(u),f()}})}}),y.util.object.extend(y.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var u,a,c=[],f=[];for(u in arguments[0])c.push(u);for(var r=0,s=c.length;r<s;r++)u=c[r],a=r!==s-1,f.push(this._animate(u,arguments[0][u],arguments[1],a));return f}return this._animate.apply(this,arguments)},_animate:function(u,a,c,f){var r,s=this;a=a.toString(),c=c?y.util.object.clone(c):{},~u.indexOf(".")&&(r=u.split("."));var h=s.colorProperties.indexOf(u)>-1||r&&s.colorProperties.indexOf(r[1])>-1,m=r?this.get(r[0])[r[1]]:this.get(u);"from"in c||(c.from=m),h||(a=~a.indexOf("=")?m+parseFloat(a.replace("=","")):parseFloat(a));var g={target:this,startValue:c.from,endValue:a,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(p,v,C){return c.abort.call(s,p,v,C)},onChange:function(p,v,C){r?s[r[0]][r[1]]=p:s.set(u,p),f||c.onChange&&c.onChange(p,v,C)},onComplete:function(p,v,C){f||(s.setCoords(),c.onComplete&&c.onComplete(p,v,C))}};return h?y.util.animateColor(g.startValue,g.endValue,g.duration,g):y.util.animate(g)}}),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function s(h,m){var g=h.origin,p=h.axis1,v=h.axis2,C=h.dimension,x=m.nearest,b=m.center,E=m.farthest;return function(){switch(this.get(g)){case x:return Math.min(this.get(p),this.get(v));case b:return Math.min(this.get(p),this.get(v))+.5*this.get(C);case E:return Math.max(this.get(p),this.get(v))}}}a.Line?a.warn("fabric.Line is already defined"):(a.Line=a.util.createClass(a.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:a.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,m){h||(h=[0,0,0,0]),this.callSuper("initialize",m),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(m)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in h?h.left:this._getLeftToOriginX(),this.top="top"in h?h.top:this._getTopToOriginY()},_set:function(h,m){return this.callSuper("_set",h,m),r[h]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var m=this.calcLinePoints();h.moveTo(m.x1,m.y1),h.lineTo(m.x2,m.y2),h.lineWidth=this.strokeWidth;var g=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle,this.stroke&&this._renderStroke(h),h.strokeStyle=g},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(h){return c(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(h.y-=this.strokeWidth),this.height===0&&(h.x-=this.strokeWidth)),h},calcLinePoints:function(){var h=this.x1<=this.x2?-1:1,m=this.y1<=this.y2?-1:1,g=h*this.width*.5,p=m*this.height*.5;return{x1:g,x2:h*this.width*-.5,y1:p,y2:m*this.height*-.5}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`" />
`]}}),a.Line.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),a.Line.fromElement=function(h,m,g){g=g||{};var p=a.parseAttributes(h,a.Line.ATTRIBUTE_NAMES),v=[p.x1||0,p.y1||0,p.x2||0,p.y2||0];m(new a.Line(v,c(p,g)))},a.Line.fromObject=function(h,m){var g=f(h,!0);g.points=[h.x1,h.y1,h.x2,h.y2],a.Object._fromObject("Line",g,function(p){delete p.points,m&&m(p)},"points")})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.degreesToRadians;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:a.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(f,r){return this.callSuper("_set",f,r),f==="radius"&&this.setRadius(r),this},toObject:function(f){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(f))},_toSVG:function(){var f,r=(this.endAngle-this.startAngle)%360;if(r===0)f=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var s=c(this.startAngle),h=c(this.endAngle),m=this.radius;f=['<path d="M '+a.util.cos(s)*m+" "+a.util.sin(s)*m," A "+m+" "+m," 0 ",+(r>180?"1":"0")+" 1"," "+a.util.cos(h)*m+" "+a.util.sin(h)*m,'" ',"COMMON_PARTS",` />
`]}return f},_render:function(f){f.beginPath(),f.arc(0,0,this.radius,c(this.startAngle),c(this.endAngle),!1),this._renderPaintInOrder(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){return this.radius=f,this.set("width",2*f).set("height",2*f)}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(f,r){var s,h=a.parseAttributes(f,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in(s=h)&&s.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");h.left=(h.left||0)-h.radius,h.top=(h.top||0)-h.radius,r(new a.Circle(h))},a.Circle.fromObject=function(f,r){a.Object._fromObject("Circle",f,r)})}(e),function(u){var a=u.fabric||(u.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",width:100,height:100,_render:function(c){var f=this.width/2,r=this.height/2;c.beginPath(),c.moveTo(-f,r),c.lineTo(0,-r),c.lineTo(f,r),c.closePath(),this._renderPaintInOrder(c)},_toSVG:function(){var c=this.width/2,f=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-c+" "+f,"0 "+-f,c+" "+f].join(","),'" />']}}),a.Triangle.fromObject=function(c,f){return a.Object._fromObject("Triangle",c,f)})}(e),function(u){var a=u.fabric||(u.fabric={}),c=2*Math.PI;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this.set("rx",f&&f.rx||0),this.set("ry",f&&f.ry||0)},_set:function(f,r){switch(this.callSuper("_set",f,r),f){case"rx":this.rx=r,this.set("width",2*r);break;case"ry":this.ry=r,this.set("height",2*r)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,c,!1),f.restore(),this._renderPaintInOrder(f)}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),a.Ellipse.fromElement=function(f,r){var s=a.parseAttributes(f,a.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,r(new a.Ellipse(s))},a.Ellipse.fromObject=function(f,r){a.Object._fromObject("Ellipse",f,r)})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend;a.Rect?a.warn("fabric.Rect is already defined"):(a.Rect=a.util.createClass(a.Object,{stateProperties:a.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(f){var r=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,m=this.height,g=-this.width/2,p=-this.height/2,v=r!==0||s!==0,C=.4477152502;f.beginPath(),f.moveTo(g+r,p),f.lineTo(g+h-r,p),v&&f.bezierCurveTo(g+h-C*r,p,g+h,p+C*s,g+h,p+s),f.lineTo(g+h,p+m-s),v&&f.bezierCurveTo(g+h,p+m-C*s,g+h-C*r,p+m,g+h-r,p+m),f.lineTo(g+r,p+m),v&&f.bezierCurveTo(g+C*r,p+m,g,p+m-C*s,g,p+m-s),f.lineTo(g,p+s),v&&f.bezierCurveTo(g,p+C*s,g+C*r,p,g+r,p),f.closePath(),this._renderPaintInOrder(f)},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(f,r,s){if(!f)return r(null);s=s||{};var h=a.parseAttributes(f,a.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0,h.height=h.height||0,h.width=h.width||0;var m=new a.Rect(c(s?a.util.object.clone(s):{},h));m.visible=m.visible&&m.width>0&&m.height>0,r(m)},a.Rect.fromObject=function(f,r){return a.Object._fromObject("Rect",f,r)})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.util.array.min,r=a.util.array.max,s=a.util.toFixed,h=a.util.projectStrokeOnPoints;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:a.Object.prototype.cacheProperties.concat("points"),initialize:function(m,g){g=g||{},this.points=m||[],this.callSuper("initialize",g),this._setPositionDimensions(g)},_projectStrokeOnPoints:function(){return h(this.points,this,!0)},_setPositionDimensions:function(m){var g,p=this._calcDimensions(m),v=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-v,this.height=p.height-v,m.fromSVG||(g=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+v/2,y:p.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),m.left===void 0&&(this.left=m.fromSVG?p.left:g.x),m.top===void 0&&(this.top=m.fromSVG?p.top:g.y),this.pathOffset={x:p.left+this.width/2+v/2,y:p.top+this.height/2+v/2}},_calcDimensions:function(){var m=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,g=f(m,"x")||0,p=f(m,"y")||0;return{left:g,top:p,width:(r(m,"x")||0)-g,height:(r(m,"y")||0)-p}},toObject:function(m){return c(this.callSuper("toObject",m),{points:this.points.concat()})},_toSVG:function(){for(var m=[],g=this.pathOffset.x,p=this.pathOffset.y,v=a.Object.NUM_FRACTION_DIGITS,C=0,x=this.points.length;C<x;C++)m.push(s(this.points[C].x-g,v),",",s(this.points[C].y-p,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',m.join(""),`" />
`]},commonRender:function(m){var g,p=this.points.length,v=this.pathOffset.x,C=this.pathOffset.y;if(!p||isNaN(this.points[p-1].y))return!1;m.beginPath(),m.moveTo(this.points[0].x-v,this.points[0].y-C);for(var x=0;x<p;x++)g=this.points[x],m.lineTo(g.x-v,g.y-C);return!0},_render:function(m){this.commonRender(m)&&this._renderPaintInOrder(m)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElementGenerator=function(m){return function(g,p,v){if(!g)return p(null);v||(v={});var C=a.parsePointsAttribute(g.getAttribute("points")),x=a.parseAttributes(g,a[m].ATTRIBUTE_NAMES);x.fromSVG=!0,p(new a[m](C,c(x,v)))}},a.Polyline.fromElement=a.Polyline.fromElementGenerator("Polyline"),a.Polyline.fromObject=function(m,g){return a.Object._fromObject("Polyline",m,g,"points")})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.projectStrokeOnPoints;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return c(this.points,this)},_render:function(f){this.commonRender(f)&&(f.closePath(),this._renderPaintInOrder(f))}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=a.Polyline.fromElementGenerator("Polygon"),a.Polygon.fromObject=function(f,r){a.Object._fromObject("Polygon",f,r,"points")})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.array.min,f=a.util.array.max,r=a.util.object.extend,s=a.util.object.clone,h=a.util.toFixed;a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,cacheProperties:a.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:a.Object.prototype.stateProperties.concat("path"),initialize:function(m,g){delete(g=s(g||{})).path,this.callSuper("initialize",g),this._setPath(m||[],g)},_setPath:function(m,g){this.path=a.util.makePathSimpler(Array.isArray(m)?m:a.util.parsePath(m)),a.Polyline.prototype._setPositionDimensions.call(this,g||{})},_renderPathCommands:function(m){var g,p=0,v=0,C=0,x=0,b=0,E=0,O=-this.pathOffset.x,L=-this.pathOffset.y;m.beginPath();for(var W=0,G=this.path.length;W<G;++W)switch((g=this.path[W])[0]){case"L":C=g[1],x=g[2],m.lineTo(C+O,x+L);break;case"M":p=C=g[1],v=x=g[2],m.moveTo(C+O,x+L);break;case"C":C=g[5],x=g[6],b=g[3],E=g[4],m.bezierCurveTo(g[1]+O,g[2]+L,b+O,E+L,C+O,x+L);break;case"Q":m.quadraticCurveTo(g[1]+O,g[2]+L,g[3]+O,g[4]+L),C=g[3],x=g[4],b=g[1],E=g[2];break;case"z":case"Z":C=p,x=v,m.closePath()}},_render:function(m){this._renderPathCommands(m),this._renderPaintInOrder(m)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(m){return r(this.callSuper("toObject",m),{path:this.path.map(function(g){return g.slice()})})},toDatalessObject:function(m){var g=this.toObject(["sourcePath"].concat(m));return g.sourcePath&&delete g.path,g},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',a.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var m=a.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,m)+", "+h(-this.pathOffset.y,m)+")"},toClipPathSVG:function(m){var g=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:g})},toSVG:function(m){var g=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:g})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var m,g,p=[],v=[],C=0,x=0,b=0,E=0,O=0,L=this.path.length;O<L;++O){switch((m=this.path[O])[0]){case"L":b=m[1],E=m[2],g=[];break;case"M":C=b=m[1],x=E=m[2],g=[];break;case"C":g=a.util.getBoundsOfCurve(b,E,m[1],m[2],m[3],m[4],m[5],m[6]),b=m[5],E=m[6];break;case"Q":g=a.util.getBoundsOfCurve(b,E,m[1],m[2],m[1],m[2],m[3],m[4]),b=m[3],E=m[4];break;case"z":case"Z":b=C,E=x}g.forEach(function(J){p.push(J.x),v.push(J.y)}),p.push(b),v.push(E)}var W=c(p)||0,G=c(v)||0;return{left:W,top:G,width:(f(p)||0)-W,height:(f(v)||0)-G}}}),a.Path.fromObject=function(m,g){if(typeof m.sourcePath=="string"){var p=m.sourcePath;a.loadSVGFromURL(p,function(v){var C=v[0];C.setOptions(m),g&&g(C)})}else a.Object._fromObject("Path",m,g,"path")},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(m,g,p){var v=a.parseAttributes(m,a.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,g(new a.Path(v.d,r(v,p)))})}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.array.min,f=a.util.array.max;a.Group||(a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,s,h){s=s||{},this._objects=[],h&&this.callSuper("initialize",s),this._objects=r||[];for(var m=this._objects.length;m--;)this._objects[m].group=this;if(h)this._updateObjectsACoords();else{var g=s&&s.centerPoint;s.originX!==void 0&&(this.originX=s.originX),s.originY!==void 0&&(this.originY=s.originY),g||this._calcBounds(),this._updateObjectsCoords(g),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var r=this._objects.length;r--;)this._objects[r].setCoords(!0)},_updateObjectsCoords:function(r){r=r||this.getCenterPoint();for(var s=this._objects.length;s--;)this._updateObjectCoords(this._objects[s],r)},_updateObjectCoords:function(r,s){var h=r.left,m=r.top;r.set({left:h-s.x,top:m-s.y}),r.group=this,r.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var s=!!this.group;return this._restoreObjectsState(),a.util.resetObjectTransform(this),r&&(s&&a.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,s?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),a.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,s){var h=this._objects.length;if(this.useSetOnGroup)for(;h--;)this._objects[h].setOnGroup(r,s);if(r==="canvas")for(;h--;)this._objects[h]._set(r,s);a.Object.prototype._set.call(this,r,s)},toObject:function(r){var s=this.includeDefaultValues,h=this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){var p=g.includeDefaultValues;g.includeDefaultValues=s;var v=g.toObject(r);return g.includeDefaultValues=p,v}),m=a.Object.prototype.toObject.call(this,r);return m.objects=h,m},toDatalessObject:function(r){var s,h=this.sourcePath;if(h)s=h;else{var m=this.includeDefaultValues;s=this._objects.map(function(p){var v=p.includeDefaultValues;p.includeDefaultValues=m;var C=p.toDatalessObject(r);return p.includeDefaultValues=v,C})}var g=a.Object.prototype.toDatalessObject.call(this,r);return g.objects=s,g},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=a.Object.prototype.shouldCache.call(this);if(r){for(var s=0,h=this._objects.length;s<h;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(a.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,s=this._objects.length;r<s;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var s=0,h=this._objects.length;s<h;s++)this._objects[s].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var s=0,h=this._objects.length;s<h;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var m=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-m/2,-g/2,m,g)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(s){a.util.addTransformToObject(s,r),delete s.group,s.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,s=this.canvas;this._objects=[];var h=this.toObject();delete h.objects;var m=new a.ActiveSelection([]);return m.set(h),m.type="activeSelection",s.remove(this),r.forEach(function(g){g.group=m,g.dirty=!0,s.add(g)}),m.canvas=s,m._objects=r,s._activeObject=m,m.setCoords(),m}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(r){r.setCoords(!0)}),this},_calcBounds:function(r){for(var s,h,m,g,p=[],v=[],C=["tr","br","bl","tl"],x=0,b=this._objects.length,E=C.length;x<b;++x){for(m=(s=this._objects[x]).calcACoords(),g=0;g<E;g++)h=C[g],p.push(m[h].x),v.push(m[h].y);s.aCoords=m}this._getBounds(p,v,r)},_getBounds:function(r,s,h){var m=new a.Point(c(r),c(s)),g=new a.Point(f(r),f(s)),p=m.y||0,v=m.x||0,C=g.x-m.x||0,x=g.y-m.y||0;this.width=C,this.height=x,h||this.setPositionByOrigin({x:v,y:p},"left","top")},_toSVG:function(r){for(var s=["<g ","COMMON_PARTS",` >
`],h=0,m=this._objects.length;h<m;h++)s.push("		",this._objects[h].toSVG(r));return s.push(`</g>
`),s},getSvgStyles:function(){var r=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",s=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),s].join("")},toClipPathSVG:function(r){for(var s=[],h=0,m=this._objects.length;h<m;h++)s.push("	",this._objects[h].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(s,{reviver:r})}}),a.Group.fromObject=function(r,s){var h=r.objects,m=a.util.object.clone(r,!0);delete m.objects,typeof h!="string"?a.util.enlivenObjects(h,function(g){var p=a.util.object.clone(r,!0);delete p.objects,a.util.enlivenObjectEnlivables(r,p,function(){s&&s(new a.Group(g,p,!0))})}):a.loadSVGFromURL(h,function(g){var p=a.util.groupSVGElements(g,r,h);p.set(m),s&&s(p)})})}(e),function(u){var a=u.fabric||(u.fabric={});a.ActiveSelection||(a.ActiveSelection=a.util.createClass(a.Group,{type:"activeSelection",initialize:function(c,f){f=f||{},this._objects=c||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;f.originX&&(this.originX=f.originX),f.originY&&(this.originY=f.originY),this._calcBounds(),this._updateObjectsCoords(),a.Object.prototype.initialize.call(this,f),this.setCoords()},toGroup:function(){var c=this._objects.concat();this._objects=[];var f=a.Object.prototype.toObject.call(this),r=new a.Group([]);if(delete f.type,r.set(f),c.forEach(function(h){h.canvas.remove(h),h.group=r}),r._objects=c,!this.canvas)return r;var s=this.canvas;return s.add(r),s._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(c,f,r){c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",c,f),(r=r||{}).hasControls===void 0&&(r.hasControls=!1),r.forActiveSelection=!0;for(var s=0,h=this._objects.length;s<h;s++)this._objects[s]._renderControls(c,r);c.restore()}}),a.ActiveSelection.fromObject=function(c,f){a.util.enlivenObjects(c.objects,function(r){delete c.objects,f&&f(new a.ActiveSelection(r,c,!0))})})}(e),function(u){var a=y.util.object.extend;u.fabric||(u.fabric={}),u.fabric.Image?y.warn("fabric.Image is already defined."):(y.Image=y.util.createClass(y.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:y.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:y.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(c,f){f||(f={}),this.filters=[],this.cacheKey="texture"+y.Object.__uid++,this.callSuper("initialize",f),this._initElement(c,f)},getElement:function(){return this._element||{}},setElement:function(c,f){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=c,this._originalElement=c,this._initConfig(f),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(c){var f=y.filterBackend;f&&f.evictCachesForKey&&f.evictCachesForKey(c)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(c){y.util.cleanUpJsdomNode(this[c]),this[c]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var c=this.getElement();return{width:c.naturalWidth||c.width,height:c.naturalHeight||c.height}},_stroke:function(c){if(this.stroke&&this.strokeWidth!==0){var f=this.width/2,r=this.height/2;c.beginPath(),c.moveTo(-f,-r),c.lineTo(f,-r),c.lineTo(f,r),c.lineTo(-f,r),c.lineTo(-f,-r),c.closePath()}},toObject:function(c){var f=[];this.filters.forEach(function(s){s&&f.push(s.toObject())});var r=a(this.callSuper("toObject",["cropX","cropY"].concat(c)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:f});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var c,f=[],r=[],s=this._element,h=-this.width/2,m=-this.height/2,g="",p="";if(!s)return[];if(this.hasCrop()){var v=y.Object.__uid++;f.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+h+'" y="'+m+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),g=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(p='" image-rendering="optimizeSpeed'),r.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',h-this.cropX,'" y="',m-this.cropY,'" width="',s.width||s.naturalWidth,'" height="',s.height||s.height,p,'"',g,`></image>
`),this.stroke||this.strokeDashArray){var C=this.fill;this.fill=null,c=["	<rect ",'x="',h,'" y="',m,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=C}return this.paintFirst!=="fill"?f.concat(c,r):f.concat(r,c)},getSrc:function(c){var f=c?this._element:this._originalElement;return f?f.toDataURL?f.toDataURL():this.srcFromAttribute?f.getAttribute("src"):f.src:this.src||""},setSrc:function(c,f,r){return y.util.loadImage(c,function(s,h){this.setElement(s,r),this._setWidthHeight(),f&&f(this,h)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var c=this.resizeFilter,f=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),s=r.scaleX,h=r.scaleY,m=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!c||s>f&&h>f)return this._element=m,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=h);y.filterBackend||(y.filterBackend=y.initFilterBackend());var g=y.util.createCanvasElement(),p=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=m.width,C=m.height;g.width=v,g.height=C,this._element=g,this._lastScaleX=c.scaleX=s,this._lastScaleY=c.scaleY=h,y.filterBackend.applyFilters([c],m,v,C,this._element,p),this._filterScalingX=g.width/this._originalElement.width,this._filterScalingY=g.height/this._originalElement.height},applyFilters:function(c){if(c=(c=c||this.filters||[]).filter(function(m){return m&&!m.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),c.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var f=this._originalElement,r=f.naturalWidth||f.width,s=f.naturalHeight||f.height;if(this._element===this._originalElement){var h=y.util.createCanvasElement();h.width=r,h.height=s,this._element=h,this._filteredEl=h}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,s),this._lastScaleX=1,this._lastScaleY=1;return y.filterBackend||(y.filterBackend=y.initFilterBackend()),y.filterBackend.applyFilters(c,this._originalElement,r,s,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(c){y.util.setImageSmoothing(c,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(c),this._renderPaintInOrder(c)},drawCacheOnCanvas:function(c){y.util.setImageSmoothing(c,this.imageSmoothing),y.Object.prototype.drawCacheOnCanvas.call(this,c)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(c){var f=this._element;if(f){var r=this._filterScalingX,s=this._filterScalingY,h=this.width,m=this.height,g=Math.min,p=Math.max,v=p(this.cropX,0),C=p(this.cropY,0),x=f.naturalWidth||f.width,b=f.naturalHeight||f.height,E=v*r,O=C*s,L=g(h*r,x-E),W=g(m*s,b-O),G=-h/2,J=-m/2,K=g(h,x/r-v),Y=g(m,b/s-C);f&&c.drawImage(f,E,O,L,W,G,J,K,Y)}},_needsResize:function(){var c=this.getTotalObjectScaling();return c.scaleX!==this._lastScaleX||c.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(c,f){this.setElement(y.util.getById(c),f),y.util.addClass(this.getElement(),y.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={}),this.setOptions(c),this._setWidthHeight(c)},_initFilters:function(c,f){c&&c.length?y.util.enlivenObjects(c,function(r){f&&f(r)},"fabric.Image.filters"):f&&f()},_setWidthHeight:function(c){c||(c={});var f=this.getElement();this.width=c.width||f.naturalWidth||f.width||0,this.height=c.height||f.naturalHeight||f.height||0},parsePreserveAspectRatioAttribute:function(){var c,f=y.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),r=this._element.width,s=this._element.height,h=1,m=1,g=0,p=0,v=0,C=0,x=this.width,b=this.height,E={width:x,height:b};return!f||f.alignX==="none"&&f.alignY==="none"?(h=x/r,m=b/s):(f.meetOrSlice==="meet"&&(c=(x-r*(h=m=y.util.findScaleToFit(this._element,E)))/2,f.alignX==="Min"&&(g=-c),f.alignX==="Max"&&(g=c),c=(b-s*m)/2,f.alignY==="Min"&&(p=-c),f.alignY==="Max"&&(p=c)),f.meetOrSlice==="slice"&&(c=r-x/(h=m=y.util.findScaleToCover(this._element,E)),f.alignX==="Mid"&&(v=c/2),f.alignX==="Max"&&(v=c),c=s-b/m,f.alignY==="Mid"&&(C=c/2),f.alignY==="Max"&&(C=c),r=x/h,s=b/m)),{width:r,height:s,scaleX:h,scaleY:m,offsetLeft:g,offsetTop:p,cropX:v,cropY:C}}}),y.Image.CSS_CANVAS="canvas-img",y.Image.prototype.getSvgSrc=y.Image.prototype.getSrc,y.Image.fromObject=function(c,f){var r=y.util.object.clone(c);y.util.loadImage(r.src,function(s,h){h?f&&f(null,!0):y.Image.prototype._initFilters.call(r,r.filters,function(m){r.filters=m||[],y.Image.prototype._initFilters.call(r,[r.resizeFilter],function(g){r.resizeFilter=g[0],y.util.enlivenObjectEnlivables(r,r,function(){var p=new y.Image(s,r);f(p,!1)})})})},null,r.crossOrigin)},y.Image.fromURL=function(c,f,r){y.util.loadImage(c,function(s,h){f&&f(new y.Image(s,r),h)},null,r&&r.crossOrigin)},y.Image.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),y.Image.fromElement=function(c,f,r){var s=y.parseAttributes(c,y.Image.ATTRIBUTE_NAMES);y.Image.fromURL(s["xlink:href"],f,a(r?y.util.object.clone(r):{},s))})}(e),y.util.object.extend(y.Object.prototype,{_getAngleValueForStraighten:function(){var u=this.angle%360;return u>0?90*Math.round((u-1)/90):90*Math.round(u/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(u){var a=function(){},c=(u=u||{}).onComplete||a,f=u.onChange||a,r=this;return y.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){r.rotate(s),f()},onComplete:function(){r.setCoords(),c()}})}}),y.util.object.extend(y.StaticCanvas.prototype,{straightenObject:function(u){return u.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(u){return u.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function u(c,f){var r="precision "+f+` float;
void main(){}`,s=c.createShader(c.FRAGMENT_SHADER);return c.shaderSource(s,r),c.compileShader(s),!!c.getShaderParameter(s,c.COMPILE_STATUS)}function a(c){c&&c.tileSize&&(this.tileSize=c.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}y.isWebglSupported=function(c){if(y.isLikelyNode)return!1;c=c||y.WebglFilterBackend.prototype.tileSize;var f=document.createElement("canvas"),r=f.getContext("webgl")||f.getContext("experimental-webgl"),s=!1;if(r){y.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),s=y.maxTextureSize>=c;for(var h=["highp","mediump","lowp"],m=0;m<3;m++)if(u(r,h[m])){y.webGlPrecision=h[m];break}}return this.isSupported=s,s},y.WebglFilterBackend=a,a.prototype={tileSize:2048,resources:{},setupGLContext:function(c,f){this.dispose(),this.createWebGLCanvas(c,f),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(c,f)},chooseFastestCopyGLTo2DMethod:function(c,f){var r,s=window.performance!==void 0;try{new ImageData(1,1),r=!0}catch{r=!1}var h=typeof ArrayBuffer<"u",m=typeof Uint8ClampedArray<"u";if(s&&r&&h&&m){var g=y.util.createCanvasElement(),p=new ArrayBuffer(c*f*4);if(y.forceGLPutImageData)return this.imageBuffer=p,void(this.copyGLTo2D=Ce);var v,C,x={imageBuffer:p,destinationWidth:c,destinationHeight:f,targetCanvas:g};g.width=c,g.height=f,v=window.performance.now(),fe.call(x,this.gl,x),C=window.performance.now()-v,v=window.performance.now(),Ce.call(x,this.gl,x),C>window.performance.now()-v?(this.imageBuffer=p,this.copyGLTo2D=Ce):this.copyGLTo2D=fe}},createWebGLCanvas:function(c,f){var r=y.util.createCanvasElement();r.width=c,r.height=f;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},h=r.getContext("webgl",s);h||(h=r.getContext("experimental-webgl",s)),h&&(h.clearColor(0,0,0,0),this.canvas=r,this.gl=h)},applyFilters:function(c,f,r,s,h,m){var g,p=this.gl;m&&(g=this.getCachedTexture(m,f));var v={originalWidth:f.width||f.originalWidth,originalHeight:f.height||f.originalHeight,sourceWidth:r,sourceHeight:s,destinationWidth:r,destinationHeight:s,context:p,sourceTexture:this.createTexture(p,r,s,!g&&f),targetTexture:this.createTexture(p,r,s),originalTexture:g||this.createTexture(p,r,s,!g&&f),passes:c.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:h},C=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,C),c.forEach(function(x){x&&x.applyTo(v)}),function(x){var b=x.targetCanvas,E=b.width,O=b.height,L=x.destinationWidth,W=x.destinationHeight;E===L&&O===W||(b.width=L,b.height=W)}(v),this.copyGLTo2D(p,v),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(v.sourceTexture),p.deleteTexture(v.targetTexture),p.deleteFramebuffer(C),h.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(c,f,r,s){var h=c.createTexture();return c.bindTexture(c.TEXTURE_2D,h),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),s?c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,s):c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f,r,0,c.RGBA,c.UNSIGNED_BYTE,null),h},getCachedTexture:function(c,f){if(this.textureCache[c])return this.textureCache[c];var r=this.createTexture(this.gl,f.width,f.height,f);return this.textureCache[c]=r,r},evictCachesForKey:function(c){this.textureCache[c]&&(this.gl.deleteTexture(this.textureCache[c]),delete this.textureCache[c])},copyGLTo2D:fe,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var c=this.gl,f={renderer:"",vendor:""};if(!c)return f;var r=c.getExtension("WEBGL_debug_renderer_info");if(r){var s=c.getParameter(r.UNMASKED_RENDERER_WEBGL),h=c.getParameter(r.UNMASKED_VENDOR_WEBGL);s&&(f.renderer=s.toLowerCase()),h&&(f.vendor=h.toLowerCase())}return this.gpuInfo=f,f}}}(),function(){var u=function(){};function a(){}y.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:u,dispose:u,clearWebGLCaches:u,resources:{},applyFilters:function(c,f,r,s,h){var m=h.getContext("2d");m.drawImage(f,0,0,r,s);var g={sourceWidth:r,sourceHeight:s,imageData:m.getImageData(0,0,r,s),originalEl:f,originalImageData:m.getImageData(0,0,r,s),canvasEl:h,ctx:m,filterBackend:this};return c.forEach(function(p){p.applyTo(g)}),g.imageData.width===r&&g.imageData.height===s||(h.width=g.imageData.width,h.height=g.imageData.height),m.putImageData(g.imageData,0,0),g}}}(),y.Image=y.Image||{},y.Image.filters=y.Image.filters||{},y.Image.filters.BaseFilter=y.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(u){u&&this.setOptions(u)},setOptions:function(u){for(var a in u)this[a]=u[a]},createProgram:function(u,a,c){a=a||this.fragmentSource,c=c||this.vertexSource,y.webGlPrecision!=="highp"&&(a=a.replace(/precision highp float/g,"precision "+y.webGlPrecision+" float"));var f=u.createShader(u.VERTEX_SHADER);if(u.shaderSource(f,c),u.compileShader(f),!u.getShaderParameter(f,u.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+u.getShaderInfoLog(f));var r=u.createShader(u.FRAGMENT_SHADER);if(u.shaderSource(r,a),u.compileShader(r),!u.getShaderParameter(r,u.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+u.getShaderInfoLog(r));var s=u.createProgram();if(u.attachShader(s,f),u.attachShader(s,r),u.linkProgram(s),!u.getProgramParameter(s,u.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+u.getProgramInfoLog(s));var h=this.getAttributeLocations(u,s),m=this.getUniformLocations(u,s)||{};return m.uStepW=u.getUniformLocation(s,"uStepW"),m.uStepH=u.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:h,uniformLocations:m}},getAttributeLocations:function(u,a){return{aPosition:u.getAttribLocation(a,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(u,a,c){var f=a.aPosition,r=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,r),u.enableVertexAttribArray(f),u.vertexAttribPointer(f,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,c,u.STATIC_DRAW)},_setupFrameBuffer:function(u){var a,c,f=u.context;u.passes>1?(a=u.destinationWidth,c=u.destinationHeight,u.sourceWidth===a&&u.sourceHeight===c||(f.deleteTexture(u.targetTexture),u.targetTexture=u.filterBackend.createTexture(f,a,c)),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,u.targetTexture,0)):(f.bindFramebuffer(f.FRAMEBUFFER,null),f.finish())},_swapTextures:function(u){u.passes--,u.pass++;var a=u.targetTexture;u.targetTexture=u.sourceTexture,u.sourceTexture=a},isNeutralState:function(){var u=this.mainParameter,a=y.Image.filters[this.type].prototype;if(u){if(Array.isArray(a[u])){for(var c=a[u].length;c--;)if(this[u][c]!==a[u][c])return!1;return!0}return a[u]===this[u]}return!1},applyTo:function(u){u.webgl?(this._setupFrameBuffer(u),this.applyToWebGL(u),this._swapTextures(u)):this.applyTo2d(u)},retrieveShader:function(u){return u.programCache.hasOwnProperty(this.type)||(u.programCache[this.type]=this.createProgram(u.context)),u.programCache[this.type]},applyToWebGL:function(u){var a=u.context,c=this.retrieveShader(u);u.pass===0&&u.originalTexture?a.bindTexture(a.TEXTURE_2D,u.originalTexture):a.bindTexture(a.TEXTURE_2D,u.sourceTexture),a.useProgram(c.program),this.sendAttributeData(a,c.attributeLocations,u.aPosition),a.uniform1f(c.uniformLocations.uStepW,1/u.sourceWidth),a.uniform1f(c.uniformLocations.uStepH,1/u.sourceHeight),this.sendUniformData(a,c.uniformLocations),a.viewport(0,0,u.destinationWidth,u.destinationHeight),a.drawArrays(a.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(u,a,c){u.activeTexture(c),u.bindTexture(u.TEXTURE_2D,a),u.activeTexture(u.TEXTURE0)},unbindAdditionalTexture:function(u,a){u.activeTexture(a),u.bindTexture(u.TEXTURE_2D,null),u.activeTexture(u.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(u){this[this.mainParameter]=u},sendUniformData:function(){},createHelpLayer:function(u){if(!u.helpLayer){var a=document.createElement("canvas");a.width=u.sourceWidth,a.height=u.sourceHeight,u.helpLayer=a}},toObject:function(){var u={type:this.type},a=this.mainParameter;return a&&(u[a]=this[a]),u},toJSON:function(){return this.toObject()}}),y.Image.filters.BaseFilter.fromObject=function(u,a){var c=new y.Image.filters[u.type](u);return a&&a(c),c},function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.ColorMatrix=f(c.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var s,h,m,g,p,v=r.imageData.data,C=v.length,x=this.matrix,b=this.colorsOnly;for(p=0;p<C;p+=4)s=v[p],h=v[p+1],m=v[p+2],b?(v[p]=s*x[0]+h*x[1]+m*x[2]+255*x[4],v[p+1]=s*x[5]+h*x[6]+m*x[7]+255*x[9],v[p+2]=s*x[10]+h*x[11]+m*x[12]+255*x[14]):(g=v[p+3],v[p]=s*x[0]+h*x[1]+m*x[2]+g*x[3]+255*x[4],v[p+1]=s*x[5]+h*x[6]+m*x[7]+g*x[8]+255*x[9],v[p+2]=s*x[10]+h*x[11]+m*x[12]+g*x[13]+255*x[14],v[p+3]=s*x[15]+h*x[16]+m*x[17]+g*x[18]+255*x[19])},getUniformLocations:function(r,s){return{uColorMatrix:r.getUniformLocation(s,"uColorMatrix"),uConstants:r.getUniformLocation(s,"uConstants")}},sendUniformData:function(r,s){var h=this.matrix,m=[h[0],h[1],h[2],h[3],h[5],h[6],h[7],h[8],h[10],h[11],h[12],h[13],h[15],h[16],h[17],h[18]],g=[h[4],h[9],h[14],h[19]];r.uniformMatrix4fv(s.uColorMatrix,!1,m),r.uniform4fv(s.uConstants,g)}}),a.Image.filters.ColorMatrix.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Brightness=f(c.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var s,h=r.imageData.data,m=h.length,g=Math.round(255*this.brightness);for(s=0;s<m;s+=4)h[s]=h[s]+g,h[s+1]=h[s+1]+g,h[s+2]=h[s+2]+g}},getUniformLocations:function(r,s){return{uBrightness:r.getUniformLocation(s,"uBrightness")}},sendUniformData:function(r,s){r.uniform1f(s.uBrightness,this.brightness)}}),a.Image.filters.Brightness.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.Image.filters,r=a.util.createClass;f.Convolute=r(f.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(s){var h=Math.sqrt(this.matrix.length),m=this.type+"_"+h+"_"+(this.opaque?1:0),g=this.fragmentSource[m];return s.programCache.hasOwnProperty(m)||(s.programCache[m]=this.createProgram(s.context,g)),s.programCache[m]},applyTo2d:function(s){var h,m,g,p,v,C,x,b,E,O,L,W,G,J=s.imageData,K=J.data,Y=this.matrix,N=Math.round(Math.sqrt(Y.length)),B=Math.floor(N/2),H=J.width,Q=J.height,ee=s.ctx.createImageData(H,Q),U=ee.data,V=this.opaque?1:0;for(L=0;L<Q;L++)for(O=0;O<H;O++){for(v=4*(L*H+O),h=0,m=0,g=0,p=0,G=0;G<N;G++)for(W=0;W<N;W++)C=O+W-B,(x=L+G-B)<0||x>=Q||C<0||C>=H||(b=4*(x*H+C),E=Y[G*N+W],h+=K[b]*E,m+=K[b+1]*E,g+=K[b+2]*E,V||(p+=K[b+3]*E));U[v]=h,U[v+1]=m,U[v+2]=g,U[v+3]=V?K[v+3]:p}s.imageData=ee},getUniformLocations:function(s,h){return{uMatrix:s.getUniformLocation(h,"uMatrix"),uOpaque:s.getUniformLocation(h,"uOpaque"),uHalfSize:s.getUniformLocation(h,"uHalfSize"),uSize:s.getUniformLocation(h,"uSize")}},sendUniformData:function(s,h){s.uniform1fv(h.uMatrix,this.matrix)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),a.Image.filters.Convolute.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Grayscale=f(c.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var s,h,m=r.imageData.data,g=m.length,p=this.mode;for(s=0;s<g;s+=4)p==="average"?h=(m[s]+m[s+1]+m[s+2])/3:p==="lightness"?h=(Math.min(m[s],m[s+1],m[s+2])+Math.max(m[s],m[s+1],m[s+2]))/2:p==="luminosity"&&(h=.21*m[s]+.72*m[s+1]+.07*m[s+2]),m[s]=h,m[s+1]=h,m[s+2]=h},retrieveShader:function(r){var s=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(s)){var h=this.fragmentSource[this.mode];r.programCache[s]=this.createProgram(r.context,h)}return r.programCache[s]},getUniformLocations:function(r,s){return{uMode:r.getUniformLocation(s,"uMode")}},sendUniformData:function(r,s){r.uniform1i(s.uMode,1)},isNeutralState:function(){return!1}}),a.Image.filters.Grayscale.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Invert=f(c.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var s,h=r.imageData.data,m=h.length;for(s=0;s<m;s+=4)h[s]=255-h[s],h[s+1]=255-h[s+1],h[s+2]=255-h[s+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,s){return{uInvert:r.getUniformLocation(s,"uInvert")}},sendUniformData:function(r,s){r.uniform1i(s.uInvert,this.invert)}}),a.Image.filters.Invert.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.Image.filters,r=a.util.createClass;f.Noise=r(f.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(s){if(this.noise!==0){var h,m,g=s.imageData.data,p=g.length,v=this.noise;for(h=0,p=g.length;h<p;h+=4)m=(.5-Math.random())*v,g[h]+=m,g[h+1]+=m,g[h+2]+=m}},getUniformLocations:function(s,h){return{uNoise:s.getUniformLocation(h,"uNoise"),uSeed:s.getUniformLocation(h,"uSeed")}},sendUniformData:function(s,h){s.uniform1f(h.uNoise,this.noise/255),s.uniform1f(h.uSeed,Math.random())},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),a.Image.filters.Noise.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Pixelate=f(c.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var s,h,m,g,p,v,C,x,b,E,O,L=r.imageData,W=L.data,G=L.height,J=L.width;for(h=0;h<G;h+=this.blocksize)for(m=0;m<J;m+=this.blocksize)for(g=W[s=4*h*J+4*m],p=W[s+1],v=W[s+2],C=W[s+3],E=Math.min(h+this.blocksize,G),O=Math.min(m+this.blocksize,J),x=h;x<E;x++)for(b=m;b<O;b++)W[s=4*x*J+4*b]=g,W[s+1]=p,W[s+2]=v,W[s+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,s){return{uBlocksize:r.getUniformLocation(s,"uBlocksize"),uStepW:r.getUniformLocation(s,"uStepW"),uStepH:r.getUniformLocation(s,"uStepH")}},sendUniformData:function(r,s){r.uniform1f(s.uBlocksize,this.blocksize)}}),a.Image.filters.Pixelate.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.extend,f=a.Image.filters,r=a.util.createClass;f.RemoveColor=r(f.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(s){var h,m,g,p,v=s.imageData.data,C=255*this.distance,x=new a.Color(this.color).getSource(),b=[x[0]-C,x[1]-C,x[2]-C],E=[x[0]+C,x[1]+C,x[2]+C];for(h=0;h<v.length;h+=4)m=v[h],g=v[h+1],p=v[h+2],m>b[0]&&g>b[1]&&p>b[2]&&m<E[0]&&g<E[1]&&p<E[2]&&(v[h+3]=0)},getUniformLocations:function(s,h){return{uLow:s.getUniformLocation(h,"uLow"),uHigh:s.getUniformLocation(h,"uHigh")}},sendUniformData:function(s,h){var m=new a.Color(this.color).getSource(),g=parseFloat(this.distance),p=[0+m[0]/255-g,0+m[1]/255-g,0+m[2]/255-g,1],v=[m[0]/255+g,m[1]/255+g,m[2]/255+g,1];s.uniform4fv(h.uLow,p),s.uniform4fv(h.uHigh,v)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),a.Image.filters.RemoveColor.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in r)c[s]=f(c.ColorMatrix,{type:s,matrix:r[s],mainParameter:!1,colorsOnly:!0}),a.Image.filters[s].fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric,c=a.Image.filters,f=a.util.createClass;c.BlendColor=f(c.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var s,h=this.type+"_"+this.mode;return r.programCache.hasOwnProperty(h)||(s=this.buildSource(this.mode),r.programCache[h]=this.createProgram(r.context,s)),r.programCache[h]},applyTo2d:function(r){var s,h,m,g,p,v,C,x=r.imageData.data,b=x.length,E=1-this.alpha;s=(C=new a.Color(this.color).getSource())[0]*this.alpha,h=C[1]*this.alpha,m=C[2]*this.alpha;for(var O=0;O<b;O+=4)switch(g=x[O],p=x[O+1],v=x[O+2],this.mode){case"multiply":x[O]=g*s/255,x[O+1]=p*h/255,x[O+2]=v*m/255;break;case"screen":x[O]=255-(255-g)*(255-s)/255,x[O+1]=255-(255-p)*(255-h)/255,x[O+2]=255-(255-v)*(255-m)/255;break;case"add":x[O]=g+s,x[O+1]=p+h,x[O+2]=v+m;break;case"diff":case"difference":x[O]=Math.abs(g-s),x[O+1]=Math.abs(p-h),x[O+2]=Math.abs(v-m);break;case"subtract":x[O]=g-s,x[O+1]=p-h,x[O+2]=v-m;break;case"darken":x[O]=Math.min(g,s),x[O+1]=Math.min(p,h),x[O+2]=Math.min(v,m);break;case"lighten":x[O]=Math.max(g,s),x[O+1]=Math.max(p,h),x[O+2]=Math.max(v,m);break;case"overlay":x[O]=s<128?2*g*s/255:255-2*(255-g)*(255-s)/255,x[O+1]=h<128?2*p*h/255:255-2*(255-p)*(255-h)/255,x[O+2]=m<128?2*v*m/255:255-2*(255-v)*(255-m)/255;break;case"exclusion":x[O]=s+g-2*s*g/255,x[O+1]=h+p-2*h*p/255,x[O+2]=m+v-2*m*v/255;break;case"tint":x[O]=s+g*E,x[O+1]=h+p*E,x[O+2]=m+v*E}},getUniformLocations:function(r,s){return{uColor:r.getUniformLocation(s,"uColor")}},sendUniformData:function(r,s){var h=new a.Color(this.color).getSource();h[0]=this.alpha*h[0]/255,h[1]=this.alpha*h[1]/255,h[2]=this.alpha*h[2]/255,h[3]=this.alpha,r.uniform4fv(s.uColor,h)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendColor.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric,c=a.Image.filters,f=a.util.createClass;c.BlendImage=f(c.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var s=this.type+"_"+this.mode,h=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(s)||(r.programCache[s]=this.createProgram(r.context,h)),r.programCache[s]},applyToWebGL:function(r){var s=r.context,h=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(s,h,s.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(r,s){return r.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var r=this.image,s=r._element.width,h=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/s,-r.top/h,1]},applyTo2d:function(r){var s,h,m,g,p,v,C,x,b,E,O,L=r.imageData,W=r.filterBackend.resources,G=L.data,J=G.length,K=L.width,Y=L.height,N=this.image;W.blendImage||(W.blendImage=a.util.createCanvasElement()),E=(b=W.blendImage).getContext("2d"),b.width!==K||b.height!==Y?(b.width=K,b.height=Y):E.clearRect(0,0,K,Y),E.setTransform(N.scaleX,0,0,N.scaleY,N.left,N.top),E.drawImage(N._element,0,0,K,Y),O=E.getImageData(0,0,K,Y).data;for(var B=0;B<J;B+=4)switch(p=G[B],v=G[B+1],C=G[B+2],x=G[B+3],s=O[B],h=O[B+1],m=O[B+2],g=O[B+3],this.mode){case"multiply":G[B]=p*s/255,G[B+1]=v*h/255,G[B+2]=C*m/255,G[B+3]=x*g/255;break;case"mask":G[B+3]=g}},getUniformLocations:function(r,s){return{uTransformMatrix:r.getUniformLocation(s,"uTransformMatrix"),uImage:r.getUniformLocation(s,"uImage")}},sendUniformData:function(r,s){var h=this.calculateMatrix();r.uniform1i(s.uImage,1),r.uniformMatrix3fv(s.uTransformMatrix,!1,h)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendImage.fromObject=function(r,s){a.Image.fromObject(r.image,function(h){var m=a.util.object.clone(r);m.image=h,s(new a.Image.filters.BlendImage(m))})}}(e),function(u){var a=u.fabric||(u.fabric={}),c=Math.pow,f=Math.floor,r=Math.sqrt,s=Math.abs,h=Math.round,m=Math.sin,g=Math.ceil,p=a.Image.filters,v=a.util.createClass;p.Resize=v(p.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(C,x){return{uDelta:C.getUniformLocation(x,"uDelta"),uTaps:C.getUniformLocation(x,"uTaps")}},sendUniformData:function(C,x){C.uniform2fv(x.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),C.uniform1fv(x.uTaps,this.taps)},retrieveShader:function(C){var x=this.getFilterWindow(),b=this.type+"_"+x;if(!C.programCache.hasOwnProperty(b)){var E=this.generateShader(x);C.programCache[b]=this.createProgram(C.context,E)}return C.programCache[b]},getFilterWindow:function(){var C=this.tempScale;return Math.ceil(this.lanczosLobes/C)},getTaps:function(){for(var C=this.lanczosCreate(this.lanczosLobes),x=this.tempScale,b=this.getFilterWindow(),E=new Array(b),O=1;O<=b;O++)E[O-1]=C(O*x);return E},generateShader:function(C){for(var x=new Array(C),b=this.fragmentSourceTOP,E=1;E<=C;E++)x[E-1]=E+".0 * uDelta";return b+="uniform float uTaps["+C+`];
`,b+=`void main() {
`,b+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,b+=`  float sum = 1.0;
`,x.forEach(function(O,L){b+="  color += texture2D(uTexture, vTexCoord + "+O+") * uTaps["+L+`];
`,b+="  color += texture2D(uTexture, vTexCoord - "+O+") * uTaps["+L+`];
`,b+="  sum += 2.0 * uTaps["+L+`];
`}),b+=`  gl_FragColor = color / sum;
`,b+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(C){C.webgl?(C.passes++,this.width=C.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=C.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),C.destinationWidth=this.dW,this._setupFrameBuffer(C),this.applyToWebGL(C),this._swapTextures(C),C.sourceWidth=C.destinationWidth,this.height=C.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),C.destinationHeight=this.dH,this._setupFrameBuffer(C),this.applyToWebGL(C),this._swapTextures(C),C.sourceHeight=C.destinationHeight):this.applyTo2d(C)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(C){return function(x){if(x>=C||x<=-C)return 0;if(x<11920929e-14&&x>-11920929e-14)return 1;var b=(x*=Math.PI)/C;return m(x)/x*m(b)/b}},applyTo2d:function(C){var x=C.imageData,b=this.scaleX,E=this.scaleY;this.rcpScaleX=1/b,this.rcpScaleY=1/E;var O,L=x.width,W=x.height,G=h(L*b),J=h(W*E);this.resizeType==="sliceHack"?O=this.sliceByTwo(C,L,W,G,J):this.resizeType==="hermite"?O=this.hermiteFastResize(C,L,W,G,J):this.resizeType==="bilinear"?O=this.bilinearFiltering(C,L,W,G,J):this.resizeType==="lanczos"&&(O=this.lanczosResize(C,L,W,G,J)),C.imageData=O},sliceByTwo:function(C,x,b,E,O){var L,W,G=C.imageData,J=.5,K=!1,Y=!1,N=x*J,B=b*J,H=a.filterBackend.resources,Q=0,ee=0,U=x,V=0;for(H.sliceByTwo||(H.sliceByTwo=document.createElement("canvas")),((L=H.sliceByTwo).width<1.5*x||L.height<b)&&(L.width=1.5*x,L.height=b),(W=L.getContext("2d")).clearRect(0,0,1.5*x,b),W.putImageData(G,0,0),E=f(E),O=f(O);!K||!Y;)x=N,b=B,E<f(N*J)?N=f(N*J):(N=E,K=!0),O<f(B*J)?B=f(B*J):(B=O,Y=!0),W.drawImage(L,Q,ee,x,b,U,V,N,B),Q=U,ee=V,V+=B;return W.getImageData(Q,ee,E,O)},lanczosResize:function(C,x,b,E,O){var L=C.imageData.data,W=C.ctx.createImageData(E,O),G=W.data,J=this.lanczosCreate(this.lanczosLobes),K=this.rcpScaleX,Y=this.rcpScaleY,N=2/this.rcpScaleX,B=2/this.rcpScaleY,H=g(K*this.lanczosLobes/2),Q=g(Y*this.lanczosLobes/2),ee={},U={},V={};return function X(te){var Z,re,he,le,oe,ue,ce,ge,ye,me,we;for(U.x=(te+.5)*K,V.x=f(U.x),Z=0;Z<O;Z++){for(U.y=(Z+.5)*Y,V.y=f(U.y),oe=0,ue=0,ce=0,ge=0,ye=0,re=V.x-H;re<=V.x+H;re++)if(!(re<0||re>=x)){me=f(1e3*s(re-U.x)),ee[me]||(ee[me]={});for(var Ie=V.y-Q;Ie<=V.y+Q;Ie++)Ie<0||Ie>=b||(we=f(1e3*s(Ie-U.y)),ee[me][we]||(ee[me][we]=J(r(c(me*N,2)+c(we*B,2))/1e3)),(he=ee[me][we])>0&&(oe+=he,ue+=he*L[le=4*(Ie*x+re)],ce+=he*L[le+1],ge+=he*L[le+2],ye+=he*L[le+3]))}G[le=4*(Z*E+te)]=ue/oe,G[le+1]=ce/oe,G[le+2]=ge/oe,G[le+3]=ye/oe}return++te<E?X(te):W}(0)},bilinearFiltering:function(C,x,b,E,O){var L,W,G,J,K,Y,N,B,H,Q=0,ee=this.rcpScaleX,U=this.rcpScaleY,V=4*(x-1),X=C.imageData.data,te=C.ctx.createImageData(E,O),Z=te.data;for(G=0;G<O;G++)for(J=0;J<E;J++)for(K=ee*J-(L=f(ee*J)),Y=U*G-(W=f(U*G)),H=4*(W*x+L),N=0;N<4;N++)B=X[H+N]*(1-K)*(1-Y)+X[H+4+N]*K*(1-Y)+X[H+V+N]*Y*(1-K)+X[H+V+4+N]*K*Y,Z[Q++]=B;return te},hermiteFastResize:function(C,x,b,E,O){for(var L=this.rcpScaleX,W=this.rcpScaleY,G=g(L/2),J=g(W/2),K=C.imageData.data,Y=C.ctx.createImageData(E,O),N=Y.data,B=0;B<O;B++)for(var H=0;H<E;H++){for(var Q=4*(H+B*E),ee=0,U=0,V=0,X=0,te=0,Z=0,re=0,he=(B+.5)*W,le=f(B*W);le<(B+1)*W;le++)for(var oe=s(he-(le+.5))/J,ue=(H+.5)*L,ce=oe*oe,ge=f(H*L);ge<(H+1)*L;ge++){var ye=s(ue-(ge+.5))/G,me=r(ce+ye*ye);me>1&&me<-1||(ee=2*me*me*me-3*me*me+1)>0&&(re+=ee*K[3+(ye=4*(ge+le*x))],V+=ee,K[ye+3]<255&&(ee=ee*K[ye+3]/250),X+=ee*K[ye],te+=ee*K[ye+1],Z+=ee*K[ye+2],U+=ee)}N[Q]=X/U,N[Q+1]=te/U,N[Q+2]=Z/U,N[Q+3]=re/V}return Y},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),a.Image.filters.Resize.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Contrast=f(c.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var s,h=r.imageData.data,m=h.length,g=Math.floor(255*this.contrast),p=259*(g+255)/(255*(259-g));for(s=0;s<m;s+=4)h[s]=p*(h[s]-128)+128,h[s+1]=p*(h[s+1]-128)+128,h[s+2]=p*(h[s+2]-128)+128}},getUniformLocations:function(r,s){return{uContrast:r.getUniformLocation(s,"uContrast")}},sendUniformData:function(r,s){r.uniform1f(s.uContrast,this.contrast)}}),a.Image.filters.Contrast.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Saturation=f(c.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var s,h,m=r.imageData.data,g=m.length,p=-this.saturation;for(s=0;s<g;s+=4)h=Math.max(m[s],m[s+1],m[s+2]),m[s]+=h!==m[s]?(h-m[s])*p:0,m[s+1]+=h!==m[s+1]?(h-m[s+1])*p:0,m[s+2]+=h!==m[s+2]?(h-m[s+2])*p:0}},getUniformLocations:function(r,s){return{uSaturation:r.getUniformLocation(s,"uSaturation")}},sendUniformData:function(r,s){r.uniform1f(s.uSaturation,-this.saturation)}}),a.Image.filters.Saturation.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Vibrance=f(c.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var s,h,m,g,p=r.imageData.data,v=p.length,C=-this.vibrance;for(s=0;s<v;s+=4)h=Math.max(p[s],p[s+1],p[s+2]),m=(p[s]+p[s+1]+p[s+2])/3,g=2*Math.abs(h-m)/255*C,p[s]+=h!==p[s]?(h-p[s])*g:0,p[s+1]+=h!==p[s+1]?(h-p[s+1])*g:0,p[s+2]+=h!==p[s+2]?(h-p[s+2])*g:0}},getUniformLocations:function(r,s){return{uVibrance:r.getUniformLocation(s,"uVibrance")}},sendUniformData:function(r,s){r.uniform1f(s.uVibrance,-this.vibrance)}}),a.Image.filters.Vibrance.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Blur=f(c.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var s,h,m=r.filterBackend.resources,g=r.imageData.width,p=r.imageData.height;m.blurLayer1||(m.blurLayer1=a.util.createCanvasElement(),m.blurLayer2=a.util.createCanvasElement()),s=m.blurLayer1,h=m.blurLayer2,s.width===g&&s.height===p||(h.width=s.width=g,h.height=s.height=p);var v,C,x,b,E=s.getContext("2d"),O=h.getContext("2d"),L=.06*this.blur*.5;for(E.putImageData(r.imageData,0,0),O.clearRect(0,0,g,p),b=-15;b<=15;b++)x=L*(C=b/15)*g+(v=(Math.random()-.5)/4),O.globalAlpha=1-Math.abs(C),O.drawImage(s,x,v),E.drawImage(h,0,0),O.globalAlpha=1,O.clearRect(0,0,h.width,h.height);for(b=-15;b<=15;b++)x=L*(C=b/15)*p+(v=(Math.random()-.5)/4),O.globalAlpha=1-Math.abs(C),O.drawImage(s,v,x),E.drawImage(h,0,0),O.globalAlpha=1,O.clearRect(0,0,h.width,h.height);r.ctx.drawImage(s,0,0);var W=r.ctx.getImageData(0,0,s.width,s.height);return E.globalAlpha=1,E.clearRect(0,0,s.width,s.height),W},getUniformLocations:function(r,s){return{delta:r.getUniformLocation(s,"uDelta")}},sendUniformData:function(r,s){var h=this.chooseRightDelta();r.uniform2fv(s.delta,h)},chooseRightDelta:function(){var r,s=1,h=[0,0];return this.horizontal?this.aspectRatio>1&&(s=1/this.aspectRatio):this.aspectRatio<1&&(s=this.aspectRatio),r=s*this.blur*.12,this.horizontal?h[0]=r:h[1]=r,h}}),c.Blur.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Gamma=f(c.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],c.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var s,h=r.imageData.data,m=this.gamma,g=h.length,p=1/m[0],v=1/m[1],C=1/m[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),s=0,g=256;s<g;s++)this.rVals[s]=255*Math.pow(s/255,p),this.gVals[s]=255*Math.pow(s/255,v),this.bVals[s]=255*Math.pow(s/255,C);for(s=0,g=h.length;s<g;s+=4)h[s]=this.rVals[h[s]],h[s+1]=this.gVals[h[s+1]],h[s+2]=this.bVals[h[s+2]]},getUniformLocations:function(r,s){return{uGamma:r.getUniformLocation(s,"uGamma")}},sendUniformData:function(r,s){r.uniform3fv(s.uGamma,this.gamma)}}),a.Image.filters.Gamma.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.Composed=f(c.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(r)})},toObject:function(){return a.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),a.Image.filters.Composed.fromObject=function(r,s){var h=(r.subFilters||[]).map(function(g){return new a.Image.filters[g.type](g)}),m=new a.Image.filters.Composed({subFilters:h});return s&&s(m),m}}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.Image.filters,f=a.util.createClass;c.HueRotation=f(c.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,s=a.util.cos(r),h=a.util.sin(r),m=1/3,g=Math.sqrt(m)*h,p=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+p/3,this.matrix[1]=m*p-g,this.matrix[2]=m*p+g,this.matrix[5]=m*p+g,this.matrix[6]=s+m*p,this.matrix[7]=m*p-g,this.matrix[10]=m*p-g,this.matrix[11]=m*p+g,this.matrix[12]=s+m*p},isNeutralState:function(r){return this.calculateMatrix(),c.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),c.BaseFilter.prototype.applyTo.call(this,r)}}),a.Image.filters.HueRotation.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(u){var a=u.fabric||(u.fabric={}),c=a.util.object.clone;if(a.Text)a.warn("fabric.Text is already defined");else{var f="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:a.Object.prototype.stateProperties.concat(f),cacheProperties:a.Object.prototype.cacheProperties.concat(f),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,s){this.styles=s&&s.styles||{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",s),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=a.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return a._measuringContext||(a._measuringContext=this.canvas&&this.canvas.contextCache||a.util.createCanvasElement().getContext("2d")),a._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,s,h,m,g,p,v,C=0,x=this._textLines.length;C<x;C++)if((this.textAlign==="justify"||C!==x-1&&!this.isEndOfWrapping(C))&&(m=0,g=this._textLines[C],(s=this.getLineWidth(C))<this.width&&(v=this.textLines[C].match(this._reSpacesAndTabs)))){h=v.length,r=(this.width-s)/h;for(var b=0,E=g.length;b<=E;b++)p=this.__charBounds[C][b],this._reSpaceAndTab.test(g[b])?(p.width+=r,p.kernedWidth+=r,p.left+=m,m+=r):p.left+=m}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),s=this.fontSize;return r.width+=s*r.zoomX,r.height+=s*r.zoomY,r},_render:function(r){var s=this.path;s&&!s.isNotVisible()&&s._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,s,h){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom"}r.font=this._getFontDeclaration(s,h)},calcTextWidth:function(){for(var r=this.getLineWidth(0),s=1,h=this._textLines.length;s<h;s++){var m=this.getLineWidth(s);m>r&&(r=m)}return r},_renderTextLine:function(r,s,h,m,g,p){this._renderChars(r,s,h,m,g,p)},_renderTextLinesBackground:function(r){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var s,h,m,g,p,v,C,x=r.fillStyle,b=this._getLeftOffset(),E=this._getTopOffset(),O=0,L=0,W=this.path,G=0,J=this._textLines.length;G<J;G++)if(s=this.getHeightOfLine(G),this.textBackgroundColor||this.styleHas("textBackgroundColor",G)){m=this._textLines[G],h=this._getLineLeftOffset(G),L=0,O=0,g=this.getValueOfPropertyAt(G,0,"textBackgroundColor");for(var K=0,Y=m.length;K<Y;K++)p=this.__charBounds[G][K],v=this.getValueOfPropertyAt(G,K,"textBackgroundColor"),W?(r.save(),r.translate(p.renderLeft,p.renderTop),r.rotate(p.angle),r.fillStyle=v,v&&r.fillRect(-p.width/2,-s/this.lineHeight*(1-this._fontSizeFraction),p.width,s/this.lineHeight),r.restore()):v!==g?(C=b+h+O,this.direction==="rtl"&&(C=this.width-C-L),r.fillStyle=g,g&&r.fillRect(C,E,L,s/this.lineHeight),O=p.left,L=p.width,g=v):L+=p.kernedWidth;v&&!W&&(C=b+h+O,this.direction==="rtl"&&(C=this.width-C-L),r.fillStyle=v,r.fillRect(C,E,L,s/this.lineHeight)),E+=s}else E+=s;r.fillStyle=x,this._removeShadow(r)}},getFontCache:function(r){var s=r.fontFamily.toLowerCase();a.charWidthsCache[s]||(a.charWidthsCache[s]={});var h=a.charWidthsCache[s],m=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return h[m]||(h[m]={}),h[m]},_measureChar:function(r,s,h,m){var g,p,v,C,x=this.getFontCache(s),b=h+r,E=this._getFontDeclaration(s)===this._getFontDeclaration(m),O=s.fontSize/this.CACHE_FONT_SIZE;if(h&&x[h]!==void 0&&(v=x[h]),x[r]!==void 0&&(C=g=x[r]),E&&x[b]!==void 0&&(C=(p=x[b])-v),g===void 0||v===void 0||p===void 0){var L=this.getMeasuringContext();this._setTextStyles(L,s,!0)}return g===void 0&&(C=g=L.measureText(r).width,x[r]=g),v===void 0&&E&&h&&(v=L.measureText(h).width,x[h]=v),E&&p===void 0&&(p=L.measureText(b).width,x[b]=p,C=p-v),{width:g*O,kernedWidth:C*O}},getHeightOfChar:function(r,s){return this.getValueOfPropertyAt(r,s,"fontSize")},measureLine:function(r){var s=this._measureLine(r);return this.charSpacing!==0&&(s.width-=this._getWidthOfCharSpacing()),s.width<0&&(s.width=0),s},_measureLine:function(r){var s,h,m,g,p,v,C=0,x=this._textLines[r],b=new Array(x.length),E=0,O=this.path,L=this.pathSide==="right";for(this.__charBounds[r]=b,s=0;s<x.length;s++)h=x[s],g=this._getGraphemeBox(h,r,s,m),b[s]=g,C+=g.kernedWidth,m=h;if(b[s]={left:g?g.left+g.width:0,width:0,kernedWidth:0,height:this.fontSize},O){switch(v=O.segmentsInfo[O.segmentsInfo.length-1].length,(p=a.util.getPointOnPath(O.path,0,O.segmentsInfo)).x+=O.pathOffset.x,p.y+=O.pathOffset.y,this.textAlign){case"left":E=L?v-C:0;break;case"center":E=(v-C)/2;break;case"right":E=L?0:v-C}for(E+=this.pathStartOffset*(L?-1:1),s=L?x.length-1:0;L?s>=0:s<x.length;L?s--:s++)g=b[s],E>v?E%=v:E<0&&(E+=v),this._setGraphemeOnPath(E,g,p),E+=g.kernedWidth}return{width:C,numOfSpaces:0}},_setGraphemeOnPath:function(r,s,h){var m=r+s.kernedWidth/2,g=this.path,p=a.util.getPointOnPath(g.path,m,g.segmentsInfo);s.renderLeft=p.x-h.x,s.renderTop=p.y-h.y,s.angle=p.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,s,h,m,g){var p,v=this.getCompleteStyleDeclaration(s,h),C=m?this.getCompleteStyleDeclaration(s,h-1):{},x=this._measureChar(r,v,m,C),b=x.kernedWidth,E=x.width;this.charSpacing!==0&&(E+=p=this._getWidthOfCharSpacing(),b+=p);var O={width:E,left:0,height:v.fontSize,kernedWidth:b,deltaY:v.deltaY};if(h>0&&!g){var L=this.__charBounds[s][h-1];O.left=L.left+L.width+x.kernedWidth-x.width}return O},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var s=this._textLines[r],h=this.getHeightOfChar(r,0),m=1,g=s.length;m<g;m++)h=Math.max(this.getHeightOfChar(r,m),h);return this.__lineHeights[r]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,s=0,h=0,m=this._textLines.length;h<m;h++)r=this.getHeightOfLine(h),s+=h===m-1?r/this.lineHeight:r;return s},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,s){r.save();for(var h=0,m=this._getLeftOffset(),g=this._getTopOffset(),p=0,v=this._textLines.length;p<v;p++){var C=this.getHeightOfLine(p),x=C/this.lineHeight,b=this._getLineLeftOffset(p);this._renderTextLine(s,r,this._textLines[p],m+b,g+h+x,p),h+=C}r.restore()},_renderTextFill:function(r){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,s,h,m,g,p){var v,C,x,b,E,O=this.getHeightOfLine(p),L=this.textAlign.indexOf("justify")!==-1,W="",G=0,J=this.path,K=!L&&this.charSpacing===0&&this.isEmptyStyles(p)&&!J,Y=this.direction==="ltr",N=this.direction==="ltr"?1:-1,B=s.canvas.getAttribute("dir");if(s.save(),B!==this.direction&&(s.canvas.setAttribute("dir",Y?"ltr":"rtl"),s.direction=Y?"ltr":"rtl",s.textAlign=Y?"left":"right"),g-=O*this._fontSizeFraction/this.lineHeight,K)return this._renderChar(r,s,p,0,h.join(""),m,g,O),void s.restore();for(var H=0,Q=h.length-1;H<=Q;H++)b=H===Q||this.charSpacing||J,W+=h[H],x=this.__charBounds[p][H],G===0?(m+=N*(x.kernedWidth-x.width),G+=x.width):G+=x.kernedWidth,L&&!b&&this._reSpaceAndTab.test(h[H])&&(b=!0),b||(v=v||this.getCompleteStyleDeclaration(p,H),C=this.getCompleteStyleDeclaration(p,H+1),b=this._hasStyleChanged(v,C)),b&&(J?(s.save(),s.translate(x.renderLeft,x.renderTop),s.rotate(x.angle),this._renderChar(r,s,p,H,W,-G/2,0,O),s.restore()):(E=m,this._renderChar(r,s,p,H,W,E,g,O)),W="",v=C,m+=N*G,G=0);s.restore()},_applyPatternGradientTransformText:function(r){var s,h=a.util.createCanvasElement(),m=this.width+this.strokeWidth,g=this.height+this.strokeWidth;return h.width=m,h.height=g,(s=h.getContext("2d")).beginPath(),s.moveTo(0,0),s.lineTo(m,0),s.lineTo(m,g),s.lineTo(0,g),s.closePath(),s.translate(m/2,g/2),s.fillStyle=r.toLive(s),this._applyPatternGradientTransform(s,r),s.fill(),s.createPattern(h,"no-repeat")},handleFiller:function(r,s,h){var m,g;return h.toLive?h.gradientUnits==="percentage"||h.gradientTransform||h.patternTransform?(m=-this.width/2,g=-this.height/2,r.translate(m,g),r[s]=this._applyPatternGradientTransformText(h),{offsetX:m,offsetY:g}):(r[s]=h.toLive(r,this),this._applyPatternGradientTransform(r,h)):(r[s]=h,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,s){return r.lineWidth=s.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",s.stroke)},_setFillStyles:function(r,s){return this.handleFiller(r,"fillStyle",s.fill)},_renderChar:function(r,s,h,m,g,p,v){var C,x,b=this._getStyleDeclaration(h,m),E=this.getCompleteStyleDeclaration(h,m),O=r==="fillText"&&E.fill,L=r==="strokeText"&&E.stroke&&E.strokeWidth;(L||O)&&(s.save(),O&&(C=this._setFillStyles(s,E)),L&&(x=this._setStrokeStyles(s,E)),s.font=this._getFontDeclaration(E),b&&b.textBackgroundColor&&this._removeShadow(s),b&&b.deltaY&&(v+=b.deltaY),O&&s.fillText(g,p-C.offsetX,v-C.offsetY),L&&s.strokeText(g,p-x.offsetX,v-x.offsetY),s.restore())},setSuperscript:function(r,s){return this._setScript(r,s,this.superscript)},setSubscript:function(r,s){return this._setScript(r,s,this.subscript)},_setScript:function(r,s,h){var m=this.get2DCursorLocation(r,!0),g=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"fontSize"),p=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"deltaY"),v={fontSize:g*h.size,deltaY:p+g*h.baseline};return this.setSelectionStyles(v,r,s),this},_hasStyleChanged:function(r,s){return r.fill!==s.fill||r.stroke!==s.stroke||r.strokeWidth!==s.strokeWidth||r.fontSize!==s.fontSize||r.fontFamily!==s.fontFamily||r.fontWeight!==s.fontWeight||r.fontStyle!==s.fontStyle||r.deltaY!==s.deltaY},_hasStyleChangedForSvg:function(r,s){return this._hasStyleChanged(r,s)||r.overline!==s.overline||r.underline!==s.underline||r.linethrough!==s.linethrough},_getLineLeftOffset:function(r){var s=this.getLineWidth(r),h=this.width-s,m=this.textAlign,g=this.direction,p=0,v=this.isEndOfWrapping(r);return m==="justify"||m==="justify-center"&&!v||m==="justify-right"&&!v||m==="justify-left"&&!v?0:(m==="center"&&(p=h/2),m==="right"&&(p=h),m==="justify-center"&&(p=h/2),m==="justify-right"&&(p=h),g==="rtl"&&(p-=h),p)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var s=this.measureLine(r).width;return this.__lineWidths[r]=s,s},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,s,h){var m=this._getStyleDeclaration(r,s);return m&&m[h]!==void 0?m[h]:this[h]},_renderTextDecoration:function(r,s){if(this[s]||this.styleHas(s)){for(var h,m,g,p,v,C,x,b,E,O,L,W,G,J,K,Y,N=this._getLeftOffset(),B=this._getTopOffset(),H=this.path,Q=this._getWidthOfCharSpacing(),ee=this.offsets[s],U=0,V=this._textLines.length;U<V;U++)if(h=this.getHeightOfLine(U),this[s]||this.styleHas(s,U)){x=this._textLines[U],J=h/this.lineHeight,p=this._getLineLeftOffset(U),O=0,L=0,b=this.getValueOfPropertyAt(U,0,s),Y=this.getValueOfPropertyAt(U,0,"fill"),E=B+J*(1-this._fontSizeFraction),m=this.getHeightOfChar(U,0),v=this.getValueOfPropertyAt(U,0,"deltaY");for(var X=0,te=x.length;X<te;X++)if(W=this.__charBounds[U][X],G=this.getValueOfPropertyAt(U,X,s),K=this.getValueOfPropertyAt(U,X,"fill"),g=this.getHeightOfChar(U,X),C=this.getValueOfPropertyAt(U,X,"deltaY"),H&&G&&K)r.save(),r.fillStyle=Y,r.translate(W.renderLeft,W.renderTop),r.rotate(W.angle),r.fillRect(-W.kernedWidth/2,ee*g+C,W.kernedWidth,this.fontSize/15),r.restore();else if((G!==b||K!==Y||g!==m||C!==v)&&L>0){var Z=N+p+O;this.direction==="rtl"&&(Z=this.width-Z-L),b&&Y&&(r.fillStyle=Y,r.fillRect(Z,E+ee*m+v,L,this.fontSize/15)),O=W.left,L=W.width,b=G,Y=K,m=g,v=C}else L+=W.kernedWidth;Z=N+p+O,this.direction==="rtl"&&(Z=this.width-Z-L),r.fillStyle=K,G&&K&&r.fillRect(Z,E+ee*m+v,L-Q,this.fontSize/15),B+=h}else B+=h;this._removeShadow(r)}},_getFontDeclaration:function(r,s){var h=r||this,m=this.fontFamily,g=a.Text.genericFonts.indexOf(m.toLowerCase())>-1,p=m===void 0||m.indexOf("'")>-1||m.indexOf(",")>-1||m.indexOf('"')>-1||g?h.fontFamily:'"'+h.fontFamily+'"';return[a.isLikelyNode?h.fontWeight:h.fontStyle,a.isLikelyNode?h.fontStyle:h.fontWeight,s?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",p].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var s=r.split(this._reNewline),h=new Array(s.length),m=[`
`],g=[],p=0;p<s.length;p++)h[p]=a.util.string.graphemeSplit(s[p]),g=g.concat(h[p],m);return g.pop(),{_unwrappedLines:h,lines:s,graphemeText:g,graphemeLines:h}},toObject:function(r){var s=f.concat(r),h=this.callSuper("toObject",s);return h.styles=c(this.styles,!0),h.path&&(h.path=this.path.toObject()),h},set:function(r,s){this.callSuper("set",r,s);var h=!1,m=!1;if(typeof r=="object")for(var g in r)g==="path"&&this.setPathInfo(),h=h||this._dimensionAffectingProps.indexOf(g)!==-1,m=m||g==="path";else h=this._dimensionAffectingProps.indexOf(r)!==-1,m=r==="path";return m&&this.setPathInfo(),h&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(r,s,h){if(!r)return s(null);var m=a.parseAttributes(r,a.Text.ATTRIBUTE_NAMES),g=m.textAnchor||"left";if((h=a.util.object.extend(h?c(h):{},m)).top=h.top||0,h.left=h.left||0,m.textDecoration){var p=m.textDecoration;p.indexOf("underline")!==-1&&(h.underline=!0),p.indexOf("overline")!==-1&&(h.overline=!0),p.indexOf("line-through")!==-1&&(h.linethrough=!0),delete h.textDecoration}"dx"in m&&(h.left+=m.dx),"dy"in m&&(h.top+=m.dy),"fontSize"in h||(h.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in r?v=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(v=r.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var C=h.strokeWidth;h.strokeWidth=0;var x=new a.Text(v,h),b=x.getScaledHeight()/x.height,E=((x.height+x.strokeWidth)*x.lineHeight-x.height)*b,O=x.getScaledHeight()+E,L=0;g==="center"&&(L=x.getScaledWidth()/2),g==="right"&&(L=x.getScaledWidth()),x.set({left:x.left-L,top:x.top-(O-x.fontSize*(.07+x._fontSizeFraction))/x.lineHeight,strokeWidth:C!==void 0?C:1}),s(x)},a.Text.fromObject=function(r,s){var h=c(r),m=r.path;return delete h.path,a.Object._fromObject("Text",h,function(g){m?a.Object._fromObject("Path",m,function(p){g.set("path",p),s(g)},"path"):s(g)},"text")},a.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],a.util.createAccessors&&a.util.createAccessors(a.Text)}}(e),y.util.object.extend(y.Text.prototype,{isEmptyStyles:function(u){if(!this.styles||u!==void 0&&!this.styles[u])return!0;var a=u===void 0?this.styles:{line:this.styles[u]};for(var c in a)for(var f in a[c])for(var r in a[c][f])return!1;return!0},styleHas:function(u,a){if(!this.styles||!u||u===""||a!==void 0&&!this.styles[a])return!1;var c=a===void 0?this.styles:{0:this.styles[a]};for(var f in c)for(var r in c[f])if(c[f][r][u]!==void 0)return!0;return!1},cleanStyle:function(u){if(!this.styles||!u||u==="")return!1;var a,c,f=this.styles,r=0,s=!0,h=0;for(var m in f){for(var g in a=0,f[m]){var p;r++,(p=f[m][g]).hasOwnProperty(u)?(c?p[u]!==c&&(s=!1):c=p[u],p[u]===this[u]&&delete p[u]):s=!1,Object.keys(p).length!==0?a++:delete f[m][g]}a===0&&delete f[m]}for(var v=0;v<this._textLines.length;v++)h+=this._textLines[v].length;s&&r===h&&(this[u]=c,this.removeStyle(u))},removeStyle:function(u){if(this.styles&&u&&u!==""){var a,c,f,r=this.styles;for(c in r){for(f in a=r[c])delete a[f][u],Object.keys(a[f]).length===0&&delete a[f];Object.keys(a).length===0&&delete r[c]}}},_extendStyles:function(u,a){var c=this.get2DCursorLocation(u);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex),this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{}),y.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),a)},get2DCursorLocation:function(u,a){u===void 0&&(u=this.selectionStart);for(var c=a?this._unwrappedTextLines:this._textLines,f=c.length,r=0;r<f;r++){if(u<=c[r].length)return{lineIndex:r,charIndex:u};u-=c[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:c[r-1].length<u?c[r-1].length:u}},getSelectionStyles:function(u,a,c){u===void 0&&(u=this.selectionStart||0),a===void 0&&(a=this.selectionEnd||u);for(var f=[],r=u;r<a;r++)f.push(this.getStyleAtPosition(r,c));return f},getStyleAtPosition:function(u,a){var c=this.get2DCursorLocation(u);return(a?this.getCompleteStyleDeclaration(c.lineIndex,c.charIndex):this._getStyleDeclaration(c.lineIndex,c.charIndex))||{}},setSelectionStyles:function(u,a,c){a===void 0&&(a=this.selectionStart||0),c===void 0&&(c=this.selectionEnd||a);for(var f=a;f<c;f++)this._extendStyles(f,u);return this._forceClearCache=!0,this},_getStyleDeclaration:function(u,a){var c=this.styles&&this.styles[u];return c?c[a]:null},getCompleteStyleDeclaration:function(u,a){for(var c,f=this._getStyleDeclaration(u,a)||{},r={},s=0;s<this._styleProperties.length;s++)r[c=this._styleProperties[s]]=f[c]===void 0?this[c]:f[c];return r},_setStyleDeclaration:function(u,a,c){this.styles[u][a]=c},_deleteStyleDeclaration:function(u,a){delete this.styles[u][a]},_getLineStyle:function(u){return!!this.styles[u]},_setLineStyle:function(u){this.styles[u]={}},_deleteLineStyle:function(u){delete this.styles[u]}}),function(){function u(a){a.textDecoration&&(a.textDecoration.indexOf("underline")>-1&&(a.underline=!0),a.textDecoration.indexOf("line-through")>-1&&(a.linethrough=!0),a.textDecoration.indexOf("overline")>-1&&(a.overline=!0),delete a.textDecoration)}y.IText=y.util.createClass(y.Text,y.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(a,c){this.callSuper("initialize",a,c),this.initBehavior()},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,c){this[a]!==c&&(this._fireSelectionChanged(),this[a]=c),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(a){this.clearContextTop(),this.callSuper("render",a),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a)},clearContextTop:function(a){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var c=this.canvas.contextTop,f=this.canvas.viewportTransform;c.save(),c.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this.transform(c),this._clearTextArea(c),a||c.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this._getCursorBoundaries(),c=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(a,c):this.renderSelection(a,c),c.restore()}},_clearTextArea:function(a){var c=this.width+4,f=this.height+4;a.clearRect(-c/2,-f/2,c,f)},_getCursorBoundaries:function(a){a===void 0&&(a=this.selectionStart);var c=this._getLeftOffset(),f=this._getTopOffset(),r=this._getCursorBoundariesOffsets(a);return{left:c,top:f,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(a){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var c,f,r,s,h=0,m=0,g=this.get2DCursorLocation(a);r=g.charIndex,f=g.lineIndex;for(var p=0;p<f;p++)h+=this.getHeightOfLine(p);c=this._getLineLeftOffset(f);var v=this.__charBounds[f][r];return v&&(m=v.left),this.charSpacing!==0&&r===this._textLines[f].length&&(m-=this._getWidthOfCharSpacing()),s={top:h,left:c+(m>0?m:0)},this.direction==="rtl"&&(s.left*=-1),this.cursorOffsetCache=s,this.cursorOffsetCache},renderCursor:function(a,c){var f=this.get2DCursorLocation(),r=f.lineIndex,s=f.charIndex>0?f.charIndex-1:0,h=this.getValueOfPropertyAt(r,s,"fontSize"),m=this.scaleX*this.canvas.getZoom(),g=this.cursorWidth/m,p=a.topOffset,v=this.getValueOfPropertyAt(r,s,"deltaY");p+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-h*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(a,c),c.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,s,"fill"),c.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,c.fillRect(a.left+a.leftOffset-g/2,p+a.top+v,g,h)},renderSelection:function(a,c){for(var f=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(f),m=this.get2DCursorLocation(r),g=h.lineIndex,p=m.lineIndex,v=h.charIndex<0?0:h.charIndex,C=m.charIndex<0?0:m.charIndex,x=g;x<=p;x++){var b,E=this._getLineLeftOffset(x)||0,O=this.getHeightOfLine(x),L=0,W=0;if(x===g&&(L=this.__charBounds[g][v].left),x>=g&&x<p)W=s&&!this.isEndOfWrapping(x)?this.width:this.getLineWidth(x)||5;else if(x===p)if(C===0)W=this.__charBounds[p][C].left;else{var G=this._getWidthOfCharSpacing();W=this.__charBounds[p][C-1].left+this.__charBounds[p][C-1].width-G}b=O,(this.lineHeight<1||x===p&&this.lineHeight>1)&&(O/=this.lineHeight);var J=a.left+E+L,K=W-L,Y=O,N=0;this.inCompositionMode?(c.fillStyle=this.compositionColor||"black",Y=1,N=O):c.fillStyle=this.selectionColor,this.direction==="rtl"&&(J=this.width-J-K),c.fillRect(J,a.top+a.topOffset+N,K,Y),a.topOffset+=b}},getCurrentCharFontSize:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")},getCurrentCharColor:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fill")},_getCurrentCharIndex:function(){var a=this.get2DCursorLocation(this.selectionStart,!0),c=a.charIndex>0?a.charIndex-1:0;return{l:a.lineIndex,c}}}),y.IText.fromObject=function(a,c){if(u(a),a.styles)for(var f in a.styles)for(var r in a.styles[f])u(a.styles[f][r]);y.Object._fromObject("IText",a,c,"text")}}(),q=y.util.object.clone,y.util.object.extend(y.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var u=this;this.on("added",function(){var a=u.canvas;a&&(a._hasITextHandlers||(a._hasITextHandlers=!0,u._initCanvasHandlers(a)),a._iTextInstances=a._iTextInstances||[],a._iTextInstances.push(u))})},initRemovedHandler:function(){var u=this;this.on("removed",function(){var a=u.canvas;a&&(a._iTextInstances=a._iTextInstances||[],y.util.removeFromArray(a._iTextInstances,u),a._iTextInstances.length===0&&(a._hasITextHandlers=!1,u._removeCanvasHandlers(a)))})},_initCanvasHandlers:function(u){u._mouseUpITextHandler=function(){u._iTextInstances&&u._iTextInstances.forEach(function(a){a.__isMousedown=!1})},u.on("mouse:up",u._mouseUpITextHandler)},_removeCanvasHandlers:function(u){u.off("mouse:up",u._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(u,a,c,f){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},u.animate("_currentCursorOpacity",a,{duration:c,onComplete:function(){r.isAborted||u[f]()},onChange:function(){u.canvas&&u.selectionStart===u.selectionEnd&&u.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var u=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){u._currentTickCompleteState=u._animateCursor(u,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(u){var a=this,c=u?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){a._tick()},c)},abortCursorAnimation:function(){var u=this._currentTickState||this._currentTickCompleteState,a=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,u&&a&&a.clearContext(a.contextTop||a.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(u){var a=0,c=u-1;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)a++,c--;for(;/\S/.test(this._text[c])&&c>-1;)a++,c--;return u-a},findWordBoundaryRight:function(u){var a=0,c=u;if(this._reSpace.test(this._text[c]))for(;this._reSpace.test(this._text[c]);)a++,c++;for(;/\S/.test(this._text[c])&&c<this._text.length;)a++,c++;return u+a},findLineBoundaryLeft:function(u){for(var a=0,c=u-1;!/\n/.test(this._text[c])&&c>-1;)a++,c--;return u-a},findLineBoundaryRight:function(u){for(var a=0,c=u;!/\n/.test(this._text[c])&&c<this._text.length;)a++,c++;return u+a},searchWordBoundary:function(u,a){for(var c=this._text,f=this._reSpace.test(c[u])?u-1:u,r=c[f],s=y.reNonWord;!s.test(r)&&f>0&&f<c.length;)r=c[f+=a];return s.test(r)&&(f+=a===1?0:1),f},selectWord:function(u){u=u||this.selectionStart;var a=this.searchWordBoundary(u,-1),c=this.searchWordBoundary(u,1);this.selectionStart=a,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(u){u=u||this.selectionStart;var a=this.findLineBoundaryLeft(u),c=this.findLineBoundaryRight(u);return this.selectionStart=a,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(u){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(u),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(u){u._iTextInstances&&u._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(u){if(this.__isMousedown&&this.isEditing){var a=this.getSelectionStartFromPointer(u.e),c=this.selectionStart,f=this.selectionEnd;(a===this.__selectionStartOnMouseDown&&c!==f||c!==a&&f!==a)&&(a>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=a):(this.selectionStart=a,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===c&&this.selectionEnd===f||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(u,a,c){var f=c.slice(0,u),r=y.util.string.graphemeSplit(f).length;if(u===a)return{selectionStart:r,selectionEnd:r};var s=c.slice(u,a);return{selectionStart:r,selectionEnd:r+y.util.string.graphemeSplit(s).length}},fromGraphemeToStringSelection:function(u,a,c){var f=c.slice(0,u).join("").length;return u===a?{selectionStart:f,selectionEnd:f}:{selectionStart:f,selectionEnd:f+c.slice(u,a).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var u=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=u.selectionStart,this.hiddenTextarea.selectionEnd=u.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var u=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=u.selectionEnd,this.inCompositionMode||(this.selectionStart=u.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var u=this._calcTextareaPosition();this.hiddenTextarea.style.left=u.left,this.hiddenTextarea.style.top=u.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var u=this.inCompositionMode?this.compositionStart:this.selectionStart,a=this._getCursorBoundaries(u),c=this.get2DCursorLocation(u),f=c.lineIndex,r=c.charIndex,s=this.getValueOfPropertyAt(f,r,"fontSize")*this.lineHeight,h=a.leftOffset,m=this.calcTransformMatrix(),g={x:a.left+h,y:a.top+a.topOffset+s},p=this.canvas.getRetinaScaling(),v=this.canvas.upperCanvasEl,C=v.width/p,x=v.height/p,b=C-s,E=x-s,O=v.clientWidth/C,L=v.clientHeight/x;return g=y.util.transformPoint(g,m),(g=y.util.transformPoint(g,this.canvas.viewportTransform)).x*=O,g.y*=L,g.x<0&&(g.x=0),g.x>b&&(g.x=b),g.y<0&&(g.y=0),g.y>E&&(g.y=E),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:g.x+"px",top:g.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var u=this._textBeforeEdit!==this.text,a=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),u&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),u&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var u in this.styles)this._textLines[u]||delete this.styles[u]},removeStyleFromTo:function(u,a){var c,f,r=this.get2DCursorLocation(u,!0),s=this.get2DCursorLocation(a,!0),h=r.lineIndex,m=r.charIndex,g=s.lineIndex,p=s.charIndex;if(h!==g){if(this.styles[h])for(c=m;c<this._unwrappedTextLines[h].length;c++)delete this.styles[h][c];if(this.styles[g])for(c=p;c<this._unwrappedTextLines[g].length;c++)(f=this.styles[g][c])&&(this.styles[h]||(this.styles[h]={}),this.styles[h][m+c-p]=f);for(c=h+1;c<=g;c++)delete this.styles[c];this.shiftLineStyles(g,h-g)}else if(this.styles[h]){f=this.styles[h];var v,C,x=p-m;for(c=m;c<p;c++)delete f[c];for(C in this.styles[h])(v=parseInt(C,10))>=p&&(f[v-x]=f[C],delete f[C])}},shiftLineStyles:function(u,a){var c=q(this.styles);for(var f in this.styles){var r=parseInt(f,10);r>u&&(this.styles[r+a]=c[r],c[r-a]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(u,a,c,f){var r,s={},h=!1,m=this._unwrappedTextLines[u].length===a;for(var g in c||(c=1),this.shiftLineStyles(u,c),this.styles[u]&&(r=this.styles[u][a===0?a:a-1]),this.styles[u]){var p=parseInt(g,10);p>=a&&(h=!0,s[p-a]=this.styles[u][g],m&&a===0||delete this.styles[u][g])}var v=!1;for(h&&!m&&(this.styles[u+c]=s,v=!0),v&&c--;c>0;)f&&f[c-1]?this.styles[u+c]={0:q(f[c-1])}:r?this.styles[u+c]={0:q(r)}:delete this.styles[u+c],c--;this._forceClearCache=!0},insertCharStyleObject:function(u,a,c,f){this.styles||(this.styles={});var r=this.styles[u],s=r?q(r):{};for(var h in c||(c=1),s){var m=parseInt(h,10);m>=a&&(r[m+c]=s[m],s[m-c]||delete r[m])}if(this._forceClearCache=!0,f)for(;c--;)Object.keys(f[c]).length&&(this.styles[u]||(this.styles[u]={}),this.styles[u][a+c]=q(f[c]));else if(r)for(var g=r[a?a-1:1];g&&c--;)this.styles[u][a+c]=q(g)},insertNewStyleBlock:function(u,a,c){for(var f=this.get2DCursorLocation(a,!0),r=[0],s=0,h=0;h<u.length;h++)u[h]===`
`?r[++s]=0:r[s]++;for(r[0]>0&&(this.insertCharStyleObject(f.lineIndex,f.charIndex,r[0],c),c=c&&c.slice(r[0]+1)),s&&this.insertNewlineStyleObject(f.lineIndex,f.charIndex+r[0],s),h=1;h<s;h++)r[h]>0?this.insertCharStyleObject(f.lineIndex+h,0,r[h],c):c&&this.styles[f.lineIndex+h]&&c[0]&&(this.styles[f.lineIndex+h][0]=c[0]),c=c&&c.slice(r[h]+1);r[h]>0&&this.insertCharStyleObject(f.lineIndex+h,0,r[h],c)},setSelectionStartEndWithShift:function(u,a,c){c<=u?(a===u?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=u),this.selectionStart=c):c>u&&c<a?this._selectionDirection==="right"?this.selectionEnd=c:this.selectionStart=c:(a===u?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=a),this.selectionEnd=c)},setSelectionInBoundaries:function(){var u=this.text.length;this.selectionStart>u?this.selectionStart=u:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>u?this.selectionEnd=u:this.selectionEnd<0&&(this.selectionEnd=0)}}),y.util.object.extend(y.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(u){if(this.canvas){this.__newClickTime=+new Date;var a=u.pointer;this.isTripleClick(a)&&(this.fire("tripleclick",u),this._stopEvent(u.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=a,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(u){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===u.x&&this.__lastPointer.y===u.y},_stopEvent:function(u){u.preventDefault&&u.preventDefault(),u.stopPropagation&&u.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(u){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(u.e))},tripleClickHandler:function(u){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(u.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(u.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(u){!this.canvas||!this.editable||u.e.button&&u.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(u){if(this.__isMousedown=!1,!(!this.editable||this.group||u.transform&&u.transform.actionPerformed||u.e.button&&u.e.button!==1)){if(this.canvas){var a=this.canvas._activeObject;if(a&&a!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(u.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(u){var a=this.getSelectionStartFromPointer(u),c=this.selectionStart,f=this.selectionEnd;u.shiftKey?this.setSelectionStartEndWithShift(c,f,a):(this.selectionStart=a,this.selectionEnd=a),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(u){for(var a,c=this.getLocalPointer(u),f=0,r=0,s=0,h=0,m=0,g=0,p=this._textLines.length;g<p&&s<=c.y;g++)s+=this.getHeightOfLine(g)*this.scaleY,m=g,g>0&&(h+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));r=this._getLineLeftOffset(m)*this.scaleX,a=this._textLines[m],this.direction==="rtl"&&(c.x=this.width*this.scaleX-c.x+r);for(var v=0,C=a.length;v<C&&(f=r,(r+=this.__charBounds[m][v].kernedWidth*this.scaleX)<=c.x);v++)h++;return this._getNewSelectionStartFromOffset(c,f,r,h,C)},_getNewSelectionStartFromOffset:function(u,a,c,f,r){var s=u.x-a,h=c-u.x,m=f+(h>s||h<0?0:1);return this.flipX&&(m=r-m),m>this._text.length&&(m=this._text.length),m}}),y.util.object.extend(y.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=y.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var u=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+u.top+"; left: "+u.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+u.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):y.document.body.appendChild(this.hiddenTextarea),y.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),y.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),y.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),y.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(y.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(u){if(this.isEditing){var a=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(u.keyCode in a)this[a[u.keyCode]](u);else{if(!(u.keyCode in this.ctrlKeysMapDown)||!u.ctrlKey&&!u.metaKey)return;this[this.ctrlKeysMapDown[u.keyCode]](u)}u.stopImmediatePropagation(),u.preventDefault(),u.keyCode>=33&&u.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(u){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:u.keyCode in this.ctrlKeysMapUp&&(u.ctrlKey||u.metaKey)&&(this[this.ctrlKeysMapUp[u.keyCode]](u),u.stopImmediatePropagation(),u.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(u){var a=this.fromPaste;if(this.fromPaste=!1,u&&u.stopPropagation(),this.isEditing){var c,f,r,s,h,m=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,g=this._text.length,p=m.length,v=p-g,C=this.selectionStart,x=this.selectionEnd,b=C!==x;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var E=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),O=C>E.selectionStart;b?(c=this._text.slice(C,x),v+=x-C):p<g&&(c=O?this._text.slice(x+v,x):this._text.slice(C,C-v)),f=m.slice(E.selectionEnd-v,E.selectionEnd),c&&c.length&&(f.length&&(r=this.getSelectionStyles(C,C+1,!1),r=f.map(function(){return r[0]})),b?(s=C,h=x):O?(s=x-c.length,h=x):(s=x,h=x+c.length),this.removeStyleFromTo(s,h)),f.length&&(a&&f.join("")===y.copiedText&&!y.disableStyleCopyPaste&&(r=y.copiedTextStyle),this.insertNewStyleBlock(f,C,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(u){this.compositionStart=u.target.selectionStart,this.compositionEnd=u.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(y.copiedText=this.getSelectedText(),y.disableStyleCopyPaste?y.copiedTextStyle=null:y.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(u){return u&&u.clipboardData||y.window.clipboardData},_getWidthBeforeCursor:function(u,a){var c,f=this._getLineLeftOffset(u);return a>0&&(f+=(c=this.__charBounds[u][a-1]).left+c.width),f},getDownCursorOffset:function(u,a){var c=this._getSelectionForOffset(u,a),f=this.get2DCursorLocation(c),r=f.lineIndex;if(r===this._textLines.length-1||u.metaKey||u.keyCode===34)return this._text.length-c;var s=f.charIndex,h=this._getWidthBeforeCursor(r,s),m=this._getIndexOnLine(r+1,h);return this._textLines[r].slice(s).length+m+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(u,a){return u.shiftKey&&this.selectionStart!==this.selectionEnd&&a?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(u,a){var c=this._getSelectionForOffset(u,a),f=this.get2DCursorLocation(c),r=f.lineIndex;if(r===0||u.metaKey||u.keyCode===33)return-c;var s=f.charIndex,h=this._getWidthBeforeCursor(r,s),m=this._getIndexOnLine(r-1,h),g=this._textLines[r].slice(0,s),p=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+m-g.length+(1-p)},_getIndexOnLine:function(u,a){for(var c,f,r=this._textLines[u],s=this._getLineLeftOffset(u),h=0,m=0,g=r.length;m<g;m++)if((s+=c=this.__charBounds[u][m].width)>a){f=!0;var p=s-c,v=s,C=Math.abs(p-a);h=Math.abs(v-a)<C?m:m-1;break}return f||(h=r.length-1),h},moveCursorDown:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",u)},moveCursorUp:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",u)},_moveCursorUpOrDown:function(u,a){var c=this["get"+u+"CursorOffset"](a,this._selectionDirection==="right");a.shiftKey?this.moveCursorWithShift(c):this.moveCursorWithoutShift(c),c!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(u){var a=this._selectionDirection==="left"?this.selectionStart+u:this.selectionEnd+u;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a),u!==0},moveCursorWithoutShift:function(u){return u<0?(this.selectionStart+=u,this.selectionEnd=this.selectionStart):(this.selectionEnd+=u,this.selectionStart=this.selectionEnd),u!==0},moveCursorLeft:function(u){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",u)},_move:function(u,a,c){var f;if(u.altKey)f=this["findWordBoundary"+c](this[a]);else{if(!u.metaKey&&u.keyCode!==35&&u.keyCode!==36)return this[a]+=c==="Left"?-1:1,!0;f=this["findLineBoundary"+c](this[a])}if(typeof f!==void 0&&this[a]!==f)return this[a]=f,!0},_moveLeft:function(u,a){return this._move(u,a,"Left")},_moveRight:function(u,a){return this._move(u,a,"Right")},moveCursorLeftWithoutShift:function(u){var a=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(a=this._moveLeft(u,"selectionStart")),this.selectionEnd=this.selectionStart,a},moveCursorLeftWithShift:function(u){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(u,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(u,"selectionStart")):void 0},moveCursorRight:function(u){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",u)},_moveCursorLeftOrRight:function(u,a){var c="moveCursor"+u+"With";this._currentCursorOpacity=1,a.shiftKey?c+="Shift":c+="outShift",this[c](a)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(u){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(u,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(u,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(u){var a=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(a=this._moveRight(u,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,a},removeChars:function(u,a){a===void 0&&(a=u+1),this.removeStyleFromTo(u,a),this._text.splice(u,a-u),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(u,a,c,f){f===void 0&&(f=c),f>c&&this.removeStyleFromTo(c,f);var r=y.util.string.graphemeSplit(u);this.insertNewStyleBlock(r,c,a),this._text=[].concat(this._text.slice(0,c),r,this._text.slice(f)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var u=y.util.toFixed,a=/  +/g;y.util.object.extend(y.Text.prototype,{_toSVG:function(){var c=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(c.textTop,c.textLeft);return this._wrapSVGTextAndBg(f)},toSVG:function(c){return this._createBaseSVGMarkup(this._toSVG(),{reviver:c,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(c){var f=this.getSvgTextDecoration(this);return[c.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",f?'text-decoration="'+f+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",c.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(c,f){var r,s=[],h=[],m=c;this._setSVGBg(h);for(var g=0,p=this._textLines.length;g<p;g++)r=this._getLineLeftOffset(g),(this.textBackgroundColor||this.styleHas("textBackgroundColor",g))&&this._setSVGTextLineBg(h,g,f+r,m),this._setSVGTextLineText(s,g,f+r,m),m+=this.getHeightOfLine(g);return{textSpans:s,textBgRects:h}},_createTextCharSpan:function(c,f,r,s){var h=c!==c.trim()||c.match(a),m=this.getSvgSpanStyles(f,h),g=m?'style="'+m+'"':"",p=f.deltaY,v="",C=y.Object.NUM_FRACTION_DIGITS;return p&&(v=' dy="'+u(p,C)+'" '),['<tspan x="',u(r,C),'" y="',u(s,C),'" ',v,g,">",y.util.string.escapeXml(c),"</tspan>"].join("")},_setSVGTextLineText:function(c,f,r,s){var h,m,g,p,v,C=this.getHeightOfLine(f),x=this.textAlign.indexOf("justify")!==-1,b="",E=0,O=this._textLines[f];s+=C*(1-this._fontSizeFraction)/this.lineHeight;for(var L=0,W=O.length-1;L<=W;L++)v=L===W||this.charSpacing,b+=O[L],g=this.__charBounds[f][L],E===0?(r+=g.kernedWidth-g.width,E+=g.width):E+=g.kernedWidth,x&&!v&&this._reSpaceAndTab.test(O[L])&&(v=!0),v||(h=h||this.getCompleteStyleDeclaration(f,L),m=this.getCompleteStyleDeclaration(f,L+1),v=this._hasStyleChangedForSvg(h,m)),v&&(p=this._getStyleDeclaration(f,L)||{},c.push(this._createTextCharSpan(b,p,r,s)),b="",h=m,r+=E,E=0)},_pushTextBgRect:function(c,f,r,s,h,m){var g=y.Object.NUM_FRACTION_DIGITS;c.push("		<rect ",this._getFillAttributes(f),' x="',u(r,g),'" y="',u(s,g),'" width="',u(h,g),'" height="',u(m,g),`"></rect>
`)},_setSVGTextLineBg:function(c,f,r,s){for(var h,m,g=this._textLines[f],p=this.getHeightOfLine(f)/this.lineHeight,v=0,C=0,x=this.getValueOfPropertyAt(f,0,"textBackgroundColor"),b=0,E=g.length;b<E;b++)h=this.__charBounds[f][b],(m=this.getValueOfPropertyAt(f,b,"textBackgroundColor"))!==x?(x&&this._pushTextBgRect(c,x,r+C,s,v,p),C=h.left,v=h.width,x=m):v+=h.kernedWidth;m&&this._pushTextBgRect(c,m,r+C,s,v,p)},_getFillAttributes:function(c){var f=c&&typeof c=="string"?new y.Color(c):"";return f&&f.getSource()&&f.getAlpha()!==1?'opacity="'+f.getAlpha()+'" fill="'+f.setAlpha(1).toRgb()+'"':'fill="'+c+'"'},_getSVGLineTopOffset:function(c){for(var f,r=0,s=0;s<c;s++)r+=this.getHeightOfLine(s);return f=this.getHeightOfLine(s),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*f/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(c){return y.Object.prototype.getSvgStyles.call(this,c)+" white-space: pre;"}})}(),function(u){var a=u.fabric||(u.fabric={});a.Textbox=a.util.createClass(a.IText,a.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:a.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(c){for(var f=0,r=0,s=0,h={},m=0;m<c.graphemeLines.length;m++)c.graphemeText[s]===`
`&&m>0?(r=0,s++,f++):!this.splitByGrapheme&&this._reSpaceAndTab.test(c.graphemeText[s])&&m>0&&(r++,s++),h[m]={line:f,offset:r},s+=c.graphemeLines[m].length,r+=c.graphemeLines[m].length;return h},styleHas:function(c,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[f];r&&(f=r.line)}return a.Text.prototype.styleHas.call(this,c,f)},isEmptyStyles:function(c){if(!this.styles)return!0;var f,r,s=0,h=!1,m=this._styleMap[c],g=this._styleMap[c+1];for(var p in m&&(c=m.line,s=m.offset),g&&(h=g.line===c,f=g.offset),r=c===void 0?this.styles:{line:this.styles[c]})for(var v in r[p])if(v>=s&&(!h||v<f))for(var C in r[p][v])return!1;return!0},_getStyleDeclaration:function(c,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[c];if(!r)return null;c=r.line,f=r.offset+f}return this.callSuper("_getStyleDeclaration",c,f)},_setStyleDeclaration:function(c,f,r){var s=this._styleMap[c];c=s.line,f=s.offset+f,this.styles[c][f]=r},_deleteStyleDeclaration:function(c,f){var r=this._styleMap[c];c=r.line,f=r.offset+f,delete this.styles[c][f]},_getLineStyle:function(c){var f=this._styleMap[c];return!!this.styles[f.line]},_setLineStyle:function(c){var f=this._styleMap[c];this.styles[f.line]={}},_wrapText:function(c,f){var r,s=[];for(this.isWrapping=!0,r=0;r<c.length;r++)s=s.concat(this._wrapLine(c[r],r,f));return this.isWrapping=!1,s},_measureWord:function(c,f,r){var s,h=0;r=r||0;for(var m=0,g=c.length;m<g;m++)h+=this._getGraphemeBox(c[m],f,m+r,s,!0).kernedWidth,s=c[m];return h},_wrapLine:function(c,f,r,s){var h=0,m=this.splitByGrapheme,g=[],p=[],v=m?a.util.string.graphemeSplit(c):c.split(this._wordJoiners),C="",x=0,b=m?"":" ",E=0,O=0,L=0,W=!0,G=this._getWidthOfCharSpacing();s=s||0,v.length===0&&v.push([]),r-=s;for(var J=0;J<v.length;J++)C=m?v[J]:a.util.string.graphemeSplit(v[J]),E=this._measureWord(C,f,x),x+=C.length,(h+=O+E-G)>r&&!W?(g.push(p),p=[],h=E,W=!0):h+=G,W||m||p.push(b),p=p.concat(C),O=m?0:this._measureWord([b],f,x),x++,W=!1,E>L&&(L=E);return J&&g.push(p),L+s>this.dynamicMinWidth&&(this.dynamicMinWidth=L-G+s),g},isEndOfWrapping:function(c){return!this._styleMap[c+1]||this._styleMap[c+1].line!==this._styleMap[c].line},missingNewlineOffset:function(c){return this.splitByGrapheme?this.isEndOfWrapping(c)?1:0:1},_splitTextIntoLines:function(c){for(var f=a.Text.prototype._splitTextIntoLines.call(this,c),r=this._wrapText(f.lines,this.width),s=new Array(r.length),h=0;h<r.length;h++)s[h]=r[h].join("");return f.lines=s,f.graphemeLines=r,f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var c={};for(var f in this._styleMap)this._textLines[f]&&(c[this._styleMap[f].line]=1);for(var f in this.styles)c[f]||delete this.styles[f]},toObject:function(c){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(c))}}),a.Textbox.fromObject=function(c,f){return a.Object._fromObject("Textbox",c,f,"text")}}(e),function(){var u=y.controlsUtils,a=u.scaleSkewCursorStyleHandler,c=u.scaleCursorStyleHandler,f=u.scalingEqually,r=u.scalingYOrSkewingX,s=u.scalingXOrSkewingY,h=u.scaleOrSkewActionName,m=y.Object.prototype.controls;if(m.ml=new y.Control({x:-.5,y:0,cursorStyleHandler:a,actionHandler:s,getActionName:h}),m.mr=new y.Control({x:.5,y:0,cursorStyleHandler:a,actionHandler:s,getActionName:h}),m.mb=new y.Control({x:0,y:.5,cursorStyleHandler:a,actionHandler:r,getActionName:h}),m.mt=new y.Control({x:0,y:-.5,cursorStyleHandler:a,actionHandler:r,getActionName:h}),m.tl=new y.Control({x:-.5,y:-.5,cursorStyleHandler:c,actionHandler:f}),m.tr=new y.Control({x:.5,y:-.5,cursorStyleHandler:c,actionHandler:f}),m.bl=new y.Control({x:-.5,y:.5,cursorStyleHandler:c,actionHandler:f}),m.br=new y.Control({x:.5,y:.5,cursorStyleHandler:c,actionHandler:f}),m.mtr=new y.Control({x:0,y:-.5,actionHandler:u.rotationWithSnapping,cursorStyleHandler:u.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),y.Textbox){var g=y.Textbox.prototype.controls={};g.mtr=m.mtr,g.tr=m.tr,g.br=m.br,g.tl=m.tl,g.bl=m.bl,g.mt=m.mt,g.mb=m.mb,g.mr=new y.Control({x:.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:a,actionName:"resizing"}),g.ml=new y.Control({x:-.5,y:0,actionHandler:u.changeWidth,cursorStyleHandler:a,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Qc={};function Di(t){var e=Qc[t];if(e!==void 0)return e.exports;var i=Qc[t]={exports:{}};return hm[t](i,i.exports,Di),i.exports}Di.d=(t,e)=>{for(var i in e)Di.o(e,i)&&!Di.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},Di.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Yd={};(()=>{let t;Di.d(Yd,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?Di(653).fabric:{version:"5.2.1"}})();var xe=Yd.R;const Zs=typeof self>"u";let Nn,Xt,jr,Os,He;if(typeof navigator<"u"&&(Nn=navigator,Xt=Nn.userAgent,jr=Nn.platform,Os=Nn.mediaDevices),!Zs){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Nn.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:jr,search:"Win"},Mac:{str:jr},Linux:{str:jr}};let i="unknownBrowser",n=0,o="unknownOS";for(let l in t){const d=t[l]||{};let _=d.str||Xt,S=d.search||l,w=d.verStr||Xt,T=d.verSearch||l;if(T instanceof Array||(T=[T]),_.indexOf(S)!=-1){i=l;for(let A of T){let I=w.indexOf(A);if(I!=-1){n=parseFloat(w.substring(I+A.length+1));break}}break}}for(let l in e){const d=e[l]||{};let _=d.str||Xt,S=d.search||l;if(_.indexOf(S)!=-1){o=l;break}}o=="Linux"&&Xt.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),He={browser:i,version:n,OS:o}}Zs&&(He={browser:"ssr",version:0,OS:"ssr"});const dm=typeof WebAssembly<"u"&&Xt&&!(/Safari/.test(Xt)&&!/Chrome/.test(Xt)&&/\(.+\s11_2_([2-6]).*\)/.test(Xt)),fm=!(typeof Worker>"u"),Xd=!(!Os||!Os.getUserMedia),gm=async()=>{let t=!1;if(Xd)try{(await Os.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};He.browser==="Chrome"&&He.version>66||He.browser==="Safari"&&He.version>13||He.browser==="OPR"&&He.version>43||He.browser==="Edge"&&He.version;const pm=(()=>{if(!Zs&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let i=t.indexOf("#");i!=-1&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();class mt{constructor(e,i){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=i}get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.styleSelector="selected"}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.styleSelector="selected":this.styleSelector="default",this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,i){if(!i)return;const n=e.toLowerCase(),o=this.mapEvent_Callbacks.get(n);if(!o)throw new Error(`Event '${e}' does not exist.`);let l=o.get(i);l||(l=d=>{const _=d.e;if(!_)return void(i&&i.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const S={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let w,T,A,I;const k=_.target.getBoundingClientRect();w=k.left,T=k.top,A=w+window.scrollX,I=T+window.scrollY;const P=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,F=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,z=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),D=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),R=z/D,M=P/F,$=this._drawingLayer._getObjectFit();let ie,ne,q,y,pe=1;if($==="contain")R<M?(pe=z/P,ie=w+this.get("x")*pe,ne=T+this.get("y")*pe+(D-F*pe)/2,q=A+this.get("x")*pe,y=I+this.get("y")*pe+(D-F*pe)/2):(pe=D/F,ie=w+this.get("x")*pe+(z-P*pe)/2,ne=T+this.get("y")*pe,q=A+this.get("x")*pe+(z-P*pe)/2,y=I+this.get("y")*pe);else if($==="cover")if(R<M){pe=D/F;let fe=this.get("x")*pe-(P*pe-z)/2;fe=Math.max(fe,0),fe=Math.min(fe,z),ie=w+fe,ne=T+this.get("y")*pe,q=A+fe,y=I+this.get("y")*pe}else{pe=z/P;let fe=this.get("y")*pe-(F*pe-D)/2;fe=Math.max(fe,0),fe=Math.min(fe,D),ie=w+this.get("x")*pe,ne=T+fe,q=A+this.get("x")*pe,y=I+fe}S.itemClientX=Math.round(ie),S.itemClientY=Math.round(ne),S.itemPageX=Math.round(q),S.itemPageY=Math.round(y)}for(let w of Object.getOwnPropertyNames(S))Object.defineProperty(_,w,{value:S[w],writable:!0});i&&i.apply(this,[_])},o.set(i,l),this._fabricObject.on(n==="dblclick"?"mousedblclick":n,l))}on(e,i){this._on(e,i)}_off(e,i){const n=e.toLowerCase(),o=this.mapEvent_Callbacks.get(n);if(!o)throw new Error(`Event '${e}' does not exist.`);let l=o.get(i);l&&(o.delete(i),this._fabricObject.off(n==="dblclick"?"mousedblclick":n,l))}off(e,i){this._off(e,i)}_setEditable(e){const i=this._fabricObject;e?(i.selectable=!0,i.hasControls=!0,i.hoverCursor=null):(i.selectable=!1,i.hasControls=!1,i.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,i){if(this.hasNote(e.name)&&!i)throw new Error("A note with the same name already exists, please use a different name.");const n=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[n])}getNote(e){const i=this.mapNoteName_Content.get(e);return i?i.length===1?{name:e,content:i[0]?JSON.parse(JSON.stringify(i[0])):i[0]}:{name:e,content:JSON.parse(JSON.stringify(i))}:null}getNotes(){const e=[];for(let i of this.mapNoteName_Content){let n=i[1].length===1?i[1][0]:i[1];n=n&&JSON.parse(JSON.stringify(n)),e.push({name:i[0],content:n})}return e}updateNote(e,i,n){const o=this.mapNoteName_Content.get(e);if(!o)throw new Error("The note name does not exist.");n||(o.length=0),i=i&&JSON.parse(JSON.stringify(i)),o.push(i)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,i){return!1}_extendGet(e){}set(e,i){if(!this._extendSet(e,i))if(e==="x"){const n=this._fabricObject.group;n?(this._fabricObject.set("left",i-n.left-n.width/2),n.addWithUpdate()):this._fabricObject.set("left",i)}else if(e==="y"){const n=this._fabricObject.group;n?(this._fabricObject.set("top",i-n.top-n.height/2),n.addWithUpdate()):this._fabricObject.set("top",i)}else e==="styleId"?this.styleId=i:this._fabricObject.set(e,i);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let i=this._extendGet(e);if(i===void 0)if(e==="x"){const n=this._fabricObject.group;i=n?this._fabricObject.get("left")+n.left+n.width/2:this._fabricObject.get("left")}else if(e==="y"){const n=this._fabricObject.group;i=n?this._fabricObject.get("top")+n.top+n.height/2:this._fabricObject.get("top")}else i=["type","mediaType"].includes(e)?this.mediaType:e==="styleSelector"?this.styleSelector:e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return i}setAttribute(e,i){this.set(e,i)}getAttribute(e){return this.get(e)}}function Aa(t,e,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,o=i.points[this.pointIndex].y-i.pathOffset.y;return xe.util.transformPoint({x:n,y:o},i.calcTransformMatrix())}function $d(t){let e=new xe.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new xe.Point(t.width+e.x,t.height+e.y)}function Oa(t,e,i,n){let o=e.target,l=o.controls[o.__corner],d=o.toLocalPoint(new xe.Point(i,n),"center","center"),_=$d(o),S=o._getTransformedDimensions(0,0),w={x:d.x*_.x/S.x+o.pathOffset.x,y:d.y*_.y/S.y+o.pathOffset.y};return o.points[l.pointIndex]=w,!0}function Ra(t,e){return function(i,n,o,l){let d=n.target,_=xe.util.transformPoint({x:d.points[t].x-d.pathOffset.x,y:d.points[t].y-d.pathOffset.y},d.calcTransformMatrix()),S=e(i,n,o,l);d._setPositionDimensions({});let w=$d(d),T=(d.points[t].x-d.pathOffset.x)/w.x,A=(d.points[t].y-d.pathOffset.y)/w.y;return d.setPositionByOrigin(_,T+.5,A+.5),S}}mt.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],mt.arrStyleSelectors=["default","selected"];class qc extends mt{constructor(e,i){super(new xe.Polygon(e,{objectCaching:!1}),i);const n=this._fabricObject;let o=n.points.length-1;n.controls=n.points.reduce(function(l,d,_){return l["p"+_]=new xe.Control({positionHandler:Aa,actionHandler:Ra(_>0?_-1:o,Oa),actionName:"modifyPolygon",pointIndex:_}),l},{})}_extendSet(e,i){if(e==="vertices"){const n=this._fabricObject;if(n.group){const l=n.group;n.points=i.map(d=>({x:d.x-l.left-l.width/2,y:d.y-l.top-l.height/2})),l.addWithUpdate()}else n.points=i;const o=n.points.length-1;return n.controls=n.points.reduce(function(l,d,_){return l["p"+_]=new xe.Control({positionHandler:Aa,actionHandler:Ra(_>0?_-1:o,Oa),actionName:"modifyPolygon",pointIndex:_}),l},{}),n._setPositionDimensions({}),!0}}_extendGet(e){if(e==="vertices"){const i=[],n=this._fabricObject;if(n.selectable&&!n.group)for(let o in n.oCoords)i.push({x:n.oCoords[o].x,y:n.oCoords[o].y});else for(let o of n.points){let l=o.x-n.pathOffset.x,d=o.y-n.pathOffset.y;const _=xe.util.transformPoint({x:l,y:d},n.calcTransformMatrix());i.push({x:_.x,y:_.y})}return i}}}const eu=t=>{let e=(i=>i.split(`
`).map(n=>n.split("	")))(t);return(i=>{for(let n=0;;n++){let o=-1;for(let l=0;l<i.length;l++){let d=i[l][n];d!==void 0&&d.length>o&&(o=d.length)}if(o===-1)break;for(let l=0;l<i.length;l++){if(n>=i[l].length-1)continue;let d=" ".repeat(o+2-i[l][n].length);i[l][n]=i[l][n].concat(d)}}})(e),(i=>{let n="";for(let o=0;o<i.length;o++)n=n.concat(...i[o],o===i.length-1?"":`
`);return n})(e)};class Kd extends mt{constructor(e,i,n,o,l){if(typeof o!="number"||o<=0)throw new RangeError("Invalid width.");super(new xe.Textbox(eu(e),{left:i,top:n,width:o}),l),this._mediaType="text",this._text=e}_extendSet(e,i){if(e==="text")return this._text=i,this._fabricObject.set("text",eu(i)),!0}_extendGet(e){if(e==="text")return this._text}}typeof document<"u"&&typeof window<"u"&&(xe.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(xe.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),xe.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},xe.Object.prototype.transparentCorners=!1,xe.Object.prototype.cornerSize=20,xe.Object.prototype.touchCornerSize=100,xe.Object.prototype.cornerColor="rgb(254,142,20)",xe.Object.prototype.cornerStyle="circle",xe.Object.prototype.strokeUniform=!0,xe.Object.prototype.hasBorders=!1,xe.Canvas.prototype.containerClass="",xe.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var i,n=this.upperCanvasEl,o=xe.util.getPointer(t,n),l=n.getBoundingClientRect(),d=l.width||0,_=l.height||0;d&&_||("top"in l&&"bottom"in l&&(_=Math.abs(l.top-l.bottom)),"right"in l&&"left"in l&&(d=Math.abs(l.right-l.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,e||(o=this.restorePointerVpt(o));var S=this.getRetinaScaling();if(S!==1&&(o.x/=S,o.y/=S),d!==0&&_!==0){var w=window.getComputedStyle(n).objectFit,T=n.width,A=n.height,I=d,k=_;i={width:T/I,height:A/k};var P,F,z=T/A,D=I/k;return w==="contain"?z>D?(P=I,F=I/z,{x:o.x*i.width,y:(o.y-(k-F)/2)*i.width}):(P=k*z,F=k,{x:(o.x-(I-P)/2)*i.height,y:o.y*i.height}):w==="cover"?z>D?{x:(T-i.height*I)/2+o.x*i.height,y:o.y*i.height}:{x:o.x*i.width,y:(A-i.width*k)/2+o.y*i.width}:{x:o.x*i.width,y:o.y*i.height}}return i={width:1,height:1},{x:o.x*i.width,y:o.y*i.height}},xe.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();xe.util.addListener(xe.document,"touchend",this._onTouchEnd,{passive:!1}),xe.util.addListener(xe.document,"touchmove",this._onMouseMove,{passive:!1}),xe.util.removeListener(i,n+"down",this._onMouseDown)},xe.Textbox.prototype._wrapLine=function(t,e,i,n){const o=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),l=!(!o||!o.length);var d=0,_=this.splitByGrapheme||l,S=[],w=[],T=_?xe.util.string.graphemeSplit(t):t.split(this._wordJoiners),A="",I=0,k=_?"":" ",P=0,F=0,z=0,D=!0,R=this._getWidthOfCharSpacing();n=n||0,T.length===0&&T.push([]),i-=n;for(var M=0;M<T.length;M++)A=_?T[M]:xe.util.string.graphemeSplit(T[M]),P=this._measureWord(A,e,I),I+=A.length,(d+=F+P-R)>i&&!D?(S.push(w),w=[],d=P,D=!0):d+=R,D||_||w.push(k),w=w.concat(A),F=_?0:this._measureWord([k],e,I),I++,D=!1,P>z&&(z=P);return M&&S.push(w),z+n>this.dynamicMinWidth&&(this.dynamicMinWidth=z-R+n),S});class mm{constructor(e,i,n,o){let l,d;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new xe.Canvas(e,Object.assign(o,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(_){const S=_.selected,w=[];for(let T of S){const A=T.getDrawingItem()._drawingLayer;A&&!w.includes(A)&&w.push(A)}for(let T of w){const A=[];for(let I of S){const k=I.getDrawingItem();k._drawingLayer===T&&A.push(k)}setTimeout(()=>{T.onSelectionChange&&T.onSelectionChange(A,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(_){const S=this.getActiveObjects(),w=[];for(let T of S){const A=T.getDrawingItem()._drawingLayer;A&&!w.includes(A)&&w.push(A)}for(let T of w){const A=[];for(let I of S){const k=I.getDrawingItem();k._drawingLayer===T&&A.push(k)}setTimeout(()=>{const I=[];for(let k of A)T.hasDrawingItem(k)&&I.push(k);I.length>0&&T.onSelectionChange&&T.onSelectionChange([],I)},0)}}),this.fabricCanvas.on("selection:updated",function(_){const S=_.selected,w=_.deselected,T=[];for(let A of S){const I=A.getDrawingItem()._drawingLayer;I&&!T.includes(I)&&T.push(I)}for(let A of w){const I=A.getDrawingItem()._drawingLayer;I&&!T.includes(I)&&T.push(I)}for(let A of T){const I=[],k=[];for(let P of S){const F=P.getDrawingItem();F._drawingLayer===A&&I.push(F)}for(let P of w){const F=P.getDrawingItem();F._drawingLayer===A&&k.push(F)}setTimeout(()=>{A.onSelectionChange&&A.onSelectionChange(I,k)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=i,this._mapDrawingStyles=n,i){case 1:l=n.get(1),d=n.get(5);break;case 2:l=n.get(2),d=n.get(6);break;case 3:l=n.get(3),d=n.get(7);break;default:l=n.get(4),d=n.get(8)}for(let _ of mt.arrMediaTypes)this.mapMediaType_Style.set(_,{default:l,selected:d})}getId(){return this.id}_getDrawingStyle(e,i){if(typeof e!="number")throw new Error("Invalid style id.");const n=this._mapDrawingStyles.get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}setVisible(e){if(e){for(let i of this._arrFabricObject)i.visible=!0;this._visible=!0}else{for(let i of this._arrFabricObject)i.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){return e.styleId?this._getDrawingStyle(e.styleId):e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,i,n,o){let l;switch(e){case"rect":l=this.fabricCanvas.getObjects("rect");break;case"arc":l=this.fabricCanvas.getObjects("circle");break;case"polygon":l=this.fabricCanvas.getObjects("polygon");break;case"image":l=this.fabricCanvas.getObjects("image");break;case"text":l=this.fabricCanvas.getObjects("textbox");break;case"line":l=this.fabricCanvas.getObjects("line");break;case"path":l=this.fabricCanvas.getObjects("path")}for(let d of l){if(!this._arrFabricObject.includes(d))continue;const _=d.getDrawingItem();_.styleSelector===i&&this._changeItemStyle(_,n,!0)}o||this.fabricCanvas.renderAll()}_changeItemStyle(e,i,n){if(!e||!i)return;const o=e._getFabricObject();typeof e.styleId=="number"&&(i=this._getDrawingStyle(e.styleId)),o.strokeWidth=i.lineWidth,i.paintMode==="fill"?(o.fill=i.fillStyle,o.stroke=i.fillStyle):i.paintMode==="stroke"?(o.fill="transparent",o.stroke=i.strokeStyle):i.paintMode==="strokeAndFill"&&(o.fill=i.fillStyle,o.stroke=i.strokeStyle),o.fontFamily&&(o.fontFamily=i.fontFamily),o.fontSize&&(o.fontSize=i.fontSize),o.group||(o.dirty=!0),n||this.fabricCanvas.renderAll()}_updateGroupItem(e,i,n){if(!e||!i)return;const o=e.getChildItems();if(n==="add"){if(o.includes(i))return;const l=i._getFabricObject();if(this.fabricCanvas.getObjects().includes(l)){if(!this._arrFabricObject.includes(l))throw new Error("Existed in other drawing layers.");i._zIndex=null}else{let d;if(i.styleId)d=this._getDrawingStyle(i.styleId);else{d=this.mapMediaType_Style.get(i._mediaType)[e.styleSelector];const _=()=>{this._changeItemStyle(i,this.mapMediaType_Style.get(i._mediaType).selected,!0)},S=()=>{this._changeItemStyle(i,this.mapMediaType_Style.get(i._mediaType).default,!0)};i._on("selected",_),i._on("deselected",S),i._funcChangeStyleToSelected=_,i._funcChangeStyleToDefault=S}i._drawingLayer=this,i._drawingLayerId=this.id,this._changeItemStyle(i,d,!0)}e._fabricObject.addWithUpdate(i._getFabricObject())}else{if(n!=="remove"||!o.includes(i))return;i._zIndex=null,i._drawingLayer=null,i._drawingLayerId=null,i._off("selected",i._funcChangeStyleToSelected),i._off("deselected",i._funcChangeStyleToDefault),i._funcChangeStyleToSelected=null,i._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(i._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,i){let n=e._getFabricObject();const o=this.fabricCanvas.getObjects();let l,d;if(o.includes(n)){if(this._arrFabricObject.includes(n))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){l=e.getChildItems();for(let w of l)if(w._drawingLayer&&w._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(i&&typeof i=="object"&&!Array.isArray(i))for(let w in i)n.set(w,i[w]);if(l){for(let w of l){const T=this.mapMediaType_Style.get(w._mediaType);for(let A of mt.arrStyleSelectors)w._mapStyle.set(A,T[A]);if(w.styleId)d=this._getDrawingStyle(w.styleId);else{d=T.default;const A=()=>{this._changeItemStyle(w,this.mapMediaType_Style.get(w._mediaType).selected,!0)},I=()=>{this._changeItemStyle(w,this.mapMediaType_Style.get(w._mediaType).default,!0)};w._on("selected",A),w._on("deselected",I),w._funcChangeStyleToSelected=A,w._funcChangeStyleToDefault=I}w._drawingLayer=this,w._drawingLayerId=this.id,this._changeItemStyle(w,d,!0)}n.dirty=!0,this.fabricCanvas.renderAll()}else{const w=this.mapMediaType_Style.get(e._mediaType);for(let T of mt.arrStyleSelectors)e._mapStyle.set(T,w[T]);if(e.styleId)d=this._getDrawingStyle(e.styleId);else{d=w.default;const T=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},A=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",T),e._on("deselected",A),e._funcChangeStyleToSelected=T,e._funcChangeStyleToDefault=A}this._changeItemStyle(e,d)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const _=this._arrFabricObject.length;let S=o.length;if(_)S=o.indexOf(this._arrFabricObject[_-1])+1;else for(let w=0;w<o.length;w++)if(e._zIndex<o[w].getDrawingItem()._zIndex){S=w;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(n),this._visible?n.visible=!0:n.visible=!1,this.fabricCanvas.insertAt(n,S,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let i of e)this.addDrawingItem(i)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const n=e.getChildItems();for(let o of n)o._zIndex=null,o._drawingLayer=null,o._drawingLayerId=null,o._off("selected",o._funcChangeStyleToSelected),o._off("deselected",o._funcChangeStyleToDefault),o._funcChangeStyleToSelected=null,o._funcChangeStyleToDefault=null,o._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const i=e._getFabricObject();e.styleSelector==="selected"&&(i.group?i.group.removeWithUpdate(i):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(i),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(i),1)}removeDrawingItems(e){for(let i of e)this.removeDrawingItem(i)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),i=[];for(let n of e)this._arrFabricObject.includes(n)&&i.push(n.getDrawingItem());return i}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,i,n){i=i?i.toLocaleLowerCase():"all",n=n?n.toLocaleLowerCase():"all";let o,l=this._getDrawingStyle(e);if(i==="all"){const d=this.mapMediaType_Style.keys();for(let _ of d)if(o=this.mapMediaType_Style.get(_),n==="all")for(let S of mt.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(_,S,l,!0),o[S]=l;for(let w of this._arrDrwaingItem)w._mapStyle.set(S,l)}else{this._changeMediaTypeCurStyleInStyleSelector(_,n,l,!0),o[n]=l;for(let S of this._arrDrwaingItem)S._mapStyle.set(n,l)}this.fabricCanvas.renderAll()}else if(o=this.mapMediaType_Style.get(i),n==="all")for(let d of mt.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(i,d,l,!0),o[d]=l;for(let _ of this._arrDrwaingItem)_._mediaType===i&&_._mapStyle.set(d,l)}else{this._changeMediaTypeCurStyleInStyleSelector(i,n,l,!0),o[n]=l;for(let d of this._arrDrwaingItem)d._mediaType===i&&d._mapStyle.set(n,l)}}setMode(e){if((e=e.toLocaleLowerCase())==="viewer"){for(let i of this._arrDrwaingItem)i._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let i of this._arrDrwaingItem)i._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,i){this.fabricCanvas.setDimensions(e,i)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const i=this._getItemCurrentStyle(e);this._changeItemStyle(e,i,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class _m{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let i;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");i=e.id}else{let o=100;for(;this._mapDrawingStyles.has(o);)o++;i=o}const n=JSON.parse(JSON.stringify(e));n.id=i;for(let o in this._defaultStyleTemplate)n.hasOwnProperty(o)||(n[o]=this._defaultStyleTemplate[o]);return this._mapDrawingStyles.set(i,n),n.id}_getDrawingStyle(e,i){if(typeof e!="number")throw new Error("Invalid style id.");const n=this._mapDrawingStyles.get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,i){const n=this._mapDrawingStyles.get(e);if(n)for(let o in i)n.hasOwnProperty(o)&&(n[o]=i[o])}updateDrawingStyle(e,i){this._updateDrawingStyle(e,i);for(let n of this._arrDrawingLayer)n.renderAll()}createDrawingLayer(e,i){const n=l=>{for(let d of this._arrDrawingLayer)if(d.getId()===l)return!0;return!1};if(i===void 0){for(let l=100;;l++)if(!n(l)){i=l;break}}else if(n(i))throw new Error("Existed drawing layer id.");const o=new mm(e,i,this._mapDrawingStyles,{enableRetinaScaling:!1});return o._manager=this,this._arrDrawingLayer.push(o),this._switchPointerEvent(),o}deleteDrawingLayer(e){const i=this.getDrawingLayer(e);if(!i)return;const n=this._arrDrawingLayer;i.dispose(),n.splice(n.indexOf(i),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let i of this._arrDrawingLayer)if(i.getId()===e)return i;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),i=[];for(let n of e)i.push(n.getDrawingItem());return i}setDimensions(e,i){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,i)}setObjectFit(e){for(let i of this._arrDrawingLayer)i&&i._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class vm{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const i=this._arrUsers.indexOf(e);i!==-1&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(i,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,i,n,o){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");o&&(this._controlTarget[i]=n),this._mapProperty_UserValue.get(i)?this._mapProperty_UserValue.get(i).set(e,n):this._mapProperty_UserValue.set(i,new Map([[e,n]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const i=this._mapProperty_UserValue.get(e.property);if(!i)return;i.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let i of this._mapProperty_UserValue.values())i.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const i=[],n=this._mapProperty_UserValue.get(e);for(let o of n.values())i.push(o);return i}return null}setDisiredAction(e,i,n,o){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return n||(n=[]),o?this._controlTarget[i](...n):(this._mapAction_UserArgs.get(i)?this._mapAction_UserArgs.get(i).set(e,n):this._mapAction_UserArgs.set(i,new Map([[e,n]])),this._render(i))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const i=this._mapAction_UserArgs.get(e.actionName);if(!i)return;i.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let i of this._mapAction_UserArgs.values())i.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,i){const n=this._mapAction_Callbacks.get(e);n?n.push(i):this._mapAction_Callbacks.set(e,[i])}removeCallback(e,i){const n=this._mapAction_Callbacks.get(e);if(!n)return;const o=n.indexOf(i);o!==-1&&n.splice(o,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const i=this._mapAction_Callbacks.get(e);if(i)for(let n of i){if(!n)return;setTimeout(n.bind(this._controlTarget),0)}}_render(e){const i=this._mapAction_UserArgs.get(e);if(!i)throw new Error("Unrecorded action.");if(i.size===this._arrUsers.length){let n=[];for(let o of i.values())o.length>0&&(n=o);if(this._controlTarget[e]){const o=this._controlTarget[e](...n);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),o}}}render(e){if(e)return this._render(e);for(let i of this._mapAction_UserArgs.keys())this._render(i)}}class ft{static multiply(e,i){const n=[];for(let o=0;o<3;o++){const l=i.slice(3*o,3*o+3);for(let d=0;d<3;d++){const _=[e[d],e[d+3],e[d+6]].reduce((S,w,T)=>S+w*l[T],0);n.push(_)}}return n}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,i,n){return ft.multiply(e,[1,0,0,0,1,0,i,n,1])}static rotate(e,i){var n=Math.cos(i),o=Math.sin(i);return ft.multiply(e,[n,-o,0,o,n,0,0,0,1])}static scale(e,i,n){return ft.multiply(e,[i,0,0,0,n,0,0,0,1])}}var Te;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Te||(Te={}));const dt=(t,e,i,n)=>{let o=e+Math.round((t-e)/i)*i;return n&&(o=Math.min(o,n)),o};class Se{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameModeIpt=null,this._clickIptSingleFrameMode=()=>{if(this.singleFrameMode&&!this.getDrawingLayers().some(e=>e.getMode()=="editor")){if(!this._singleFrameModeIpt){const e=document.createElement("input");this._singleFrameModeIpt=e,e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.addEventListener("change",async()=>{const i=e.files[0];e.value="";const n=await(async w=>{let T=null,A=null;if(typeof createImageBitmap<"u")try{if(T=await createImageBitmap(w),T)return T}catch{}var I;return T||(A=await(I=w,new Promise((k,P)=>{let F=URL.createObjectURL(I),z=new Image;z.dbrObjUrl=F,z.src=F,z.onload=()=>{k(z)},z.onerror=D=>{P(new Error("Can't convert blob to image : "+(D instanceof Event?D.type:D)))}}))),A})(i),o=n instanceof HTMLImageElement?n.naturalWidth:n.width,l=n instanceof HTMLImageElement?n.naturalHeight:n.height;this._imgWidth=o,this._imgHeight=l;const d=w=>{const T=Date.now();if(o===0||l===0)return null;if(w instanceof HTMLImageElement&&!w.complete)throw new Error("The source is not loaded.");const A=this._scanRegion,I=this.getFrameSize(o,l,A,this.maxCvsSideLength);if(!I)return null;let k=!0;o===I.sWidth&&l===I.sHeight&&(k=!1);const P=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase()),F={data:null,region:A?JSON.parse(JSON.stringify(A)):null,sx:I.sx,sy:I.sy,width:I.dWidth,height:I.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:k,toCanvas:this._toCanvas,_sWidth:I.sWidth,_sHeight:I.sHeight,_bUseWebGL:null},z=this._getImageData(w,o,l,I,null,{pixelFormat:P});if(!z)return null;const D=Date.now();return F.data=z.data,F.pixelFormat=F.colorMode=z.pixelFormat,F._bUseWebGL=z._bUseWebGL,F.timeSpent=D-T,F.timeStamp=D,z.pixelFormat===Te.GREY?F.stride=F.width:F.stride=4*F.width,F};(w=>{let T=this._cvsSingleFrameMode;if(!T){if(T=document.createElement("canvas"),!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(T),T.style.position="absolute",T.style.width="100%",T.style.height="100%",T.style.left="0",T.style.top="0",T.style.objectFit="contain",T.style.pointerEvents="none",this._cvsSingleFrameMode=T}T.width==o&&T.height==l||(T.width=o,T.height=l);const A=T.getContext("2d");A.clearRect(0,0,T.width,T.height),A.drawImage(w,0,0)})(n),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let w of this._arrScanRegionOverlays)w&&this._updateScanRegionOverlay(w);let _;this._updateDrawingLayersSize();try{_=d(n)}catch(w){throw w}const S=this.mapCameraEvents.get("singleframeacquired");for(let w of S)if(w)try{const T={data:new Uint8Array(_.data),region:JSON.parse(JSON.stringify(_.region)),sx:_.sx,sy:_.sy,width:_.width,height:_.height,stride:_.stride,colorMode:_.colorMode,pixelFormat:_.pixelFormat,timeSpent:_.timeSpent,timeStamp:_.timeStamp,isCropped:_.isCropped,toCanvas:_.toCanvas,_sWidth:_._sWidth,_sHeight:_._sHeight,_bUseWebGL:_._bUseWebGL};await w.apply(this,[T])}catch(T){console.error(T)}}),e.style.position="fixed",e.style.left="-1px",e.style.top="-1px",e.style.width="1px",e.style.height="1px",e.style.backgroundColor="transparent",e.style.color="transparent",document.body.appendChild(e)}this._singleFrameModeIpt.click()}},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",Te.GREY],["grey32",Te.GREY32],["rgba",Te.RGBA],["rbga",Te.RBGA],["grba",Te.GRBA],["gbra",Te.GBRA],["brga",Te.BRGA],["bgra",Te.BGRA]]),this.shaderPixelFormat=Te.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,_focusArea:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._tapDoFocus=async e=>{if(this._touchMoved)return void(this._touchMoved=!1);if(!this._tapFocusEnabled||!this._bOpen||this.singleFrameMode||!this._video||this._video.paused||!this._videoTrack||!this._focusSupported||this.getDrawingLayers().some(ie=>ie.getMode()=="editor"))return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let i,n,o,l;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)i=e.clientX,n=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY}const d=this.getVideoFit(),_=this._video.videoWidth,S=this._video.videoHeight,w=this._elContainer.getBoundingClientRect(),T=w.left,A=w.top,I=window.getComputedStyle(this._elContainer),k=parseFloat(I.width),P=parseFloat(I.height),F=k/P,z=_/S;let D=1;if(d==="contain")z>F?(D=k/_,o=(i-T)/D,l=(n-A-(P-k/z)/2)/D):(D=P/S,l=(n-A)/D,o=(i-T-(k-P*z)/2)/D);else{if(d!=="cover")throw new Error("Unsupported object-fit.");z>F?(D=P/S,l=(n-A)/D,o=(i-T+(P*z-k)/2)/D):(D=k/_,o=(i-T)/D,l=(n-A+(k/z-P)/2)/D)}const R={x:o+"px",y:l+"px"},M=2*Math.round(Math.min(_,S)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px",$=M;await this._setLocalFocus(R,M,$,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance),this._focusParameters.taskBackToContinous=setTimeout(()=>{this._videoTrack&&this._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime)},this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const e=document.createElement("canvas");let i;if(e.width=this.width,e.height=this.height,(this.pixelFormat||this.colorMode)==="grey"){i=new Uint8ClampedArray(this.width*this.height*4);for(let o=0;o<i.length;o+=4)i[o]=this.data[o/4],i[o+1]=this.data[o/4],i[o+2]=this.data[o/4],i[o+3]=255}else i=new Uint8ClampedArray(this.data.buffer);const n=new ImageData(i,this.width,this.height);return e.getContext("2d").putImageData(n,0,0),e},this._onCameraSelChange=async()=>{await this.selectCamera(this._selCam.value),this._bOpen||this.stop()},this._onResolutionSelChange=async()=>{let e,i;if(this._selRsl&&this._selRsl.selectedIndex!=-1){let n=this._selRsl.options[this._selRsl.selectedIndex];e=n.getAttribute("data-width"),i=n.getAttribute("data-height")}await this.setResolution(e,i),this._bOpen||this.stop()},this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{if(!this.singleFrameMode)if(document.visibilityState==="visible"){if(this._bOpen&&this._vc_bPlayingVideoBeforeHide){if(this.videoSrc)this._video.play();else if(this._video.srcObject){const e=this._video.srcObject.getTracks()[0];this._video.srcObject.active&&e&&!e.muted?this._video.play():this.play()}}}else document.visibilityState==="hidden"&&(["iPhone","iPad"].includes(He.OS)?(this._vc_bPlayingVideoBeforeHide=!0,this._video&&this._video.pause()):this._video&&!this._video.paused?(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause()):this._vc_bPlayingVideoBeforeHide=!1)},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout(()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&(e.style.display="",this._updateScanRegionOverlay(e));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}},this._updateLayersTimeout)},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null}static getVersion(){return this._version}static async detectEnvironment(){return await(async()=>({wasm:dm,worker:fm,getUserMedia:Xd,camera:await gm(),browser:He.browser,version:He.version,OS:He.OS}))()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");Se._engineResourcePath=(i=>{if(i==null&&(i="./"),!Zs){let n=document.createElement("a");n.href=i,i=n.href}return i.endsWith("/")||(i+="/"),i})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let i;try{i=window[e];const n="__storage_test__";return i.setItem(n,n),i.removeItem(n),!0}catch(n){return n instanceof DOMException&&(n.code===22||n.code===1014||n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED")&&i&&i.length!==0}}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static async testCameraAccess(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()})}catch(e){if(e.name==="OverconstrainedError"||e.name==="NotFoundError")return{ok:!1,message:"No camera detected."};if(e.name==="NotAllowedError")return{ok:!1,message:"No permission to access camera."};if(e.name==="AbortError")return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if(e.name==="NotReadableError")return{ok:!1,message:"A hardware error occurred."};if(e.name==="SecurityError")return{ok:!1,message:"User media support is disabled."};throw e}return{ok:!0,message:"Successfully accessed the camera."}}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(this._maxCvsSideLength!==void 0)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&e.length===1)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){Se._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=Se._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",Se.engineResourcePath)}getUIElement(){return this.UIElement}async setUIElement(e){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if(typeof e=="string"||e instanceof String){if(!e.trim().startsWith("<")){let n=await fetch(e);if(!n.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+n.statusText);e=await n.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let i=document.createElement("div");i.innerHTML=e;for(let n=0;n<i.childElementCount;++n){let o=i.children[n];o instanceof HTMLStyleElement&&(this.styleEls.push(o),document.head.append(o))}(e=i.childElementCount==1?i.children[0]:i).remove()}this.UIElement=e,this._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),this.UIElement.style.display=="none"&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayersManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?Se.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this.singleFrameMode)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i);this._updateVideoContainerStyle(),this._drawingLayersManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame")}_hideElClassName(){this._cvsScanRegion&&this._cvsScanRegion.classList.remove("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.remove("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.remove("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.remove("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.remove("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.remove("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.remove("cvs-single-frame")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display=="none"&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(this._bShowScanRegionLaser!==void 0)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let i=0;for(let n of e)n||i++;return i!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return!(e!==null&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){if(!this._bOpen)return null;let e,i,n;if(this.singleFrameMode)e=this._imgWidth,i=this._imgHeight,n="contain";else{if(!this._video)return null;e=this._video.videoWidth,i=this._video.videoHeight,n=this.getVideoFit()}return{width:e,height:i,objectFit:n}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const i=document.createElement("div");if(this._scanRegionOverlayContainer=i,i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.overflow="hidden",i.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(i);else if(this._cvsScanRegion)this._cvsScanRegion.after(i);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(i);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(i);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(i)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const i=this._arrScanRegionOverlays.indexOf(e);i!==-1&&(e.remove(),this._arrScanRegionOverlays.splice(i,1))}_updateScanRegionOverlay(e){if(!e)return;const i=this._calculateCvsSize();if(!i)return;const{width:n,height:o,objectFit:l}=i;if(n<=0||o<=0)return e.width=0,void(e.height=0);const d=this._getRegionInPixels(n,o,this._scanRegion),_=this.getFrameSize(n,o,this._scanRegion,this.maxCvsSideLength),S=_.dWidth,w=_.dHeight;e.width==S&&e.height==w||(e.width=S,e.height=w);const T=window.getComputedStyle(this._elContainer),A=parseFloat(T.width),I=parseFloat(T.height),k=A/I,P=n/o;let F,z,D,R,M=1;l==="contain"?(P>k?(M=A/n,F=0,z=(I-o*M)/2):(M=I/o,F=(A-n*M)/2,z=0),F+=d.regionLeft*M,z+=d.regionTop*M,D=(d.regionRight-d.regionLeft)*M,R=(d.regionBottom-d.regionTop)*M):l==="cover"?(P>k?(M=I/o,F=d.regionLeft*M-(n*M-A)/2,z=d.regionTop*M):(M=A/n,F=d.regionLeft*M,z=d.regionTop*M-(o*M-I)/2),D=(d.regionRight-d.regionLeft)*M,R=(d.regionBottom-d.regionTop)*M):(F=0,z=0,D=0,R=0),e.style.position="absolute",e.style.left=F+"px",e.style.top=z+"px",e.style.width=D+"px",e.style.height=R+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display=="none"&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,i){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!i)throw new Error("Invalid area.");this._assertOpen();let n=[];if(typeof e=="string"?n.push(e):Array.isArray(e)&&(n=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(i)),this._decoratorType.length=0;const o=["rectangle","focus"],l=["crossline","crosshair"];let d=!1,_=!1;for(let S of n)S=S.toLowerCase(),o.includes(S)&&!d&&(d=!0,this._decoratorType.push(S)),l.includes(S)&&!_&&(_=!0,!this._decoratorType.includes(S)&&this._decoratorType.push(S));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display=="none"&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=i,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=i,this._updateViewDecorator()}setViewDecoratorFillStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=i,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=i,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen||!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this.singleFrameMode)e="contain";else{if(!this._video)return;e=this.getVideoFit()}const i=this._cvsViewDecorator;i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.left="0",i.style.top="0",i.style.objectFit=e,i.style.pointerEvents="none";const n=this.getVisibleRegion(!0),o=n.regionRight-n.regionLeft,l=n.regionBottom-n.regionTop;if(i.width==o&&i.height==l||(i.width=o,i.height=l),o<=0||l<=0)return;const d=i.getContext("2d");d.clearRect(0,0,i.width,i.height);const _=this._decoratorArea.x/100*o,S=this._decoratorArea.y/100*l,w=this._decoratorArea.width/100*o,T=this._decoratorArea.height/100*l;for(let A of this._decoratorType){if(A==="rectangle"){d.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,d.fillRect(0,0,i.width,i.height),d.clearRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,d.fillRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,d.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const I=d.lineWidth/2;d.strokeRect(Math.round(_-I),Math.round(S-I),Math.round(w+d.lineWidth),Math.round(T+d.lineWidth))}if(A==="focus"){d.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,d.fillRect(0,0,i.width,i.height),d.clearRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.fillStyle=this._viewDecoratorInfo.focus.fillStyle,d.fillRect(Math.round(_),Math.round(S),Math.round(w),Math.round(T)),d.lineWidth=this._viewDecoratorInfo.focus.lineWidth,d.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const I=d.lineWidth/2,k=[0,.25,.75,1],P=[0,.25,.75,1];d.beginPath();for(let F=0;F<k.length;F++)if(F==0||F==3)for(let z=0;z<P.length;z+=2)d.moveTo(Math.round(_+k[F]*w),Math.round(S+P[z]*T)),d.lineTo(Math.round(_+k[F]*w),Math.round(S+P[z+1]*T));for(let F=0;F<P.length;F++)if(F==0||F==3)for(let z=0;z<k.length;z+=2)d.moveTo(Math.round(_+k[z]*w-I),Math.round(S+P[F]*T)),d.lineTo(Math.round(_+k[z+1]*w+I),Math.round(S+P[F]*T));d.stroke()}if(A==="crossline"&&(d.beginPath(),d.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,d.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,d.moveTo(Math.round(_),Math.round(S+T/2)),d.lineTo(Math.round(_+w),Math.round(S+T/2)),d.moveTo(Math.round(_+w/2),Math.round(S)),d.lineTo(Math.round(_+w/2),Math.round(S+T)),d.stroke()),A==="crosshair"){d.beginPath();const I=.05*Math.min(w,T);d.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,d.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,d.moveTo(Math.round(_+(w-I)/2),Math.round(S+T/2)),d.lineTo(Math.round(_+(w+I)/2),Math.round(S+T/2)),d.moveTo(Math.round(_+w/2),Math.round(S+(T-I)/2)),d.lineTo(Math.round(_+w/2),Math.round(S+(T+I)/2)),d.stroke()}}}getVisibleRegion(e){this._assertOpen();const i=this._calculateCvsSize();if(!i)return null;const{width:n,height:o,objectFit:l}=i;let d=(()=>{const _=parseFloat(window.getComputedStyle(this._elContainer).width),S=parseFloat(window.getComputedStyle(this._elContainer).height);let w,T={regionBottom:o,regionRight:n,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return l==="cover"?_/S<n/o?(w=S/o,T.regionLeft=Math.floor((n-_/w)/2),T.regionRight=Math.ceil(n-T.regionLeft),T.regionTop=0,T.regionBottom=o):(w=_/n,T.regionTop=Math.floor((o-S/w)/2),T.regionBottom=Math.ceil(o-T.regionTop),T.regionLeft=0,T.regionRight=n):l==="none"&&(_<n&&S<o?(T.regionLeft=Math.floor((n-_)/2),T.regionRight=Math.ceil(n-T.regionLeft),T.regionTop=Math.floor((o-S)/2),T.regionBottom=Math.ceil(o-T.regionTop)):_<n?(T.regionLeft=Math.floor((n-_)/2),T.regionRight=Math.ceil(n-T.regionLeft),T.regionTop=0,T.regionBottom=o):S<o&&(T.regionTop=Math.floor((o-S)/2),T.regionBottom=Math.ceil(o-T.regionTop),T.regionLeft=0,T.regionRight=n)),T})();return e?d.regionMeasuredByPercentage=!1:(d.regionBottom=Math.ceil(d.regionBottom/o*100),d.regionRight=Math.ceil(d.regionRight/n*100),d.regionLeft=Math.floor(d.regionLeft/n*100),d.regionTop=Math.floor(d.regionTop/o*100),d.regionMeasuredByPercentage=!0),d}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,i,n){if(!(e<=0||i<=0))return n?n.regionMeasuredByPercentage?{regionLeft:Math.round(n.regionLeft/100*e),regionTop:Math.round(n.regionTop/100*i),regionRight:Math.round(n.regionRight/100*e),regionBottom:Math.round(n.regionBottom/100*i),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(n)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:i,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;const e=this._calculateCvsSize();if(!e)return;const{width:i,height:n,objectFit:o}=e;if(i<=0||n<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const l=this._getRegionInPixels(i,n,this._scanRegion);if(!this._cvsScanRegion){if(this._cvsScanRegion=document.createElement("canvas"),this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsScanRegion);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsScanRegion);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsScanRegion)}this._recordedStates.maskShow=!0}const d=this._cvsScanRegion;d.style.position="absolute",d.style.width="100%",d.style.height="100%",d.style.left="0",d.style.top="0",d.style.objectFit=o,d.style.pointerEvents="none",d.width==i&&d.height==n||(d.width=i,d.height=n);const _=d.getContext("2d");if(_.clearRect(0,0,d.width,d.height),l.regionLeft!=0||l.regionRight!=i||l.regionTop!=0||l.regionBottom!=n){const S=l.regionLeft,w=l.regionTop,T=l.regionRight-l.regionLeft,A=l.regionBottom-l.regionTop;_.fillStyle=this.regionMaskFillStyle,_.fillRect(0,0,d.width,d.height),_.clearRect(Math.round(S),Math.round(w),Math.round(T),Math.round(A)),_.strokeStyle=this.regionMaskStrokeStyle,_.lineWidth=this.regionMaskLineWidth;const I=_.lineWidth/2;_.strokeRect(Math.round(S-I),Math.round(w-I),Math.round(T+_.lineWidth),Math.round(A+_.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;const e=this._calculateCvsSize();if(!e)return;const{width:i,height:n,objectFit:o}=e;if(!this._divScanArea)return;if(i<=0||n<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const l=this._getRegionInPixels(i,n,this._scanRegion),d=window.getComputedStyle(this._elContainer),_=parseFloat(d.width),S=parseFloat(d.height),w=_/S,T=i/n;let A,I,k,P,F=1;if(o==="contain")w<T?(F=_/i,A=0,I=(S-n*F)/2):(F=S/n,A=(_-i*F)/2,I=0),A+=l.regionLeft*F,I+=l.regionTop*F,k=(l.regionRight-l.regionLeft)*F,P=(l.regionBottom-l.regionTop)*F;else if(o==="cover")if(w<T){F=S/n,A=l.regionLeft*F-(i*F-_)/2,A=Math.max(A,0),A=Math.min(A,parseFloat(d.width)),I=l.regionTop*F;let z=l.regionRight*F-(i*F-_)/2;z=Math.max(z,0),z=Math.min(z,parseFloat(d.width)),k=z-A,P=(l.regionBottom-l.regionTop)*F}else{F=_/i,A=l.regionLeft*F,I=l.regionTop*F-(n*F-S)/2,I=Math.max(I,0),I=Math.min(I,parseFloat(d.height));let z=l.regionBottom*F-(n*F-S)/2;z=Math.max(z,0),z=Math.min(z,parseFloat(d.height)),k=(l.regionRight-l.regionLeft)*F,P=z-I}else A=0,I=0,k=0,P=0;this._divScanArea.style.left=A+"px",this._divScanArea.style.top=I+"px",this._divScanArea.style.width=k+"px",this._divScanArea.style.height=P+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(this._croppingRegions!==void 0)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&e.length===1)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(this._loopInterval!==void 0)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&e.length===1)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(this._maxNumberOfFramesInBuffer!==void 0)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&e.length===1)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(this._refreshInterval!==void 0)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&e.length===1)return e[0]}return this._defaultRefreshInterval}static async createInstance(e){let i=new Se;(typeof e=="string"||e instanceof String)&&(e=JSON.parse(e));for(let n in e)i[n]=e[n];return this._hasEngineResourceLoaded=!0,i._drawingLayersManager=new _m,i}static async playVideo(e,i,n){return new Promise((o,l)=>{e||l(new Error("Invalid video element.")),i||l(new Error("Invalid source.")),e.onloadedmetadata=async()=>{e.onloadedmetadata=null,await e.play(),o(e)},typeof i=="string"||i instanceof String?e.src=i:e.srcObject=i,n!==void 0&&setTimeout(()=>l(new Error("Failed to play video. Timeout.")),n)})}static findBestRearCamera(e){if(!e||!e.length)return null;const i=["rear","back","rück","arrière","trasera","trás","traseira","posteriore","后面","後面","背面","后置","後置","背置","задней","الخلفية","후","arka","achterzijde","หลัง","baksidan","bagside","sau","bak","tylny","takakamera","belakang","אחורית","πίσω","spate","hátsó","zadní","darrere","zadná","задня","stražnja","belakang","बैक"];for(let n of e){const o=n.label.toLowerCase();if(o&&i.some(l=>o.includes(l))&&/\b0(\b)?/.test(o))return n.deviceId}return["Android","HarmonyOS"].includes(He.OS)?e[e.length-1].deviceId:null}async play(e,i,n,o){if(this._video&&this.videoSrc){const _=await Se.playVideo(this._video,this.videoSrc,4e3);if(!this._video)return _.pause(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const S={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.playCallbackInfo=JSON.parse(JSON.stringify(S));const w=this.mapCameraEvents.get("played");for(let T of w){if(!T)continue;const A=JSON.parse(JSON.stringify(S));setTimeout(()=>{this.isDisposed&&this.disposed||T.apply(this,[A])},0)}return this._recordedStates.videoPlaying=!0,S}if(this.singleFrameMode)return o&&o.notTriggerSingleFrameClick||this._clickIptSingleFrameMode(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!this._video)throw new Error("'video' is null or undefined.");const l=++this.iPlayRound;if(this.promisePlay&&(await this.promisePlay,l<this.iPlayRound))return this.playCallbackInfo={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId},{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.promisePlay=(async()=>{var _;try{this._video&&this._video.srcObject&&this.stop(),Se._onLog&&Se._onLog("DCE: ======before video========");const S=()=>{if(!this._video)throw A&&A.getTracks().forEach($=>{$.stop()}),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null or undefined.")},w=this.getVideoSettings();let T,A;if(typeof w.video=="boolean"&&(w.video={}),e)delete w.video.facingMode,w.video.deviceId={exact:e};else if(!w.video.deviceId){if(this._lastDeviceId)delete w.video.facingMode,w.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&Se.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete w.video.facingMode,w.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const $=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),ie=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));$&&ie&&(w.video.width=$,w.video.height=ie)}else if(!this.ifSkipCameraInspection){if(w.video.facingMode){if(await this.getAllCameras(!1),!this._video)throw new Error("'video' is null or undefined.");let $=w.video.facingMode;if($ instanceof Array&&$.length&&($=$[0]),$=$.exact||$.ideal||$,$==="environment"){T=!0;const ie=Se.findBestRearCamera(this._allCameras);ie&&(delete w.video.facingMode,w.video.deviceId={ideal:ie})}}}}i&&(w.video.width={ideal:i}),n&&(w.video.height={ideal:n}),Se._onLog&&Se._onLog("DCE: ======try getUserMedia========");let I=[0,500],k=null;const P=async $=>{for(let ie of I){ie&&await new Promise(ne=>setTimeout(ne,ie)),S();try{Se._onLog&&Se._onLog("DCE: ask "+JSON.stringify($)),A=await navigator.mediaDevices.getUserMedia($);break}catch(ne){k=ne,Se._onLog&&Se._onLog("DCE: "+ne.message||ne)}}};let F;if(await P(w),A||(Se._onLog&&Se._onLog("DCE: ======try getUserMedia again========"),F=JSON.parse(JSON.stringify(w)),typeof F.video=="object"&&(["iPhone","iPad"].includes(He.OS)?(i>=1280||n>=1280?F.video.width=1280:i>=640||n>=640?F.video.width=640:(i<640||n<640)&&(F.video.width=320),delete F.video.height):T&&!w.video.deviceId?(delete F.video.facingMode,this._allCameras.length&&(F.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):F.video=!0),Se._onLog&&Se._onLog("DCE: "+F),await P(F)),A||(I=[1e3,2e3],await P(w)),A||await P(F),!A)throw k;const z=()=>{const $=A.getVideoTracks();let ie,ne;if($.length&&(ie=this._videoTrack=$[0]),this._video&&ie){const q=ie.getSettings();if(q){for(let y of this._allCameras)if(q.deviceId===y.deviceId){y._checked=!0,y.label=ie.label,ne=y;break}}}this._currentCamera=ne};if(await this.getAllCameras(!1),S(),T){z();const $=Se.findBestRearCamera(this._allCameras),ie=(_=this._currentCamera)===null||_===void 0?void 0:_.deviceId;$&&$!=ie&&(A.getTracks().forEach(ne=>{ne.stop()}),I=[0,500,1e3,2e3],await P(w))}Se._onLog&&Se._onLog("DCE: ======play video========"),S(),await Se.playVideo(this._video,A,4e3),S(),Se._onLog&&Se._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const D=this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=D,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),Se._onLog&&Se._onLog("DCE: got "+D),z(),this._renderSelCameraInfo();const R={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};R.deviceId&&(this._lastDeviceId=R.deviceId,this.ifSaveLastUsedCamera&&Se.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),w.video.width&&w.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(w.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(w.video.height)))));const M=this.mapCameraEvents.get("played");for(let $ of M){if(!$)continue;const ie=JSON.parse(JSON.stringify(R));setTimeout(()=>{this.isDisposed&&this.disposed||$.apply(this,[ie])},0)}return this.promisePlay=null,R}catch(S){throw this.promisePlay=null,this._bgLoading&&(this._bgLoading.style.display="none"),S.name==="NotFoundError"&&(DOMException?S=new DOMException("No camera available, please use a device with an accessible camera.",S.name):(S=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),S}})();const d=await this.promisePlay;return this.playCallbackInfo=JSON.parse(JSON.stringify(d)),this._recordedStates.videoPlaying=!0,d}async resume(){this._assertOpen(),this._video&&(await this._video.play(),this._recordedStates.videoPlaying=!0),this.ifShowScanRegionLaser&&this.showScanRegionLaser()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let i=0;i<e.length;++i)for(let n of e[i].children)e.push(n);for(let i of e){if(!this._video&&i.classList.contains(this.containerClassName)){this._elContainer=i;const n=document.createElement("video");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.objectFit=this.getVideoFit(),n.setAttribute("playsinline","true"),n.setAttribute("muted","true"),this._video=n;const o=document.createElement("div");o.append(n),o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.overflow="hidden",this._videoContainer=o,i.prepend(o)}else!this._divScanArea&&i.classList.contains("dce-scanarea")?this._divScanArea=i:!this._divScanLight&&i.classList.contains("dce-scanlight")?this._divScanLight=i:!this._bgLoading&&i.classList.contains("dce-bg-loading")?this._bgLoading=i:!this._bgCamera&&i.classList.contains("dce-bg-camera")?this._bgCamera=i:!this._selCam&&i.classList.contains("dce-sel-camera")?this._selCam=i:!this._selRsl&&i.classList.contains("dce-sel-resolution")?(this._selRsl=i,this.videoSrc||this.singleFrameMode||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">1920x1080</option>','<option data-width="1280" data-height="720">1280x720</option>','<option data-width="640" data-height="480">640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&i.classList.contains("dce-opt-gotResolution")?this._optGotRsl=i:!this._btnClose&&i.classList.contains("dce-btn-close")?this._btnClose=i:!this._selMinLtr&&i.classList.contains("dlr-sel-minletter")?(this._selMinLtr=i,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&i.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=i);if(this.extraBindings&&this.extraBindings.length)for(let n of this.extraBindings)try{n(i)}catch{}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this.singleFrameMode||this.videoSrc?(this.singleFrameMode&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(He.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver(i=>{for(let n of i)n.target===this._elContainer&&this._updateLayers()})),this._elContainer&&this._resizeObserver.observe(this._elContainer)),window.addEventListener("resize",this._updateLayers)}_unbindUI(){this.singleFrameMode?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayersManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameModeIpt&&(this._singleFrameModeIpt.remove(),this._singleFrameModeIpt=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._updateLayers)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}async open(e){this.UIElement||await this.setUIElement(Se.defaultUIElementURL),this._bindUI(),e&&this.appendAndShowUI();let i=await this.play();this.bOpen=!0,this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this.singleFrameMode&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1));const n=this.mapCameraEvents.get("cameraopen");for(let o of n){if(!o)continue;const l=JSON.parse(JSON.stringify(i));setTimeout(()=>{this.isDisposed&&this.disposed||o.apply(this,[l])},0)}return i}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const i=this.mapCameraEvents.get("cameraclose");for(let n of i){if(!n)continue;const o={width:0,height:0,deviceId:null};setTimeout(()=>{this.isDisposed&&this.disposed||n.apply(this,[o])},0)}}stop(){this._video&&this._video.srcObject&&(this._video.srcObject.getTracks().forEach(e=>{e.stop()}),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}async getAllCameras(e=!0){let i=(await navigator.mediaDevices.enumerateDevices()).filter(l=>l.kind==="videoinput");if(e&&i&&i.length&&!i[0].deviceId){let l=await navigator.mediaDevices.getUserMedia({video:!0});i=(await navigator.mediaDevices.enumerateDevices()).filter(d=>d.kind==="videoinput"),l.getTracks().forEach(d=>{d.stop()})}const n=[],o=[];if(this._allCameras)for(let l of this._allCameras)l._checked&&o.push(l);for(let l=0;l<i.length;l++){let d,_=i[l];for(let S of o)if(_.deviceId==S.deviceId){d=S;break}d||(d={deviceId:_.deviceId,label:_.label?_.label:"camera "+l,_checked:!1}),d.deviceId&&n.push(d)}return this._allCameras=n,n}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let i of this._allCameras){const n=document.createElement("option");n.value=i.deviceId,n.innerText=i.label,this._selCam.append(n),i.deviceId&&this._currentCamera&&this._currentCamera.deviceId==i.deviceId&&(e=n)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const i=this.videoSettings.video.deviceId;i&&(e=i.exact||i.ideal||i);for(let n of this._allCameras)if(n.deviceId===e)return JSON.parse(JSON.stringify(n));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}async selectCamera(e){let i="";if(e&&(i=e.deviceId||e),this.videoSettings.video.deviceId={exact:i},!this._bOpen||this._video.paused)return null;let n=null;this._currentCamera&&(n=this._currentCamera.deviceId);const o=this._video.videoWidth,l=this._video.videoHeight,d=await this.play(e.deviceId||e);if(this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this.singleFrameMode&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1)),n!==d.deviceId){const _=this.mapCameraEvents.get("camerachange");for(let S of _){if(!S)continue;const w=JSON.parse(JSON.stringify(d));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[w])},0)}}if(o!==d.width||l!==d.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let S of this._arrScanRegionOverlays)S&&this._updateScanRegionOverlay(S);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const _=this.mapCameraEvents.get("resolutionchange");for(let S of _){if(!S)continue;const w=JSON.parse(JSON.stringify(d));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[w])},0)}}return d}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,i=0;const n=this.videoSettings.video.width,o=this.videoSettings.video.height;return n&&(e=n.exact||n.ideal||n),o&&(i=o.exact||o.ideal||o),[e,i]}}async setResolution(e,i){let n,o;if(e instanceof Array?(n=e[0],o=e[1]):(n=e,o=i),this.videoSettings.video.width={ideal:n},this.videoSettings.video.height={ideal:o},!this._bOpen||this._video.paused)return null;const l=this._video.videoWidth,d=this._video.videoHeight,_=await this.play(null,n,o);if(l!==_.width||d!==_.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let w of this._arrScanRegionOverlays)w&&this._updateScanRegionOverlay(w);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const S=this.mapCameraEvents.get("resolutionchange");for(let w of S){if(!w)continue;const T=JSON.parse(JSON.stringify(_));setTimeout(()=>{this.isDisposed&&this.disposed||w.apply(this,[T])},0)}}return _}async getResolutions(e){let i="";const n=(l,d)=>{const _=this._mapCameraResolutions.get(l);if(!_||!_.length)return!1;for(let S of _)if(S[0]===d.width&&S[1]===d.height)return!0;return!1},o=async(l,d,_)=>{const S={video:{deviceId:{exact:l},width:{ideal:d},height:{ideal:_}}};let w=null;try{w=await navigator.mediaDevices.getUserMedia(S)}catch{return null}if(!w)return null;const T=w.getVideoTracks();let A=null;try{const I=T[0].getSettings();A={width:I.width,height:I.height}}catch{const k=document.createElement("video");k.srcObject=w,A={width:k.videoWidth,height:k.videoHeight},k.srcObject=null}return T.forEach(I=>{I.stop()}),A};if(!this._bOpen){const l=this.videoSettings.video.deviceId;if(!l||(i=l.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:l.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!i))return null;let d=this._mapCameraResolutions.get(i);if(d&&!e)return this._mapCameraResolutions.get(i);this._mapCameraResolutions.set(i,[]),d=this._mapCameraResolutions.get(i);for(let _ of this._predefinedResolutions){const S=await o(i,_.width,_.height);S&&!n(i,S)&&d.push([S.width,S.height])}return d}if(this._currentCamera){i=this._currentCamera.deviceId;let l=this._mapCameraResolutions.get(i);if(l&&!e)return this._mapCameraResolutions.get(i);this._mapCameraResolutions.set(i,[]),l=this._mapCameraResolutions.get(i);const d=this.getConstraints();for(let _ of this._predefinedResolutions){await this._videoTrack.applyConstraints({width:{ideal:_.width},height:{ideal:_.height}});const S=this._videoTrack.getSettings(),w={width:S.width,height:S.height};n(i,w)||l.push([w.width,w.height])}return await this._videoTrack.applyConstraints(d),l}return null}on(e,i){if(!i)return;const n=this.mapCameraEvents.get(e.toLowerCase());if(!n)throw new Error(`Event '${e}' does not exist.`);n.includes(i)||n.push(i)}off(e,i){const n=this.mapCameraEvents.get(e.toLowerCase());if(!n)throw new Error(`Event '${e}' does not exist.`);const o=n.indexOf(i);o!==-1&&n.splice(o,1)}offAll(e){if(e){if(typeof e=="string"){const i=this.mapCameraEvents.get(e);i&&(i.length=0)}}else for(let i of this.mapCameraEvents.values())i&&(i.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}async applyConstraints(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return await this._videoTrack.applyConstraints(e)}async turnOnTorch(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}async turnOffTorch(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}async setColorTemperature(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let i=this.getCapabilities().colorTemperature;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})}getColorTemperature(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}async setExposureCompensation(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let i=this.getCapabilities().exposureCompensation;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}getExposureCompensation(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}async _setHardwareScale(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!this._videoTrack)return;const i=this.getCapabilities().zoom;if(!i)throw new Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),e=dt(e,i.min,i.step,i.max),await this._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e}_getHardwareScale(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,i){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");i&&this._setScaleCenter(i),this._softwareScale=e,this._scaleVideo(e,i)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid center.");const i=this._video.videoWidth,n=this._video.videoHeight;let o=0,l=0;if(e.x.endsWith("px"))o=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(e.x)/100*i}if(e.y.endsWith("px"))l=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");l=parseFloat(e.y)/100*n}if(o==NaN||l==NaN)throw new Error("Invalid scale center.");this._scaleCenter={x:o,y:l}}_resetScaleCenter(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");const e=this._video.videoWidth,i=this._video.videoHeight;this._scaleCenter={x:e/2,y:i/2}}_isVideoCenter(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}async _setZoom(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const i=await this._setHardwareScale(e);let n=this._getHardwareScale();n==1&&i!=1&&(n=i),e>n?this._setSoftwareScale(e/n):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e)}catch(i){if((i.message||i)!=="Not supported.")throw i;this._setSoftwareScale(e)}}async setZoom(e){if(typeof e!="number"&&typeof e!="object")throw new TypeError("Illegal type of argument.");if(typeof e=="number")return this._setZoom(e);if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?this._setScaleCenter(e.centerPoint):this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const i=await this._setHardwareScale(e.factor);let n=this._getHardwareScale();n==1&&i!=1&&(n=i),e.factor>n?this._setSoftwareScale(e.factor/n):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e.factor)}catch(i){if((i.message||i)!=="Not supported.")throw i;this._setSoftwareScale(e.factor)}}}getZoom(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}async resetZoom(){await this.setZoom({factor:1})}async setFrameRate(e){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let i=this.getCapabilities().frameRate;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}getFrameRate(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}async _setFocus(e,i){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(typeof e!="string")throw Error("Invalid focus mode.");e=e.toLowerCase();const n=this.getCapabilities().focusMode,o=this.getCapabilities().focusDistance;if(!n)throw Error("Not supported.");if(!n.includes(e))throw Error("Unsupported mode.");if(i>=0){if(!o)throw Error("Manual focus unsupported.");return i<o.min?i=o.min:i>o.max&&(i=o.max),i=dt(i,o.min,o.step,o.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:i}]})}return await this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}async setFocus(e,i){if(typeof e=="string")return this._setFocus(e,i);if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const n=this.getCapabilities(),o=n.focusMode,l=n.focusDistance;if(!o)throw Error("Not supported.");if(typeof e.mode!="string")throw Error("Invalid focus mode.");const d=e.mode.toLowerCase();if(!o.includes(d))throw Error("Unsupported focus mode.");if(d!=="manual")return this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:d}]});if(!l)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let _=e.distance;return _<l.min?_=l.min:_>l.max&&(_=l.max),_=dt(_,l.min,l.step,l.max),this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:d,focusDistance:_}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const _=e.area.centerPoint;let S=e.area.width,w=e.area.height;if(!S||!w){const T=this._video.videoWidth,A=this._video.videoHeight;S||(S=2*Math.round(Math.min(T,A)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),w||(w=2*Math.round(Math.min(T,A)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters._focusArea={centerPoint:{x:_.x,y:_.y},width:S,height:w},await this._setLocalFocus(_,S,w)}}getFocus(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?e==="continuous"?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),i=e.focusMode;return i?i==="manual"?this._focusParameters._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:i}:null}async _setFocusAndGetContract(e,i){const n=I=>{if(!this._bOpen||!this._videoTrack||this.video.paused||I.focusTaskId!=this._focusParameters.curFocusTaskId){this._bOpen&&this._videoTrack&&!this.video.paused||(this._focusParameters.isDoingFocus=0);const k=new Error(`Focus task ${I.focusTaskId} canceled.`);throw k.name="DeprecatedTaskError",k}this._focusParameters.isDoingFocus===1&&Date.now()-I.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let o;i=dt(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(e),o=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise(I=>{setTimeout(I,o)}),n(e);let l=e.focusL-e.focusW/2,d=e.focusT-e.focusH/2,_=e.focusW,S=e.focusH;if(l>=this.video.videoWidth||d>=this.video.videoHeight)throw new Error("Invalid area.");l+_>this.video.videoWidth&&(_=this.video.videoWidth-l),d+S>this.video.videoHeight&&(S=this.video.videoHeight-d);const w=this._getImageData(this.video,this.video.videoWidth,this.video.videoHeight,{sx:l,sy:d,sWidth:_,sHeight:S,dWidth:_,dHeight:S},null,{pixelFormat:Te.RGBA});if(!w)return this._setFocusAndGetContract(e,i);const T=w.data;let A=0;for(let I=0,k=T.length-8;I<k;++I){let P=T[I]-T[I+8];++I;let F=T[I]-T[I+8];++I;let z=T[I]-T[I+8];++I,A+=P*P+F*F+z*z}return-A}async _doFocusDetail(e,i,n,o,l,d,_){let S;if(i=dt(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=dt(o,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),d?d=dt(d,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(d=dt(Math.sqrt((i||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),_=await this._setFocusAndGetContract(e,d)),_<=n&&_<=l?S=3:n<l&&n<_?S=1:l<n&&l<_&&(S=2),(o-i)/2<=this._focusParameters.fds.step)return S===3||(S===1?await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):S===2&&await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:o}]})),!0;if(S===1)return await this._doFocusDetail(e,i,n,d,_);if(S===2)return await this._doFocusDetail(e,d,_,o,l);if(S!==3)return n=await this._setFocusAndGetContract(e,i),l=await this._setFocusAndGetContract(e,o),await this._doFocusDetail(e,i,n,o,l);let w=dt(Math.sqrt((i||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),T=dt(Math.sqrt((o||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/w)<=Math.abs(1/this._focusParameters.oldDistance-1/T)){let A=await this._setFocusAndGetContract(e,w);if(A<_)return await this._doFocusDetail(e,i,n,d,_,w,A);if(A==_)return await this._doFocusDetail(e,w,A,d,_);let I=await this._setFocusAndGetContract(e,T);if(A>_&&_<I)return await this._doFocusDetail(e,w,A,T,I,d,_);if(_==I)return await this._doFocusDetail(e,d,_,T,I);if(_>I)return await this._doFocusDetail(e,d,_,o,l,T,I)}else{let A=await this._setFocusAndGetContract(e,T);if(_>A)return await this._doFocusDetail(e,d,_,o,l,T,A);if(_==A)return await this._doFocusDetail(e,d,_,T,A);let I=await this._setFocusAndGetContract(e,w);if(I>_&&_<A)return await this._doFocusDetail(e,w,I,T,A,d,_);if(I==_)return await this._doFocusDetail(e,w,I,d,_);if(I<_)return await this._doFocusDetail(e,i,n,d,_,w,I)}return!1}async _setLocalFocus(e,i,n,o,l){if(this._focusParameters.isDoingFocus==1)return!1;if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid centerPoint.");if(!i||typeof i!="string")throw new Error("Invalid width.");if(!n||typeof n!="string")throw new Error("Invalid height.");const d=this._video.videoWidth,_=this._video.videoHeight;let S=0,w=0;if(e.x.endsWith("px"))S=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");S=parseFloat(e.x)/100*d}if(e.y.endsWith("px"))w=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");w=parseFloat(e.y)/100*_}if(S==NaN||w==NaN)throw new Error("Invalid centerPoint.");let T=0;if(i.endsWith("px"))T=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid width.");T=parseFloat(i)/100*d}if(T==NaN)throw new Error("Invalid width.");let A=0;if(n.endsWith("px"))A=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid height.");A=parseFloat(n)/100*_}if(A==NaN)throw new Error("Invalid height.");if(this._softwareScale!==1){const P=this._softwareScale,F=this._scaleCenter;T/=P,A/=P,S=(1-1/P)*F.x+S/P,w=(1-1/P)*F.y+w/P}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const I={focusL:S,focusT:w,focusW:T,focusH:A,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},k=async(P,F,z)=>{try{(F==null||F<this._focusParameters.fds.min)&&(F=this._focusParameters.fds.min),(z==null||z>this._focusParameters.fds.max)&&(z=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let D=dt(Math.sqrt(z*(F||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),R=dt(Math.sqrt((F||this._focusParameters.fds.step)*D),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),M=dt(Math.sqrt(D*z),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),$=await this._setFocusAndGetContract(P,M),ie=await this._setFocusAndGetContract(P,R),ne=await this._setFocusAndGetContract(P,D);if(ie>ne&&ne<$){const q=await this._doFocusDetail(P,R,ie,M,$,D,ne);return this._focusParameters.isDoingFocus=0,q}if(ie<ne&&ie<$){let q=await this._setFocusAndGetContract(P,F);const y=await this._doFocusDetail(P,F,q,D,ne,R,ie);return this._focusParameters.isDoingFocus=0,y}if(ne>$&&ie>$){let q=await this._setFocusAndGetContract(P,z);const y=await this._doFocusDetail(P,D,ne,z,q,M,$);return this._focusParameters.isDoingFocus=0,y}if(ie==ne&&ne<$){const q=await this._doFocusDetail(P,R,ie,D,ne);return this._focusParameters.isDoingFocus=0,q}if(ne==$&&ie>ne){const q=await this._doFocusDetail(P,D,ne,M,$);return this._focusParameters.isDoingFocus=0,q}return k(P,F,z)}catch(D){if(D.name!=="DeprecatedTaskError")throw D}};return k(I,o,l)}async enableTapToFocus(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error("Video is not playing.");if(!this._focusSupported)throw new Error("Tapping to focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,this._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");this._tapFocusEnabled=!0}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video||this.singleFrameMode)return;const e=this._getSoftwareScale(),i=this._videoContainer;if(this.videoFit==="contain"&&e>1){const n=this._video.videoWidth,o=this._video.videoHeight,l=window.getComputedStyle(this._elContainer),d=parseFloat(l.width),_=parseFloat(l.height),S=n/o;if(d/_<S){let w=d/S;i.style.left="0",i.style.top=(_-w)/2/_*100+"%",i.style.width="100%",i.style.height=w/_*100+"%"}else{let w=_*S;i.style.left=(d-w)/2/d*100+"%",i.style.top="0",i.style.width=w/d*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}_scaleVideo(e,i){if(this._video&&!this.singleFrameMode){if(e<1)throw new RangeError("Invalid scale value.");if(i&&this._setScaleCenter(i),e===1)this._video.style.transform="";else{const n=this.getVideoFit(),o=this._video.videoWidth,l=this._video.videoHeight,d=window.getComputedStyle(this._elContainer),_=parseFloat(d.width),S=parseFloat(d.height),w=_/S,T=o/l;let A=1;n==="contain"?A=w<T?_/(o/e):S/(l/e):n==="cover"&&(A=T>w?S/(o/e):_/(l/e));const I=A*(1-1/e)*(o/2-this._scaleCenter.x),k=A*(1-1/e)*(l/2-this._scaleCenter.y);this._video.style.transform=`translate(${I}px, ${k}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,i,n,o){if(!e||!i)return null;let l,d,_,S,w=e,T=i;const A={regionLeft:0,regionTop:0,regionRight:w,regionBottom:T,regionMeasuredByPercentage:!1};n?(n.regionMeasuredByPercentage?(A.regionLeft=n.regionLeft*w/100,A.regionTop=n.regionTop*T/100,A.regionRight=n.regionRight*w/100,A.regionBottom=n.regionBottom*T/100):(A.regionLeft=n.regionLeft,A.regionTop=n.regionTop,A.regionRight=n.regionRight,A.regionBottom=n.regionBottom),l=Math.round(A.regionLeft),d=Math.round(A.regionTop),w=Math.round(A.regionRight-A.regionLeft),T=Math.round(A.regionBottom-A.regionTop)):(l=0,d=0,w=Math.round(w),T=Math.round(T));const I=Math.max(w,T);if(o&&o>0&&I>o){const k=o/I;w>T?(_=o,S=Math.round(T*k)):(_=Math.round(w*k),S=o)}else _=w,S=T;return _<=0||S<=0?null:{sx:l,sy:d,sWidth:w,sHeight:T,dWidth:_,dHeight:S}}getFrame(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,i,n,o,l,d,_){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!n||!o)return null;if(i instanceof HTMLVideoElement&&i.readyState!==4||i instanceof HTMLImageElement&&!i.complete)throw new Error("The source is not loaded.");let S=0,w=0,T=n,A=o,I=0,k=0,P=n,F=o;l&&(l.sx&&(S=Math.round(l.sx)),l.sy&&(w=Math.round(l.sy)),l.sWidth&&(T=Math.round(l.sWidth)),l.sHeight&&(A=Math.round(l.sHeight)),l.dx&&(I=Math.round(l.dx)),l.dy&&(k=Math.round(l.dy)),l.dWidth&&(P=Math.round(l.dWidth)),l.dHeight&&(F=Math.round(l.dHeight)));let z=Te.RGBA;_&&_.pixelFormat&&(z=_.pixelFormat);const D=e;if(_&&_.bUseWebGL){(D.width<I+P||D.height<k+F)&&(D.width=I+P,D.height=k+F,D.ctxWebGL&&D.ctxWebGL.viewport(0,0,I+P,k+F));const R=D.ctxWebGL||D.getContext("webgl",{antialias:!1})||D.getContext("experimental-webgl",{antialias:!1});if(!R){const q=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw q.name="WebGLError",q}if(!D.ctxWebGL||z!==this.shaderPixelFormat){D.ctxWebGL=R;const q=f=>{const r=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,r),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),f.STATIC_DRAW);const s=f.createBuffer();return f.bindBuffer(f.ARRAY_BUFFER,s),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),f.STATIC_DRAW),{positions:r,texCoords:s}},y=f=>{const r=f.createTexture();return f.bindTexture(f.TEXTURE_2D,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),r},pe=(f,r)=>{const s=f.createProgram();if(r.forEach(h=>f.attachShader(s,h)),f.linkProgram(s),!f.getProgramParameter(s,f.LINK_STATUS)){const h=new Error(`An error occured linking the program: ${f.getProgramInfoLog(s)}.`);throw h.name="WebGLError",h}return f.useProgram(s),s},fe=(f,r,s)=>{const h=f.createShader(r);if(f.shaderSource(h,s),f.compileShader(h),!f.getShaderParameter(h,f.COMPILE_STATUS)){const m=new Error(`An error occured compiling the shader: ${f.getShaderInfoLog(h)}.`);throw m.name="WebGLError",m}return h},Ce=`
                    attribute vec2 a_position;
                    attribute vec2 a_texCoord;

                    uniform mat3 u_matrix;
                    uniform mat3 u_textureMatrix;

                    varying vec2 v_texCoord;
                    void main(void) {
                    gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                    v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                    }
                `;let u="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(z)&&(u=z.slice(0,3));const a=`
                    precision mediump float;
                    varying vec2 v_texCoord;
                    uniform sampler2D u_image;
                    uniform float uColorFactor;

                    void main() {
                        vec4 sample = texture2D(u_image, v_texCoord);
                        float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                        gl_FragColor = vec4(sample.${u} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                    }
                `,c=pe(R,[fe(R,R.VERTEX_SHADER,Ce),fe(R,R.FRAGMENT_SHADER,a)]);this._webGLProgramInfo={program:c,attribLocations:{vertexPosition:R.getAttribLocation(c,"a_position"),texPosition:R.getAttribLocation(c,"a_texCoord")},uniformLocations:{uSampler:R.getUniformLocation(c,"u_image"),uColorFactor:R.getUniformLocation(c,"uColorFactor"),uMatrix:R.getUniformLocation(c,"u_matrix"),uTextureMatrix:R.getUniformLocation(c,"u_textureMatrix")}},this._webGLBuffers=q(R),this._webGLTexture=y(R),this.shaderPixelFormat=z}const M=(q,y,pe)=>{q.bindBuffer(q.ARRAY_BUFFER,y),q.enableVertexAttribArray(pe),q.vertexAttribPointer(pe,2,q.FLOAT,!1,0,0)},$=(q,y,pe)=>{const fe=q.RGBA,Ce=q.RGBA,u=q.UNSIGNED_BYTE;q.bindTexture(q.TEXTURE_2D,y),q.texImage2D(q.TEXTURE_2D,0,fe,Ce,u,pe)},ie=(q,y,pe,fe)=>{q.clearColor(0,0,0,1),q.clearDepth(1),q.enable(q.DEPTH_TEST),q.depthFunc(q.LEQUAL),q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT),M(q,pe.positions,y.attribLocations.vertexPosition),M(q,pe.texCoords,y.attribLocations.texPosition),q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,fe),q.uniform1i(y.uniformLocations.uSampler,0),q.uniform1f(y.uniformLocations.uColorFactor,[Te.GREY,Te.GREY32].includes(z)?1:0);let Ce,u,a=ft.translate(ft.identity(),-1,-1);a=ft.scale(a,2,2),a=ft.scale(a,1/q.canvas.width,1/q.canvas.height),Ce=ft.translate(a,I,k),Ce=ft.scale(Ce,P,F),q.uniformMatrix3fv(y.uniformLocations.uMatrix,!1,Ce),u=ft.translate(ft.identity(),S/n,w/o),u=ft.scale(u,T/n,A/o),q.uniformMatrix3fv(y.uniformLocations.uTextureMatrix,!1,u),q.drawArrays(q.TRIANGLES,0,6)};let ne;if($(R,this._webGLTexture,i),ie(R,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),d){if(d.length<P*F*4)throw new Error("Unexpected size of the 'bufferContainer'.");ne=d}else ne=new Uint8Array(P*F*4);if(R.readPixels(I,k,P,F,R.RGBA,R.UNSIGNED_BYTE,ne),ne[3]!==255){this._bWebGLSupported=!1;const q=new Error("WebGL error: incorrect WebGL drawing.");throw q.name="WebGLError",q}return{context:R,pixelFormat:z===Te.GREY?Te.GREY32:z,_bUseWebGL:!0}}{D.ctx2d||(D.ctx2d=D.getContext("2d",{willReadFrequently:!0}));const R=D.ctx2d;if(!R)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(D.width<I+P||D.height<k+F)&&(D.width=I+P,D.height=k+F),R.drawImage(i,S,w,T,A,I,k,P,F),{context:R,pixelFormat:Te.RGBA,_bUseWebGL:!1}}}_readCvsData(e,i,n){let o,l=0,d=0,_=e.canvas.width,S=e.canvas.height;if(i&&(i.x&&(l=i.x),i.y&&(d=i.y),i.width&&(_=i.width),i.height&&(S=i.height)),e instanceof WebGLRenderingContext){const w=e;if(n){if(n.length<_*S*4)throw new Error("Unexpected size of the 'bufferContainer'.");w.readPixels(l,d,_,S,w.RGBA,w.UNSIGNED_BYTE,n),o=new Uint8Array(n.buffer,0,_*S*4)}else o=new Uint8Array(_*S*4),w.readPixels(l,d,_,S,w.RGBA,w.UNSIGNED_BYTE,o)}else if(e instanceof CanvasRenderingContext2D){let w;if(w=e.getImageData(l,d,_,S),o=new Uint8Array(w.data.buffer),n){if(n.length<o.length)throw new Error("Unexpected size of the 'bufferContainer'.");n.set(o)}}return o}_transformPixelFormat(e,i,n,o){let l;if(i===n)return o?new Uint8Array(e):e;const d=[Te.RGBA,Te.RBGA,Te.GRBA,Te.GBRA,Te.BRGA,Te.BGRA];if(d.includes(i))if(n===Te.GREY){l=new Uint8Array(e.length/4);for(let _=0;_<e.length;_+=4){const S=.21*e[_]+.71*e[_+1]+.07*e[_+2];l[_/4]=S}}else if(n===Te.GREY32){l=o?new Uint8Array(e):e;for(let _=0;_<e.length;_+=4){const S=.21*e[_]+.71*e[_+1]+.07*e[_+2];l[_]=S,l[_+1]=S,l[_+2]=S}}else{if(!d.includes(n))throw new Error("Unable to transform.");if(o){l=new Uint8Array(e);const _=i.indexOf("r"),S=i.indexOf("g"),w=i.indexOf("b"),T=n.indexOf("r"),A=n.indexOf("g"),I=n.indexOf("b");for(let k=0;k<e.length;k+=4)l[k+T]=e[k+_],l[k+A]=e[k+S],l[k+I]=e[k+w]}else{l=e;const _=i.indexOf("r"),S=i.indexOf("g"),w=i.indexOf("b"),T=n.indexOf("r"),A=n.indexOf("g"),I=n.indexOf("b");for(let k=0;k<e.length;k+=4){let P=[e[k],e[k+1],e[k+2]];l[k+T]=P[_],l[k+A]=P[S],l[k+I]=P[w]}}}else if(i===Te.GREY){if(n!==Te.GREY32)throw new Error("Unable to transform.");l=new Uint8Array(4*e.length);for(let _=0;_<e.length;_++)l[4*_]=e[_],l[4*_+1]=e[_],l[4*_+2]=e[_],l[4*_+3]=255}else{if(i!==Te.GREY32)throw new Error("Unable to transform.");if(n!==Te.GREY)throw new Error("Unable to transform.");l=new Uint8Array(new Uint32Array(e.buffer))}return l}_getImageData(e,i,n,o,l,d){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!i||!n)return null;if(o.sx>i||o.sy>n||o.sx+o.sWidth>i||o.sy+o.sHeight>n)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");const _=Math.round(o.sx),S=Math.round(o.sy),w=Math.round(o.sWidth),T=Math.round(o.sHeight),A=Math.round(o.dWidth),I=Math.round(o.dHeight);let k=Te.RGBA;d&&d.pixelFormat&&(k=d.pixelFormat);let P,F,z,D=this._bWebGLSupported;d&&d.bUseWebGL==0&&(D=!1),D?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),P=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),P=this._reusedCvs);try{if(D)if(Se._onLog&&Se._onLog("DCE: _getImageData() in WebGL."),l)if(k===Te.GREY){if(z=new Uint8Array(A*I*4),F=this._drawImage(P,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},z,{pixelFormat:k,bUseWebGL:D}),z=this._transformPixelFormat(z,F.pixelFormat,k),l){if(l.length<z.length)throw new Error("Unexpected size of the 'bufferContainer'.");l.set(z)}}else F=this._drawImage(P,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},l,{pixelFormat:k,bUseWebGL:D}),z=new Uint8Array(l.buffer,0,A*I*4),z=this._transformPixelFormat(z,F.pixelFormat,k);else k===Te.GREY?((!this._tempDataContainer||this._tempDataContainer.length<A*I*4)&&(this._tempDataContainer=new Uint8Array(A*I*4)),z=new Uint8Array(this._tempDataContainer.buffer,0,A*I*4)):z=new Uint8Array(A*I*4),F=this._drawImage(P,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},z,{pixelFormat:k,bUseWebGL:D}),z=this._transformPixelFormat(z,F.pixelFormat,k);else if(Se._onLog&&Se._onLog("DCE: _getImageData() in context2d."),F=this._drawImage(P,e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},null,{pixelFormat:Te.RGBA,bUseWebGL:D}),z=this._readCvsData(F.context,null,null),z=this._transformPixelFormat(z,F.pixelFormat,k),l){if(l.length<z.length)throw new Error("Unexpected size of the 'bufferContainer'.");l.set(z)}}catch(R){if(R.name==="WebGLError")return this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,i,n,{sx:_,sy:S,sWidth:w,sHeight:T,dWidth:A,dHeight:I},l,d);throw R}return{data:z,pixelFormat:k,_bUseWebGL:F._bUseWebGL}}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_getVideoData(e,i){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||this._video.readyState!==4)return null;const n=Date.now();let o=this._scanRegion;i&&i.hasOwnProperty("region")&&(o=i.region);let l=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());i&&i.pixelFormat&&(l=this.mapPixelFormatString_Enum.get(i.pixelFormat.toLowerCase()));let d=this._softwareScale;i&&i.scale&&(d=i.scale);const _=this._video.videoWidth,S=this._video.videoHeight;let w=this._scaleCenter;if(i&&i.scaleCenter){if(typeof i.scaleCenter.x!="string"||typeof i.scaleCenter.y!="string")throw new Error("Invalid scale center.");let F=0,z=0;if(i.scaleCenter.x.endsWith("px"))F=parseFloat(i.scaleCenter.x);else{if(!i.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");F=parseFloat(i.scaleCenter.x)/100*_}if(i.scaleCenter.y.endsWith("px"))z=parseFloat(i.scaleCenter.y);else{if(!i.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");z=parseFloat(i.scaleCenter.y)/100*S}if(F==NaN||z==NaN)throw new Error("Invalid scale center.");w.x=Math.round(F),w.y=Math.round(z)}if(_===0||S===0)return null;const T=this.getFrameSize(_,S,o,this.maxCvsSideLength);if(!T)return null;let A=!0;_===T.sWidth&&S===T.sHeight&&(A=!1);const I={data:null,region:o?JSON.parse(JSON.stringify(o)):null,sx:T.sx,sy:T.sy,width:T.dWidth,height:T.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:A,toCanvas:this._toCanvas,_sWidth:T.sWidth,_sHeight:T.sHeight,_bUseWebGL:null};d!==1&&(T.sWidth=Math.round(T.sWidth/d),T.sHeight=Math.round(T.sHeight/d),T.sx=Math.round((1-1/d)*w.x+T.sx/d),T.sy=Math.round((1-1/d)*w.y+T.sy/d));const k=this._getImageData(this._video,_,S,T,e,{pixelFormat:l});if(!k)return null;const P=Date.now();return I.data=k.data,I.pixelFormat=I.colorMode=k.pixelFormat,I._bUseWebGL=k._bUseWebGL,I.timeSpent=P-n,I.timeStamp=P,k.pixelFormat===Te.GREY?I.stride=I.width:I.stride=4*I.width,I}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const i=()=>{const o=this.getCurrentRegion();let l=this._getVideoData(null,{region:o});if(!l)return void Se._onLog;for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(l);const d=this.mapCameraEvents.get("frameaddedtobuffer");for(let _ of d)_&&setTimeout(()=>{this.isDisposed&&this.disposed||_.apply(this)},0)},n=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout(()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(i(),n()):this.stopFetchingLoop())},this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(i(),this.refreshInterval>0&&n()):this.refreshInterval>0?(i(),n()):this.refreshInterval===0?i():this.refreshInterval),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)},this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this.singleFrameMode)throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}_createDrawingLayerBaseCvs(){this._assertOpen();const e=this._calculateCvsSize();if(!e)throw new Error("Camera is not open.");const{width:i,height:n,objectFit:o}=e;if(i<=0||n<=0)throw new Error("Invalid dimension of video or image.");const l=document.createElement("canvas");if(l.width==i&&l.height==n||(l.width=i,l.height=n),l.style.objectFit=o,this._cvsScanRegion)this._cvsScanRegion.after(l);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(l);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(l);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(l)}return l}_updateDrawingLayersSize(e){let i;if(i=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize(),!i)return;const{width:n,height:o,objectFit:l}=i;this._drawingLayersManager.setDimensions({width:n,height:o},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(l)}_createDrawingLayer(e){this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs());const i=this._layerBaseCvs;return this._drawingLayersManager.createDrawingLayer(i,e)}deleteDrawingLayer(e){this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayersManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayersManager.getDrawingLayers().filter(e=>e.getId()>=0)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayersManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayersManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayersManager.getDrawingStyles()}updateDrawingStyle(e,i){return this._drawingLayersManager.updateDrawingStyle(e,i)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let i of e)this.deleteDrawingLayer(i.getId())}showTip(e,i,n,o,l=3e3,d=!0){this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=i,this._tipArgs.width=n,this._tipArgs.autoShowSuggestedTip=!!d,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const _=new Kd(o||"",e,i,n,this._tipStyleId);_._fabricObject.paddingTop=15,_._fabricObject.calcTextHeight=function(){for(var S=0,w=0,T=this._textLines.length;w<T;w++)S+=this.getHeightOfLine(w);return S+2*this.paddingTop},_._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},_.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),_.setAttribute("lineHeight",1.3),_.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(_),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=l===void 0?3e3:l,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}_hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}hideTip(){this._hideTip(),this._tipArgs.x=null,this._tipArgs.y=null,this._tipArgs.width=null,this._tipArgs.autoShowSuggestedTip=null}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}suggestTip(e,i){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(i):this._tipArgs.x!==void 0&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,i,this._tipArgs.duration)),this.onTipSuggested&&setTimeout(()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,i])},0)}_createControler(){if(this._controler||(this._controler=new vm(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,i,n){if(!e||!i||!n)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:i,height:n};let o=this._cvsOriginalImage;o||(o=document.createElement("canvas"),o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.left="0",o.style.top="0",o.style.backgroundColor="white",o.style.objectFit="contain",this._cvsOriginalImage=o),o.width===i&&o.height===n||(o.width=i,o.height=n);const l=o.getContext("2d");l.clearRect(0,0,o.width,o.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),l.putImageData(new ImageData(e,i,n),0,0)):e instanceof HTMLCanvasElement&&l.drawImage(e,0,0),document.body.contains(o)&&o.style.display===""&&this._updateDrawingLayersSize({width:i,height:n,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}async deleteOriginalImage(){await this.hideOriginalImage(),this._cvsOriginalImage&&(this._cvsOriginalImage.remove(),this._cvsOriginalImage=null),this._originalImageData=null}_showOriginalImageCvs(){this._cvsOriginalImage&&this._cvsOriginalImage.style.display=="none"&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(e.style.display===""&&document.body.contains(e))return;const{width:i,height:n}=this._originalImageData;if(this._updateDrawingLayersSize({width:i,height:n,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}async _hideOriginalImage(e){this._originalImageData&&this._cvsOriginalImage&&this._cvsOriginalImage.style.display!=="none"&&(this._updateDrawingLayersSize(),this._bOpen&&e&&(this._video&&this._recordedStates.videoPlaying&&await this.play(null,null,null,{notTriggerSingleFrameClick:!0}),this._recordedStates.fetchingLoopStart&&!this.singleFrameMode&&this.startFetchingLoop(),this.ifShowScanRegionMask&&this._cvsScanRegion&&this._recordedStates.maskShow&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this._divScanLight&&this._recordedStates.laserShow&&this.showScanRegionLaser(),this._cvsViewDecorator&&this._recordedStates.decoratorShow&&this.showViewDecorator(),this._scanRegionOverlayContainer&&this._recordedStates.overlayShow&&this.showScanRegionOverlays()),this._selCam&&(this._selCam.parentElement.style.display=""),this._hideOriginalImageCvs())}async hideOriginalImage(){return this._hideOriginalImage(!0)}dispose(e){this.UIElement&&(this._uiOriginalState&&this._uiOriginalState.inDom?this.UIElement.style.display=this._uiOriginalState.display:this.UIElement.style.display="none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let i in this)delete this[i];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}Se._jsVersion="3.3.1",Se._jsEditVersion="20230217",Se._version="JS "+Se._jsVersion+"."+Se._jsEditVersion,Se.browserInfo=He,Se._hasEngineResourceLoaded=!1,Se._engineResourcePath=pm,Se._defaultUIElementURL="@engineResourcePath/dce.ui.html";const ym={DT_Arc:class extends mt{constructor(t,e,i,n,o,l){super(new xe.Circle({left:t,top:e,radius:i,startAngle:n,endAngle:o}),l),this._mediaType="arc"}},DT_Polygon:qc,DT_Rect:class extends mt{constructor(t,e,i,n,o){super(new xe.Rect({left:t,top:e,width:i,height:n}),o)}},DT_Image:class extends mt{constructor(t,e,i,n){super(new xe.Image(t,{left:e,top:i}),n),this.image=t}_extendSet(t,e){if(t==="image"){if(e instanceof HTMLImageElement)return this._fabricObject.setElement(e),this.image=e,!0;if(e instanceof HTMLCanvasElement){const i=new Image;return i.src=e.toDataURL(),this._fabricObject.setElement(i),this.image=e,!0}throw new Error("Unsupported value.")}}_extendGet(t){if(t==="image")return this.image}},DT_Text:Kd,DT_Line:class extends qc{constructor(t,e,i){super([t,e],i),this._mediaType="line"}_extendSet(t,e){if(t==="startPoint"||t==="endPoint"){e=t==="startPoint"?[e,this.get("endPoint")]:[this.get("startPoint"),e];const i=this._fabricObject;if(i.group){const o=i.group;i.points=e.map(l=>({x:l.x-o.left-o.width/2,y:l.y-o.top-o.height/2})),o.addWithUpdate()}else i.points=e;const n=i.points.length-1;return i.controls=i.points.reduce(function(o,l,d){return o["p"+d]=new xe.Control({positionHandler:Aa,actionHandler:Ra(d>0?d-1:n,Oa),actionName:"modifyPolygon",pointIndex:d}),o},{}),i._setPositionDimensions({}),!0}}_extendGet(t){if(t==="startPoint"||t==="endPoint"){const e=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let n in i.oCoords)e.push({x:i.oCoords[n].x,y:i.oCoords[n].y});else for(let n of i.points){let o=n.x-i.pathOffset.x,l=n.y-i.pathOffset.y;const d=xe.util.transformPoint({x:o,y:l},i.calcTransformMatrix());e.push({x:d.x,y:d.y})}return t==="startPoint"?e[0]:e[1]}}},DT_Group:class extends mt{constructor(t){super(new xe.Group(t.map(e=>e._getFabricObject()))),this._fabricObject.on("selected",()=>{this.styleSelector="selected";const e=this._fabricObject._objects;for(let i of e)setTimeout(()=>{i&&i.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.styleSelector="default";const e=this._fabricObject._objects;for(let i of e)setTimeout(()=>{i&&i.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)})}getChildItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}addChildItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}};function Sm(t,e,i){return(i.x-t.x)*(e.y-t.y)==(e.x-t.x)*(i.y-t.y)&&Math.min(t.x,e.x)<=i.x&&i.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=i.y&&i.y<=Math.max(t.y,e.y)}function Ro(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Vr(t,e,i,n){let o=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),l=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return!((o^l)>=0&&o!==0&&l!==0)&&(o=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),l=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),!((o^l)>=0&&o!==0&&l!==0))}class zt extends j{constructor(){super(),this._barcodeFillStyle="rgba(254,180,32,0.3)",this._barcodeStrokeStyle="rgba(254,180,32,0.9)",this._barcodeLineWidth=1,this._barcodeFillStyleBeforeVerification="rgba(248,252,0,0.2)",this._barcodeStrokeStyleBeforeVerification="transparent",this._barcodeLineWidthBeforeVerification=2,this.bFilterRegionInJs=!0,this._onCameraSelChange=()=>{},this._onResolutionSelChange=()=>{},this._onCloseBtnClick=()=>{},this._onPlayed=null}static get version(){return this._version+`(DCE ${Se.getVersion()})`}static _fireHTTPSWarnning(){zt.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{zt.onWarning&&zt.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}static async testCameraAccess(){return Se.testCameraAccess()}_fireResolutionWarning(){if(!this.singleFrameMode&&this.onWarning&&this.dce.isOpen()){const e=this.dce.getConstraints();e&&e.width<1280&&e.height<720&&setTimeout(()=>{this.onWarning&&this.onWarning({id:3,message:"Camera resolution too low, please use a higher resolution (720P or better)."})},0)}}getUIElement(){return this.dce.getUIElement()}async setUIElement(e){await this.dce.setUIElement(e)}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,(async()=>{let i=await this.getScanSettings();i.oneDTrustFrameCount=1,await this.updateScanSettings(i)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}get video(){return this.dce&&this.dce.video}set videoSrc(e){this.dce&&(this.dce.videoSrc=e)}get videoSrc(){return this.dce&&this.dce.videoSrc}set onTipSuggested(e){this.dce&&(this.dce.onTipSuggested=e)}get onTipSuggested(){return this.dce&&this.dce.onTipSuggested}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set barcodeFillStyle(e){this._barcodeFillStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{fillStyle:e})}get barcodeFillStyle(){return this._barcodeFillStyle}set barcodeStrokeStyle(e){this._barcodeStrokeStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{strokeStyle:e})}get barcodeStrokeStyle(){return this._barcodeStrokeStyle}set barcodeLineWidth(e){this._barcodeLineWidth=e,this.dce&&this.dce.updateDrawingStyle(3,{lineWidth:e})}get barcodeLineWidth(){return this._barcodeLineWidth}set barcodeFillStyleBeforeVerification(e){this._barcodeFillStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{fillStyle:e})}get barcodeFillStyleBeforeVerification(){return this._barcodeFillStyleBeforeVerification}set barcodeStrokeStyleBeforeVerification(e){this._barcodeStrokeStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{strokeStyle:e})}get barcodeStrokeStyleBeforeVerification(){return this._barcodeStrokeStyleBeforeVerification}set barcodeLineWidthBeforeVerification(e){this._barcodeLineWidthBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{lineWidth:e})}get barcodeLineWidthBeforeVerification(){return this._barcodeLineWidthBeforeVerification}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.framePixelFormat=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}async createDCEInstance(){this.dce||(j._onLog&&j._onLog("createDCEInstance()"),Se.defaultUIElementURL=null,this.dce=await Se.createInstance(),this.dce.refreshInterval=200,this.dce.framePixelFormat="grey",this.dce.maxCvsSideLength=this.maxCvsSideLength,this._drawingItemNamespace=ym,["iPhone","iPad","Android","HarmonyOS"].includes(j.browserInfo.OS)||this.dce.setResolution(1920,1080),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"}),this.barcodeLineWidth=this._barcodeLineWidth,this.dce.on("cameraChange",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("resolutionChange",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("cameraClose",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1}),this.dce.on("singleFrameAcquired",async e=>{if(!e||!e.data)return;let i;this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:n,sx:o,sy:l,width:d,height:_,stride:S,pixelFormat:w,timeStamp:T,_sWidth:A,_sHeight:I}=e,k={timeStamp:T};if(w==="grey")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_GrayScaled,0,k);else if(w==="rgba")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ABGR_8888,0,k);else{if(w!=="bgra")throw new Error(`Pixel format '${w}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ARGB_8888,0,k)}if(await this.clearMapDecodeRecord(),j.recalculateResultLocation(i,o,l,A,I,d,_),this._drawResults(i),this.onFrameRead&&this.isOpen()&&!this._bPauseScan){let P=this._cloneDecodeResults(i);this.onFrameRead(P)}if(this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let P of i)this.onUniqueRead(P.barcodeText,this._cloneDecodeResults(P))}))}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}static async createInstance(e){let i=new zt;i._instanceID=await zt.createInstanceInWorker(!0),await i.createDCEInstance(),typeof e=="string"&&(e=JSON.parse(e));for(let n in e)i[n]=e[n];return await i.dce.setUIElement(zt.defaultUIElementURL),i.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),zt._fireHTTPSWarnning(),i.singleFrameMode||await i.updateRuntimeSettings("single"),i}async decodeCurrentFrame(e){this._assertOpen();let i=null;e&&e.region&&(i=e.region);const n=this.dce._getVideoData(null,{region:i});return this._decode_DCEFrame(n)}async updateRuntimeSettings(e){let i;if(typeof e=="string")if(e=="speed"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9}else if(e=="balance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=512,i.deblurLevel=3,i.localizationModes=[2,16,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="coverage"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=512,i.deblurLevel=5,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="single"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region)}else if(e=="dense"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.deblurLevel=7,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.minResultConfidence=0,i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="distance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else i=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let n=e.region;[n.regionLeft,n.regionTop,n.regionLeft,n.regionBottom,n.regionMeasuredByPercentage].some(o=>o!==void 0)&&(i.region={regionLeft:n.regionLeft||0,regionTop:n.regionTop||0,regionRight:n.regionRight||0,regionBottom:n.regionBottom||0,regionMeasuredByPercentage:n.regionMeasuredByPercentage||0})}}if(!j._bUseFullFeature){if(i.barcodeFormatIds&~(pt.BF_ONED|pt.BF_QR_CODE|pt.BF_PDF417|pt.BF_DATAMATRIX)||i.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(i.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let n=i.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(n)):this.userDefinedRegion=null,n instanceof Array)if(n.length){for(let o=0;o<n.length;++o){let l=n[o];l&&((l.regionLeft||l.regionTop||l.regionRight||l.regionBottom||l.regionMeasuredByPercentage)&&(l.regionLeft||l.regionTop||l.regionRight!=100||l.regionBottom!=100||!l.regionMeasuredByPercentage)||(n[o]=null))}this.region=n}else this.region=null;else n&&(n.regionLeft||n.regionTop||n.regionRight||n.regionBottom||n.regionMeasuredByPercentage)&&(n.regionLeft||n.regionTop||n.regionRight!=100||n.regionBottom!=100||!n.regionMeasuredByPercentage)?this.region=n:this.region=null;this.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}(this.autoZoom||this.autoFocus)&&(i.intermediateResultTypes|=wn.IRT_TYPED_BARCODE_ZONE),await new Promise((n,o)=>{let l=j._nextTaskID++;j._taskCallbackMap.set(l,d=>{if(d.success){try{this._handleRetJsonString(d.updateReturn)}catch(_){o(_)}return n()}{let _=new Error(d.message);return _.stack=d.stack+`
`+_.stack,o(_)}}),j._dbrWorker.postMessage({type:"updateRuntimeSettings",id:l,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})}),typeof e=="string"&&["speed","balance","coverage","dense","distance"].includes(e)&&(await this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","1"),await this.setModeArgument("BinarizationModes",0,"BlockSizeX","0"),await this.setModeArgument("BinarizationModes",0,"BlockSizeY","0"))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}async getAllCameras(){return this.dce.getAllCameras()}async getCurrentCamera(){return this.dce.getSelectedCamera()}async setCurrentCamera(e){const i=await this.dce.selectCamera(e);return this._fireResolutionWarning(),i}getResolution(){return this.dce.getResolution()}async setResolution(e,i){const n=await this.dce.setResolution(e,i);return this._fireResolutionWarning(),n}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}set ifSaveLastUsedCamera(e){this.dce&&(this.dce.ifSaveLastUsedCamera=e)}get ifSaveLastUsedCamera(){return this.dce&&this.dce.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){this.dce&&(this.dce.ifSkipCameraInspection=e)}get ifSkipCameraInspection(){return this.dce&&this.dce.ifSkipCameraInspection}stop(){this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.dce.stop(),this.dce.ifShowScanRegionLaser=!1,this.dce.hideViewDecorator(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}async play(e,i,n){this.dce.ifShowScanRegionLaser=!0;const o=await this.dce.play(e,i,n);return this._fireResolutionWarning(),o}pauseScan(e){this._assertOpen(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}async applyConstraints(e){return this.dce.applyConstraints(e)}async turnOnTorch(){return this.dce.turnOnTorch()}async turnOffTorch(){return this.dce.turnOffTorch()}async setColorTemperature(e){return this.dce.setColorTemperature(e)}getColorTemperature(){return this.dce.getColorTemperature()}async setExposureCompensation(e){return this.dce.setExposureCompensation(e)}getExposureCompensation(){return this.dce.getExposureCompensation()}async setZoom(e){return this.dce.setZoom(e)}getZoomSettings(){return this.dce.getZoomSettings()}resetZoom(){return this.dce.resetZoom()}async setFrameRate(e){return this.dce.setFrameRate(e)}getFrameRate(){return this.dce.getFrameRate()}async setFocus(e,i){return this.dce.setFocus(e,i)}getFocus(){return this.dce.getFocus()}getFocusSettings(){return this.dce.getFocusSettings()}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(!this.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return j._onLog&&j._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));j._onLog&&j._onLog("======= once read ======="),j._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return j._onLog&&j._onLog("Get invalid frame."),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{e._bUseWebGL||e.pixelFormat!=="grey"||(this.dce.framePixelFormat="rgba");let i=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:n,sx:o,sy:l,width:d,height:_,stride:S,pixelFormat:w,timeStamp:T,_sWidth:A,_sHeight:I}=e,k={timeStamp:T};if(w==="grey")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_GrayScaled,0,k);else if(w==="rgba")i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ABGR_8888,0,k);else{if(w!=="bgra")throw new Error(`Pixel format '${w}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,d,_,S,De.IPF_ARGB_8888,0,k)}if(j.recalculateResultLocation(i,o,l,A,I,d,_),this._resultHighlightingDuration==0?this._drawResults(null):this._drawResults(i),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout(()=>{this.bDestroyed||this._drawResults(null)},this._resultHighlightingDuration)),this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan&&(this.autoZoom||this.autoFocus||this.autoSuggestTip))if(i.length)this.autoZoomInFrameArray.length=0,this.autoZoomOutFrameCount=0,this.frameArrayInIdealZoom.length=0,this.suggestTipFrameArray.length=0,this.autoZoom&&this.autoFocus&&(this.nextActionInIdealZoom="focus"),this.autoFocusFrameArray.length=0,this.noIntermediateResultsCount=0;else{const P=await this.getIntermediateResults(),F=(R,M,$,ie,ne,q,y)=>{let pe=q/ie,fe=y/ne;R.x1=R.x1/pe+M,R.x2=R.x2/pe+M,R.x3=R.x3/pe+M,R.x4=R.x4/pe+M,R.y1=R.y1/fe+$,R.y2=R.y2/fe+$,R.y3=R.y3/fe+$,R.y4=R.y4/fe+$},z=R=>{if(!R)return null;const M={};let $,ie,ne,q,y;{const g=this.video.videoWidth*(1-this.autoZoomDetectionArea)/2,p=this.video.videoWidth*(1+this.autoZoomDetectionArea)/2,v=p,C=g,x=this.video.videoHeight*(1-this.autoZoomDetectionArea)/2,b=x,E=this.video.videoHeight*(1+this.autoZoomDetectionArea)/2;y={x1:g,x2:p,x3:v,x4:C,y1:x,y2:b,y3:E,y4:E}}const pe=(g,p)=>{const v=(x,b)=>{if(!x&&!b)throw new Error("Invalid arguments.");return function(E,O,L){let W=!1;const G=E.length;if(G<=2)return!1;for(let J=0;J<G;J++){const K=E[J],Y=E[(J+1)%G];if(Sm(K,Y,{x:O,y:L}))return!0;Ro(K.y-L)>0!=Ro(Y.y-L)>0&&Ro(O-(L-K.y)*(K.x-Y.x)/(K.y-Y.y)-K.x)<0&&(W=!W)}return W}([{x:b.x1,y:b.y1},{x:b.x2,y:b.y2},{x:b.x3,y:b.y3},{x:b.x4,y:b.y4}],x.x,x.y)},C=(x,b)=>!!(Vr([x[0],x[1]],[x[2],x[3]],[b.x1,b.y1],[b.x2,b.y2])||Vr([x[0],x[1]],[x[2],x[3]],[b.x2,b.y2],[b.x3,b.y3])||Vr([x[0],x[1]],[x[2],x[3]],[b.x3,b.y3],[b.x4,b.y4])||Vr([x[0],x[1]],[x[2],x[3]],[b.x4,b.y4],[b.x1,b.y1]));return!!(v({x:g.x1,y:g.y1},p)||v({x:g.x2,y:g.y2},p)||v({x:g.x3,y:g.y3},p)||v({x:g.x4,y:g.y4},p))||!!(v({x:p.x1,y:p.y1},g)||v({x:p.x2,y:p.y2},g)||v({x:p.x3,y:p.y3},g)||v({x:p.x4,y:p.y4},g))||!!(C([p.x1,p.y1,p.x2,p.y2],g)||C([p.x2,p.y2,p.x3,p.y3],g)||C([p.x3,p.y3,p.x4,p.y4],g)||C([p.x4,p.y4,p.x1,p.y1],g))},fe=[];for(let g of R){if(g.resultType!==wn.IRT_TYPED_BARCODE_ZONE)continue;const p=g.scaleDownRatio;for(let v of g.results){if(!v)continue;const C={x1:v.x1=v.x1*p,x2:v.x2=v.x2*p,x3:v.x3=v.x3*p,x4:v.x4=v.x4*p,y1:v.y1=v.y1*p,y2:v.y2=v.y2*p,y3:v.y4=v.y3*p,y4:v.y4=v.y4*p};F(C,o,l,A,I,d,_),pe(y,C)&&fe.push(v)}}const Ce=(g=>{if(!g||!g.length)return null;const p=b=>{const E=(b.x1+b.x2+b.x3+b.x4)/4,O=(b.y1+b.y2+b.y3+b.y4)/4;return(E-d/2)*(E-d/2)+(O-_/2)*(O-_/2)};let v,C=g.filter(b=>b.barcodeFormat==pt.BF_QR_CODE||b.barcodeFormat==pt.BF_DATAMATRIX);if(C.length||(C=g.filter(b=>b.barcodeFormat==pt.BF_ONED),C.length||(C=g)),!C.length)return null;v=C[0];let x=p(v);if(C.length!=1)for(let b=1;b<C.length;b++){const E=p(C[b]);(C[b].confidence>1.1*v.confidence||C[b].confidence>.9*v.confidence&&E<x)&&(v=C[b],x=E)}return v})(fe);if(!Ce)return null;const u=Ce.x1,a=Ce.x2,c=Ce.x3,f=Ce.x4,r=Ce.y1,s=Ce.y2,h=Ce.y3,m=Ce.y4;return $=Math.min(u,a,c,f),ie=Math.max(u,a,c,f),ne=Math.min(r,s,h,m),q=Math.max(r,s,h,m),M.x1=M.x4=$,M.x2=M.x3=ie,M.y1=M.y2=ne,M.y3=M.y4=q,M.result=Ce,M},D=z(P);if(D&&D.x1){if(this.autoZoomOutFrameCount=0,this.noIntermediateResultsCount=0,this.suggestTipFrameArray.push(!0),this.suggestTipFrameArray.splice(0,this.suggestTipFrameArray.length-this.suggestTipFrameLimit[0]),this.autoSuggestTip&&this.suggestTipFrameArray.filter(R=>R===!0).length>=this.suggestTipFrameLimit[1]){this.suggestTipFrameArray.length=0;const R=D.x3-D.x1,M=D.y3-D.y1;D.result.moduleSize<this.tinyBarcodeTipModuleSizeLimit?this.dce&&this.dce.suggestTip("tiny-barcode","Please zoom in or move closer."):R>M?R>d*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):R>.6*d&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."):R<=M&&(M>_*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):M>.6*_&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."))}if(this.autoZoom){const R=this.autoZoomIdealArea[1];let M=(1-this.autoZoomTargetBorder)/2;const $=D.x1/A,ie=(A-D.x3)/A,ne=D.y1/I,q=(I-D.y3)/I;if($>R&&ie>R&&ne>R&&q>R&&D.result.moduleSize<this.autoZoomInIdealModuleSize){if(this.autoZoomInFrameArray.push(!0),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.frameArrayInIdealZoom.length=0,this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(()=>{})),this.autoZoomInFrameArray.filter(y=>y===!0).length>=this.autoZoomInFrameLimit[1]){this.autoZoomInFrameArray.length=0;const y=[(.5-M)/(.5-$),(.5-M)/(.5-ie),(.5-M)/(.5-ne),(.5-M)/(.5-q)].filter(a=>a>0),pe=Math.min(...y,this.autoZoomInIdealModuleSize/D.result.moduleSize),fe=this.dce.getZoomSettings().factor;let Ce=Math.max(Math.pow(fe*pe,1/this.autoZoomInMaxTimes),this.autoZoomInMinStep);Ce=Math.min(Ce,pe);const u=fe*Ce;await this.setZoom({factor:u}),this.dce.clearFrameBuffer()}}else if(this.autoZoomInFrameArray.length=0,this.frameArrayInIdealZoom.push(!0),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.frameArrayInIdealZoom.filter(y=>y===!0).length>=this.frameLimitInIdealZoom[1])if(this.frameArrayInIdealZoom.length=0,this.nextActionInIdealZoom==="focus"&&this.autoFocus){F(D,o,l,A,I,d,_);try{await this.setFocus({mode:"manual",area:{centerPoint:{x:(D.x1+D.x3)/2+"px",y:(D.y1+D.y3)/2+"px"},width:D.x3-D.x1+"px",height:D.y3-D.y1+"px"}})}catch{}this.dce.clearFrameBuffer(),this.nextActionInIdealZoom="zoomOut"}else{if(this.nextActionInIdealZoom!=="zoomOut"&&this.autoFocus)throw new Error("Invalid action.");if(this.enableZoomOutInIdealZoom){M=this.autoZoomIdealArea[1]+this.autoZoomOutStepRate_2;const y=[(.5-M)/(.5-$),(.5-M)/(.5-ie),(.5-M)/(.5-ne),(.5-M)/(.5-q)].filter(fe=>fe>0);let pe=Math.min(...y)*this.dce.getZoomSettings().factor;await this.setZoom({factor:pe}),this.dce.clearFrameBuffer(),this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(fe=>{}))}}}else if(this.autoFocus&&(this.autoFocusFrameArray.push(!0),this.autoFocusFrameArray.splice(0,this.autoFocusFrameArray.length-this.autoFocusFrameLimit[0]),this.autoFocusFrameArray.filter(R=>R===!0).length>=this.autoFocusFrameLimit[1])){this.autoFocusFrameArray.length=0;try{F(D,o,l,A,I,d,_),await this.setFocus({mode:"manual",area:{centerPoint:{x:(D.x1+D.x3)/2+"px",y:(D.y1+D.y3)/2+"px"},width:D.x3-D.x1+"px",height:D.y3-D.y1+"px"}})}catch{}this.dce.clearFrameBuffer()}}else if(this.noIntermediateResultsCount++,this.suggestTipFrameArray.push(!1),this.autoZoom){if(this.autoZoomInFrameArray.push(!1),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.autoZoomOutFrameCount++,this.frameArrayInIdealZoom.push(!1),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.autoZoomOutFrameCount>=this.autoZoomOutFrameLimit){this.autoZoomOutFrameCount=0;const R=this.getZoomSettings().factor;if(R>this.autoZoomOutMinValue){const M=Math.max((R-1)*this.autoZoomOutStepRate,this.autoZoomOutMinStep),$=Math.max(R-M,this.autoZoomOutMinValue);await this.setZoom({factor:$}),this.dce.clearFrameBuffer()}}this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(R=>{}))}else this.autoFocus&&(this.autoFocusFrameArray.length=0,this.setFocus({mode:"continuous"}).catch(R=>{}))}return i})().then(i=>{if(j._onLog&&j._onLog(i),this.captureAndDecodeInParallel){let n=this.array_decodeFrameTimeCost,o=this.array_getFrameTimeCost,l=this._indexCurrentDecodingFrame;const d=()=>{let _=0;if(this.region instanceof Array){let S=0,w=0;S=l+1>=this.region.length?0:l+1,w=S+1>=this.region.length?0:S+1,_=n[S]&&n[S].length&&o[w]&&o[w].length?Math.min(...n[S])-Math.max(...o[w]):0}else if(o&&o.length){let S=Math.min(...n),w=Math.max(...o);S&&w&&(_=S-w)}else _=0;return _>0?_:0};(()=>{if(this.region instanceof Array){for(n[l]&&n[l]instanceof Array||(n[l]=[]);n[l].length>=5;)n[l].shift();n[l].push(this._lastInnerDecodeDuration)}else{for(;n.length>=5;)n.shift();n.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=d()+this.intervalTime,j._onLog&&j._onLog("Next fetching frame loop interval: "+this._intervalGetVideoFrame)}if(this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&i.length){let n=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?n=i.some(o=>o.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(n=i.some(o=>o.resultState==0)),n&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&i.length){let n=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?n=i.some(o=>o.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(n=i.some(o=>o.resultState==0)),n)try{navigator.vibrate(this.vibrateDuration)}catch(o){console.warn("Vibration not allowed. User interaction required: "+(o.message||o))}}if(this.onFrameRead){i=i.filter(o=>o.resultState>=0);const n=this._cloneDecodeResults(i);this.onFrameRead(n)}if(this.onUniqueRead){i=i.filter(o=>o.resultState==0);const n=this._cloneDecodeResults(i);for(let o of n)this.onUniqueRead(o.barcodeText,o)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){j._onLog&&j._onLog("Get frame in parallel.");let i=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,i||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;e=this.dce.getFrameFromBuffer(),(o=>{if(!o)return;let l=o.timeSpent,d=this.array_getFrameTimeCost;for(;d.length>=5;)d.shift();d.push(l)})(e)}else j._onLog&&j._onLog("Get frame in serial."),this.dce.stopFetchingLoop(),e=this.dce.getFrame();return e}async open(){this._bindUI();const e=await this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async openVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}close(){this.dce.close(),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}async show(){this._bindUI();const e=await this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async showVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}hide(){this.dce.close(!0),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}showTip(e,i,n,o,l=3e3,d=!0){this.dce&&this.dce.showTip(e,i,n,o,l,d)}hideTip(){this.dce&&this.dce.hideTip()}updateTipMessage(e){this.dce&&this.dce.updateTipMessage(e)}async enableTapToFocus(){this.dce&&this.dce.enableTapToFocus()}disableTapToFocus(){this.dce&&this.dce.disableTapToFocus()}isTapToFocusEnabled(){return this.dce.isTapToFocusEnabled()}destroyContext(){this.close(),this.dce&&this.dce.dispose(!1),this.bDestroyed||super.destroyContext()}}var tu,iu,nu,ru,su,ou,au,lu,cu,uu,hu,du,fu,gu,pu,mu,_u,vu,yu,Su,wu,Cu,xu,Tu,bu,Eu;(function(t){t[t.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",t[t.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",t[t.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",t[t.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",t[t.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",t[t.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",t[t.BICM_SKIP=0]="BICM_SKIP",t[t.BICM_REV=2147483648]="BICM_REV"})(tu||(tu={})),function(t){t[t.BCM_AUTO=1]="BCM_AUTO",t[t.BCM_GENERAL=2]="BCM_GENERAL",t[t.BCM_SKIP=0]="BCM_SKIP",t[t.BCM_REV=2147483648]="BCM_REV"}(iu||(iu={})),function(t){t[t.BF2_NULL=0]="BF2_NULL",t[t.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",t[t.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",t[t.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",t[t.BF2_POSTNET=2097152]="BF2_POSTNET",t[t.BF2_PLANET=4194304]="BF2_PLANET",t[t.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",t[t.BF2_RM4SCC=16777216]="BF2_RM4SCC",t[t.BF2_DOTCODE=2]="BF2_DOTCODE",t[t.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",t[t.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",t[t.BF2_PHARMACODE=12]="BF2_PHARMACODE",t[t.BF2_ALL=4294967295]="BF2_ALL"}(nu||(nu={})),function(t){t[t.BM_AUTO=1]="BM_AUTO",t[t.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",t[t.BM_SKIP=0]="BM_SKIP",t[t.BM_THRESHOLD=4]="BM_THRESHOLD",t[t.BM_REV=2147483648]="BM_REV"}(ru||(ru={})),function(t){t[t.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(su||(su={})),function(t){t[t.CFM_GENERAL=1]="CFM_GENERAL"}(ou||(ou={})),function(t){t[t.CCM_AUTO=1]="CCM_AUTO",t[t.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",t[t.CCM_SKIP=0]="CCM_SKIP",t[t.CCM_REV=2147483648]="CCM_REV"}(au||(au={})),function(t){t[t.CICM_GENERAL=1]="CICM_GENERAL",t[t.CICM_SKIP=0]="CICM_SKIP",t[t.CICM_REV=2147483648]="CICM_REV"}(lu||(lu={})),function(t){t[t.CM_IGNORE=1]="CM_IGNORE",t[t.CM_OVERWRITE=2]="CM_OVERWRITE"}(cu||(cu={})),function(t){t[t.DM_SKIP=0]="DM_SKIP",t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(uu||(uu={})),function(t){t[t.DRM_AUTO=1]="DRM_AUTO",t[t.DRM_GENERAL=2]="DRM_GENERAL",t[t.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",t[t.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",t[t.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",t[t.DRM_SKIP=0]="DRM_SKIP",t[t.DRM_REV=2147483648]="DRM_REV"}(hu||(hu={})),function(t){t[t.DPMCRM_AUTO=1]="DPMCRM_AUTO",t[t.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",t[t.DPMCRM_SKIP=0]="DPMCRM_SKIP",t[t.DPMCRM_REV=2147483648]="DPMCRM_REV"}(du||(du={})),function(t){t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_REV=2147483648]="GTM_REV"}(fu||(fu={})),function(t){t[t.IPM_AUTO=1]="IPM_AUTO",t[t.IPM_GENERAL=2]="IPM_GENERAL",t[t.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",t[t.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",t[t.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",t[t.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",t[t.IPM_SKIP=0]="IPM_SKIP",t[t.IPM_REV=2147483648]="IPM_REV"}(gu||(gu={})),function(t){t[t.IRSM_MEMORY=1]="IRSM_MEMORY",t[t.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",t[t.IRSM_BOTH=4]="IRSM_BOTH"}(pu||(pu={})),function(t){t[t.LM_SKIP=0]="LM_SKIP",t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=2147483648]="LM_REV"}(mu||(mu={})),function(t){t[t.PDFRM_RASTER=1]="PDFRM_RASTER",t[t.PDFRM_AUTO=2]="PDFRM_AUTO",t[t.PDFRM_VECTOR=4]="PDFRM_VECTOR",t[t.PDFRM_REV=2147483648]="PDFRM_REV"}(_u||(_u={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(vu||(vu={})),function(t){t[t.RPM_AUTO=1]="RPM_AUTO",t[t.RPM_GENERAL=2]="RPM_GENERAL",t[t.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",t[t.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",t[t.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",t[t.RPM_SKIP=0]="RPM_SKIP",t[t.RPM_REV=2147483648]="RPM_REV"}(yu||(yu={})),function(t){t[t.RCT_PIXEL=1]="RCT_PIXEL",t[t.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(Su||(Su={})),function(t){t[t.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",t[t.RT_RAW_TEXT=1]="RT_RAW_TEXT",t[t.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",t[t.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(wu||(wu={})),function(t){t[t.SUM_AUTO=1]="SUM_AUTO",t[t.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",t[t.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",t[t.SUM_SKIP=0]="SUM_SKIP",t[t.SUM_REV=2147483648]="SUM_REV"}(Cu||(Cu={})),function(t){t[t.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",t[t.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",t[t.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",t[t.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",t[t.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",t[t.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(xu||(xu={})),function(t){t[t.TFM_AUTO=1]="TFM_AUTO",t[t.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",t[t.TFM_SKIP=0]="TFM_SKIP",t[t.TFM_REV=2147483648]="TFM_REV"}(Tu||(Tu={})),function(t){t[t.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",t[t.TROM_POSITION=2]="TROM_POSITION",t[t.TROM_FORMAT=4]="TROM_FORMAT",t[t.TROM_SKIP=0]="TROM_SKIP",t[t.TROM_REV=2147483648]="TROM_REV"}(bu||(bu={})),function(t){t[t.TDM_AUTO=1]="TDM_AUTO",t[t.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",t[t.TDM_SKIP=0]="TDM_SKIP",t[t.TDM_REV=2147483648]="TDM_REV"}(Eu||(Eu={}));j.license="DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9";j.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.10/dist/";const Zd=!!navigator.onLine,Jd=_e.exports.createContext(Zd);function wm({children:t}){const[e,i]=_e.exports.useState(Zd),n=async()=>{try{if(!(await fetch(`/favicon.ico?d=${Date.now()}`)).ok)throw new Error("Network response was not ok");console.log("Internet connection available"),i(!0)}catch(l){i(!1),console.log("No Internet connection",l)}};_e.exports.useEffect(()=>{setInterval(async()=>{await n()},6e3)},[]);const o=_e.exports.useMemo(()=>e,[e]);return de(Jd.Provider,{value:o,children:t})}var Qd={exports:{}};(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var n=[],o=0;o<arguments.length;o++){var l=arguments[o];if(l){var d=typeof l;if(d==="string"||d==="number")n.push(l);else if(Array.isArray(l)){if(l.length){var _=i.apply(null,l);_&&n.push(_)}}else if(d==="object"){if(l.toString!==Object.prototype.toString&&!l.toString.toString().includes("[native code]")){n.push(l.toString());continue}for(var S in l)e.call(l,S)&&l[S]&&n.push(S)}}}return n.join(" ")}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(Qd);const Ve=Qd.exports,Cm=["as","disabled"];function xm(t,e){if(t==null)return{};var i={},n=Object.keys(t),o,l;for(l=0;l<n.length;l++)o=n[l],!(e.indexOf(o)>=0)&&(i[o]=t[o]);return i}function Tm(t){return!t||t.trim()==="#"}function qd({tagName:t,disabled:e,href:i,target:n,rel:o,role:l,onClick:d,tabIndex:_=0,type:S}){t||(i!=null||n!=null||o!=null?t="a":t="button");const w={tagName:t};if(t==="button")return[{type:S||"button",disabled:e},w];const T=I=>{if((e||t==="a"&&Tm(i))&&I.preventDefault(),e){I.stopPropagation();return}d==null||d(I)},A=I=>{I.key===" "&&(I.preventDefault(),T(I))};return t==="a"&&(i||(i="#"),e&&(i=void 0)),[{role:l??"button",disabled:void 0,tabIndex:e?void 0:_,href:i,target:t==="a"?n:void 0,"aria-disabled":e||void 0,rel:t==="a"?o:void 0,onClick:T,onKeyDown:A},w]}const bm=_e.exports.forwardRef((t,e)=>{let{as:i,disabled:n}=t,o=xm(t,Cm);const[l,{tagName:d}]=qd(Object.assign({tagName:i,disabled:n},o));return de(d,Object.assign({},o,l,{ref:e}))});bm.displayName="Button";const Em=["xxl","xl","lg","md","sm","xs"],Im="xs",Al=_e.exports.createContext({prefixes:{},breakpoints:Em,minBreakpoint:Im});function $e(t,e){const{prefixes:i}=_e.exports.useContext(Al);return t||i[e]||e}function Am(){const{breakpoints:t}=_e.exports.useContext(Al);return t}function Om(){const{minBreakpoint:t}=_e.exports.useContext(Al);return t}const Rm={variant:"primary",active:!1,disabled:!1},Ui=_e.exports.forwardRef(({as:t,bsPrefix:e,variant:i,size:n,active:o,className:l,...d},_)=>{const S=$e(e,"btn"),[w,{tagName:T}]=qd({tagName:t,...d});return de(T,{...w,...d,ref:_,className:Ve(l,S,o&&"active",i&&`${S}-${i}`,n&&`${S}-${n}`,d.href&&d.disabled&&"disabled")})});Ui.displayName="Button";Ui.defaultProps=Rm;const Iu="/barcode-scanner-pwa/images/back-button.png";function Dm({setBarcode:t,setShowScanner:e}){const[i,n]=_e.exports.useState(!1),o=_e.exports.useRef();return _e.exports.useEffect(()=>{let l=null;return(async()=>{try{const d=await(l=zt.createInstance());let _=await d.getRuntimeSettings();if(_.region.regionMeasuredByPercentage=1,_.region.regionLeft=20,_.region.regionTop=25,_.region.regionRight=80,_.region.regionBottom=75,d.isContextDestroyed()||(await d.setUIElement(o.current),d.isContextDestroyed()))return;d.onFrameRead=S=>{for(let w of S)console.log(w.barcodeText),t(w.barcodeText),e(!1)},i?(await d.close(),d.singleFrameMode=!0,await d.show()):(await d.open(),await d.updateRuntimeSettings(_))}catch(d){let _;d.message.includes("network connection error")?_="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":_=d.message||d,console.error(_),alert(_)}})(),async()=>{l&&((await l).destroyContext(),console.log("BarcodeScanner Component Unmount"))}},[i]),de("div",{ref:o,className:"video-container",children:Ye("div",{className:"div-ui-container",children:[de("svg",{className:"dce-bg-loading",viewBox:"0 0 1792 1792",children:de("path",{d:"M1760 896q0 176-68.5 336t-184 275.5-275.5 184-336 68.5-336-68.5-275.5-184-184-275.5-68.5-336q0-213 97-398.5t265-305.5 374-151v228q-221 45-366.5 221t-145.5 406q0 130 51 248.5t136.5 204 204 136.5 248.5 51 248.5-51 204-136.5 136.5-204 51-248.5q0-230-145.5-406t-366.5-221v-228q206 31 374 151t265 305.5 97 398.5z"})}),Ye("div",{className:"div-back-button",children:[Ye(Ui,{variant:"link",onClick:()=>e(!1),className:"back-btn d-flex justify-content-center align-items-center",children:[de("img",{alt:"logo",src:Iu,width:"12",height:"24"}),de("span",{children:"Back"})," "]}),Ye(Ui,{variant:"link",onClick:()=>n(!0),id:"btn-single-frame-mode",className:"back-btn d-flex justify-content-center align-items-center",children:[de("img",{alt:"logo",src:Iu,width:"12",height:"24"}),de("span",{children:"click me"})," "]}),Ye("div",{className:"div-select-container",children:[de("select",{className:"dce-sel-camera"}),de("select",{className:"dce-sel-resolution"})]})]}),de("div",{className:"dce-video-container"})]})})}var Fi={exports:{}},Mm="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",km=Mm,Lm=km;function ef(){}function tf(){}tf.resetWarningCache=ef;var Fm=function(){function t(n,o,l,d,_,S){if(S!==Lm){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}t.isRequired=t;function e(){return t}var i={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:tf,resetWarningCache:ef};return i.PropTypes=i,i};Fi.exports=Fm();const Pm={type:Fi.exports.string,tooltip:Fi.exports.bool,as:Fi.exports.elementType},Js=_e.exports.forwardRef(({as:t="div",className:e,type:i="valid",tooltip:n=!1,...o},l)=>de(t,{...o,ref:l,className:Ve(e,`${i}-${n?"tooltip":"feedback"}`)}));Js.displayName="Feedback";Js.propTypes=Pm;const ti=_e.exports.createContext({}),Ol=_e.exports.forwardRef(({id:t,bsPrefix:e,className:i,type:n="checkbox",isValid:o=!1,isInvalid:l=!1,as:d="input",..._},S)=>{const{controlId:w}=_e.exports.useContext(ti);return e=$e(e,"form-check-input"),de(d,{..._,ref:S,type:n,id:t||w,className:Ve(i,e,o&&"is-valid",l&&"is-invalid")})});Ol.displayName="FormCheckInput";const Rs=_e.exports.forwardRef(({bsPrefix:t,className:e,htmlFor:i,...n},o)=>{const{controlId:l}=_e.exports.useContext(ti);return t=$e(t,"form-check-label"),de("label",{...n,ref:o,htmlFor:i||l,className:Ve(e,t)})});Rs.displayName="FormCheckLabel";function Bm(t,e){return _e.exports.Children.toArray(t).some(i=>_e.exports.isValidElement(i)&&i.type===e)}const nf=_e.exports.forwardRef(({id:t,bsPrefix:e,bsSwitchPrefix:i,inline:n=!1,reverse:o=!1,disabled:l=!1,isValid:d=!1,isInvalid:_=!1,feedbackTooltip:S=!1,feedback:w,feedbackType:T,className:A,style:I,title:k="",type:P="checkbox",label:F,children:z,as:D="input",...R},M)=>{e=$e(e,"form-check"),i=$e(i,"form-switch");const{controlId:$}=_e.exports.useContext(ti),ie=_e.exports.useMemo(()=>({controlId:t||$}),[$,t]),ne=!z&&F!=null&&F!==!1||Bm(z,Rs),q=de(Ol,{...R,type:P==="switch"?"checkbox":P,ref:M,isValid:d,isInvalid:_,disabled:l,as:D});return de(ti.Provider,{value:ie,children:de("div",{style:I,className:Ve(A,ne&&e,n&&`${e}-inline`,o&&`${e}-reverse`,P==="switch"&&i),children:z||Ye(Pu,{children:[q,ne&&de(Rs,{title:k,children:F}),w&&de(Js,{type:T,tooltip:S,children:w})]})})})});nf.displayName="FormCheck";const Ds=Object.assign(nf,{Input:Ol,Label:Rs}),rf=_e.exports.forwardRef(({bsPrefix:t,type:e,size:i,htmlSize:n,id:o,className:l,isValid:d=!1,isInvalid:_=!1,plaintext:S,readOnly:w,as:T="input",...A},I)=>{const{controlId:k}=_e.exports.useContext(ti);t=$e(t,"form-control");let P;return S?P={[`${t}-plaintext`]:!0}:P={[t]:!0,[`${t}-${i}`]:i},de(T,{...A,type:e,size:n,ref:I,readOnly:w,id:o||k,className:Ve(l,P,d&&"is-valid",_&&"is-invalid",e==="color"&&`${t}-color`)})});rf.displayName="FormControl";const Nm=Object.assign(rf,{Feedback:Js});var jm=/-(.)/g;function Vm(t){return t.replace(jm,function(e,i){return i.toUpperCase()})}const Um=t=>t[0].toUpperCase()+Vm(t).slice(1);function Ti(t,{displayName:e=Um(t),Component:i,defaultProps:n}={}){const o=_e.exports.forwardRef(({className:l,bsPrefix:d,as:_=i||"div",...S},w)=>{const T=$e(d,t);return de(_,{ref:w,className:Ve(l,T),...S})});return o.defaultProps=n,o.displayName=e,o}const Wm=Ti("form-floating"),Rl=_e.exports.forwardRef(({controlId:t,as:e="div",...i},n)=>{const o=_e.exports.useMemo(()=>({controlId:t}),[t]);return de(ti.Provider,{value:o,children:de(e,{...i,ref:n})})});Rl.displayName="FormGroup";function Gm({as:t,bsPrefix:e,className:i,...n}){e=$e(e,"col");const o=Am(),l=Om(),d=[],_=[];return o.forEach(S=>{const w=n[S];delete n[S];let T,A,I;typeof w=="object"&&w!=null?{span:T,offset:A,order:I}=w:T=w;const k=S!==l?`-${S}`:"";T&&d.push(T===!0?`${e}${k}`:`${e}${k}-${T}`),I!=null&&_.push(`order${k}-${I}`),A!=null&&_.push(`offset${k}-${A}`)}),[{...n,className:Ve(i,...d,..._)},{as:t,bsPrefix:e,spans:d}]}const sf=_e.exports.forwardRef((t,e)=>{const[{className:i,...n},{as:o="div",bsPrefix:l,spans:d}]=Gm(t);return de(o,{...n,ref:e,className:Ve(i,!d.length&&l)})});sf.displayName="Col";const zm={column:!1,visuallyHidden:!1},Dl=_e.exports.forwardRef(({as:t="label",bsPrefix:e,column:i,visuallyHidden:n,className:o,htmlFor:l,...d},_)=>{const{controlId:S}=_e.exports.useContext(ti);e=$e(e,"form-label");let w="col-form-label";typeof i=="string"&&(w=`${w} ${w}-${i}`);const T=Ve(o,e,n&&"visually-hidden",i&&w);return l=l||S,i?de(sf,{ref:_,as:"label",className:T,htmlFor:l,...d}):de(t,{ref:_,className:T,htmlFor:l,...d})});Dl.displayName="FormLabel";Dl.defaultProps=zm;const of=_e.exports.forwardRef(({bsPrefix:t,className:e,id:i,...n},o)=>{const{controlId:l}=_e.exports.useContext(ti);return t=$e(t,"form-range"),de("input",{...n,type:"range",ref:o,className:Ve(e,t),id:i||l})});of.displayName="FormRange";const af=_e.exports.forwardRef(({bsPrefix:t,size:e,htmlSize:i,className:n,isValid:o=!1,isInvalid:l=!1,id:d,..._},S)=>{const{controlId:w}=_e.exports.useContext(ti);return t=$e(t,"form-select"),de("select",{..._,size:i,ref:S,className:Ve(n,t,e&&`${t}-${e}`,o&&"is-valid",l&&"is-invalid"),id:d||w})});af.displayName="FormSelect";const lf=_e.exports.forwardRef(({bsPrefix:t,className:e,as:i="small",muted:n,...o},l)=>(t=$e(t,"form-text"),de(i,{...o,ref:l,className:Ve(e,t,n&&"text-muted")})));lf.displayName="FormText";const cf=_e.exports.forwardRef((t,e)=>de(Ds,{...t,ref:e,type:"switch"}));cf.displayName="Switch";const Hm=Object.assign(cf,{Input:Ds.Input,Label:Ds.Label}),uf=_e.exports.forwardRef(({bsPrefix:t,className:e,children:i,controlId:n,label:o,...l},d)=>(t=$e(t,"form-floating"),Ye(Rl,{ref:d,className:Ve(e,t),controlId:n,...l,children:[i,de("label",{htmlFor:n,children:o})]})));uf.displayName="FloatingLabel";const Ym={_ref:Fi.exports.any,validated:Fi.exports.bool,as:Fi.exports.elementType},Ml=_e.exports.forwardRef(({className:t,validated:e,as:i="form",...n},o)=>de(i,{...n,ref:o,className:Ve(t,e&&"was-validated")}));Ml.displayName="Form";Ml.propTypes=Ym;const es=Object.assign(Ml,{Group:Rl,Control:Nm,Floating:Wm,Check:Ds,Switch:Hm,Label:Dl,Text:lf,Range:of,Select:af,FloatingLabel:uf}),Xm="/barcode-scanner-pwa/images/camera.png";function Do({barcode:t,setBarcode:e,showScanner:i,setShowScanner:n,ID:o,placeholder:l}){const d=_e.exports.useContext(Jd),_=T=>{e(T.target.value)},S=()=>{n(!0)},w=()=>{e(""),n(!1)};return _e.exports.useEffect(()=>{(async()=>{try{await j.loadWasm()}catch(T){let A;T.message.includes("network connection error")?A="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":A=T.message||T,console.error(A),alert(A)}})()},[]),Ye(Pu,{children:[Ye(es.Group,{children:[de(es.Label,{style:{fontWeight:"600",fontSize:"14px",lineHeight:"21px"},children:o}),Ye("div",{className:"d-flex gap-2 justify-content-center align-items-center my-1",children:[de(es.Control,{className:"d-flex justify-content-center align-items-center p-2",type:"text",value:t,onChange:_,placeholder:l,required:!0}),t?de(Ui,{onClick:w,variant:"danger",className:"d-flex justify-content-center align-items-center px-3 py-2",children:de("span",{children:"X"})}):Ye(Ui,{disabled:!d,onClick:S,className:"d-flex justify-content-center align-items-center",children:[" ",de("img",{alt:"logo",src:Xm,width:"20",height:"20",className:"m-1"})]})]})]}),i&&!t?de(Dm,{setBarcode:e,setShowScanner:n}):null]})}const hf=t=>_e.exports.forwardRef((e,i)=>de("div",{...e,ref:i,className:Ve(e.className,t)})),df=_e.exports.forwardRef(({bsPrefix:t,className:e,variant:i,as:n="img",...o},l)=>{const d=$e(t,"card-img");return de(n,{ref:l,className:Ve(i?`${d}-${i}`:d,e),...o})});df.displayName="CardImg";const ff=_e.exports.createContext(null);ff.displayName="CardHeaderContext";const gf=_e.exports.forwardRef(({bsPrefix:t,className:e,as:i="div",...n},o)=>{const l=$e(t,"card-header"),d=_e.exports.useMemo(()=>({cardHeaderBsPrefix:l}),[l]);return de(ff.Provider,{value:d,children:de(i,{ref:o,...n,className:Ve(e,l)})})});gf.displayName="CardHeader";const $m=hf("h5"),Km=hf("h6"),pf=Ti("card-body"),Zm=Ti("card-title",{Component:$m}),Jm=Ti("card-subtitle",{Component:Km}),Qm=Ti("card-link",{Component:"a"}),qm=Ti("card-text",{Component:"p"}),e_=Ti("card-footer"),t_=Ti("card-img-overlay"),i_={body:!1},kl=_e.exports.forwardRef(({bsPrefix:t,className:e,bg:i,text:n,border:o,body:l,children:d,as:_="div",...S},w)=>{const T=$e(t,"card");return de(_,{ref:w,...S,className:Ve(e,T,i&&`bg-${i}`,n&&`text-${n}`,o&&`border-${o}`),children:l?de(pf,{children:d}):d})});kl.displayName="Card";kl.defaultProps=i_;const Ms=Object.assign(kl,{Img:df,Title:Zm,Subtitle:Jm,Body:pf,Link:Qm,Text:qm,Header:gf,Footer:e_,ImgOverlay:t_});function n_(){const[t,e]=_e.exports.useState(!0),{roomID:i,assetID:n,tagID:o,setRoomID:l,setAssetID:d,setTagID:_}=_e.exports.useContext(Ud),{showRoomID:S,showAssetID:w,showTagID:T,setShowRoomID:A,setShowAssetID:I,setShowTagID:k}=_e.exports.useContext(Wd),P=F=>{F.preventDefault(),i&&n&&o?($c("01",{roomID:i,assetID:n,tagID:o}),A(!1),I(!1),k(!1),l(""),d(""),_("")):($c("01",{assetID:n,tagID:o}),A(!1),I(!1),k(!1),l(""),d(""),_(""))};return _e.exports.useEffect(()=>{e(!(n&&o))},[n,o]),de(Ms,{className:"border-0 shadow-none rounded-0",style:{width:"350px"},children:de(Ms.Body,{children:Ye(es,{action:"/",noValidate:!0,onSubmit:P,children:[de(Do,{barcode:i,setBarcode:l,showScanner:S,setShowScanner:A,ID:"Room-ID",placeholder:"4302 (Option)"}),de(Do,{barcode:n,setBarcode:d,showScanner:w,setShowScanner:I,ID:"Asset-ID",placeholder:"999 87456317AD"}),de(Do,{barcode:o,setBarcode:_,showScanner:T,setShowScanner:k,ID:"Tag-ID",placeholder:"999 87456317"}),de(Ui,{type:"submit",disabled:t&&!0,className:"mt-3 p-2",style:{width:"100%"},children:"Tag Asset"})]})})})}const r_={fluid:!1},Ll=_e.exports.forwardRef(({bsPrefix:t,fluid:e,as:i="div",className:n,...o},l)=>{const d=$e(t,"container"),_=typeof e=="string"?`-${e}`:"-fluid";return de(i,{ref:l,...o,className:Ve(n,e?`${d}${_}`:d)})});Ll.displayName="Container";Ll.defaultProps=r_;const s_=_e.exports.forwardRef(({bsPrefix:t,className:e,striped:i,bordered:n,borderless:o,hover:l,size:d,variant:_,responsive:S,...w},T)=>{const A=$e(t,"table"),I=Ve(e,A,_&&`${A}-${_}`,d&&`${A}-${d}`,i&&`${A}-${typeof i=="string"?`striped-${i}`:"striped"}`,n&&`${A}-bordered`,o&&`${A}-borderless`,l&&`${A}-hover`),k=de("table",{...w,className:I,ref:T});if(S){let P=`${A}-responsive`;return typeof S=="string"&&(P=`${P}-${S}`),de("div",{className:P,children:k})}return k}),o_="/barcode-scanner-pwa/images/searchTag.png",a_=()=>{const[t,e]=_e.exports.useState([]),i=async()=>{(await El).getAll("taggedList").then(o=>{e(o)})},n=()=>{qp("01")};return _e.exports.useEffect(()=>{i()},[t]),de(Ms,{className:"border-0 rounded-3 shadow m-2",style:{width:"350px",height:"228px"},children:de(Ms.Body,{children:t.length?de("div",{className:"d-flex justify-content-center align-items-center",children:Ye(s_,{className:"d-flex flex-column mx-3 table-sm",style:{fontSize:"12px",lineHeight:"18px"},children:[de("thead",{style:{width:"292px",fontWeight:"700"},children:Ye("tr",{className:"d-flex justify-content-between align-items-center px-1",children:[de("th",{children:"Asset ID"}),de("th",{children:"Tag ID"}),de("th",{children:"Synced"})]})}),de("tbody",{className:"border-0 rounded-3 shadow",style:{width:"292px",minHeight:"78px",fontWeight:"400",backgroundColor:"#E8ECFC"},children:t.map((o,l)=>Ye("tr",{className:"d-flex justify-content-between align-items-center p-1",children:[de("td",{children:o.assetID}),de("td",{children:o.tagID}),Ye("td",{children:[" ",de("span",{className:"btn btn-default btn-custom",style:{fontSize:"12px",lineHeight:"18px",fontWeight:"400"},onClick:n,children:"Yes"})]})]},l))})]})}):Ye("div",{className:"d-flex flex-column justify-content-center align-items-center",children:[de("img",{alt:"search tag",src:o_,width:"36.7",height:"37.7",className:"my-4 mx-auto"}),de("p",{className:"text-center",style:{width:"161px",fontSize:"12px",lineHeight:"18px"},children:"Scan an asset to begin popuplating this list."})]})})})};function l_(){return Ye(Ll,{style:{maxWidth:"390px",waxheight:"844px"},className:"d-flex flex-column justify-content-center align-items-center",children:[de(a_,{}),de(n_,{})]})}function c_(){return de(wm,{children:de(tm,{children:de(em,{children:de(l_,{})})})})}Mo.createRoot(document.getElementById("root")).render(de(kf.StrictMode,{children:de(c_,{})}));
